!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{var e={8424:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},r=function(e){try{return!!e()}catch(e){return!0}},i=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),o=i,a=Function.prototype,s=a.bind,c=a.call,l=o&&s.bind(c,c),d=o?function(e){return e&&l(e)}:function(e){return e&&function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),p=function(e){return e&&e.Math==Math&&e},h=p("object"==typeof globalThis&&globalThis)||p("object"==typeof window&&window)||p("object"==typeof self&&self)||p("object"==typeof t&&t)||function(){return this}()||Function("return this")(),f=i,m=Function.prototype,g=m.apply,v=m.call,_="object"==typeof Reflect&&Reflect.apply||(f?v.bind(g):function(){return v.apply(g,arguments)}),E=function(e){return"function"==typeof e},y={},w=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),b=i,S=Function.prototype.call,T=b?S.bind(S):function(){return S.apply(S,arguments)},C={},R={}.propertyIsEnumerable,I=Object.getOwnPropertyDescriptor,O=I&&!R.call({1:2},1);C.f=O?function(e){var t=I(this,e);return!!t&&t.enumerable}:R;var A,N,L=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},P=d,k=P({}.toString),D=P("".slice),x=function(e){return D(k(e),8,-1)},M=d,U=r,V=x,j=h.Object,B=M("".split),F=U((function(){return!j("z").propertyIsEnumerable(0)}))?function(e){return"String"==V(e)?B(e,""):j(e)}:j,G=h.TypeError,H=function(e){if(null==e)throw G("Can't call method on "+e);return e},W=F,K=H,q=function(e){return W(K(e))},Y=E,z=function(e){return"object"==typeof e?null!==e:Y(e)},J={},X=J,Q=h,Z=E,$=function(e){return Z(e)?e:void 0},ee=function(e,t){return arguments.length<2?$(X[e])||$(Q[e]):X[e]&&X[e][t]||Q[e]&&Q[e][t]},te=ee("navigator","userAgent")||"",ne=h,re=te,ie=ne.process,oe=ne.Deno,ae=ie&&ie.versions||oe&&oe.version,se=ae&&ae.v8;se&&(N=(A=se.split("."))[0]>0&&A[0]<4?1:+(A[0]+A[1])),!N&&re&&(!(A=re.match(/Edge\/(\d+)/))||A[1]>=74)&&(A=re.match(/Chrome\/(\d+)/))&&(N=+A[1]);var ce=N,le=ce,de=r,ue=!!Object.getOwnPropertySymbols&&!de((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&le&&le<41})),pe=ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,he=ee,fe=E,me=u,ge=pe,ve=h.Object,_e=ge?function(e){return"symbol"==typeof e}:function(e){var t=he("Symbol");return fe(t)&&me(t.prototype,ve(e))},Ee=h.String,ye=function(e){try{return Ee(e)}catch(e){return"Object"}},we=E,be=ye,Se=h.TypeError,Te=function(e){if(we(e))return e;throw Se(be(e)+" is not a function")},Ce=Te,Re=function(e,t){var n=e[t];return null==n?void 0:Ce(n)},Ie=T,Oe=E,Ae=z,Ne=h.TypeError,Le={exports:{}},Pe=h,ke=Object.defineProperty,De=function(e,t){try{ke(Pe,e,{value:t,configurable:!0,writable:!0})}catch(n){Pe[e]=t}return t},xe="__core-js_shared__",Me=h[xe]||De(xe,{}),Ue=Me;(Le.exports=function(e,t){return Ue[e]||(Ue[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Ve=H,je=h.Object,Be=function(e){return je(Ve(e))},Fe=Be,Ge=d({}.hasOwnProperty),He=Object.hasOwn||function(e,t){return Ge(Fe(e),t)},We=d,Ke=0,qe=Math.random(),Ye=We(1..toString),ze=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ye(++Ke+qe,36)},Je=h,Xe=Le.exports,Qe=He,Ze=ze,$e=ue,et=pe,tt=Xe("wks"),nt=Je.Symbol,rt=nt&&nt.for,it=et?nt:nt&&nt.withoutSetter||Ze,ot=function(e){if(!Qe(tt,e)||!$e&&"string"!=typeof tt[e]){var t="Symbol."+e;$e&&Qe(nt,e)?tt[e]=nt[e]:tt[e]=et&&rt?rt(t):it(t)}return tt[e]},at=T,st=z,ct=_e,lt=Re,dt=function(e,t){var n,r;if("string"===t&&Oe(n=e.toString)&&!Ae(r=Ie(n,e)))return r;if(Oe(n=e.valueOf)&&!Ae(r=Ie(n,e)))return r;if("string"!==t&&Oe(n=e.toString)&&!Ae(r=Ie(n,e)))return r;throw Ne("Can't convert object to primitive value")},ut=ot,pt=h.TypeError,ht=ut("toPrimitive"),ft=function(e,t){if(!st(e)||ct(e))return e;var n,r=lt(e,ht);if(r){if(void 0===t&&(t="default"),n=at(r,e,t),!st(n)||ct(n))return n;throw pt("Can't convert object to primitive value")}return void 0===t&&(t="number"),dt(e,t)},mt=_e,gt=function(e){var t=ft(e,"string");return mt(t)?t:t+""},vt=z,_t=h.document,Et=vt(_t)&&vt(_t.createElement),yt=function(e){return Et?_t.createElement(e):{}},wt=yt,bt=!w&&!r((function(){return 7!=Object.defineProperty(wt("div"),"a",{get:function(){return 7}}).a})),St=w,Tt=T,Ct=C,Rt=L,It=q,Ot=gt,At=He,Nt=bt,Lt=Object.getOwnPropertyDescriptor;y.f=St?Lt:function(e,t){if(e=It(e),t=Ot(t),Nt)try{return Lt(e,t)}catch(e){}if(At(e,t))return Rt(!Tt(Ct.f,e,t),e[t])};var Pt=r,kt=E,Dt=/#|\.prototype\./,xt=function(e,t){var n=Ut[Mt(e)];return n==jt||n!=Vt&&(kt(t)?Pt(t):!!t)},Mt=xt.normalize=function(e){return String(e).replace(Dt,".").toLowerCase()},Ut=xt.data={},Vt=xt.NATIVE="N",jt=xt.POLYFILL="P",Bt=xt,Ft=Te,Gt=i,Ht=d(d.bind),Wt=function(e,t){return Ft(e),void 0===t?e:Gt?Ht(e,t):function(){return e.apply(t,arguments)}},Kt={},qt=w&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Yt=h,zt=z,Jt=Yt.String,Xt=Yt.TypeError,Qt=function(e){if(zt(e))return e;throw Xt(Jt(e)+" is not an object")},Zt=w,$t=bt,en=qt,tn=Qt,nn=gt,rn=h.TypeError,on=Object.defineProperty,an=Object.getOwnPropertyDescriptor,sn="enumerable",cn="configurable",ln="writable";Kt.f=Zt?en?function(e,t,n){if(tn(e),t=nn(t),tn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&ln in n&&!n.writable){var r=an(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:cn in n?n.configurable:r.configurable,enumerable:sn in n?n.enumerable:r.enumerable,writable:!1})}return on(e,t,n)}:on:function(e,t,n){if(tn(e),t=nn(t),tn(n),$t)try{return on(e,t,n)}catch(e){}if("get"in n||"set"in n)throw rn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var dn=Kt,un=L,pn=w?function(e,t,n){return dn.f(e,t,un(1,n))}:function(e,t,n){return e[t]=n,e},hn=h,fn=_,mn=d,gn=E,vn=y.f,_n=Bt,En=J,yn=Wt,wn=pn,bn=He,Sn=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return fn(e,this,arguments)};return t.prototype=e.prototype,t},Tn=function(e,t){var n,r,i,o,a,s,c,l,d=e.target,u=e.global,p=e.stat,h=e.proto,f=u?hn:p?hn[d]:(hn[d]||{}).prototype,m=u?En:En[d]||wn(En,d,{})[d],g=m.prototype;for(i in t)n=!_n(u?i:d+(p?".":"#")+i,e.forced)&&f&&bn(f,i),a=m[i],n&&(s=e.noTargetGet?(l=vn(f,i))&&l.value:f[i]),o=n&&s?s:t[i],n&&typeof a==typeof o||(c=e.bind&&n?yn(o,hn):e.wrap&&n?Sn(o):h&&gn(o)?mn(o):o,(e.sham||o&&o.sham||a&&a.sham)&&wn(c,"sham",!0),wn(m,i,c),h&&(bn(En,r=d+"Prototype")||wn(En,r,{}),wn(En[r],i,o),e.real&&g&&!g[i]&&wn(g,i,o)))},Cn=Math.ceil,Rn=Math.floor,In=function(e){var t=+e;return t!=t||0===t?0:(t>0?Rn:Cn)(t)},On=In,An=Math.min,Nn=function(e){return e>0?An(On(e),9007199254740991):0},Ln=function(e){return Nn(e.length)},Pn=Te,kn=Be,Dn=F,xn=Ln,Mn=h.TypeError,Un=function(e){return function(t,n,r,i){Pn(n);var o=kn(t),a=Dn(o),s=xn(o),c=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=l;break}if(c+=l,e?c<0:s<=c)throw Mn("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=l)c in a&&(i=n(i,a[c],c,o));return i}},Vn={left:Un(!1),right:Un(!0)},jn=r,Bn=function(e,t){var n=[][e];return!!n&&jn((function(){n.call(null,t||function(){throw 1},1)}))},Fn="process"==x(h.process),Gn=Vn.left,Hn=ce,Wn=Fn;Tn({target:"Array",proto:!0,forced:!Bn("reduce")||!Wn&&Hn>79&&Hn<83},{reduce:function(e){var t=arguments.length;return Gn(this,e,t,t>1?arguments[1]:void 0)}});var Kn=J,qn=function(e){return Kn[e+"Prototype"]},Yn=qn("Array").reduce,zn=u,Jn=Yn,Xn=Array.prototype,Qn=function(e){var t=e.reduce;return e===Xn||zn(Xn,e)&&t===Xn.reduce?Jn:t},Zn=Qn;let $n=!0,er=!0;function tr(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function nr(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function rr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):($n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ir(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(er=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function or(){if("object"==typeof window){if($n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function ar(e,t){er&&console.warn(e+" is deprecated, please use "+t+" instead.")}function sr(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=tr(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=tr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=tr(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function cr(e){return"[object Object]"===Object.prototype.toString.call(e)}function lr(e){var t;return cr(e)?Zn(t=Object.keys(e)).call(t,(function(t,n){const r=cr(e[n]),i=r?lr(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function dr(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach((i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach((n=>{e(t,t.get(n),r)}))})))}(e,n,i)}))})),i}var ur=Le.exports,pr=ze,hr=ur("keys"),fr=function(e){return hr[e]||(hr[e]=pr(e))},mr=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),gr=h,vr=He,_r=E,Er=Be,yr=mr,wr=fr("IE_PROTO"),br=gr.Object,Sr=br.prototype,Tr=yr?br.getPrototypeOf:function(e){var t=Er(e);if(vr(t,wr))return t[wr];var n=t.constructor;return _r(n)&&t instanceof n?n.prototype:t instanceof br?Sr:null},Cr=h,Rr=E,Ir=Cr.String,Or=Cr.TypeError,Ar=d,Nr=Qt,Lr=function(e){if("object"==typeof e||Rr(e))return e;throw Or("Can't set "+Ir(e)+" as a prototype")},Pr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Ar(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Nr(n),Lr(r),t?e(n,r):n.__proto__=r,n}}():void 0),kr={},Dr=In,xr=Math.max,Mr=Math.min,Ur=function(e,t){var n=Dr(e);return n<0?xr(n+t,0):Mr(n,t)},Vr=q,jr=Ur,Br=Ln,Fr=function(e){return function(t,n,r){var i,o=Vr(t),a=Br(o),s=jr(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},Gr={includes:Fr(!0),indexOf:Fr(!1)},Hr={},Wr=He,Kr=q,qr=Gr.indexOf,Yr=Hr,zr=d([].push),Jr=function(e,t){var n,r=Kr(e),i=0,o=[];for(n in r)!Wr(Yr,n)&&Wr(r,n)&&zr(o,n);for(;t.length>i;)Wr(r,n=t[i++])&&(~qr(o,n)||zr(o,n));return o},Xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Qr=Jr,Zr=Xr.concat("length","prototype");kr.f=Object.getOwnPropertyNames||function(e){return Qr(e,Zr)};var $r={};$r.f=Object.getOwnPropertySymbols;var ei=ee,ti=kr,ni=$r,ri=Qt,ii=d([].concat),oi=ei("Reflect","ownKeys")||function(e){var t=ti.f(ri(e)),n=ni.f;return n?ii(t,n(e)):t},ai=He,si=oi,ci=y,li=Kt,di={},ui=Jr,pi=Xr,hi=Object.keys||function(e){return ui(e,pi)},fi=w,mi=qt,gi=Kt,vi=Qt,_i=q,Ei=hi;di.f=fi&&!mi?Object.defineProperties:function(e,t){vi(e);for(var n,r=_i(t),i=Ei(t),o=i.length,a=0;o>a;)gi.f(e,n=i[a++],r[n]);return e};var yi,wi=ee("document","documentElement"),bi=Qt,Si=di,Ti=Xr,Ci=Hr,Ri=wi,Ii=yt,Oi=fr("IE_PROTO"),Ai=function(){},Ni=function(e){return"<script>"+e+"<\/script>"},Li=function(e){e.write(Ni("")),e.close();var t=e.parentWindow.Object;return e=null,t},Pi=function(){try{yi=new ActiveXObject("htmlfile")}catch(e){}var e,t;Pi="undefined"!=typeof document?document.domain&&yi?Li(yi):((t=Ii("iframe")).style.display="none",Ri.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ni("document.F=Object")),e.close(),e.F):Li(yi);for(var n=Ti.length;n--;)delete Pi.prototype[Ti[n]];return Pi()};Ci[Oi]=!0;var ki=Object.create||function(e,t){var n;return null!==e?(Ai.prototype=bi(e),n=new Ai,Ai.prototype=null,n[Oi]=e):n=Pi(),void 0===t?n:Si.f(n,t)},Di=d("".replace),xi=String(Error("zxcasd").stack),Mi=/\n\s*at [^:]*:[^\n]*/,Ui=Mi.test(xi),Vi=z,ji=pn,Bi={},Fi=Bi,Gi=ot("iterator"),Hi=Array.prototype,Wi={};Wi[ot("toStringTag")]="z";var Ki="[object z]"===String(Wi),qi=h,Yi=Ki,zi=E,Ji=x,Xi=ot("toStringTag"),Qi=qi.Object,Zi="Arguments"==Ji(function(){return arguments}()),$i=Yi?Ji:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Qi(e),Xi))?n:Zi?Ji(t):"Object"==(r=Ji(t))&&zi(t.callee)?"Arguments":r},eo=$i,to=Re,no=Bi,ro=ot("iterator"),io=function(e){if(null!=e)return to(e,ro)||to(e,"@@iterator")||no[eo(e)]},oo=T,ao=Te,so=Qt,co=ye,lo=io,uo=h.TypeError,po=T,ho=Qt,fo=Re,mo=Wt,go=T,vo=Qt,_o=ye,Eo=function(e){return void 0!==e&&(Fi.Array===e||Hi[Gi]===e)},yo=Ln,wo=u,bo=function(e,t){var n=arguments.length<2?lo(e):t;if(ao(n))return so(oo(n,e));throw uo(co(e)+" is not iterable")},So=io,To=function(e,t,n){var r,i;ho(e);try{if(!(r=fo(e,"return"))){if("throw"===t)throw n;return n}r=po(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return ho(r),n},Co=h.TypeError,Ro=function(e,t){this.stopped=e,this.result=t},Io=Ro.prototype,Oo=function(e,t,n){var r,i,o,a,s,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),f=mo(t,d),m=function(e){return r&&To(r,"normal",e),new Ro(!0,e)},g=function(e){return u?(vo(e),h?f(e[0],e[1],m):f(e[0],e[1])):h?f(e,m):f(e)};if(p)r=e;else{if(!(i=So(e)))throw Co(_o(e)+" is not iterable");if(Eo(i)){for(o=0,a=yo(e);a>o;o++)if((s=g(e[o]))&&wo(Io,s))return s;return new Ro(!1)}r=bo(e,i)}for(c=r.next;!(l=go(c,r)).done;){try{s=g(l.value)}catch(e){To(r,"throw",e)}if("object"==typeof s&&s&&wo(Io,s))return s}return new Ro(!1)},Ao=$i,No=h.String,Lo=function(e){if("Symbol"===Ao(e))throw TypeError("Cannot convert a Symbol value to a string");return No(e)},Po=Lo,ko=L,Do=!r((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",ko(1,7)),7!==e.stack)})),xo=Tn,Mo=h,Uo=u,Vo=Tr,jo=Pr,Bo=function(e,t,n){for(var r=si(t),i=li.f,o=ci.f,a=0;a<r.length;a++){var s=r[a];ai(e,s)||n&&ai(n,s)||i(e,s,o(t,s))}},Fo=ki,Go=pn,Ho=L,Wo=function(e,t){if(Ui&&"string"==typeof e)for(;t--;)e=Di(e,Mi,"");return e},Ko=function(e,t){Vi(t)&&"cause"in t&&ji(e,"cause",t.cause)},qo=Oo,Yo=function(e,t){return void 0===e?arguments.length<2?"":t:Po(e)},zo=Do,Jo=ot("toStringTag"),Xo=Mo.Error,Qo=[].push,Zo=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,i=Uo($o,this);jo?n=jo(new Xo,i?Vo(this):$o):(n=i?this:Fo($o),Go(n,Jo,"Error")),void 0!==t&&Go(n,"message",Yo(t)),zo&&Go(n,"stack",Wo(n.stack,1)),Ko(n,r);var o=[];return qo(e,Qo,{that:o}),Go(n,"errors",o),n};jo?jo(Zo,Xo):Bo(Zo,Xo,{name:!0});var $o=Zo.prototype=Fo(Xo.prototype,{constructor:Ho(1,Zo),message:Ho(1,""),name:Ho(1,"AggregateError")});xo({global:!0},{AggregateError:Zo});var ea=E,ta=Me,na=d(Function.toString);ea(ta.inspectSource)||(ta.inspectSource=function(e){return na(e)});var ra,ia,oa,aa=ta.inspectSource,sa=E,ca=aa,la=h.WeakMap,da=sa(la)&&/native code/.test(ca(la)),ua=h,pa=d,ha=z,fa=pn,ma=He,ga=Me,va=fr,_a=Hr,Ea="Object already initialized",ya=ua.TypeError,wa=ua.WeakMap;if(da||ga.state){var ba=ga.state||(ga.state=new wa),Sa=pa(ba.get),Ta=pa(ba.has),Ca=pa(ba.set);ra=function(e,t){if(Ta(ba,e))throw new ya(Ea);return t.facade=e,Ca(ba,e,t),t},ia=function(e){return Sa(ba,e)||{}},oa=function(e){return Ta(ba,e)}}else{var Ra=va("state");_a[Ra]=!0,ra=function(e,t){if(ma(e,Ra))throw new ya(Ea);return t.facade=e,fa(e,Ra,t),t},ia=function(e){return ma(e,Ra)?e[Ra]:{}},oa=function(e){return ma(e,Ra)}}var Ia,Oa,Aa,Na={set:ra,get:ia,has:oa,enforce:function(e){return oa(e)?ia(e):ra(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=ia(t)).type!==e)throw ya("Incompatible receiver, "+e+" required");return n}}},La=w,Pa=He,ka=Function.prototype,Da=La&&Object.getOwnPropertyDescriptor,xa=Pa(ka,"name"),Ma={EXISTS:xa,PROPER:xa&&"something"===function(){}.name,CONFIGURABLE:xa&&(!La||La&&Da(ka,"name").configurable)},Ua=pn,Va=function(e,t,n,r){r&&r.enumerable?e[t]=n:Ua(e,t,n)},ja=r,Ba=E,Fa=ki,Ga=Tr,Ha=Va,Wa=ot("iterator"),Ka=!1;[].keys&&("next"in(Aa=[].keys())?(Oa=Ga(Ga(Aa)))!==Object.prototype&&(Ia=Oa):Ka=!0);var qa=null==Ia||ja((function(){var e={};return Ia[Wa].call(e)!==e}));Ba((Ia=qa?{}:Fa(Ia))[Wa])||Ha(Ia,Wa,(function(){return this}));var Ya={IteratorPrototype:Ia,BUGGY_SAFARI_ITERATORS:Ka},za=$i,Ja=Ki?{}.toString:function(){return"[object "+za(this)+"]"},Xa=Ki,Qa=Kt.f,Za=pn,$a=He,es=Ja,ts=ot("toStringTag"),ns=function(e,t,n,r){if(e){var i=n?e:e.prototype;$a(i,ts)||Qa(i,ts,{configurable:!0,value:t}),r&&!Xa&&Za(i,"toString",es)}},rs=Ya.IteratorPrototype,is=ki,os=L,as=ns,ss=Bi,cs=function(){return this},ls=Tn,ds=T,us=function(e,t,n,r){var i=t+" Iterator";return e.prototype=is(rs,{next:os(+!r,n)}),as(e,i,!1,!0),ss[i]=cs,e},ps=Tr,hs=ns,fs=Va,ms=Bi,gs=Ma.PROPER,vs=Ya.BUGGY_SAFARI_ITERATORS,_s=ot("iterator"),Es="keys",ys="values",ws="entries",bs=function(){return this},Ss=function(e,t,n,r,i,o,a){us(n,t,r);var s,c,l,d=function(e){if(e===i&&m)return m;if(!vs&&e in h)return h[e];switch(e){case Es:case ys:case ws:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",p=!1,h=e.prototype,f=h[_s]||h["@@iterator"]||i&&h[i],m=!vs&&f||d(i),g="Array"==t&&h.entries||f;if(g&&(s=ps(g.call(new e)))!==Object.prototype&&s.next&&(hs(s,u,!0,!0),ms[u]=bs),gs&&i==ys&&f&&f.name!==ys&&(p=!0,m=function(){return ds(f,this)}),i)if(c={values:d(ys),keys:o?m:d(Es),entries:d(ws)},a)for(l in c)(vs||p||!(l in h))&&fs(h,l,c[l]);else ls({target:t,proto:!0,forced:vs||p},c);return a&&h[_s]!==m&&fs(h,_s,m,{name:i}),ms[t]=m,c},Ts=q,Cs=Bi,Rs=Na;Kt.f;var Is=Ss,Os="Array Iterator",As=Rs.set,Ns=Rs.getterFor(Os);Is(Array,"Array",(function(e,t){As(this,{type:Os,target:Ts(e),index:0,kind:t})}),(function(){var e=Ns(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),Cs.Arguments=Cs.Array;var Ls=h.Promise,Ps=Va,ks=ee,Ds=Kt,xs=w,Ms=ot("species"),Us=u,Vs=h.TypeError,js=ot("iterator"),Bs=!1;try{var Fs=0,Gs={next:function(){return{done:!!Fs++}},return:function(){Bs=!0}};Gs[js]=function(){return this},Array.from(Gs,(function(){throw 2}))}catch(e){}var Hs=d,Ws=r,Ks=E,qs=$i,Ys=aa,zs=function(){},Js=[],Xs=ee("Reflect","construct"),Qs=/^\s*(?:class|function)\b/,Zs=Hs(Qs.exec),$s=!Qs.exec(zs),ec=function(e){if(!Ks(e))return!1;try{return Xs(zs,Js,e),!0}catch(e){return!1}},tc=function(e){if(!Ks(e))return!1;switch(qs(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return $s||!!Zs(Qs,Ys(e))}catch(e){return!0}};tc.sham=!0;var nc,rc,ic,oc,ac=!Xs||Ws((function(){var e;return ec(ec.call)||!ec(Object)||!ec((function(){e=!0}))||e}))?tc:ec,sc=ac,cc=ye,lc=h.TypeError,dc=Qt,uc=function(e){if(sc(e))return e;throw lc(cc(e)+" is not a constructor")},pc=ot("species"),hc=function(e,t){var n,r=dc(e).constructor;return void 0===r||null==(n=dc(r)[pc])?t:uc(n)},fc=d([].slice),mc=/(?:ipad|iphone|ipod).*applewebkit/i.test(te),gc=h,vc=_,_c=Wt,Ec=E,yc=He,wc=r,bc=wi,Sc=fc,Tc=yt,Cc=mc,Rc=Fn,Ic=gc.setImmediate,Oc=gc.clearImmediate,Ac=gc.process,Nc=gc.Dispatch,Lc=gc.Function,Pc=gc.MessageChannel,kc=gc.String,Dc=0,xc={},Mc="onreadystatechange";try{nc=gc.location}catch(e){}var Uc=function(e){if(yc(xc,e)){var t=xc[e];delete xc[e],t()}},Vc=function(e){return function(){Uc(e)}},jc=function(e){Uc(e.data)},Bc=function(e){gc.postMessage(kc(e),nc.protocol+"//"+nc.host)};Ic&&Oc||(Ic=function(e){var t=Sc(arguments,1);return xc[++Dc]=function(){vc(Ec(e)?e:Lc(e),void 0,t)},rc(Dc),Dc},Oc=function(e){delete xc[e]},Rc?rc=function(e){Ac.nextTick(Vc(e))}:Nc&&Nc.now?rc=function(e){Nc.now(Vc(e))}:Pc&&!Cc?(oc=(ic=new Pc).port2,ic.port1.onmessage=jc,rc=_c(oc.postMessage,oc)):gc.addEventListener&&Ec(gc.postMessage)&&!gc.importScripts&&nc&&"file:"!==nc.protocol&&!wc(Bc)?(rc=Bc,gc.addEventListener("message",jc,!1)):rc=Mc in Tc("script")?function(e){bc.appendChild(Tc("script")).onreadystatechange=function(){bc.removeChild(this),Uc(e)}}:function(e){setTimeout(Vc(e),0)});var Fc,Gc,Hc,Wc,Kc,qc,Yc,zc,Jc={set:Ic,clear:Oc},Xc=h,Qc=/ipad|iphone|ipod/i.test(te)&&void 0!==Xc.Pebble,Zc=/web0s(?!.*chrome)/i.test(te),$c=h,el=Wt,tl=y.f,nl=Jc.set,rl=mc,il=Qc,ol=Zc,al=Fn,sl=$c.MutationObserver||$c.WebKitMutationObserver,cl=$c.document,ll=$c.process,dl=$c.Promise,ul=tl($c,"queueMicrotask"),pl=ul&&ul.value;pl||(Fc=function(){var e,t;for(al&&(e=ll.domain)&&e.exit();Gc;){t=Gc.fn,Gc=Gc.next;try{t()}catch(e){throw Gc?Wc():Hc=void 0,e}}Hc=void 0,e&&e.enter()},rl||al||ol||!sl||!cl?!il&&dl&&dl.resolve?((Yc=dl.resolve(void 0)).constructor=dl,zc=el(Yc.then,Yc),Wc=function(){zc(Fc)}):al?Wc=function(){ll.nextTick(Fc)}:(nl=el(nl,$c),Wc=function(){nl(Fc)}):(Kc=!0,qc=cl.createTextNode(""),new sl(Fc).observe(qc,{characterData:!0}),Wc=function(){qc.data=Kc=!Kc}));var hl=pl||function(e){var t={fn:e,next:void 0};Hc&&(Hc.next=t),Gc||(Gc=t,Wc()),Hc=t},fl={},ml=Te,gl=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=ml(t),this.reject=ml(n)};fl.f=function(e){return new gl(e)};var vl=Qt,_l=z,El=fl,yl=function(e,t){if(vl(e),_l(t)&&t.constructor===e)return t;var n=El.f(e);return(0,n.resolve)(t),n.promise},wl=h,bl=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Sl=function(){this.head=null,this.tail=null};Sl.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var Tl,Cl,Rl,Il="object"==typeof window,Ol=Tn,Al=h,Nl=ee,Ll=T,Pl=Ls,kl=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:Ps(e,r,t[r],n);return e},Dl=ns,xl=function(e){var t=ks(e),n=Ds.f;xs&&t&&!t[Ms]&&n(t,Ms,{configurable:!0,get:function(){return this}})},Ml=Te,Ul=E,Vl=z,jl=function(e,t){if(Us(t,e))return e;throw Vs("Incorrect invocation")},Bl=aa,Fl=Oo,Gl=function(e,t){if(!t&&!Bs)return!1;var n=!1;try{var r={};r[js]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Hl=hc,Wl=Jc.set,Kl=hl,ql=yl,Yl=function(e,t){var n=wl.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))},zl=fl,Jl=bl,Xl=Sl,Ql=Na,Zl=Bt,$l=Il,ed=Fn,td=ce,nd=ot("species"),rd="Promise",id=Ql.getterFor(rd),od=Ql.set,ad=Ql.getterFor(rd),sd=Pl&&Pl.prototype,cd=Pl,ld=sd,dd=Al.TypeError,ud=Al.document,pd=Al.process,hd=zl.f,fd=hd,md=!!(ud&&ud.createEvent&&Al.dispatchEvent),gd=Ul(Al.PromiseRejectionEvent),vd="unhandledrejection",_d=Zl(rd,(function(){var e=Bl(cd),t=e!==String(cd);if(!t&&66===td)return!0;if(!ld.finally)return!0;if(td>=51&&/native code/.test(e))return!1;var n=new cd((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[nd]=r,!(n.then((function(){}))instanceof r)||!t&&$l&&!gd})),Ed=_d||!Gl((function(e){cd.all(e).catch((function(){}))})),yd=function(e){var t;return!(!Vl(e)||!Ul(t=e.then))&&t},wd=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Rd(t),t.rejection=1),!0===s?n=o:(d&&d.enter(),n=s(o),d&&(d.exit(),i=!0)),n===e.promise?l(dd("Promise-chain cycle")):(r=yd(n))?Ll(r,n,c,l):c(n)):l(o)}catch(e){d&&!i&&d.exit(),l(e)}},bd=function(e,t){e.notified||(e.notified=!0,Kl((function(){for(var n,r=e.reactions;n=r.get();)wd(n,e);e.notified=!1,t&&!e.rejection&&Td(e)})))},Sd=function(e,t,n){var r,i;md?((r=ud.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Al.dispatchEvent(r)):r={promise:t,reason:n},!gd&&(i=Al["on"+e])?i(r):e===vd&&Yl("Unhandled promise rejection",n)},Td=function(e){Ll(Wl,Al,(function(){var t,n=e.facade,r=e.value;if(Cd(e)&&(t=Jl((function(){ed?pd.emit("unhandledRejection",r,n):Sd(vd,n,r)})),e.rejection=ed||Cd(e)?2:1,t.error))throw t.value}))},Cd=function(e){return 1!==e.rejection&&!e.parent},Rd=function(e){Ll(Wl,Al,(function(){var t=e.facade;ed?pd.emit("rejectionHandled",t):Sd("rejectionhandled",t,e.value)}))},Id=function(e,t,n){return function(r){e(t,r,n)}},Od=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,bd(e,!0))},Ad=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw dd("Promise can't be resolved itself");var r=yd(t);r?Kl((function(){var n={done:!1};try{Ll(r,t,Id(Ad,n,e),Id(Od,n,e))}catch(t){Od(n,t,e)}})):(e.value=t,e.state=1,bd(e,!1))}catch(t){Od({done:!1},t,e)}}};_d&&(ld=(cd=function(e){jl(this,ld),Ml(e),Ll(Tl,this);var t=id(this);try{e(Id(Ad,t),Id(Od,t))}catch(e){Od(t,e)}}).prototype,(Tl=function(e){od(this,{type:rd,done:!1,notified:!1,parent:!1,reactions:new Xl,rejection:!1,state:0,value:void 0})}).prototype=kl(ld,{then:function(e,t){var n=ad(this),r=hd(Hl(this,cd));return n.parent=!0,r.ok=!Ul(e)||e,r.fail=Ul(t)&&t,r.domain=ed?pd.domain:void 0,0==n.state?n.reactions.add(r):Kl((function(){wd(r,n)})),r.promise},catch:function(e){return this.then(void 0,e)}}),Cl=function(){var e=new Tl,t=id(e);this.promise=e,this.resolve=Id(Ad,t),this.reject=Id(Od,t)},zl.f=hd=function(e){return e===cd||e===Rl?new Cl(e):fd(e)}),Ol({global:!0,wrap:!0,forced:_d},{Promise:cd}),Dl(cd,rd,!1,!0),xl(rd),Rl=Nl(rd),Ol({target:rd,stat:!0,forced:_d},{reject:function(e){var t=hd(this);return Ll(t.reject,void 0,e),t.promise}}),Ol({target:rd,stat:!0,forced:!0},{resolve:function(e){return ql(this===Rl?cd:this,e)}}),Ol({target:rd,stat:!0,forced:Ed},{all:function(e){var t=this,n=hd(t),r=n.resolve,i=n.reject,o=Jl((function(){var n=Ml(t.resolve),o=[],a=0,s=1;Fl(e,(function(e){var c=a++,l=!1;s++,Ll(n,t,e).then((function(e){l||(l=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=hd(t),r=n.reject,i=Jl((function(){var i=Ml(t.resolve);Fl(e,(function(e){Ll(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Nd=T,Ld=Te,Pd=fl,kd=bl,Dd=Oo;Tn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=Pd.f(t),r=n.resolve,i=n.reject,o=kd((function(){var n=Ld(t.resolve),i=[],o=0,a=1;Dd(e,(function(e){var s=o++,c=!1;a++,Nd(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}});var xd=Te,Md=ee,Ud=T,Vd=fl,jd=bl,Bd=Oo,Fd="No one promise resolved";Tn({target:"Promise",stat:!0},{any:function(e){var t=this,n=Md("AggregateError"),r=Vd.f(t),i=r.resolve,o=r.reject,a=jd((function(){var r=xd(t.resolve),a=[],s=0,c=1,l=!1;Bd(e,(function(e){var d=s++,u=!1;c++,Ud(r,t,e).then((function(e){u||l||(l=!0,i(e))}),(function(e){u||l||(u=!0,a[d]=e,--c||o(new n(a,Fd)))}))})),--c||o(new n(a,Fd))}));return a.error&&o(a.value),r.promise}});var Gd=Ls,Hd=ee,Wd=E,Kd=hc,qd=yl;Tn({target:"Promise",proto:!0,real:!0,forced:!!Gd&&r((function(){Gd.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Kd(this,Hd("Promise")),n=Wd(e);return this.then(n?function(n){return qd(t,e()).then((function(){return n}))}:e,n?function(n){return qd(t,e()).then((function(){throw n}))}:e)}});var Yd=d,zd=In,Jd=Lo,Xd=H,Qd=Yd("".charAt),Zd=Yd("".charCodeAt),$d=Yd("".slice),eu=function(e){return function(t,n){var r,i,o=Jd(Xd(t)),a=zd(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=Zd(o,a))<55296||r>56319||a+1===s||(i=Zd(o,a+1))<56320||i>57343?e?Qd(o,a):r:e?$d(o,a,a+2):i-56320+(r-55296<<10)+65536}},tu=(eu(!1),eu(!0)),nu=Lo,ru=Na,iu=Ss,ou="String Iterator",au=ru.set,su=ru.getterFor(ou);iu(String,"String",(function(e){au(this,{type:ou,string:nu(e),index:0})}),(function(){var e,t=su(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=tu(n,r),t.index+=e.length,{value:e,done:!1})}));var cu=J.Promise,lu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},du=h,uu=$i,pu=pn,hu=Bi,fu=ot("toStringTag");for(var mu in lu){var gu=du[mu],vu=gu&&gu.prototype;vu&&uu(vu)!==fu&&pu(vu,fu,mu),hu[mu]=hu.Array}var _u=cu,Eu=_u;const yu=or;function wu(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),yu("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return yu("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Eu.reject(o(e))))))}}}function bu(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Su(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else nr(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Tu(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Cu(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Eu(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function Ru(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>dr(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),nr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>dr(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Eu.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Eu.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Iu(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function Ou(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Iu(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Eu.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Au(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Nu(e,t){nr(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Lu=Object.freeze({__proto__:null,shimMediaStream:bu,shimOnTrack:Su,shimGetSendersWithDtmf:Tu,shimGetStats:Cu,shimSenderReceiverGetStats:Ru,shimAddTrackRemoveTrackWithNative:Iu,shimAddTrackRemoveTrack:Ou,shimPeerConnection:Au,fixNegotiationNeeded:Nu,shimGetUserMedia:wu,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function Pu(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){ar("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function ku(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Du(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function xu(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Eu.resolve(new Map)}}function Mu(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),nr(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Uu(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){ar("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Vu(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ju(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function Bu(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Fu(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Eu.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Gu(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Eu.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Hu=Object.freeze({__proto__:null,shimOnTrack:ku,shimPeerConnection:Du,shimSenderGetStats:xu,shimReceiverGetStats:Mu,shimRemoveStream:Uu,shimRTCDataChannel:Vu,shimAddTransceiver:ju,shimGetParameters:Bu,shimCreateOffer:Fu,shimCreateAnswer:Gu,shimGetUserMedia:Pu,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Eu.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function Wu(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ku(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function qu(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Eu.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Eu.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Eu.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Eu.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Eu.resolve()):r},t.addIceCandidate=s}function Yu(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(zu(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function zu(e){return e&&void 0!==e.video?Object.assign({},e,{video:lr(e.video)}):e}function Ju(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(ar("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Xu(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qu(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Zu(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var $u=Object.freeze({__proto__:null,shimLocalStreamsAPI:Wu,shimRemoteStreamsAPI:Ku,shimCallbacksAPI:qu,shimGetUserMedia:Yu,shimConstraints:zu,shimRTCIceServerUrls:Ju,shimTrackEventTransceiver:Xu,shimCreateOfferLegacy:Qu,shimAudioContext:Zu}),ep="\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff",tp=H,np=Lo,rp=d("".replace),ip="[\t\n\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff]",op=RegExp("^"+ip+ip+"*"),ap=RegExp(ip+ip+"*$"),sp=function(e){return function(t){var n=np(tp(t));return 1&e&&(n=rp(n,op,"")),2&e&&(n=rp(n,ap,"")),n}},cp={start:sp(1),end:sp(2),trim:sp(3)},lp=Ma.PROPER,dp=r,up=ep,pp=cp.trim;Tn({target:"String",proto:!0,forced:function(e){return dp((function(){return!!up[e]()||"â€‹Â…á Ž"!=="â€‹Â…á Ž"[e]()||lp&&up[e].name!==e}))}("trim")},{trim:function(){return pp(this)}});var hp=qn("String").trim,fp=u,mp=hp,gp=String.prototype,vp=function(e){var t=e.trim;return"string"==typeof e||e===gp||fp(gp,e)&&t===gp.trim?mp:t},_p={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return vp(e).call(e).split("\n").map((e=>vp(e).call(e)))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>{var n;return vp(n=t>0?"m="+e:e).call(n)+"\r\n"}))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++){var i,o;n=vp(i=r[e]).call(i).split("="),t[vp(o=n[0]).call(o)]=n[1]}return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");for(let i=3;i<r.length;i++){const o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const r=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substr(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(_p);var Ep=_p.exports,yp=Object.freeze(e({__proto__:null,default:Ep},[_p.exports]));function wp(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Ep.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,nr(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function bp(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||nr(e,"icecandidate",(e=>{if(e.candidate){const t=Ep.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Sp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Ep.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ep.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Ep.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function Tp(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},nr(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Cp(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Rp(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==vp(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ip(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Eu.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Eu.resolve())})}function Op(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Ap=Object.freeze({__proto__:null,shimRTCIceCandidate:wp,shimRTCIceCandidateRelayProtocol:bp,shimMaxMessageSize:Sp,shimSendThrowTypeError:Tp,shimConnectionState:Cp,removeExtmapAllowMixed:Rp,shimAddIceCandidateNullOrEmpty:Ip,shimParameterlessSetLocalDescription:Op});let Np,Lp;!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=or,r=sr(e),i={browserDetails:r,commonShim:Ap,extractVersion:tr,disableLog:rr,disableWarnings:ir,sdp:yp};switch(r.browser){case"chrome":if(!Lu||!Au||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Lu,Ip(e,r),Op(e),wu(e,r),bu(e),Au(e,r),Su(e),Ou(e,r),Tu(e),Cu(e),Ru(e),Nu(e,r),wp(e),bp(e),Cp(e),Sp(e,r),Tp(e),Rp(e,r);break;case"firefox":if(!Hu||!Du||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Hu,Ip(e,r),Op(e),Pu(e,r),Du(e,r),ku(e),Uu(e),xu(e),Mu(e),Vu(e),ju(e),Bu(e),Fu(e),Gu(e),wp(e),Cp(e),Sp(e,r),Tp(e);break;case"safari":if(!$u||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=$u,Ip(e,r),Op(e),Ju(e),Qu(e),qu(e),Wu(e),Ku(e),Xu(e),Yu(e),Zu(e),wp(e),bp(e),Sp(e,r),Tp(e),Rp(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(Np||(Np={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Lp||(Lp={}));var Pp={exports:{}};!function(e,n){!function(t,r){var i="function",o="undefined",a="object",s="string",c="major",l="model",d="name",u="type",p="vendor",h="version",f="architecture",m="console",g="mobile",v="tablet",_="smarttv",E="wearable",y="embedded",w="Amazon",b="Apple",S="ASUS",T="BlackBerry",C="Google",R="Huawei",I="LG",O="Microsoft",A="Motorola",N="Samsung",L="Sharp",P="Sony",k="Xiaomi",D="Zebra",x="Facebook",M="Chromium OS",U="Mac OS",V=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},j=function(e,t){return typeof e===s&&-1!==B(t).indexOf(B(e))},B=function(e){return e.toLowerCase()},F=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},G=function(e,t){for(var n,o,s,c,l,d,u=0;u<t.length&&!l;){var p=t[u],h=t[u+1];for(n=o=0;n<p.length&&!l&&p[n];)if(l=p[n++].exec(e))for(s=0;s<h.length;s++)d=l[++o],typeof(c=h[s])===a&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):r:this[c[0]]=d?c[1].call(this,d,c[2]):r:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):r):this[c]=d||r;u+=2}},H=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(j(t[n][i],e))return"?"===n?r:n}else if(j(t[n],e))return"?"===n?r:n;return e},W={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,h],[/opios[\/ ]+([\w\.]+)/i],[h,[d,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[h,[d,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[d,h],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[d,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[h,[d,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[h,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[d,"IE"]],[/yabrowser\/([\w\.]+)/i],[h,[d,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure Browser"],h],[/\bfocus\/([\w\.]+)/i],[h,[d,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[h,[d,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[d,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[d,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[h,[d,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 Browser"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[d,h],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,x],h],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[d,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[d,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[d,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,"Chrome WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[d,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[h,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[d,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[d,h],[/(cobalt)\/([\w\.]+)/i],[d,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,B]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[p,N],[u,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[p,N],[u,g]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[p,b],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[p,b],[u,v]],[/(macintosh);/i],[l,[p,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[p,L],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[p,R],[u,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[p,R],[u,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[p,k],[u,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[p,k],[u,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[p,"OPPO"],[u,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[p,"Vivo"],[u,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[p,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[p,A],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[p,A],[u,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[p,I],[u,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[p,I],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[p,"Lenovo"],[u,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[p,"Nokia"],[u,g]],[/(pixel c)\b/i],[l,[p,C],[u,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[p,C],[u,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[p,P],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[p,P],[u,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[p,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[p,w],[u,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[p,w],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,p,[u,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[p,T],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[p,S],[u,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[p,S],[u,g]],[/(nexus 9)/i],[l,[p,"HTC"],[u,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[l,/_/g," "],[u,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[p,"Acer"],[u,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[p,"Meizu"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,l,[u,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,l,[u,v]],[/(surface duo)/i],[l,[p,O],[u,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[p,"Fairphone"],[u,g]],[/(u304aa)/i],[l,[p,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[l,[p,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[l,[p,"RCA"],[u,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[p,"Dell"],[u,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[p,"Verizon"],[u,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[p,"Barnes & Noble"],[u,v]],[/\b(tm\d{3}\w+) b/i],[l,[p,"NuVision"],[u,v]],[/\b(k88) b/i],[l,[p,"ZTE"],[u,v]],[/\b(nx\d{3}j) b/i],[l,[p,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[l,[p,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[l,[p,"Swiss"],[u,v]],[/\b((zeki)?tb.*\b) b/i],[l,[p,"Zeki"],[u,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],l,[u,v]],[/\b(ns-?\w{0,9}) b/i],[l,[p,"Insignia"],[u,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[p,"NextBook"],[u,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],l,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],l,[u,g]],[/\b(ph-1) /i],[l,[p,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[p,"Envizen"],[u,v]],[/\b(trio[-\w\. ]+) b/i],[l,[p,"MachSpeed"],[u,v]],[/\btu_(1491) b/i],[l,[p,"Rotor"],[u,v]],[/(shield[\w ]+) b/i],[l,[p,"Nvidia"],[u,v]],[/(sprint) (\w+)/i],[p,l,[u,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[p,O],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[p,D],[u,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[p,D],[u,g]],[/smart-tv.+(samsung)/i],[p,[u,_]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[p,N],[u,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,I],[u,_]],[/(apple) ?tv/i],[p,[l,"Apple TV"],[u,_]],[/crkey/i],[[l,"Chromecast"],[p,C],[u,_]],[/droid.+aft(\w)( bui|\))/i],[l,[p,w],[u,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[p,L],[u,_]],[/(bravia[\w ]+)( bui|\))/i],[l,[p,P],[u,_]],[/(mitv-\w{5}) bui/i],[l,[p,k],[u,_]],[/Hbbtv.*(technisat) (.*);/i],[p,l,[u,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,F],[l,F],[u,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,l,[u,m]],[/droid.+; (shield) bui/i],[l,[p,"Nvidia"],[u,m]],[/(playstation [345portablevi]+)/i],[l,[p,P],[u,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[p,O],[u,m]],[/((pebble))app/i],[p,l,[u,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[p,b],[u,E]],[/droid.+; (glass) \d/i],[l,[p,C],[u,E]],[/droid.+; (wt63?0{2,3})\)/i],[l,[p,D],[u,E]],[/(quest( 2| pro)?)/i],[l,[p,x],[u,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[u,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[d,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,h],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[d,[h,H,W]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,"Windows"],[h,H,W]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,U],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,h],[/\(bb(10);/i],[h,[d,T]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[d,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[d,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,M],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,h],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[d,h]]},q=function(e,n){if(typeof e===a&&(n=e,e=r),!(this instanceof q))return new q(e,n).getResult();var c=typeof t!==o&&t.navigator?t.navigator:r,l=e||(c&&c.userAgent?c.userAgent:""),d=c&&c.userAgentData?c.userAgentData:r,u=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(K,n):K;return this.getBrowser=function(){var e={};return e.name=r,e.version=r,G.call(e,l,u.browser),e.major=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e.version),c&&c.brave&&typeof c.brave.isBrave==i&&(e.name="Brave"),e},this.getCPU=function(){var e={};return e.architecture=r,G.call(e,l,u.cpu),e},this.getDevice=function(){var e={};return e.vendor=r,e.model=r,e.type=r,G.call(e,l,u.device),!e.type&&d&&d.mobile&&(e.type=g),"Macintosh"==e.model&&c&&typeof c.standalone!==o&&c.maxTouchPoints&&c.maxTouchPoints>2&&(e.model="iPad",e.type=v),e},this.getEngine=function(){var e={};return e.name=r,e.version=r,G.call(e,l,u.engine),e},this.getOS=function(){var e={};return e.name=r,e.version=r,G.call(e,l,u.os),!e.name&&d&&"Unknown"!=d.platform&&(e.name=d.platform.replace(/chrome os/i,M).replace(/macos/i,U)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return l},this.setUA=function(e){return l=typeof e===s&&e.length>350?F(e,350):e,this},this.setUA(l),this};q.VERSION="0.7.34",q.BROWSER=V([d,h,c]),q.CPU=V([f]),q.DEVICE=V([l,p,u,m,g,_,v,E,y]),q.ENGINE=q.OS=V([d,h]),e.exports&&(n=e.exports=q),n.UAParser=q;var Y=typeof t!==o&&(t.jQuery||t.Zepto);if(Y&&!Y.ua){var z=new q;Y.ua=z.getResult(),Y.ua.get=function(){return z.getUA()},Y.ua.set=function(e){z.setUA(e);var t=z.getResult();for(var n in t)Y.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Pp,Pp.exports);const kp=new(0,Pp.exports);let Dp,xp,Mp=kp.getResult(),Up=null;function Vp(e){if(!Up){e&&kp.setUA(e),Mp=kp.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return Lp.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Lp.CHROME;case"Safari":case"Mobile Safari":return Lp.SAFARI;case"Edge":return Lp.EDGE;case"Firefox":return Lp.FIREFOX;case"QQBrowser":return Lp.QQ;case"Opera":return Lp.OPERA;case"WeChat":return Lp.WECHAT;default:return e.browser.name||""}}(Mp),n=function(e){let t;return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",t.split(".")[0]}(Mp),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(Mp),i=Mp.os.version;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i};Up={name:t,version:n,os:r,osVersion:i}}return Up}function jp(){return Vp().os}function Bp(){const e=Vp();return"".concat(e.os," ").concat(e.osVersion)}function Fp(){const e=Vp();return!!("WebKit"===Mp.engine.name&&e.os===Np.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Lp.SAFARI||Yp()&&e.name!==Lp.SAFARI)}function Gp(){const e=Vp();if(Fp()){if(e.os===Np.MAC_OS)return!0;if(e.os===Np.IOS){const e=Mp.os.version&&Mp.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}function Hp(){return"WebKit"===Mp.engine.name}function Wp(){return Vp().name===Lp.CHROME}function Kp(){return Vp().name===Lp.SAFARI}function qp(){return Vp().name===Lp.FIREFOX}function Yp(){return Vp().os===Np.IOS}function zp(e){const t=Vp();return!(t.name!==Lp.CHROME||!t.osVersion)&&Number(t.version)>=e}function Jp(e){const t=Vp();return!(t.name!==Lp.EDGE||!t.osVersion)&&Number(t.version)>=e}function Xp(e){const t=Vp();return!(t.name!==Lp.OPERA||!t.osVersion)&&Number(t.version)>=e}function Qp(){const e=Vp();return!(e.name!==Lp.CHROME||!e.osVersion)&&Number(e.version)<=90}function Zp(){const e=Vp();if(e.os!==Np.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function $p(){const e=Vp();if(e.os!==Np.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function eh(){const e=Vp();if(e.os!==Np.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function th(){const e=Vp();if(e.os!==Np.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function nh(){return Kp()&&navigator.maxTouchPoints>0}function rh(){return Vp().name===Lp.WECHAT}function ih(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function oh(){const e=Vp();return e.name!==Lp.EDGE&&e.name!==Lp.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function ah(){return jp()===Np.ANDROID}function sh(){const e=Vp();return ah()&&(e.name===Lp.CHROME||e.name===Lp.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}!function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"}(Dp||(Dp={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(xp||(xp={}));var ch={exports:{}},lh=Tn,dh=w,uh=Kt.f;lh({target:"Object",stat:!0,forced:Object.defineProperty!==uh,sham:!dh},{defineProperty:uh});var ph=J.Object,hh=ch.exports=function(e,t,n){return ph.defineProperty(e,t,n)};ph.defineProperty.sham&&(hh.sham=!0);var fh=ch.exports;function mh(e,t,n){return t in e?fh(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gh,vh={exports:{}},_h=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Eh=_h,yh=Object.prototype.toString,wh=(gh=Object.create(null),function(e){var t=yh.call(e);return gh[t]||(gh[t]=t.slice(8,-1).toLowerCase())});function bh(e){return e=e.toLowerCase(),function(t){return wh(t)===e}}function Sh(e){return Array.isArray(e)}function Th(e){return void 0===e}var Ch=bh("ArrayBuffer");function Rh(e){return null!==e&&"object"==typeof e}function Ih(e){if("object"!==wh(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var Oh=bh("Date"),Ah=bh("File"),Nh=bh("Blob"),Lh=bh("FileList");function Ph(e){return"[object Function]"===yh.call(e)}var kh=bh("URLSearchParams");function Dh(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),Sh(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var xh,Mh=(xh="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return xh&&e instanceof xh}),Uh={isArray:Sh,isArrayBuffer:Ch,isBuffer:function(e){return null!==e&&!Th(e)&&null!==e.constructor&&!Th(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||yh.call(e)===t||Ph(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ch(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:Rh,isPlainObject:Ih,isUndefined:Th,isDate:Oh,isFile:Ah,isBlob:Nh,isFunction:Ph,isStream:function(e){return Rh(e)&&Ph(e.pipe)},isURLSearchParams:kh,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:Dh,merge:function e(){var t={};function n(n,r){Ih(t[r])&&Ih(n)?t[r]=e(t[r],n):Ih(n)?t[r]=e({},n):Sh(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)Dh(arguments[r],n);return t},extend:function(e,t,n){return Dh(t,(function(t,r){e[r]=n&&"function"==typeof t?Eh(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,o,a={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=r[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:wh,kindOfTest:bh,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(Th(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:Mh,isFileList:Lh},Vh=Uh;function jh(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Bh=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(Vh.isURLSearchParams(t))r=t.toString();else{var i=[];Vh.forEach(t,(function(e,t){null!=e&&(Vh.isArray(e)?t+="[]":e=[e],Vh.forEach(e,(function(e){Vh.isDate(e)?e=e.toISOString():Vh.isObject(e)&&(e=JSON.stringify(e)),i.push(jh(t)+"="+jh(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},Fh=Uh;function Gh(){this.handlers=[]}Gh.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Gh.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Gh.prototype.forEach=function(e){Fh.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Hh=Gh,Wh=Uh,Kh=Uh;function qh(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Kh.inherits(qh,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Yh=qh.prototype,zh={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){zh[e]={value:e}})),Object.defineProperties(qh,zh),Object.defineProperty(Yh,"isAxiosError",{value:!0}),qh.from=function(e,t,n,r,i,o){var a=Object.create(Yh);return Kh.toFlatObject(e,a,(function(e){return e!==Error.prototype})),qh.call(a,e.message,t,n,r,i),a.name=e.name,o&&Object.assign(a,o),a};var Jh=qh,Xh={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qh=Uh,Zh=function(e,t){t=t||new FormData;var n=[];function r(e){return null===e?"":Qh.isDate(e)?e.toISOString():Qh.isArrayBuffer(e)||Qh.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(Qh.isPlainObject(i)||Qh.isArray(i)){if(-1!==n.indexOf(i))throw Error("Circular reference detected in "+o);n.push(i),Qh.forEach(i,(function(n,i){if(!Qh.isUndefined(n)){var a,s=o?o+"."+i:i;if(n&&!o&&"object"==typeof n)if(Qh.endsWith(i,"{}"))n=JSON.stringify(n);else if(Qh.endsWith(i,"[]")&&(a=Qh.toArray(n)))return void a.forEach((function(e){!Qh.isUndefined(e)&&t.append(s,r(e))}));e(n,s)}})),n.pop()}else t.append(o,r(i))}(e),t},$h=Jh,ef=Uh,tf=ef.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),ef.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ef.isString(r)&&a.push("path="+r),ef.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},nf=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},rf=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},of=function(e,t){return e&&!nf(t)?rf(e,t):t},af=Uh,sf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],cf=Uh,lf=cf.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=cf.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},df=Jh;function uf(e){df.call(this,null==e?"canceled":e,df.ERR_CANCELED),this.name="CanceledError"}Uh.inherits(uf,df,{__CANCEL__:!0});var pf=uf,hf=Uh,ff=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new $h("Request failed with status code "+n.status,[$h.ERR_BAD_REQUEST,$h.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},mf=tf,gf=Bh,vf=of,_f=function(e){var t,n,r,i={};return e?(af.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=af.trim(e.substr(0,r)).toLowerCase(),n=af.trim(e.substr(r+1)),t){if(i[t]&&sf.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i},Ef=lf,yf=Xh,wf=Jh,bf=pf,Sf=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},Tf=function(e){return new Promise((function(t,n){var r,i=e.data,o=e.headers,a=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}hf.isFormData(i)&&hf.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var l=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(l+":"+d)}var u=vf(e.baseURL,e.url);function p(){if(c){var r="getAllResponseHeaders"in c?_f(c.getAllResponseHeaders()):null,i={data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c};ff((function(e){t(e),s()}),(function(e){n(e),s()}),i),c=null}}if(c.open(e.method.toUpperCase(),gf(u,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(n(new wf("Request aborted",wf.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new wf("Network Error",wf.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||yf;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new wf(t,r.clarifyTimeoutError?wf.ETIMEDOUT:wf.ECONNABORTED,e,c)),c=null},hf.isStandardBrowserEnv()){var h=(e.withCredentials||Ef(u))&&e.xsrfCookieName?mf.read(e.xsrfCookieName):void 0;h&&(o[e.xsrfHeaderName]=h)}"setRequestHeader"in c&&hf.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),hf.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),a&&"json"!==a&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(e){c&&(n(!e||e&&e.type?new bf:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),i||(i=null);var f=Sf(u);f&&-1===["http","https","file"].indexOf(f)?n(new wf("Unsupported protocol "+f+":",wf.ERR_BAD_REQUEST,e)):c.send(i)}))},Cf=Uh,Rf=function(e,t){Wh.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},If=Jh,Of=Zh,Af={"Content-Type":"application/x-www-form-urlencoded"};function Nf(e,t){!Cf.isUndefined(e)&&Cf.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Lf,Pf={transitional:Xh,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Lf=Tf),Lf),transformRequest:[function(e,t){if(Rf(t,"Accept"),Rf(t,"Content-Type"),Cf.isFormData(e)||Cf.isArrayBuffer(e)||Cf.isBuffer(e)||Cf.isStream(e)||Cf.isFile(e)||Cf.isBlob(e))return e;if(Cf.isArrayBufferView(e))return e.buffer;if(Cf.isURLSearchParams(e))return Nf(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=Cf.isObject(e),i=t&&t["Content-Type"];if((n=Cf.isFileList(e))||r&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return Of(n?{"files[]":e}:e,o&&new o)}return r||"application/json"===i?(Nf(t,"application/json"),function(e,t,n){if(Cf.isString(e))try{return(t||JSON.parse)(e),Cf.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Pf.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&Cf.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw If.from(e,If.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Cf.forEach(["delete","get","head"],(function(e){Pf.headers[e]={}})),Cf.forEach(["post","put","patch"],(function(e){Pf.headers[e]=Cf.merge(Af)}));var kf=Pf,Df=Uh,xf=kf,Mf=function(e){return!(!e||!e.__CANCEL__)},Uf=Uh,Vf=function(e,t,n){var r=this||xf;return Df.forEach(n,(function(n){e=n.call(r,e,t)})),e},jf=Mf,Bf=kf,Ff=pf;function Gf(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ff}var Hf=Uh,Wf=function(e,t){t=t||{};var n={};function r(e,t){return Hf.isPlainObject(e)&&Hf.isPlainObject(t)?Hf.merge(e,t):Hf.isPlainObject(t)?Hf.merge({},t):Hf.isArray(t)?t.slice():t}function i(n){return Hf.isUndefined(t[n])?Hf.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!Hf.isUndefined(t[e]))return r(void 0,t[e])}function a(n){return Hf.isUndefined(t[n])?Hf.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function s(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return Hf.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,r=t(e);Hf.isUndefined(r)&&t!==s||(n[e]=r)})),n},Kf="0.27.2",qf=Kf,Yf=Jh,zf={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){zf[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var Jf={};zf.transitional=function(e,t,n){function r(e,t){return"[Axios v"+qf+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new Yf(r(i," has been removed"+(t?" in "+t:"")),Yf.ERR_DEPRECATED);return t&&!Jf[i]&&(Jf[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var Xf=Uh,Qf=Bh,Zf=Hh,$f=function(e){return Gf(e),e.headers=e.headers||{},e.data=Vf.call(e,e.data,e.headers,e.transformRequest),e.headers=Uf.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Uf.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||Bf.adapter)(e).then((function(t){return Gf(e),t.data=Vf.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return jf(t)||(Gf(e),t&&t.response&&(t.response.data=Vf.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},em=Wf,tm=of,nm={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Yf("options must be an object",Yf.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new Yf("option "+o+" must be "+c,Yf.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Yf("Unknown option "+o,Yf.ERR_BAD_OPTION)}},validators:zf},rm=nm.validators;function im(e){this.defaults=e,this.interceptors={request:new Zf,response:new Zf}}im.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=em(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&nm.assertOptions(n,{silentJSONParsing:rm.transitional(rm.boolean),forcedJSONParsing:rm.transitional(rm.boolean),clarifyTimeoutError:rm.transitional(rm.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var s=[$f,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(a),o=Promise.resolve(t);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=t;r.length;){var l=r.shift(),d=r.shift();try{c=l(c)}catch(e){d(e);break}}try{o=$f(c)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},im.prototype.getUri=function(e){e=em(this.defaults,e);var t=tm(e.baseURL,e.url);return Qf(t,e.params,e.paramsSerializer)},Xf.forEach(["delete","get","head","options"],(function(e){im.prototype[e]=function(t,n){return this.request(em(n||{},{method:e,url:t,data:(n||{}).data}))}})),Xf.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(em(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}im.prototype[e]=t(),im.prototype[e+"Form"]=t(!0)}));var om=im,am=pf;function sm(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new am(e),t(n.reason))}))}sm.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},sm.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},sm.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},sm.source=function(){var e;return{token:new sm((function(t){e=t})),cancel:e}};var cm=sm,lm=Uh,dm=Uh,um=_h,pm=om,hm=Wf,fm=function e(t){var n=new pm(t),r=um(pm.prototype.request,n);return dm.extend(r,pm.prototype,n),dm.extend(r,n),r.create=function(n){return e(hm(t,n))},r}(kf);fm.Axios=pm,fm.CanceledError=pf,fm.CancelToken=cm,fm.isCancel=Mf,fm.VERSION=Kf,fm.toFormData=Zh,fm.AxiosError=Jh,fm.Cancel=fm.CanceledError,fm.all=function(e){return Promise.all(e)},fm.spread=function(e){return function(t){return e.apply(null,t)}},fm.isAxiosError=function(e){return lm.isObject(e)&&!0===e.isAxiosError},vh.exports=fm,vh.exports.default=fm;var mm=vh.exports;class gm{constructor(e){mh(this,"logger",void 0),mh(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}class vm{constructor(){mh(this,"_events",{}),mh(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let n=0;n<t.length;n+=1){const i=t[n];i.once&&this.off(e,i.listener),i.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){Am.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}const _m=new class extends vm{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let Em;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(Em||(Em={}));class ym extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),mh(this,"code",void 0),mh(this,"message",void 0),mh(this,"data",void 0),mh(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return"error"===e&&Am.error(this.toString()),"warning"===e&&Am.warning(this.toString()),this}throw(){throw this.print(),this}}const wm={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function bm(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Sm(e,t,n,r){const i=Object.assign({},wm,r);let o=i.timeout;const a=async()=>{await function(e){return new Eu((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let s=!1;const c=new Eu((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return o(new ym(Em.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await a()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await a()}}}));return c.cancel=()=>s=!0,c}function Tm(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function Cm(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Rm={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Im=Date.now(),Om=e=>{for(const t in Rm)if(Object.prototype.hasOwnProperty.call(Rm,t)&&Rm[t]===e)return t;return"DEFAULT"},Am=new class{constructor(){mh(this,"proxyServerURL",void 0),mh(this,"logLevel",Rm.DEBUG),mh(this,"uploadState","collecting"),mh(this,"uploadLogWaitingList",[]),mh(this,"uploadLogUploadingList",[]),mh(this,"uploadErrorCount",0),mh(this,"currentLogID",0),mh(this,"url",void 0),mh(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Rm.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Rm.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Rm.WARNING].concat(t);this.log.apply(this,r)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Rm.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Rm.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Hm("UPLOAD_LOG",!0)}disableLogUpload(){Hm("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new gm(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Im<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-Im);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=Tm()+" Agora-SDK [".concat(Om(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=Tm()+" %cAgora-SDK [".concat(Om(r),"]:");let o=[];if(!Wm("USE_NEW_LOG"))switch(r){case Rm.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case Rm.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case Rm.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case Rm.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Im<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-Im);const r=Math.max(0,Math.min(4,t[0]));t[0]=Tm()+" Agora-SDK [".concat(Om(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!Wm("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=Cm()+" Agora-SDK [".concat(Om(e),"]:"):n[0]=Cm()+" Agora-SDK [".concat(Om(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Lm,process_id:Wm("PROCESS_ID"),payload:JSON.stringify(e)};return Sm((async()=>{const e=await mm.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Wm("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Wm("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(e=>(e.response?_m.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?_m.reportLogUploadError({status:e.request.status,message:e.message}):_m.reportLogUploadError({status:-1,message:e.message}),!0)),{timeout:Wm("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Wm("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Wm("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),Wm("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),Wm("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),Wm("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}},Nm="v4.18.3-0-g04adbcef-dirty(9/20/2023, 10:34:38 AM)",Lm=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.18.3"),Pm=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),km=["CHINA","GLOBAL"],Dm=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let e=0;e<6;e++)i.push("1");const o=i.join(""),a={};return a[e]=r,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Dm;const xm={"90p":zm(160,90),"90p_1":zm(160,90),"120p":zm(160,120,15,30,65),"120p_1":zm(160,120,15,30,65),"120p_3":zm(120,120,15,30,50),"120p_4":zm(212,120),"180p":zm(320,180,15,30,140),"180p_1":zm(320,180,15,30,140),"180p_3":zm(180,180,15,30,100),"180p_4":zm(240,180,15,30,120),"240p":zm(320,240,15,40,200),"240p_1":zm(320,240,15,40,200),"240p_3":zm(240,240,15,40,140),"240p_4":zm(424,240,15,40,220),"360p":zm(640,360,15,80,400),"360p_1":zm(640,360,15,80,400),"360p_3":zm(360,360,15,80,260),"360p_4":zm(640,360,30,80,600),"360p_6":zm(360,360,30,80,400),"360p_7":zm(480,360,15,80,320),"360p_8":zm(480,360,30,80,490),"360p_9":zm(640,360,15,80,800),"360p_10":zm(640,360,24,80,800),"360p_11":zm(640,360,24,80,1e3),"480p":zm(640,480,15,100,500),"480p_1":zm(640,480,15,100,500),"480p_2":zm(640,480,30,100,1e3),"480p_3":zm(480,480,15,100,400),"480p_4":zm(640,480,30,100,750),"480p_6":zm(480,480,30,100,600),"480p_8":zm(848,480,15,100,610),"480p_9":zm(848,480,30,100,930),"480p_10":zm(640,480,10,100,400),"720p":zm(1280,720,15,120,1130),"720p_1":zm(1280,720,15,120,1130),"720p_2":zm(1280,720,30,120,2e3),"720p_3":zm(1280,720,30,120,1710),"720p_5":zm(960,720,15,120,910),"720p_6":zm(960,720,30,120,1380),"1080p":zm(1920,1080,15,120,2080),"1080p_1":zm(1920,1080,15,120,2080),"1080p_2":zm(1920,1080,30,120,3e3),"1080p_3":zm(1920,1080,30,120,3150),"1080p_5":zm(1920,1080,60,120,4780),"1440p":zm(2560,1440,30,120,4850),"1440p_1":zm(2560,1440,30,120,4850),"1440p_2":zm(2560,1440,60,120,7350),"4k":zm(3840,2160,30,120,8910),"4k_1":zm(3840,2160,30,120,8910),"4k_3":zm(3840,2160,60,120,13500)},Mm={"480p":Jm(640,480,5),"480p_1":Jm(640,480,5),"480p_2":Jm(640,480,30),"480p_3":Jm(640,480,15),"720p":Jm(1280,720,5),"720p_1":Jm(1280,720,5),"720p_2":Jm(1280,720,30),"720p_3":Jm(1280,720,15),"1080p":Jm(1920,1080,5),"1080p_1":Jm(1920,1080,5),"1080p_2":Jm(1920,1080,30),"1080p_3":Jm(1920,1080,15)},Um={"1SL1TL":Xm(1,1),"3SL3TL":Xm(3,3),"2SL3TL":Xm(2,3)};function Vm(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},xm[e]):e}function jm(e){return"string"==typeof e?Object.assign({},Mm[e]):e}function Bm(e){return"string"==typeof e?Object.assign({},Um[e]):e}const Fm={speech_low_quality:Ym(16e3,!1),speech_standard:Ym(32e3,!1,18),music_standard:Ym(48e3,!1),standard_stereo:Ym(48e3,!0,56),high_quality:Ym(48e3,!1,128),high_quality_stereo:Ym(48e3,!0,192)};function Gm(e){return"string"==typeof e?Object.assign({},Fm[e]):e}function Hm(e,t,n){Object.keys(Km).includes(e)&&(!n&&Object.keys(qm).includes(e)||(Km[e]=t))}function Wm(e){return Km[e]}const Km={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:km,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},qm={};function Ym(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function zm(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Jm(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function Xm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}Pm||(Km.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Km.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Km.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Km.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Km.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Km.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Km.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Km.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Km.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Km.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Km.AREAS=["NORTH_AMERICA","OVERSEA"]);const Qm=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Zm=[],$m=[];function eg(e,t){return!!t&&Zm.some((n=>n.uid===e&&n.channelName===t))}var tg=gt,ng=Kt,rg=L,ig=function(e,t,n){var r=tg(t);r in e?ng.f(e,r,rg(0,n)):e[r]=n},og=Ur,ag=Ln,sg=ig,cg=h.Array,lg=Math.max,dg=function(e,t,n){for(var r=ag(e),i=og(t,r),o=og(void 0===n?r:n,r),a=cg(lg(o-i,0)),s=0;i<o;i++,s++)sg(a,s,e[i]);return a.length=s,a},ug=dg,pg=Math.floor,hg=function(e,t){var n=e.length,r=pg(n/2);return n<8?fg(e,t):mg(e,hg(ug(e,0,r),t),hg(ug(e,r),t),t)},fg=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},mg=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},gg=hg,vg=te.match(/firefox\/(\d+)/i),_g=!!vg&&+vg[1],Eg=/MSIE|Trident/.test(te),yg=te.match(/AppleWebKit\/(\d+)\./),wg=!!yg&&+yg[1],bg=Tn,Sg=d,Tg=Te,Cg=Be,Rg=Ln,Ig=Lo,Og=r,Ag=gg,Ng=Bn,Lg=_g,Pg=Eg,kg=ce,Dg=wg,xg=[],Mg=Sg(xg.sort),Ug=Sg(xg.push),Vg=Og((function(){xg.sort(void 0)})),jg=Og((function(){xg.sort(null)})),Bg=Ng("sort"),Fg=!Og((function(){if(kg)return kg<70;if(!(Lg&&Lg>3)){if(Pg)return!0;if(Dg)return Dg<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)xg.push({k:t+r,v:n})}for(xg.sort((function(e,t){return t.v-e.v})),r=0;r<xg.length;r++)t=xg[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));bg({target:"Array",proto:!0,forced:Vg||!jg||!Bg||!Fg},{sort:function(e){void 0!==e&&Tg(e);var t=Cg(this);if(Fg)return void 0===e?Mg(t):Mg(t,e);var n,r,i=[],o=Rg(t);for(r=0;r<o;r++)r in t&&Ug(i,t[r]);for(Ag(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ig(t)>Ig(n)?1:-1}}(e)),n=i.length,r=0;r<n;)t[r]=i[r++];for(;r<o;)delete t[r++];return t}});var Gg=qn("Array").sort,Hg=u,Wg=Gg,Kg=Array.prototype,qg=function(e){var t=e.sort;return e===Kg||Hg(Kg,e)&&t===Kg.sort?Wg:t};function Yg(e,t){if("boolean"!=typeof e)throw new ym(Em.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function zg(e,t,n){if(!n.includes(e))throw new ym(Em.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Jg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!rv(e))throw new ym(Em.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function Xg(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new ym(Em.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&Jg(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&Jg(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&Jg(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&Jg(e.ideal,"".concat(t,".ideal"),1,1/0)}else Jg(e,t,1,1/0)}function Qg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new ym(Em.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!nv(e,n,r,i))throw new ym(Em.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Zg(e,t){if(!Array.isArray(e))throw new ym(Em.INVALID_PARAMS,"".concat(t," should be an array"))}function $g(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Am.error("Invalid Channel Name ".concat(e)),new ym(Em.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ev(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||nv(e,1,255)))throw Am.error("Invalid UID ".concat(e," ").concat(typeof e)),new ym(Em.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&Am.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function tv(e){return null==e}function nv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||iv(e))}function rv(e){return"number"==typeof e&&e%1==0}function iv(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let ov,av,sv;!function(e){e.FREE="free",e.UPLOADING="uploading"}(ov||(ov={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(av||(av={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(sv||(sv={}));const cv={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function lv(e){return Qg(e.reportId,"params.reportId",0,100,!1),Qg(e.category,"params.category",0,100,!1),Qg(e.event,"params.event",0,100,!1),Qg(e.label,"params.label",0,100,!1),Jg(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const dv={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let uv,pv,hv,fv,mv,gv,vv,_v,Ev,yv,wv,bv,Sv,Tv,Cv,Rv,Iv,Ov,Av,Nv,Lv,Pv,kv,Dv;function xv(e){return Jg(e.timeout,"config.timeout",0,1e5),Jg(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Jg(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Jg(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Mv(e){return zg(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zg(e.mode,"config.mode",["rtc","live"]),void 0!==e.audioCodec&&zg(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&Qg(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Vv(e.turnServer),void 0!==e.httpRetryConfig&&xv(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&xv(e.websocketRetryConfig),!0}function Uv(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function Vv(e){return Qg(e.turnServerURL,"turnServerURL"),Qg(e.username,"username"),Qg(e.password,"password"),e.udpport&&Jg(e.udpport,"udpport",1,99999,!0),e.forceturn&&Yg(e.forceturn,"forceturn"),e.security&&Yg(e.security,"security"),e.tcpport&&Jg(e.tcpport,"tcpport",1,99999,!0),!0}function jv(e){return void 0!==e.level&&zg(e.level,"level",[1,2,3]),!0}!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"}(uv||(uv={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(pv||(pv={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(hv||(hv={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(fv||(fv={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(mv||(mv={})),function(e){e.TRACER="tracer"}(gv||(gv={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(vv||(vv={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(_v||(_v={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ev||(Ev={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(yv||(yv={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(wv||(wv={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(bv||(bv={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Sv||(Sv={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Tv||(Tv={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(Cv||(Cv={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(Rv||(Rv={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Iv||(Iv={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(Ov||(Ov={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(Av||(Av={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(Nv||(Nv={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(Lv||(Lv={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Pv||(Pv={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(kv||(kv={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(Dv||(Dv={}));const Bv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},Fv={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Gv={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Hv={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Wv={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Kv,qv,Yv;!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Kv||(Kv={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(qv||(qv={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Yv||(Yv={}));const zv={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Jv={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Xv(e,t){Qg(e.url,"".concat(t,".url"),1,1e3,!1),tv(e.x)||Jg(e.x,"".concat(t,".x"),0,1e4),tv(e.y)||Jg(e.y,"".concat(t,".y"),0,1e4),tv(e.width)||Jg(e.width,"".concat(t,".width"),0,1e4),tv(e.height)||Jg(e.height,"".concat(t,".height"),0,1e4),tv(e.zOrder)||Jg(e.zOrder,"".concat(t,".zOrder"),0,255),tv(e.alpha)||Jg(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Qv={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Zv={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let $v,e_,t_,n_,r_,i_,o_,a_,s_,c_,l_,d_,u_,p_,h_,f_,m_,g_,v_,__,E_;function y_(e){if(!e.channelName)throw new ym(Em.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new ym(Em.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Qg(e.token,"info.token",1,2047),ev(e.uid),$g(e.channelName),!0}function w_(e){return zg(e,"mediaSource",["screen","window","application"]),!0}!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}($v||($v={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(e_||(e_={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(t_||(t_={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(n_||(n_={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(r_||(r_={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(i_||(i_={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(o_||(o_={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(a_||(a_={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(s_||(s_={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(c_||(c_={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(l_||(l_={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(d_||(d_={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(u_||(u_={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(p_||(p_={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(h_||(h_={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(f_||(f_={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(m_||(m_={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(g_||(g_={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(v_||(v_={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(__||(__={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(E_||(E_={}));const b_=[E_.AFRICA,E_.ASIA,E_.CHINA,E_.EUROPE,E_.GLOBAL,E_.INDIA,E_.JAPAN,E_.NORTH_AMERICA,E_.OCEANIA,E_.OVERSEA,E_.SOUTH_AMERICA];let S_;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"}(S_||(S_={}));const T_={CHINA:{},ASIA:{CODE:S_.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:S_.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:S_.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:S_.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:S_.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:S_.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:S_.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:S_.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:S_.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:S_.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:S_.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:S_.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:S_.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let C_,R_,I_,O_,A_,N_,L_,P_,k_,D_,x_,M_,U_,V_,j_,B_,F_,G_,H_,W_,K_,q_;Pm&&(T_.CHINA={CODE:S_.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(C_||(C_={}));class Y_ extends vm{constructor(e,t){super(),mh(this,"onICEConnectionStateChange",void 0),mh(this,"onConnectionStateChange",void 0),mh(this,"onDTLSTransportStateChange",void 0),mh(this,"onDTLSTransportError",void 0),mh(this,"onICETransportStateChange",void 0),mh(this,"onFirstAudioReceived",void 0),mh(this,"onFirstVideoReceived",void 0),mh(this,"onFirstAudioDecoded",void 0),mh(this,"onFirstVideoDecoded",void 0),mh(this,"onFirstVideoDecodedTimeout",void 0),mh(this,"onSelectedLocalCandidateChanged",void 0),mh(this,"onSelectedRemoteCandidateChanged",void 0),mh(this,"establishPromise",void 0)}}!function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"}(R_||(R_={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(I_||(I_={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(O_||(O_={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(A_||(A_={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(N_||(N_={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(L_||(L_={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(P_||(P_={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(k_||(k_={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(D_||(D_={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(x_||(x_={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(M_||(M_={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(U_||(U_={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(V_||(V_={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(j_||(j_={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(B_||(B_={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(F_||(F_={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(G_||(G_={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(H_||(H_={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(W_||(W_={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(K_||(K_={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(q_||(q_={}));const z_={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function J_(){return z_}let X_;!function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(X_||(X_={}));var Q_=x,Z_=Array.isArray||function(e){return"Array"==Q_(e)},$_=h,eE=Z_,tE=ac,nE=z,rE=ot("species"),iE=$_.Array,oE=function(e){var t;return eE(e)&&(t=e.constructor,(tE(t)&&(t===iE||eE(t.prototype))||nE(t)&&null===(t=t[rE]))&&(t=void 0)),void 0===t?iE:t},aE=function(e,t){return new(oE(e))(0===t?0:t)},sE=Wt,cE=F,lE=Be,dE=Ln,uE=aE,pE=d([].push),hE=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,l,d,u){for(var p,h,f=lE(c),m=cE(f),g=sE(l,d),v=dE(m),_=0,E=u||uE,y=t?E(c,v):n||a?E(c,0):void 0;v>_;_++)if((s||_ in m)&&(h=g(p=m[_],_,f),e))if(t)y[_]=h;else if(h)switch(e){case 3:return!0;case 5:return p;case 6:return _;case 2:pE(y,p)}else switch(e){case 4:return!1;case 7:pE(y,p)}return o?-1:r||i?i:y}},fE={forEach:hE(0),map:hE(1),filter:hE(2),some:hE(3),every:hE(4),find:hE(5),findIndex:hE(6),filterReject:hE(7)},mE=fE.forEach,gE=Bn("forEach")?[].forEach:function(e){return mE(this,e,arguments.length>1?arguments[1]:void 0)};Tn({target:"Array",proto:!0,forced:[].forEach!=gE},{forEach:gE});var vE=qn("Array").forEach,_E=$i,EE=He,yE=u,wE=vE,bE=Array.prototype,SE={DOMTokenList:!0,NodeList:!0},TE=function(e){var t=e.forEach;return e===bE||yE(bE,e)&&t===bE.forEach||EE(SE,_E(e))?wE:t},CE=Be,RE=hi;Tn({target:"Object",stat:!0,forced:r((function(){RE(1)}))},{keys:function(e){return RE(CE(e))}});var IE=J.Object.keys,OE=Qn,AE=Tn,NE=Z_,LE=d([].reverse),PE=[1,2];AE({target:"Array",proto:!0,forced:String(PE)===String(PE.reverse())},{reverse:function(){return NE(this)&&(this.length=this.length),LE(this)}});var kE=qn("Array").reverse,DE=u,xE=kE,ME=Array.prototype,UE=function(e){var t=e.reverse;return e===ME||DE(ME,e)&&t===ME.reverse?xE:t},VE=r,jE=ce,BE=ot("species"),FE=function(e){return jE>=51||!VE((function(){var t=[];return(t.constructor={})[BE]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},GE=Tn,HE=h,WE=Z_,KE=ac,qE=z,YE=Ur,zE=Ln,JE=q,XE=ig,QE=ot,ZE=fc,$E=FE("slice"),ey=QE("species"),ty=HE.Array,ny=Math.max;GE({target:"Array",proto:!0,forced:!$E},{slice:function(e,t){var n,r,i,o=JE(this),a=zE(o),s=YE(e,a),c=YE(void 0===t?a:t,a);if(WE(o)&&(n=o.constructor,(KE(n)&&(n===ty||WE(n.prototype))||qE(n)&&null===(n=n[ey]))&&(n=void 0),n===ty||void 0===n))return ZE(o,s,c);for(r=new(void 0===n?ty:n)(ny(c-s,0)),i=0;s<c;s++,i++)s in o&&XE(r,i,o[s]);return r.length=i,r}});var ry=qn("Array").slice,iy=u,oy=ry,ay=Array.prototype,sy=function(e){var t=e.slice;return e===ay||iy(ay,e)&&t===ay.slice?oy:t};function cy(e,t,n,r,i){var o,a,s,c={};return TE(o=IE(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=OE(a=UE(s=sy(n).call(n)).call(s)).call(a,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(fh(e,t,c),c=null),c}var ly=qn("Array").keys,dy=$i,uy=He,py=u,hy=ly,fy=Array.prototype,my={DOMTokenList:!0,NodeList:!0},gy=function(e){var t=e.keys;return e===fy||py(fy,e)&&t===fy.keys||uy(my,dy(e))?hy:t};function vy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vy(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Ey=0,yy=0;function wy(e,t,n,r){return new Eu(((i,o)=>{t.timeout=t.timeout||Wm("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Ey+=Xb(t.data)):n&&(t.data.size?Ey+=t.data.size:t.data instanceof FormData?Ey+=function(e){let t=0;return/DingTalk/i.test(navigator.userAgent)&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?Xb(e):e.size})),t+138}(t.data):Ey+=Xb(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mm.request(t).then((e=>{"string"==typeof e.data?yy+=Xb(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?yy+=e.data.byteLength:yy+=Xb(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{mm.isCancel(e)?o(new ym(Em.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new ym(Em.NETWORK_TIMEOUT,e.message)):e.response?o(new ym(Em.NETWORK_RESPONSE_ERROR,e.response.status)):o(new ym(Em.NETWORK_ERROR,e.message))}))}))}async function by(e,t){const n=new Blob([t.data],{type:"buffer"});return await wy(e,_y(_y({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Sy=new class extends vm{set networkState(e){Am.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(D_.NETWORK_STATE_CHANGE,e,this._networkState),e===k_.ONLINE?this.emit(D_.ONLINE):e===k_.OFFLINE&&(this.onlineWaiter=new Eu((e=>{this.once(D_.ONLINE,(()=>{this.onlineWaiter=void 0,e(k_.ONLINE)}))})),this.emit(D_.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),mh(this,"_moduleName","network-indicator"),mh(this,"_networkState",k_.ONLINE),mh(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=k_.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=k_.OFFLINE}))}};let Ty=!1;const Cy=new class extends vm{constructor(){super(...arguments),mh(this,"onAutoplayFailed",void 0),mh(this,"onAudioAutoplayFailed",void 0)}};function Ry(){if(Vp(),!Ty){const e=t=>{t.preventDefault(),Ty=!1,sh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Ty=!0,sh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Am.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Cy.onAutoplayFailed?Cy.onAutoplayFailed():Cy.onAudioAutoplayFailed?Am.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):Am.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Cy.emit("autoplay-failed")}}function Iy(e){return(new TextEncoder).encode(e)}const Oy=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Ay=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",Iy(e)),16);function Ny(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ly(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ny(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ny(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Py(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];let s=r;if(e.argsMap)try{s=e.argsMap(this,...r)}catch(e){Am.warning(e),s=[]}try{JSON.stringify(s)}catch(e){Am.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),s=[]}const c=(e.report||ky).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:s,tag:gv.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,r);return t instanceof Eu?t.then((t=>(c.onSuccess(e.reportResult&&t),t))).catch((e=>{throw c.onError(e),e})):(c.onSuccess(e.reportResult&&t),t)}catch(e){throw c.onError(e),e}}}return r}}const ky=new class{constructor(){mh(this,"baseInfoMap",new Map),mh(this,"proxyServer",void 0),mh(this,"clientList",Zm),mh(this,"eventUploadTimer",void 0),mh(this,"setSessionIdTimer",void 0),mh(this,"url",void 0),mh(this,"backupUrl",void 0),mh(this,"_appId",void 0),mh(this,"keyEventUploadPendingItems",[]),mh(this,"normalEventUploadPendingItems",[]),mh(this,"apiInvokeUploadPendingItems",[]),mh(this,"apiInvokeCount",0),mh(this,"ltsList",[]),mh(this,"lastSendNormalEventTime",Date.now()),mh(this,"customReportCounterTimer",void 0),mh(this,"customReportCount",0),mh(this,"extApiInvoke",(async e=>{for(const t of e){const e=Ly(Ly({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:gv.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Wm("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Wm("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void Am.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,Am.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),a=!!Wm("SHOW_REPORT_INVOKER_LOG");a&&Am.info("".concat(t.name," start"),t.options);let s=!1;Qb(t.timeout).then((()=>{s||(this.sendApiInvoke(Ly(Ly({},o()),{},{error:Em.API_INVOKE_TIMEOUT,success:!1})),Am.debug("".concat(t.name," timeout")))}));const c=new ym(Em.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(s)throw c;return s=!0,this.sendApiInvoke(Ly(Ly({},o()),{},{success:!0},t.reportResult&&{result:e})),a&&Am.info("".concat(t.name," onSuccess")),e};return n?vS(r,t.name+"Success",n,(()=>s=!0)):r()},onError:e=>{const r=()=>{if(s)throw e;s=!0,this.sendApiInvoke(Ly(Ly({},o()),{},{success:!1,error:e})),a&&Am.info("".concat(t.name," onFailure"),e.toString())};return n?vS(r,t.name+"Error",n,(()=>s=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:Wm("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Pm?"global":"oversea",areas:Wm("AREAS")&&Wm("AREAS").join(",")},t.extend),o=Date.now(),a=Ly(Ly({},r),{},{eventType:uv.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Nm,lts:o,elapse:o-n,extend:JSON.stringify(i),mode:t.mode,process:Wm("PROCESS_ID"),appType:Wm("APP_TYPE"),success:!0,version:Lm});this.send({type:pv.SESSION,data:a},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.JOIN_CHOOSE_SERVER,lts:i,eventElapse:i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:pv.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:pv.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:a,isProxy:s,addr:c}=t,l=i-(o&&a?a:n.startTime),d=Ly(Ly({},r),{},{eventType:uv.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:l,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),u=d.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:pv.JOIN_GATEWAY,data:d},!0);else{let e;if(c)if(s){const t=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=c.match(/p=[0-9]{1,6}/g);e={isSuccess:u,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:s?1:0}}else{const t=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=c.match(/:[0-9]{1,6}/g);e={isSuccess:u,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(":")[1]:"",isProxy:s?1:0}}else e={isSuccess:u,gatewayIp:"",port:"",isProxy:s?1:0};delete d.success,delete d.eventType,delete d.firstSuccess,d.vid=Number(d.vid);const t=Object.assign({},d,e,{eventType:uv.REJOIN_GATEWAY});this.send({type:pv.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=Ly(Ly({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:pv.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:pv.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),a=Ly(Ly({},i),{},{eventType:uv.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:pv.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...gy(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,a=Date.now(),s=Ly(Ly({},o),{},{eventType:uv.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:pv.WS_COMPRESSOR_INIT,data:s},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=Ly(Ly(Ly({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max(a-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=Ly(Ly(Ly({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly(Ly({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:uv.PC_STATS,lts:i});this.send({type:pv.PC_STATS,data:o},!0)}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=Ly(Ly(Ly({},o),r),{},{eventType:t,lts:a});this.send({type:n,data:s},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:pv.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pv.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{eventType:uv.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pv.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?Am.debug("reportProxyServerurl: ".concat(e)):Am.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:pv.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=Xb(JSON.stringify(e));let o=0;const a=[];let s=0;for(let c=0;c<r.length;c++)s+=r.charCodeAt(c)<=127?1:3,s<=n-i||(a[a.length]=Jb(Jb({},e),{},{[t]:r.substring(o,c)}),o=c,s=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(a[a.length]=Jb(Jb({},e),{},{[t]:r.substring(o)})),a})(Ly(Ly(Ly({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((e=>this.send({type:pv.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly(Ly({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:pv.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly(Ly({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:pv.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Ly(Ly(Ly({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:pv.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Wm("CUSTOM_REPORT_LIMIT"))throw new ym(Em.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:pv.USER_ANALYTICS,data:Ly(Ly({sid:e},t),{},{lts:n})})));try{Wm("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw Am.error("send custom report message failed",e.toString()),new ym(Em.CUSTOM_REPORT_SEND_FAILED,e.message)}}autoplayFailed(e,t,n,r){if(!e)return;const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=Ly(Ly({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:Cy.onAutoplayFailed||Cy.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});this.send({type:pv.AUTOPLAY_FAILED,data:s},!0)}sendApiInvoke(e){const t=Wm("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ym){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const s={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:pv.API_INVOKE,data:s},!1),!0}appendSessionId(){this.clientList.forEach((e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Wm("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const e of[...n]){var i;-1!==this.ltsList.indexOf(e.data.lts)?(e.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(e.data.lts)):(this.ltsList.push(e.data.lts),qg(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),Wm("ENABLE_EVENT_REPORT")?(n.length&&(Wm("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{Wm("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>Wm("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Wm("NORMAL_EVENT_QUEUE_CAPACITY")),Am.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){Sy.networkState===k_.OFFLINE&&await Eu.race([Sy.onlineWaiter,Qb(2*wm.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=Iy(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(pv).forEach((n=>{let[r,i]=n;i===e.type&&(t=fv[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=Oy(t,new Uint8Array(r)),t=Oy(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Wm("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(Wm("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Wm("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(Wm("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await wy(r,{timeout:1e4,data:t(e),headers:Ly(Ly({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};Sy.networkState===k_.OFFLINE&&await Eu.race([Sy.onlineWaiter,Qb(2*wm.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Wm("EVENT_REPORT_DOMAIN"),"&p=").concat(Wm("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(Wm("EVENT_REPORT_DOMAIN"),":").concat(Wm("STATS_COLLECTOR_PORT")).concat(r));for(let e=0;e<2;e+=1){1===e&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Wm("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Wm("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(Wm("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Wm("STATS_COLLECTOR_PORT")).concat(r)));try{t?await by(i,{timeout:1e4,data:n}):await wy(i,{timeout:1e4,data:n})}catch(t){if(1===e)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},dv);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:gv.TRACER}).onSuccess()}};_m.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Sy.networkState,ky.reportApiInvoke(null,{name:"logUploadError",options:e,tag:gv.TRACER})}));class Dy extends vm{constructor(e,t){super(),mh(this,"trackMediaType",void 0),mh(this,"_ID",void 0),mh(this,"_rtpTransceiver",void 0),mh(this,"_lowRtpTransceiver",void 0),mh(this,"_hints",[]),mh(this,"_isClosed",!1),mh(this,"_originMediaStreamTrack",void 0),mh(this,"_mediaStreamTrack",void 0),mh(this,"_external",{}),this._ID=t||$b(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(e){$m.includes(e)||$m.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const e=ky.reportApiInvoke(null,{name:mv.GET_MEDIA_STREAM_TRACK,options:[],tag:gv.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===h_.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=$m.indexOf(e);-1!==t&&$m.splice(t,1)}(this),this.emit(v_.CLOSED)}_updateRtpTransceiver(e,t){if(t===h_.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(g_.TRANSCEIVER_UPDATED,e,t)}}let xy,My=1;class Uy{constructor(e){mh(this,"lockingPromise",Eu.resolve()),mh(this,"locks",0),mh(this,"name",""),mh(this,"lockId",void 0),this.lockId=My++,e&&(this.name=e),Am.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,Am.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new Eu((n=>{t=()=>{this.locks-=1,Am.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}}function Vy(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await o.apply(this,s)}finally{i()}},i}}class jy extends Dy{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}constructor(e,t){super(e,t),mh(this,"_enabled",!0),mh(this,"_muted",!1),mh(this,"_isExternalTrack",!1),mh(this,"_isClosed",!1),mh(this,"_enabledMutex",void 0),mh(this,"processor",void 0),mh(this,"_processorContext",void 0),mh(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Uy("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Am.debug("[".concat(this.getTrackId(),"] close")),this.emit(u_.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oS(this,u_.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Am.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(v_.TRACK_ENDED)}stateCheck(e,t){if(Am.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Yg(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new ym(Em.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new ym(Em.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function By(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}!function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"}(xy||(xy={}));const Fy=window.AudioContext||window.webkitAudioContext;let Gy=null;const Hy=new class extends vm{constructor(){super(...arguments),mh(this,"prevState",void 0),mh(this,"curState",void 0),mh(this,"currentTime",void 0),mh(this,"currentTimeStuckAt",void 0),mh(this,"interruptDetectorTrack",void 0),mh(this,"onLocalAudioTrackMute",(()=>{Am.info("ios15-interruption-start"),this.emit(xy.IOS_15_16_INTERRUPTION_START)})),mh(this,"onLocalAudioTrackUnmute",(async()=>{Am.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?Am.info("ios15-interruption-end-canceled"):(Gy&&await Gy.suspend(),this.emit(xy.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){Am.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){Am.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Wy(){if(!Fy)return void Am.error("your browser is not support web audio");Am.info("create audio context");const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?By(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):By(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Wm("WEBAUDIO_INIT_OPTIONS"));Am.debug("audio context init option:",JSON.stringify(e)),Gy=new Fy(e),Hy.curState=Gy.state,Gy.onstatechange=()=>{Hy.prevState=Hy.curState,Hy.curState=Gy?Gy.state:void 0;const{prevState:e,curState:t}=Hy,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,a="interrupted"===e,s=Vp().osVersion;(Yp()||nh())&&i&&r&&(Am.info("ios".concat(s,"-interruption-start")),Hy.emit(xy.IOS_INTERRUPTION_START)),(Yp()||nh())&&(o||a)&&n&&(Am.info("ios".concat(s,"-interruption-end")),Hy.emit(xy.IOS_INTERRUPTION_END)),e!==t&&(Am.debug("AudioContext State Change","".concat(e,"=>").concat(t)),Hy.emit(xy.STATE_CHANGE))},setInterval((()=>{var e;const t=null===(e=Gy)||void 0===e?void 0:e.currentTime;Hy.currentTime!==t?(Hy.currentTimeStuckAt&&(Am.debug("AudioContext current time resume at ".concat(t)),Hy.currentTimeStuckAt=void 0),Hy.currentTime=t):(t!==Hy.currentTimeStuckAt&&(ky.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:gv.TRACER}).onSuccess(),Am.warning("AudioContext current time stuck at ".concat(t))),Hy.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function a(t){"running"===e.state?s(!1):Yp()||nh()?"suspended"===e.state&&(s(!0),t&&e.resume().then(l,l)):"closed"!==e.state&&(s(!0),t&&e.resume().then(l,l))}function s(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,d,{capture:!0,passive:!0}):window.removeEventListener(t,d,{capture:!0,passive:!0})}}}function c(){a(!0)}function l(){a(!1)}function d(){a(!0)}function u(e){if(!o)if(n.paused)if(e){let t;p(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else p(!0);else p(!1)}function p(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,f,{capture:!0,passive:!0}):window.removeEventListener(t,f,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,u(!1)}function f(){u(!0)}if(Yp()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,u(!0)}Hy.on(xy.STATE_CHANGE,c),a(!1)}(Gy)}function Ky(){if(!Gy){if(Wy(),!Gy)throw new ym(Em.NOT_SUPPORTED,"can not create audio context");return Gy}return Gy}function qy(){return!!Gy}function Yy(e){if(function(){if(null!==zy)return zy;const e=Ky(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),zy=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e),e.disconnect=(r,i,o)=>{n.call(e),r?cS(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let zy=null;function Jy(e,t){let n=!1;const r=1/t;if(Wm("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=Ky();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const a=t.createOscillator();a.onended=o,a.connect(i),a.start(0),a.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class Xy{constructor(){mh(this,"context",void 0),mh(this,"analyserNode",void 0),mh(this,"sourceNode",void 0),this.context=Ky(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||Yp()||nh()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=Zn(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){Am.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Qy extends vm{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),mh(this,"outputNode",void 0),mh(this,"outputTrack",void 0),mh(this,"isPlayed",!1),mh(this,"sourceNode",void 0),mh(this,"context",void 0),mh(this,"audioBufferNode",void 0),mh(this,"destNode",void 0),mh(this,"audioOutputLevel",0),mh(this,"volumeLevelAnalyser",void 0),mh(this,"_processedNode",void 0),mh(this,"playNode",void 0),mh(this,"isDestroyed",!1),mh(this,"onNoAudioInput",void 0),mh(this,"isNoAudioInput",!1),mh(this,"_noAudioInputCount",0),this.context=Ky(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Yy(this.outputNode),this.volumeLevelAnalyser=new Xy}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(Dv.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!J_().webAudioMediaStreamDest)throw new ym(Em.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&dS((()=>{Hy.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Yp()||nh()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let e=0;e<n.length;e++)0!==n[e]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Qb(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Zy extends Qy{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),mh(this,"sourceNode",void 0),mh(this,"track",void 0),mh(this,"clonedTrack",void 0),mh(this,"audioElement",void 0),mh(this,"isCurrentTrackCloned",!1),mh(this,"isRemoteTrack",!1),mh(this,"originVolumeLevelAnalyser",void 0),mh(this,"rebuildWebAudio",(async()=>{if(Am.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Am.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>Am.info("resume success"))),Am.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),Yy(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),Yy(this.outputNode),this.emit(Dv.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new ym(Em.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),Yy(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,Am.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));Yy(t),this.originVolumeLevelAnalyser=new Xy,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=Vp();t&&o.os===Np.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(Hy.on(xy.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),Yy(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Dv.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Hy.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),Am.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));Yy(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function $y(e,t){const n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function ew(e){const t=await tw(e.mediaSource),n=await function(e){return new Eu(((t,n)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const s=document.createElement("div");s.setAttribute("style","text-align: right; padding: 16px 0;");const c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(l);const e=new Error("NotAllowedError");e.name="NotAllowedError",n(e)},s.appendChild(c),i.appendChild(o),i.appendChild(a),i.appendChild(s);const l=document.createElement("div");l.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),l.appendChild(r),l.appendChild(i),document.body.appendChild(l),e.map((e=>{if(e.id){const n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;const{width:i}=r.getSize();i>1920&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",n.onclick=()=>{document.body.removeChild(l),t(e.id)},a.appendChild(n)}}))}))}(t);return await $y(n,e)}async function tw(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=rw();if(!n)throw new ym(Em.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new Eu(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new ym(Em.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}let nw=null;function rw(){if(nw)return nw;try{return nw=window.require("electron"),nw}catch(e){return null}}function iw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const ow=new Uy("safari");let aw=!1,sw=!1;async function cw(e,t){let n=0,r=null;for(;n<2;)try{r=await lw(e,t,n>0);break}catch(e){if(e instanceof ym)throw Am.error("[".concat(t,"] ").concat(e.toString())),e;const r=dw(e.name||e.code||e,e.message);if(r.code===Em.MEDIA_OPTION_INVALID){Am.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Qb(500);continue}throw Am.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new ym(Em.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function lw(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ym(Em.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=J_(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return Am.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(rw())e.screen.sourceId?uw(i,await $y(e.screen.sourceId,e.screen)):uw(i,await ew(e.screen));else if(Wp()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new ym(Em.NOT_SUPPORTED,"This browser does not support screen sharing");Am.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,s=t,new Eu(((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},(n=>{if(!n||!n.streamId)return Am.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new ym(Em.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){Am.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new ym(Em.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,uw(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&w_(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s};!r&&delete c.selfBrowserSurface,!a&&delete c.surfaceSwitching,!s&&delete c.systemAudio,Am.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c})),uw(i,await navigator.mediaDevices.getDisplayMedia(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iw(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({video:n,audio:!!e.screenAudio},c)))}else{if(!qp())throw Am.error("[".concat(t,"] This browser does not support screenSharing")),new ym(Em.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&w_(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};Am.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),uw(i,await navigator.mediaDevices.getUserMedia(n))}}var a,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=Wm("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=function e(t,n){if(!ES(t)||!ES(n))return n;if(Array.isArray(t)&&!Array.isArray(n)||!Array.isArray(t)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(t)){const r=[...t];for(let i=0;i<n.length;i++)r[i]=e(t[i],n[i]);return r}{const r=Jb({},t);for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(Object.prototype.hasOwnProperty.call(t,i)?r[i]=e(t[i],n[i]):r[i]=n[i]);return r}}(c,l)}catch(e){}Am.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),Vp();let d,u=null;(Kp()||Yp()||Fp())&&(u=await ow.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(aw=!0),c.video&&(sw=!0),uw(i,d),u&&u(),i}function dw(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ym(Em.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ym(Em.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ym(Em.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ym(Em.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ym(Em.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ym(Em.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return Am.error("getUserMedia unexpected error",e),new ym(Em.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function uw(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const pw=new class extends vm{get state(){return this._state}set state(e){e!==this._state&&(this.emit(_v.STATE_CHANGE,e),this._state=e)}constructor(){super(),mh(this,"_state",vv.IDLE),mh(this,"isAccessMicrophonePermission",!1),mh(this,"isAccessCameraPermission",!1),mh(this,"lastAccessMicrophonePermission",!1),mh(this,"lastAccessCameraPermission",!1),mh(this,"checkdeviceMatched",!1),mh(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(Wm("ENUMERATE_DEVICES_INTERVAL")||(ah()||jp()===Np.HARMONY_OS)&&oh())&&this.updateDevicesInfo()}),Wm("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>Am.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ym(Em.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=null,c=null,l=null;if(!n&&(o||a)){if(ow.isLocked&&(Am.debug("[device manager] wait GUM lock"),(await ow.lock())(),Am.debug("[device manager] GUM unlock")),aw&&(o=!1,this.isAccessMicrophonePermission=!0),sw&&(a=!1,this.isAccessCameraPermission=!0),Am.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=dw(e.name||e.code||e,e.message);if(t.code===Em.PERMISSION_DENIED)throw t;Am.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=dw(e.name||e.code||e,e.message);if(t.code===Em.PERMISSION_DENIED)throw t;Am.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=dw(e.name||e.code||e,e.message);if(t.code===Em.PERMISSION_DENIED)throw t;Am.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}Am.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,e}catch(e){return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,new ym(Em.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new ym(Em.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=vv.INITING;try{await this.updateDevicesInfo(),this.state=vv.INITEND}catch(e){throw Am.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=vv.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new ym(Em.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?Am.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):Am.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):Am.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==vv.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_v.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(_v.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_v.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const e of t)if(e.label&&e.deviceId){r.audio=!0;break}for(const e of n)if(e.label&&e.deviceId){r.video=!0;break}return r}},hw=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],fw=new class{constructor(){mh(this,"onAutoplayFailed",void 0),mh(this,"elementMap",new Map),mh(this,"elementStateMap",new Map),mh(this,"elementsNeedToResume",[]),mh(this,"sinkIdMap",new Map),mh(this,"autoResumeAfterInterruption",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=this.elementStateMap.get(t),i=n.srcObject.getAudioTracks()[0];$p()?i&&"live"===i.readyState&&"running"===Hy.curState&&(Am.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):r&&"paused"===r&&i&&"live"===i.readyState&&"running"===Hy.curState&&(Am.debug("auto resume after interruption for iOS"),n.play())}))})),mh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(Am.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),Hy.on(xy.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hy.on(xy.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Hy.on(xy.STATE_CHANGE,(()=>{Yp()&&"suspended"===Hy.prevState&&"running"===Hy.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new ym(Em.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,sv.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{Am.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){Am.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=i.play();a&&a.then&&a.catch((e=>{r&&ky.autoplayFailed(r,"audio",e.message,t),Am.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(Am.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),dS((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Ry()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){hw.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(Am.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&Am.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{Am.debug("Auto resume audio element success")})).catch((e=>{Am.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new Eu((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{sh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function mw(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new ym(Em.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof Eu?new Eu(((e,t)=>{i.then(e).catch(t)})):i}),n}}var gw=qn("Array").values,vw=$i,_w=He,Ew=u,yw=gw,ww=Array.prototype,bw={DOMTokenList:!0,NodeList:!0},Sw=function(e){var t=e.values;return e===ww||Ew(ww,e)&&t===ww.values||_w(bw,vw(e))?yw:t};function Tw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tw(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Rw extends vm{constructor(e){super(),mh(this,"name","VideoProcessorDestination"),mh(this,"ID","0"),mh(this,"_source",void 0),mh(this,"videoContext",void 0),mh(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ym(Em.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ym(Em.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(x_.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(x_.ON_TRACK,void 0)}}class Iw extends vm{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),mh(this,"constraintsMap",new Map),mh(this,"statsRegistry",[]),mh(this,"usageRegistry",[]),mh(this,"trackId",void 0),mh(this,"direction",void 0),mh(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await iS(this,M_.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return Am.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oS(this,M_.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sw(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return Am.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),oS(this,M_.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sw(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){Am.error(new ym(Em.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Eu&&(n=await n),e.push(Cw(Cw({},n),{},{direction:this.direction}))}catch(e){Am.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Ow extends vm{constructor(e){super(),mh(this,"name","AudioProcessorDestination"),mh(this,"ID","0"),mh(this,"inputTrack",void 0),mh(this,"inputNode",void 0),mh(this,"audioProcessorContext",void 0),mh(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ym(Em.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ym(Em.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(x_.ON_TRACK,void 0),this.emit(x_.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(x_.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(x_.ON_NODE,this.inputNode))}}class Aw extends vm{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),mh(this,"constraintsMap",new Map),mh(this,"statsRegistry",[]),mh(this,"audioContext",void 0),mh(this,"trackId",void 0),mh(this,"direction",void 0),mh(this,"usageRegistry",[]),mh(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return iS(this,M_.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return Am.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oS(this,M_.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sw(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),oS(this,M_.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sw(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){Am.error(new ym(Em.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Eu&&(n=await n),e.push(Cw(Cw({},n),{},{direction:this.direction}))}catch(e){Am.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Nw extends vm{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),mh(this,"context",void 0),mh(this,"processSourceNode",void 0),mh(this,"outputTrack",void 0),mh(this,"processedNode",void 0),mh(this,"clonedTrack",void 0),mh(this,"outputNode",void 0),this.outputNode=new Lw}setVolume(){}createOutputTrack(){throw new ym(Em.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Lw{disconnect(){}connect(){}}let Pw,kw=null;class Dw{constructor(){mh(this,"state","open"),mh(this,"trigger",void 0),mh(this,"tasks",[]),Am.debug("[macro-task-queue] is created."),this.trigger=setTimeout((()=>{this.state="closed",Am.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map((e=>e.key)),"]")),this.trigger=void 0,this.tasks.forEach((e=>{let{func:t}=e;return t()})),this.tasks.length=0,Am.debug("[macro-task-queue] is closed.")}))}enqueue(e,t){"closed"!==this.state&&(this.tasks.push({key:e,func:t}),Am.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")))}runTask(e){if("closed"===this.state)return;const t=this.tasks.findIndex((t=>t.key===e));if(-1!==t){const n=this.tasks.splice(t,1);Am.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")),n[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,Am.debug("[macro-task-queue] is closed."))}}function xw(e){return function(t,n,r){var i;const o=null!==(i=r.value)&&void 0!==i?i:r.get,a=function(){kw&&"open"===kw.state&&kw.runTask(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==o?void 0:o.apply(this,...n)};return r.value?r.value=a:r.get=a,r}}var Mw,Uw,Vw,jw,Bw,Fw,Gw,Hw,Ww,Kw,qw,Yw,zw,Jw,Xw,Qw,Zw,$w,eb,tb,nb,rb,ib,ob,ab,sb,cb,lb,db,ub,pb,hb,fb,mb,gb,vb,_b,Eb,yb,wb,bb,Sb;function Tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tb(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.UPDATE_TRACK_SOURCE="update-track-source"}(Pw||(Pw={}));let Rb=(Mw=xw("INIT_WEBAUDIO"),Uw=xw("INIT_WEBAUDIO"),Vw=xw("INIT_WEBAUDIO"),jw=Py({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Bw=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),Fw=mw(),Gw=Vy("LocalAudioTrack","_enabledMutex"),Hw=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),Ww=mw(),Kw=Vy("LocalAudioTrack","_enabledMutex"),qw=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),Yw=mw(),zw=mw(),Jw=mw(),Xw=Py({argsMap:e=>[e.getTrackId()]}),Qw=mw(),Zw=Py({argsMap:e=>[e.getTrackId()]}),$w=mw(),eb=Py({argsMap:e=>[e.getTrackId()]}),tb=Py({argsMap:(e,t)=>[e.getTrackId(),t.name]}),nb=Py({argsMap:e=>[e.getTrackId()]}),cy((rb=class extends jy{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?fw.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r,i){super(e,n),mh(this,"trackMediaType","audio"),mh(this,"_encoderConfig",void 0),mh(this,"_trackSource",void 0),mh(this,"_enabled",!0),mh(this,"_volume",100),mh(this,"_useAudioElement",!1),mh(this,"_bypassWebAudio",!1),mh(this,"processor",void 0),mh(this,"_processorContext",void 0),mh(this,"_processorDestination",void 0),mh(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r;const o=()=>{this.processorContext=new Aw(this._source.context,this.getTrackId(),"local"),this.processorDestination=new Ow(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Dv.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))},a=i&&Kp()&&!qy();Wm("DISABLE_WEBAUDIO")?(this._source=new Nw,this._useAudioElement=!0,this._bypassWebAudio=!0):a?this._source=new Nw:(this._source=new Zy(e,!1,this._getOriginVolumeLevel?e:void 0),Wm("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),o(),!Wm("DISABLE_WEBAUDIO")&&a&&(kw||(kw=new Dw),kw).enqueue("INIT_WEBAUDIO",(()=>{this._source=new Zy(e,!1,this._getOriginVolumeLevel?e:void 0),Wm("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),o(),this.emit(Pw.UPDATE_TRACK_SOURCE)}))}setVolume(e){Jg(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&fw.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Am.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,oS(this,u_.NEED_REPLACE_TRACK,this).then((()=>{Am.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{Am.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new ym(Em.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fw.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Am.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await oS(this,u_.NEED_ENABLE_TRACK,this),Am.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),Am.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await oS(this,u_.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),Am.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Am.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oS(this,u_.NEED_MUTE_TRACK,this):await oS(this,u_.NEED_UNMUTE_TRACK,this))}getStats(){return hS((()=>{Am.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),aS(this,u_.GET_STATS)||Cb({},Bv)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Dv.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Dv.ON_AUDIO_BUFFER),this._source.on(Dv.ON_AUDIO_BUFFER,(t=>e(t)))}play(){Am.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Am.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fw.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Am.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fw.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Am.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fw.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oS(this,u_.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Eu.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ym(Em.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ym(Em.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(x_.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await oS(this,u_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oS(this,u_.NEED_REPLACE_TRACK,this))})),this.processorDestination.on(x_.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x_.ON_TRACK),this.processorDestination.removeAllListeners(x_.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(M_.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(M_.REQUEST_CONSTRAINTS)}}).prototype,"_source",[Mw],Object.getOwnPropertyDescriptor(rb.prototype,"_source"),rb.prototype),cy(rb.prototype,"processorContext",[Uw],Object.getOwnPropertyDescriptor(rb.prototype,"processorContext"),rb.prototype),cy(rb.prototype,"processorDestination",[Vw],Object.getOwnPropertyDescriptor(rb.prototype,"processorDestination"),rb.prototype),cy(rb.prototype,"setVolume",[jw],Object.getOwnPropertyDescriptor(rb.prototype,"setVolume"),rb.prototype),cy(rb.prototype,"setPlaybackDevice",[Bw,Fw],Object.getOwnPropertyDescriptor(rb.prototype,"setPlaybackDevice"),rb.prototype),cy(rb.prototype,"setEnabled",[Gw,Hw,Ww],Object.getOwnPropertyDescriptor(rb.prototype,"setEnabled"),rb.prototype),cy(rb.prototype,"setMuted",[Kw,qw,Yw],Object.getOwnPropertyDescriptor(rb.prototype,"setMuted"),rb.prototype),cy(rb.prototype,"getStats",[zw],Object.getOwnPropertyDescriptor(rb.prototype,"getStats"),rb.prototype),cy(rb.prototype,"setAudioFrameCallback",[Jw],Object.getOwnPropertyDescriptor(rb.prototype,"setAudioFrameCallback"),rb.prototype),cy(rb.prototype,"play",[Xw,Qw],Object.getOwnPropertyDescriptor(rb.prototype,"play"),rb.prototype),cy(rb.prototype,"stop",[Zw,$w],Object.getOwnPropertyDescriptor(rb.prototype,"stop"),rb.prototype),cy(rb.prototype,"close",[eb],Object.getOwnPropertyDescriptor(rb.prototype,"close"),rb.prototype),cy(rb.prototype,"pipe",[tb],Object.getOwnPropertyDescriptor(rb.prototype,"pipe"),rb.prototype),cy(rb.prototype,"unpipe",[nb],Object.getOwnPropertyDescriptor(rb.prototype,"unpipe"),rb.prototype),rb),Ib=(ib=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),ob=mw(),ab=Vy("MicrophoneAudioTrack","_enabledMutex"),sb=Py({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),cb=mw(),lb=Py({argsMap:e=>[e.getTrackId()]}),cy((db=class extends Rb{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Gm(t.encoderConfig):{},r,Wm("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),mh(this,"_config",void 0),mh(this,"_deviceName","default"),mh(this,"_constraints",void 0),mh(this,"_originalConstraints",void 0),mh(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),($p()||eh())&&Hy.bindInterruptDetectorTrack(this),this.on(Pw.UPDATE_TRACK_SOURCE,(()=>{this.bindProcessorContextEvents()})),qy()&&this.bindProcessorContextEvents()}async setDevice(e){if(Am.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await pw.getDeviceById(e),n={};n.audio=Cb({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await cw(n,this.getTrackId())}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await cw({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await pw.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return Am.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Am.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await oS(this,u_.NEED_DISABLE_TRACK,this)}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=Cb({},this._constraints),o=pw.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await cw({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await oS(this,u_.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),Am.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),($p()||eh())&&Hy.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Yp()||nh())&&this._enabled&&!this._isClosed&&Hy.duringInterruption){const e=async()=>{Hy.off(xy.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Am.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Hy.on(xy.IOS_INTERRUPTION_END,e)}else Am.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(v_.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=pw.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await cw({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(M_.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(M_.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}).prototype,"setDevice",[ib,ob],Object.getOwnPropertyDescriptor(db.prototype,"setDevice"),db.prototype),cy(db.prototype,"setEnabled",[ab,sb,cb],Object.getOwnPropertyDescriptor(db.prototype,"setEnabled"),db.prototype),cy(db.prototype,"close",[lb],Object.getOwnPropertyDescriptor(db.prototype,"close"),db.prototype),db),Ob=(ub=Py({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),pb=mw(),hb=Py({argsMap:e=>[e.getTrackId()]}),fb=mw(),mb=Py({argsMap:e=>[e.getTrackId()]}),gb=mw(),vb=Py({argsMap:e=>[e.getTrackId()]}),_b=mw(),Eb=Py({argsMap:e=>[e.getTrackId()]}),yb=mw(),wb=Py({argsMap:e=>[e.getTrackId()]}),bb=mw(),cy((Sb=class extends Rb{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),mh(this,"source",void 0),mh(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(Dv.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(v_.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){Jg(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[ub,pb],Object.getOwnPropertyDescriptor(Sb.prototype,"startProcessAudioBuffer"),Sb.prototype),cy(Sb.prototype,"pauseProcessAudioBuffer",[hb,fb],Object.getOwnPropertyDescriptor(Sb.prototype,"pauseProcessAudioBuffer"),Sb.prototype),cy(Sb.prototype,"seekAudioBuffer",[mb,gb],Object.getOwnPropertyDescriptor(Sb.prototype,"seekAudioBuffer"),Sb.prototype),cy(Sb.prototype,"resumeProcessAudioBuffer",[vb,_b],Object.getOwnPropertyDescriptor(Sb.prototype,"resumeProcessAudioBuffer"),Sb.prototype),cy(Sb.prototype,"stopProcessAudioBuffer",[Eb,yb],Object.getOwnPropertyDescriptor(Sb.prototype,"stopProcessAudioBuffer"),Sb.prototype),cy(Sb.prototype,"setAudioBufferPlaybackSpeed",[wb,bb],Object.getOwnPropertyDescriptor(Sb.prototype,"setAudioBufferPlaybackSpeed"),Sb.prototype),Sb);class Ab extends Rb{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Ky().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,$b(8,"track-mix-")),mh(this,"trackList",void 0),mh(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(Am.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Am.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){Am.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}cS(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof Ab?t.emit(g_.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class Nb extends vm{constructor(){super(...arguments),mh(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(Wm("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){const n=r.result.includes(!0);r.isPrevNormal&&!n&&this.emit("exception",Lb[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",Lb[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof Ab&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=Fb(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof Ab&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const Lb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Pb=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function kb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Db(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kb(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class xb{constructor(e){mh(this,"store",void 0),mh(this,"onStatsException",void 0),mh(this,"onUploadPublishDuration",void 0),mh(this,"onStatsChanged",void 0),mh(this,"localStats",new Map),mh(this,"remoteStats",new Map),mh(this,"updateStatsInterval",void 0),mh(this,"trafficStats",void 0),mh(this,"trafficStatsPeerList",[]),mh(this,"uplinkStats",void 0),mh(this,"exceptionMonitor",void 0),mh(this,"p2pChannel",void 0),mh(this,"scalabilityMode",Dp.L1T1),mh(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Nb,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(N_.LocalAudioTrack)||Db({},Bv)}getLocalVideoTrackStats(){return this.localStats.get(N_.LocalVideoTrack)||Db({},Fv)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(N_.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get(N_.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const a=this.localStats.get(N_.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?Pb.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?Pb.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Am.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case N_.LocalVideoTrack:case N_.LocalVideoLowTrack:{const t=r,o=Db({},Fv),a=e.getStats(),s=e.getLocalMedia(n);if(a){const n=a.videoSend.find((e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig(N_.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(Am.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&s&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,s.track,o);break}case N_.LocalAudioTrack:{const t=r,i=Db({},Bv),o=e.getStats(),a=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(N_.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{let[n,{videoStats:r,audioStats:i,videoPcStats:o}]=t;const a=i,s=r,c=o,l=Db({},Gv),d=Db({},Wv),u=Db({},Hv),{audioTrack:p,videoTrack:h,audioSSRC:f,videoSSRC:m}=e.getRemoteMedia(n),g=e.getStats(),v=null==g?void 0:g.audioRecv.find((e=>e.ssrc===f)),_=null==g?void 0:g.videoRecv.find((e=>e.ssrc===m)),E=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===n));if(v&&("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(l.codecType=v.codec),v.outputLevel?l.receiveLevel=Math.round(32767*v.outputLevel):p&&(l.receiveLevel=Math.round(32767*p.getVolumeLevel())),l.receiveBytes=v.bytes,l.receivePackets=v.packets,l.receivePacketsLost=v.packetsLost,l.packetLossRate=l.receivePacketsLost/(l.receivePackets+l.receivePacketsLost),l.receiveBitrate=a?8*Math.max(0,l.receiveBytes-a.receiveBytes):0,l.totalDuration=a?a.totalDuration+1:1,l.totalFreezeTime=a?a.totalFreezeTime:0,l.freezeRate=l.totalFreezeTime/l.totalDuration,l.receiveDelay=v.jitterBufferMs,l.totalDuration>10&&xb.isRemoteAudioFreeze(p)&&(l.totalFreezeTime+=1)),_){"H264"!==_.codec&&"H265"!==_.codec&&"VP8"!==_.codec&&"VP9"!==_.codec&&"AV1X"!==_.codec&&"AV1"!==_.codec||(d.codecType=_.codec),d.receiveBytes=_.bytes,d.receiveBitrate=s?8*Math.max(0,d.receiveBytes-s.receiveBytes):0,d.decodeFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,d.renderFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,_.outputFrame&&(d.renderFrameRate=_.outputFrame.frameRate),_.receivedFrame?(d.receiveFrameRate=_.receivedFrame.frameRate,d.receiveResolutionHeight=_.receivedFrame.height,d.receiveResolutionWidth=_.receivedFrame.width):h&&(d.receiveResolutionHeight=h._videoHeight||0,d.receiveResolutionWidth=h._videoWidth||0),void 0!==_.framesRateFirefox&&(d.receiveFrameRate=Math.round(_.framesRateFirefox)),d.receivePackets=_.packets,d.receivePacketsLost=_.packetsLost,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.totalDuration=s?s.totalDuration+1:1,d.totalFreezeTime=s?s.totalFreezeTime:0,d.receiveDelay=_.jitterBufferMs||0;const t=!!m&&e.getRemoteVideoIsReady(m);h&&t&&xb.isRemoteVideoFreeze(h,_,c)&&(d.totalFreezeTime+=1),d.freezeRate=d.totalFreezeTime/d.totalDuration}E&&(l.end2EndDelay=E.B_ad,d.end2EndDelay=E.B_vd,l.transportDelay=E.B_ed,d.transportDelay=E.B_ed,l.currentPacketLossRate=E.B_ealr4/100,d.currentPacketLossRate=E.B_evlr4/100,u.uplinkNetworkQuality=E.B_punq?E.B_punq:0,u.downlinkNetworkQuality=E.B_pdnq?E.B_pdnq:0),this.remoteStats.set(n,{audioStats:l,videoStats:d,videoPcStats:_,networkStats:u}),p&&this.exceptionMonitor.setRemoteAudioStats(p,l),h&&this.exceptionMonitor.setRemoteVideoStats(h,d)}))}}const Mb=new class extends vm{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),mh(this,"_lastHiddenTime",0),mh(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Am.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};function Ub(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ub(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ub(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jb(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Wm("TURN_DOMAIN")):(Am.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function Bb(e,t){var n,r;const i=Wm("GATEWAY_DOMAINS");let o=i[1]&&-1!==t.indexOf(i[1])?1:0;e.addresses=e.addresses||[];const a=e.addresses.map((e=>e.domain_prefix?{address:"".concat(e.domain_prefix,".").concat(i[o++%i.length],":").concat(e.port)}:e.ip.match(/^[\.\:\d]+$/)?{ip:e.ip,port:e.port,address:"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(i[o++%i.length],":").concat(e.port)}:(Am.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),{ip:e.ip,port:e.port,address:"".concat(e.ip,":").concat(e.port)})));if(null!==(n=e.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[18])){const t=e.detail[18],n=null==t?void 0:t.split(";");for(let e=0;e<n.length;e++){var s;const t=vp(s=n[e]).call(s);a[e]&&t&&(a[e].ip6=t)}}return{gatewayAddrs:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Fb(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Gb(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Fb(t.width),"x").concat(Fb(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function Hb(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Wb(e,t){let n,r,i;switch(t){case X_.CHOOSE_SERVER:n=4096,r="choose server";break;case X_.CLOUD_PROXY:n=1048576,r="proxy";break;case X_.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case X_.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new ym(Em.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===n&&(i={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>Vb(Vb({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:Vb(Vb({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!i)throw new ym(Em.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function Kb(e,t){return await Eu.all(e.addresses.map((async e=>({address:jb(e.ip),tcpport:e.port,udpport:e.port,username:t&&Wm("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Dm.username,password:t&&Wm("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Ay(t.toString()):Dm.password}))))}function qb(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||Am.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/Fb(e.width):4}function Yb(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:a}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:a}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:a}}function zb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zb(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xb(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Qb(e){return new Eu((t=>{window.setTimeout(t,e)}))}function Zb(e){const t=new ym(Em.TIMEOUT,"timeout");return new Eu(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function $b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+$b(e-n.length,"")}function eS(){return $b(32,"").toUpperCase()}const tS=()=>{};function nS(e){return new Eu(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=Yp()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&qp()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(tS),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function rS(e){return Eu.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}function iS(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?Eu.reject(new ym(Em.UNEXPECTED_ERROR,"can not emit promise")):new Eu(((n,i)=>{e.emit(t,...r,n,i)}))}function oS(e,t){if(0===e.getListeners(t).length)return Eu.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return iS(e,t,...r)}function aS(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return sS(e,t,...r)}function sS(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new ym(Em.UNEXPECTED_ERROR,"handler is not sync");return n}function cS(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function lS(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function dS(e){Eu.resolve().then(e)}function uS(e){return JSON.parse(JSON.stringify(e))}const pS={};function hS(e,t){pS[t]||(pS[t]=!0,e())}function fS(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)n[e]=t.charCodeAt(e);return n}function mS(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const gS=new class{constructor(){mh(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const a=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,Jb(Jb({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},vS=gS.throttleByKey.bind(gS),_S=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,a=0;const s=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*s,t=e+s;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await rS(e)}catch(e){if(l+=s,a++,!(l>=n.length))return void await d();i(e)}e.forEach((e=>e.cancel()))};return await d(),c};function ES(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}const yS={[Ev.ACCESS_POINT]:{[bv.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[bv.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[bv.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[bv.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[bv.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[bv.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[bv.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ev.UNILBS]:{[wv.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[wv.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[wv.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[wv.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[wv.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[wv.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[wv.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[wv.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[wv.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[wv.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[wv.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[wv.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ev.STRING_UID_ALLOCATOR]:{[yv.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[yv.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[yv.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wS(e){const t=yS[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Ev.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const bS={[Sv.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Sv.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Sv.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Sv.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Sv.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Sv.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Sv.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Sv.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Sv.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Sv.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Sv.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Sv.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Sv.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Sv.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Sv.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Sv.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Sv.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Sv.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Sv.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Sv.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Sv.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Sv.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Sv.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Sv.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Sv.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Sv.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Sv.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Sv.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Sv.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Sv.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Sv.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Sv.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Sv.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Sv.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Sv.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Sv.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Sv.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Sv.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Sv.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Sv.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Sv.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Sv.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Sv.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Sv.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Sv.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Sv.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Sv.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Sv.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Sv.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Sv.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Sv.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Sv.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Sv.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Sv.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Sv.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Sv.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Sv.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Sv.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Sv.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Sv.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Sv.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Sv.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Sv.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Sv.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function SS(e){return bS[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function TS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class CS extends vm{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Kv.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Kv.CONNECTED):"closed"===this._state?this.emit(Kv.CLOSED):"failed"===this._state&&this.emit(Kv.FAILED))}resetReconnectCount(e){Am.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;super(),mh(this,"connectionID",0),mh(this,"currentURLIndex",0),mh(this,"urls",void 0),mh(this,"_reconnectMode","tryNext"),mh(this,"reconnectReason",void 0),mh(this,"_initMutex",new Uy("websocket")),mh(this,"name",void 0),mh(this,"_state","closed"),mh(this,"reconnectInterrupter",void 0),mh(this,"websocket",void 0),mh(this,"retryConfig",void 0),mh(this,"reconnectCount",0),mh(this,"forceCloseTimeout",5e3),mh(this,"onlineReconnectListener",void 0),mh(this,"useCompress",void 0),mh(this,"tryDoubleDomain",!1),mh(this,"wsInflateLength",0),mh(this,"wsDeflateLength",0),mh(this,"closeEstablishingWs",(()=>{})),mh(this,"store",void 0),mh(this,"joinChannelServiceRecordIndex",void 0),this.store=i,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TS(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r;const{timeout:o,timeoutFactor:a}=t,s=Math.max(300,Math.floor(3*o/5)),c=Math.max(1.2,Math.floor(8*a)/10);k_.ONLINE&&(this.retryConfig.timeout=s,this.retryConfig.timeoutFactor=c),Sy.on(D_.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===k_.ONLINE?(this.retryConfig.timeout=s,this.retryConfig.timeoutFactor=c):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=a))}))}getConnection(){return this.websocket||void 0}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this.forceCloseTimeout=t;const n=(t,n)=>{this.urls=e;const r=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(r).then(t).catch(n),this.once(Kv.CLOSED,(()=>n(new ym(Em.WS_DISCONNECT)))),this.once(Kv.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new Eu(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void Am.warning("[".concat(this.name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),Am.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinChannelServiceRecordIndex&&(null===(n=this.store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinChannelServiceRecordIndex));const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ym(Em.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new ym(Em.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e,t){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new Eu(((n,r)=>{var i;const o=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),Am.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},a=async e=>{if(Am.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=aS(this,Kv.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(t);if("closed"===this.state)return void Am.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!i)return r(new ym(Em.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),void this.close(!0);n()}else r(new ym(Em.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close()},s=e=>{this.emit(Kv.ON_MESSAGE,e)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Wm("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=Wm("GATEWAY_WSS_ADDRESS")),Am.debug("[".concat(this.name,"] start connect, url: ").concat(e));const c=null===(i=this.store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(e,!!t,c).then((e=>{var t;this.websocket=e,o&&o(e.url),e.onclose=a,e.onmessage=s,null===(t=this.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinChannelServiceRecordIndex=c})).catch((e=>{var t;if(null===(t=this.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof ym&&e.code===Em.WS_ABORT?"aborted":"error",errors:[e]},c),"closed"!==this.state){if(e instanceof ym&&e.code===Em.WS_ERR){const t=new ym(Em.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Am.error("[".concat(this.name,"]").concat(t)),void r(t)}a&&a(e)}else r(new ym(Em.WS_DISCONNECT,"websocket is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(!this.urls)return!1;if("closed"===this.state)return!1;this.onlineReconnectListener||Sy.networkState!==k_.OFFLINE||(this.onlineReconnectListener=Sy.onlineWaiter&&Sy.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>{n=!1},t){const t=bm(this.reconnectCount,this.retryConfig);Am.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await Eu.race([Qb(t),this.onlineReconnectListener||new Eu((()=>{}))])}if("closed"===this.state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(Kv.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e){const t=this.urls[this.currentURLIndex];this.emit(Kv.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);Am.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const t=this.urls[this.currentURLIndex];this.emit(Kv.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("recover"===e){Am.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Kv.RECONNECT_WAITTING_FINISH,e),this.urls=await iS(this,Kv.REQUEST_NEW_URLS),this.currentURLIndex=0;const t=this.urls[this.currentURLIndex];await r(t,e)}return!0}catch(n){var i;return Am.error("[".concat(this.name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&n.data.desc.includes("dynamic key expired")?(this.emit(Kv.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}async chooseBestWebsocketConnection(e,t,n){return new Eu(((r,i)=>{let o=!1;const a=[];this.closeEstablishingWs=()=>{Am.debug("[choose-best-ws] close establishing websockets"),a.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),i(new ym(Em.WS_ABORT,"choose best websocket aborted"))};const s=Wm("GATEWAY_DOMAINS");let c;const l=e.indexOf("?h="),d=s.find((t=>-1!==l?e.includes(t,l):e.includes(t)));Am.debug("[choose-best-ws] currentDomain: ",d,", domains: ",s);let u=!this.tryDoubleDomain||t||!d;if(!u&&d){var p;const t=Date.now();try{s.forEach((t=>{const n=-1===l?e.replace(d,t):e.substr(0,l)+e.substr(l).replace(d,t),r=new WebSocket(n);r.binaryType="arraybuffer",a.push(r),Am.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(Am.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach((e=>e.close()));a.length;)a.pop();u=!0}null===(p=this.store)||void 0===p||p.recordJoinChannelService({urls:a.map((e=>e.url)),service:"gateway"},n),a.forEach((e=>{e.onopen=()=>{if(o)return;const n=Date.now()-t;Am.debug("[choose-best-ws] ws open cost ".concat(n,"ms")),a.filter((t=>t!==e)).forEach((e=>{Am.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),o=!0,r(e)},e.onclose=e=>{c=e,o||a.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(Am.debug("[choose-best-ws] all websocket is closed"),o=!0,i(c))},e.onmessage=t=>{Am.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),Qb(this.forceCloseTimeout).then((()=>{a.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(u){var h;let t;Am.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},n);try{t=new WebSocket(e),a.push(t),t.binaryType="arraybuffer"}catch(e){const t=new ym(Em.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Am.error("[".concat(this.name,"]").concat(t)),void i(t)}t.onopen=()=>{r(t)},t.onclose=e=>{i(e)},t.onmessage=e=>{Am.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))},Qb(this.forceCloseTimeout).then((()=>{t&&t.readyState!==WebSocket.OPEN&&t.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class RS{constructor(e){mh(this,"input",[]),mh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Zn(e=this.input).call(e,((e,t)=>e+t))/this.input.length}}class IS extends vm{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Ov.CONNECTED?this.emit(Av.WS_CONNECTED):e===Ov.RECONNECTING?this.emit(Av.WS_RECONNECTING,this._websocketReconnectReason):e===Ov.CLOSED&&this.emit(Av.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),mh(this,"_disconnectedReason",void 0),mh(this,"_websocketReconnectReason",void 0),mh(this,"_connectionState",Ov.CLOSED),mh(this,"reconnectToken",void 0),mh(this,"websocket",void 0),mh(this,"openConnectionTime",void 0),mh(this,"clientId",void 0),mh(this,"lastMsgTime",Date.now()),mh(this,"uploadCache",[]),mh(this,"uploadCacheInterval",void 0),mh(this,"rttRolling",new RS(5)),mh(this,"pingpongTimer",void 0),mh(this,"wsInflateDataTimer",void 0),mh(this,"pingpongTimeoutCount",0),mh(this,"joinResponse",void 0),mh(this,"multiIpOption",void 0),mh(this,"initError",void 0),mh(this,"spec",void 0),mh(this,"store",void 0),mh(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(Av.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===Pv.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Pv.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(Cv.UID_BANNED);break;case 15:this.close(Cv.IP_BANNED);break;case 16:this.close(Cv.CHANNEL_BANNED)}if(t._type===Pv.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Sv.ERR_LICENSE_MISSING:this.close(Cv.LICENSE_MISSING);break;case Sv.ERR_LICENSE_EXPIRED:this.close(Cv.LICENSE_EXPIRED);break;case Sv.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Cv.LICENSE_MINUTES_EXCEEDED);break;case Sv.ERR_LICENSE_PERIOD_INVALID:this.close(Cv.LICENSE_PERIOD_INVALID);break;case Sv.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Cv.LICENSE_MULTIPLE_SDK_SERVICE);break;case Sv.ERR_LICENSE_ILLEGAL:this.close(Cv.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new CS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Ov.CONNECTED&&this.reconnect("retry",Iv.OFFLINE)}))}async request(e,t,n,r){const i=$b(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Eu(((t,n)=>{if(this.connectionState===Ov.CONNECTED)return t();const r=()=>{this.off(Av.WS_CLOSED,i),t()},i=()=>{this.off(Av.WS_CONNECTED,r),n(new ym(Em.WS_ABORT))};this.once(Av.WS_CONNECTED,r),this.once(Av.WS_CLOSED,i),e!==Nv.PUBLISH&&e!==Nv.SUBSCRIBE&&e!==Nv.UNSUBSCRIBE&&e!==Nv.UNPUBLISH&&e!==Nv.CONTROL&&e!==Nv.RESTART_ICE||this.once(Av.DISCONNECT_P2P,(()=>{n(new ym(Em.DISCONNECT_P2P))})),e!==Nv.PUBLISH&&e!==Nv.RESTART_ICE||this.once(Av.ABORT_P2P_EXECUTION,(()=>{n(new ym(Em.DISCONNECT_P2P))}))}));if(this.connectionState!==Ov.CONNECTING&&this.connectionState!==Ov.RECONNECTING||e===Nv.JOIN||e===Nv.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;const c=new Eu(((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Av.WS_CLOSED,c),this.off(Av.WS_RECONNECTING,c),this.emit(Av.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new ym(Em.WS_ABORT,"type: ".concat(e))),this.off(Av.WS_CLOSED,c),this.off(Av.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(Av.WS_CLOSED,c),this.once(Av.WS_RECONNECTING,c),Qb(Wm("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(Am.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Av.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===Ov.CLOSED||e===Nv.LEAVE)throw new ym(Em.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Nv.JOIN||e===Nv.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=SS(d),p=new ym(Em.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message});return"success"===u.action?l.message:(Am.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Sv.ERR_TOO_MANY_BROADCASTERS?e===Nv.JOIN||e===Nv.REJOIN?(this.initError=p,this.close(),p.throw()):p.throw():"failed"===u.action?p.throw():"quit"===u.action?(this.initError=p,this.close(),p.throw()):(d===Sv.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,Am.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Iv.MULTI_IP)):this.reconnect(u.action,Iv.SERVER_ERROR),e===Nv.JOIN||e===Nv.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Eu((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=Wm("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Ov.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),Wm("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Eu(((n,r)=>{this.once(Av.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(Av.WS_CLOSED,(()=>r(this.initError||new ym(Em.WS_ABORT)))),this.connectionState=Ov.CONNECTING,this.websocket.init(e).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(Am.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),r(new ym(Em.INIT_WEBSOCKET_TIMEOUT)))}),Wm("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Cv.LEAVE,this.connectionState=Ov.CLOSED,Am.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===Cv.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new CS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Av.ABORT_P2P_EXECUTION);const e=await iS(this,Av.REQUEST_JOIN_INFO),t=await this.request(Nv.JOIN,e);if(!t)return this.emit(Av.REPORT_JOIN_GATEWAY,Em.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Av.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ov.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ym(Em.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=sS(this,Av.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Nv.REJOIN,e);return!!t&&(this.connectionState=Ov.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(Pv.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(Pv.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(Pv.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(Pv.MUTE_AUDIO,{uid:e.uid}):this.emit(Pv.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(Pv.MUTE_VIDEO,{uid:e.uid}):this.emit(Pv.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(Pv.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(Pv.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(Pv.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(Pv.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(Pv.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Am.debug("[".concat(this.clientId,"] receive notification: "),e);const t=SS(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Cv.UID_BANNED),void this.close()):void this.reconnect(t.action,Iv.SERVER_ERROR);Am.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=Wm("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Am.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>Wm("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Iv.TIMEOUT):this.request(Nv.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),Wm("REPORT_STATS")&&this.send(Nv.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(Lv.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Kv.RECONNECT_WAITTING_FINISH,(e=>{this.emit(Av.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(Kv.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(Av.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(Kv.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Kv.CLOSED,(()=>{this.connectionState=Ov.CLOSED})),this.websocket.on(Kv.FAILED,(()=>{this._disconnectedReason=Cv.NETWORK_ERROR,this.connectionState=Ov.CLOSED})),this.websocket.on(Kv.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Ov.CONNECTED?this.connectionState=Ov.RECONNECTING:this.connectionState=Ov.CONNECTING})),this.websocket.on(Kv.WILL_RECONNECT,((e,t)=>{if(sS(this,Av.IS_P2P_DISCONNECTED)&&"retry"===e)return Am.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Av.NEED_RENEW_SESSION),this.emit(Av.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(Am.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(Av.NEED_RENEW_SESSION),this.emit(Av.DISCONNECT_P2P)),t(e)})),this.websocket.on(Kv.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Am.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Iv.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(Av.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof ym&&e.code===Em.UNEXPECTED_RESPONSE&&e.data.code===Sv.ERR_NO_AUTHORIZED)return Am.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Iv.SERVER_ERROR);Am.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Iv.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(Kv.REQUEST_NEW_URLS,((e,t)=>{iS(this,Av.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(Kv.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pv.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}function OS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class AS extends vm{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(F_.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(F_.CONNECTED):"closed"===this._state?this.emit(F_.CLOSED):"failed"===this._state&&this.emit(F_.FAILED))}constructor(e,t,n,r){super(),mh(this,"connectionID",0),mh(this,"currentURLIndex",0),mh(this,"reconnectReason",void 0),mh(this,"_reconnectMode","tryNext"),mh(this,"_initMutex",void 0),mh(this,"_name",void 0),mh(this,"_state","closed"),mh(this,"_reconnectInterrupter",void 0),mh(this,"_url",void 0),mh(this,"_retryConfig",void 0),mh(this,"_reconnectCount",0),mh(this,"_forceCloseTimeout",5e3),mh(this,"_onlineReconnectListener",void 0),mh(this,"_closeEstablishingTransmitter",(()=>{})),mh(this,"_store",void 0),mh(this,"_joinChannelServiceRecordIndex",void 0),mh(this,"_transmitter",void 0),mh(this,"_useCompress",void 0),mh(this,"_inflateLength",0),mh(this,"_deflateLength",0),this._store=r,this._name=e,this._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OS(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this._useCompress=n}resetReconnectCount(e){Am.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const e=this._transmitter;t?setTimeout((()=>e.close()),500):e.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void Am.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),Am.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function NS(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=Number(!!n),a=Number(!n);return BigInt(r*a+i*o)<<BigInt(32)|BigInt(r*o+i*a)}function LS(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,o,r)):(e.setUint32(t,i,r),e.setUint32(t+4,o,r))}let PS;!function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"}(PS||(PS={}));class kS{constructor(e,t,n){mh(this,"version",1),mh(this,"initialRTO",void 0),mh(this,"maxBatchAckCount",void 0),mh(this,"maxRTO",void 0),mh(this,"initialRTT",void 0),mh(this,"ID",void 0),mh(this,"rtt",void 0),mh(this,"packetNumber",1),mh(this,"rtoRatioMap",new Map),mh(this,"timeoutMap",new Map),mh(this,"unorderedPacketQueue",[]),mh(this,"batchAckPacketQueue",[]),mh(this,"lastOrderedPacketNumber",0),mh(this,"batchAckTimer",void 0),mh(this,"sendImpl",void 0),mh(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=$b(7,"transmitter-"),this.initialRTO=void 0!==(null==n?void 0:n.initialRTO)?n.initialRTO:Wm("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:Wm("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:Wm("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:Wm("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==n?void 0:n.maxRTO)?n.maxRTO:Wm("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:PS.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case PS.Default:{let t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;const n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),LS(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n}case PS.Ack:{const t=new ArrayBuffer(16),n=new DataView(t);return n.setUint16(0,e.version),n.setUint8(2,e.type),n.setUint32(3,e.maxAckPacketNumber),n.setUint8(7,e.shift),LS(n,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case PS.Default:{const i=t.getUint32(3),o=NS(t,7),a=e.slice(15),s=(new TextDecoder).decode(a);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:s}}case PS.Ack:{const e=t.getUint32(3),i=t.getUint8(7),o=NS(t,8);return{version:n,type:r,maxAckPacketNumber:e,shift:i,ackSendTs:Number(o)}}default:throw Am.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const n=this.calculateRTO(t),r=window.setTimeout((()=>{this.resendMessage(t)}),n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===PS.Default?this.ack(t):t.type===PS.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((e=>{let[t,n]=e;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),n=window.setTimeout((()=>{this.resendMessage(e)}),t);this.timeoutMap.set(e.packetNumber,n),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(e,t){const n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:PS.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:PS.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:PS.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===PS.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const e=this.timeoutMap.get(t);void 0!==e&&window.clearTimeout(e),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class DS extends AS{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),mh(this,"_initMutex",void 0),mh(this,"_reconnectInterrupter",void 0),mh(this,"_url",void 0),mh(this,"_transmitter",void 0),mh(this,"_addresses",void 0),mh(this,"_reliableTransmission",void 0),this._initMutex=new Uy("datachannel");const{timeout:n,timeoutFactor:r}=t,i=Math.max(300,Math.floor(3*n/5)),o=Math.max(1.2,Math.floor(8*r)/10);k_.ONLINE&&(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o),Sy.on(D_.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===k_.ONLINE?(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=r))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=t;const n=(t,n)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex((e=>e.fingerprint||Wm("FINGERPRINT")));const r=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(r).then(t).catch(n),this.once(F_.CLOSED,(()=>n(new ym(Em.WS_DISCONNECT)))),this.once(F_.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new Eu(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ym(Em.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new ym(Em.WS_ERR,"send datachannel signal message error"+e.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new Eu(((t,n)=>{var r;const i=()=>{Am.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},o=async e=>{var r;if(null===(r=this._closeEstablishingTransmitter)||void 0===r||r.call(this),Am.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const r=aS(this,F_.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(r);if("closed"===this.state)return void Am.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!i)return n(new ym(Em.WS_DISCONNECT,"datachannel reconnect failed: ".concat(e.code))),void this.close(!0);t()}else n(new ym(Em.WS_DISCONNECT,"datachannel close: ".concat(e.code))),this.close()},a=e=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.onData(e.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),Am.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const s=null===(r=this._store)||void 0===r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),c=Date.now();iS(this,F_.TO_CONNECT_DATACHANNEL,e).then((e=>{var t,n;if(!e)throw new Error("transmissonInfo not exist yet");const{transmitter:r,close:l}=e;this._transmitter=r,null===(t=this._store)||void 0===t||t.signalChannelOpen();const d=Date.now()-c;Am.debug("[choose dc] dc open cost ".concat(d,"ms")),this._reliableTransmission=new kS((e=>{var t;this._transmitter&&"open"===this._transmitter.readyState&&(null===(t=this._transmitter)||void 0===t||t.send(e))}),(e=>{"string"==typeof e&&this.emit(F_.ON_MESSAGE,e)})),this._closeEstablishingTransmitter=()=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.close(),this._reliableTransmission=void 0,l()},i&&i(),r.onclose=o,r.onmessage=a,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this._joinChannelServiceRecordIndex=s})).catch((e=>{var t;if(null===(t=this._store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof ym&&e.code===Em.WS_ABORT?"aborted":"error",errors:[e]},s),"closed"!==this.state){if(e instanceof ym&&e.code===Em.WS_ERR){const t=new ym(Em.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return Am.error("[".concat(this._name,"]").concat(t)),void n(t)}o&&o(e)}else n(new ym(Em.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount)return!1;if(!this._addresses)return!1;if("closed"===this.state)return!1;this._onlineReconnectListener||Sy.networkState!==k_.OFFLINE||(this._onlineReconnectListener=Sy.onlineWaiter&&Sy.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},t){const t=bm(this._reconnectCount,this._retryConfig);Am.debug("[".concat(this._name,"] wait ").concat(t,"ms to reconnect datachannel, mode: ").concat(e)),await Eu.race([Qb(t),this._onlineReconnectListener||new Eu((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;const r=async(e,t)=>{this.emit(F_.RECONNECT_CREATE_CONNECTION,t),await this.createTransmitterConnection(e)};try{if("retry"===e){const t=this._addresses[this.currentURLIndex];this.emit(F_.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){this.currentURLIndex+=1;for(let e=this.currentURLIndex;e<this._addresses.length;e++){if(this._addresses[e].fingerprint||Wm("FINGERPRINT")){this.currentURLIndex=e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return Am.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);Am.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const t=this._addresses[this.currentURLIndex];this.emit(F_.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else"recover"===e&&(Am.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(F_.RECONNECT_WAITTING_FINISH,e),this.emit(F_.FAILBACK));return!0}catch(n){var i;return Am.error("[".concat(this._name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&n.data.desc.includes("dynamic key expired")?(this.emit(F_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class xS extends vm{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Ov.CONNECTED?this.emit(Av.WS_CONNECTED):e===Ov.RECONNECTING?this.emit(Av.WS_RECONNECTING,this._websocketReconnectReason):e===Ov.CLOSED&&this.emit(Av.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),mh(this,"_disconnectedReason",void 0),mh(this,"_websocketReconnectReason",void 0),mh(this,"_connectionState",Ov.CLOSED),mh(this,"reconnectToken",void 0),mh(this,"websocket",void 0),mh(this,"openConnectionTime",void 0),mh(this,"clientId",void 0),mh(this,"lastMsgTime",Date.now()),mh(this,"uploadCache",[]),mh(this,"uploadCacheInterval",void 0),mh(this,"rttRolling",new RS(5)),mh(this,"pingpongTimer",void 0),mh(this,"inflateDataTimer",void 0),mh(this,"pingpongTimeoutCount",0),mh(this,"joinResponse",void 0),mh(this,"multiIpOption",void 0),mh(this,"initError",void 0),mh(this,"spec",void 0),mh(this,"store",void 0),mh(this,"onWebsocketMessage",(e=>{if(e instanceof ArrayBuffer)return void this.emit(Av.ON_BINARY_DATA,e);const t=JSON.parse(e);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(this.emit(t._type,t._message),t._type===Pv.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===Pv.ON_USER_BANNED))switch(t._message.error_code){case 14:this.close(Cv.UID_BANNED);break;case 15:this.close(Cv.IP_BANNED);break;case 16:this.close(Cv.CHANNEL_BANNED)}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new DS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Ov.CONNECTED&&this.reconnect("retry",B_.OFFLINE)}))}async request(e,t,n,r){const i=$b(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Eu(((t,n)=>{if(this.connectionState===Ov.CONNECTED)return t();const r=()=>{this.off(Av.WS_CLOSED,i),t()},i=()=>{this.off(Av.WS_CONNECTED,r),n(new ym(Em.WS_ABORT))};this.once(Av.WS_CONNECTED,r),this.once(Av.WS_CLOSED,i),e!==Nv.PUBLISH&&e!==Nv.SUBSCRIBE&&e!==Nv.UNSUBSCRIBE&&e!==Nv.UNPUBLISH&&e!==Nv.CONTROL&&e!==Nv.RESTART_ICE||this.once(Av.DISCONNECT_P2P,(()=>{n(new ym(Em.DISCONNECT_P2P))})),e!==Nv.PUBLISH&&e!==Nv.RESTART_ICE||this.once(Av.ABORT_P2P_EXECUTION,(()=>{n(new ym(Em.DISCONNECT_P2P))}))}));if(this.connectionState!==Ov.CONNECTING&&this.connectionState!==Ov.RECONNECTING||e===Nv.JOIN||e===Nv.REJOIN||await s(),e===Nv.LEAVE&&(this.websocket.unbindDcCloseEventListener(),r=!0),this.websocket.sendMessage(o,!0,!1),r)return;const c=new Eu(((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Av.WS_CLOSED,c),this.off(Av.WS_RECONNECTING,c),this.emit(Av.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new ym(Em.WS_ABORT,"type: ".concat(e))),this.off(Av.WS_CLOSED,c),this.off(Av.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(Av.WS_CLOSED,c),this.once(Av.WS_RECONNECTING,c),Qb(Wm("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(Am.warning("dc request timeout, type: ".concat(e)),this.emit(Av.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===Ov.CLOSED||e===Nv.LEAVE)throw new ym(Em.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Nv.JOIN||e===Nv.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=SS(d),p=new ym(Em.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message});return"success"===u.action?l.message:(Am.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===Sv.ERR_TOO_MANY_BROADCASTERS?e===Nv.JOIN||e===Nv.REJOIN?(this.initError=p,this.close(),p.throw()):p.throw():"failed"===u.action?p.throw():"quit"===u.action?(this.initError=p,this.close(),p.throw()):(d===Sv.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,Am.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",B_.MULTI_IP)):this.reconnect(u.action,B_.SERVER_ERROR),e===Nv.JOIN||e===Nv.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Eu((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=Wm("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Ov.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),Wm("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Eu(((n,r)=>{this.once(Av.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(Av.WS_CLOSED,(()=>r(this.initError||new ym(Em.WS_ABORT)))),this.connectionState=Ov.CONNECTING,this.websocket.init(e).catch(r),this.websocket.once(F_.FAILBACK,(()=>{void 0===this.openConnectionTime&&r(new ym(Em.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(Am.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new ym(Em.INIT_DATACHANNEL_TIMEOUT)))}),Wm("DC_JOIN_WITH_FAILBACK"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Cv.LEAVE,this.connectionState=Ov.CLOSED,Am.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===Cv.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new DS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Av.ABORT_P2P_EXECUTION);const e=await iS(this,Av.DATACHANNEL_CONNECTING),t=await this.request(Nv.JOIN,e);if(!t)return this.emit(Av.REPORT_JOIN_GATEWAY,Em.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Av.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ov.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ym(Em.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=sS(this,Av.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Nv.REJOIN,e);return!!t&&(this.connectionState=Ov.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(Pv.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(Pv.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(Pv.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(Pv.MUTE_AUDIO,{uid:e.uid}):this.emit(Pv.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(Pv.MUTE_VIDEO,{uid:e.uid}):this.emit(Pv.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(Pv.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(Pv.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(Pv.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(Pv.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(Pv.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Am.debug("[".concat(this.clientId,"] receive notification: "),e);const t=SS(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Cv.UID_BANNED),void this.close()):void this.reconnect(t.action,B_.SERVER_ERROR);Am.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=Wm("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Am.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>Wm("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",B_.TIMEOUT):this.request(Nv.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),Wm("REPORT_STATS")&&this.send(Nv.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();0!==e&&0!==t&&this.upload(Lv.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(F_.RECONNECT_WAITTING_FINISH,(e=>{this.emit(Av.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(F_.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(Av.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(F_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(F_.CLOSED,(()=>{this.connectionState=Ov.CLOSED})),this.websocket.on(F_.FAILED,(()=>{this._disconnectedReason=Cv.NETWORK_ERROR,this.connectionState=Ov.CLOSED})),this.websocket.on(F_.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Ov.CONNECTED?this.connectionState=Ov.RECONNECTING:this.connectionState=Ov.CONNECTING})),this.websocket.on(F_.WILL_RECONNECT,((e,t)=>{if(sS(this,Av.IS_P2P_DISCONNECTED)&&"retry"===e)return Am.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Av.NEED_RENEW_SESSION),this.emit(Av.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(Am.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(Av.NEED_RENEW_SESSION),this.emit(Av.DISCONNECT_P2P)),t(e)})),this.websocket.on(F_.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Am.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",B_.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(Av.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof ym&&e.code===Em.UNEXPECTED_RESPONSE&&e.data.code===Sv.ERR_NO_AUTHORIZED)return Am.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",B_.SERVER_ERROR);Am.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",B_.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(F_.REQUEST_NEW_URLS,((e,t)=>{iS(this,Av.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(F_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pv.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(F_.TO_CONNECT_DATACHANNEL,(async(e,t,n)=>iS(this,Av.DATACHANNEL_PRECONNECT,e).then(t).catch(n))),this.websocket.on(F_.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(Av.DATACHANNEL_FAILBACK)}))}}function MS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function US(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?MS(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const VS=new Map;class jS extends vm{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(c_.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(c_.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){Am.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),mh(this,"store",void 0),mh(this,"joinInfo",void 0),mh(this,"key",void 0),mh(this,"signal",void 0),mh(this,"role",void 0),mh(this,"inChannelInfo",{joinAt:null,duration:0}),mh(this,"spec",void 0),mh(this,"_state","DISCONNECTED"),mh(this,"_statsCollector",void 0),mh(this,"_disconnectedReason",void 0),mh(this,"isSignalRecover",!1),mh(this,"hasChangeBGPAddress",!1),mh(this,"trafficStatsInterval",void 0),mh(this,"networkQualityInterval",void 0),mh(this,"_joinGatewayStartTime",0),mh(this,"_signalTimeout",!1),mh(this,"_clientRoleOptions",void 0),mh(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useDataChannel?new xS(US(US({},t),{},{retryConfig:t.websocketRetryConfig}),e):new IS(US(US({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){if(this.signal instanceof xS){let t=!1;"disabled"!==e.cloudProxyServer?(Am.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),t=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(Am.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),t=!0):e.apResponse.addresses.some((e=>e.fingerprint))||Wm("FINGERPRINT")||(Am.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),t=!0),t&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=VS.get(e.cname);if(i||(i=new Map,VS.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new ym(Em.UID_CONFLICT);throw ky.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof xS?"1":"0"}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const a=e.proxyServer;try{let t;if(Am.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof xS?"datachannel":"websocket"," join uid ").concat(o)),this.signal instanceof xS)t=await this.signal.init(e.apResponse.addresses,n);else{const r=e.proxyServer,i=r?e.gatewayAddrs.map((e=>{const t=e.address.split(":");return"wss://".concat(r,"/ws/?h=").concat(t[0],"&p=").concat(t[1])})):e.gatewayAddrs.map((e=>"wss://".concat(e.address)));t=await this.signal.init(i,n)}o=t.uid,Am.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof xS?"datachannel":"websocket"," join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){if(t&&t.code===Em.INIT_WEBSOCKET_TIMEOUT)throw Am.warning("[".concat(this.store.clientId,"] User join failed"),t.toString()),t;if(t&&t.code===Em.INIT_DATACHANNEL_TIMEOUT)throw Am.warning("[".concat(this.store.clientId,"] User join datachannel failed"),t.toString()),this.resetSignal(),t;throw Am.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),ky.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:this.signal instanceof xS?"1":"0"}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Am.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{Am.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(c_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(c_.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(c_.NETWORK_QUALITY,{uplinkNetworkQuality:Hb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Hb(this._statsCollector.trafficStats.B_dnq)}):this.emit(c_.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==Cv.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Ov.CONNECTED||await function(e,t){return t===1/0?e:Eu.race([e,Zb(t)])}(this.signal.request(Nv.LEAVE,void 0,!0),3e3)}catch(e){Am.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==Cv.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new ym(Em.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:Wm("PUB_EXTEND"),twcc:!!Wm("PUBLISH_TWCC"),rtx:!!Wm("USE_PUB_RTX")};try{return(await this.signal.request(Nv.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Sv.ERR_PUBLISH_REQUEST_INVALID)return Am.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new ym(Em.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Nv.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){Am.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new ym(Em.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Wm("SUBSCRIBE_TWCC"),rtx:!!Wm("USE_SUB_RTX"),extend:Wm("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(Wm("SVC"))&&0!==Wm("SVC").length?Wm("SVC"):void 0};try{return(await this.signal.request(Nv.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Sv.ERR_SUBSCRIBE_REQUEST_INVALID)return Am.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new ym(Em.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!Wm("USE_SUB_RTX")};try{return await this.signal.request(Nv.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===Sv.ERR_SUBSCRIBE_REQUEST_INVALID)return Am.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(Nv.SET_VIDEO_PROFILE,t);Am.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Nv.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){Am.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async massUnsubscribe(e){try{await this.signal.request(Nv.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){Am.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Nv.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Nv.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Nv.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n;n="audience"===e?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Nv.SET_CLIENT_ROLE,{role:e,level:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Nv.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Nv.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Nv.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Nv.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),US({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Nv.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=VS.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:Dm.username,password:Dm.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(US(US({},Dm),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(Nv.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&dS((()=>{this.emit(c_.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new ym(Em.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=Wm("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);const r=US({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Lm,browser:navigator.userAgent,process_id:Wm("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:Wm("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:Wm("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Wm("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof Wm("SUBSCRIBE_AUDIO_FILTER_TOPN")?Wm("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof Wm("ENABLE_PUBLISH_AUDIO_FILTER")?Wm("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof Wm("ENABLE_USER_LICENSE_CHECK")?Wm("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===Wm("USE_PUB_RTX")||!0===Wm("USE_SUB_RTX")||void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,Wm("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}getRejoinMessage(){if(!this.joinInfo)throw new ym(Em.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Av.WS_RECONNECT_WAITTING_FINISH,(e=>{["tryNext","recover"].includes(e)&&this.joinInfo&&ky.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(Av.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(Av.WS_RECONNECTING,(e=>{this.joinInfo&&ky.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Iv.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ky.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(Av.WS_CLOSED,(e=>{let t;switch(e){case Cv.LEAVE:t=Iv.LEAVE;break;case Cv.UID_BANNED:case Cv.IP_BANNED:case Cv.CHANNEL_BANNED:case Cv.SERVER_ERROR:t=Iv.SERVER_ERROR;break;case Cv.FALLBACK:t=Iv.FALLBACK;break;case Cv.LICENSE_MISSING:case Cv.LICENSE_EXPIRED:case Cv.LICENSE_MINUTES_EXCEEDED:case Cv.LICENSE_PERIOD_INVALID:case Cv.LICENSE_MULTIPLE_SDK_SERVICE:case Cv.LICENSE_ILLEGAL:t=e;break;default:t=Iv.NETWORK_ERROR}Am.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Iv.NETWORK_ERROR)),this.joinInfo&&ky.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Cv.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Cv.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(Av.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&this._clientRoleOptions.level&&(Am.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),ky.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xS?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void Am.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Hm("EVENT_REPORT_DOMAIN",e[1]),Hm("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Hm("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(Pv.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(Av.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new ym(Em.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,iS(this,c_.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(Av.REQUEST_JOIN_INFO,(async e=>{var t;this.updateTurnConfigFromSignal();const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await iS(this,c_.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(Av.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(Av.REPORT_JOIN_GATEWAY,((e,t)=>{this.joinInfo&&(ky.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xS?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(Av.IS_P2P_DISCONNECTED,(e=>{e(sS(this,c_.IS_P2P_DISCONNECTED))})),this.signal.on(Av.DISCONNECT_P2P,(()=>{this.emit(c_.DISCONNECT_P2P)})),this.signal.on(Av.NEED_RENEW_SESSION,(()=>{this.emit(c_.NEED_RENEW_SESSION)})),this.signal.on(Av.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(Av.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(Av.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(c_.JOIN_RESPONSE,e,t)})),this.signal.on(Av.DATACHANNEL_PRECONNECT,(async(e,t,n)=>{this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress();return iS(this,c_.DATACHANNEL_PRECONNECT,e,r).then(t).catch(n)})),this.signal.on(Av.DATACHANNEL_CONNECTING,(async e=>{const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await iS(this,c_.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r,version:"2"}}))})),this.signal.on(Av.DATACHANNEL_FAILBACK,(()=>{Am.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(c_.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Nv.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Nv.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(Nv.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===s_.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Nv.CONTROL,n,!0,!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===s_.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Nv.CONTROL,n,!0,!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}uploadStats(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Nv.RESTART_ICE,t,!0)}catch(e){throw Am.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Iv.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!Wm("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Nv.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Cv.FALLBACK)),this.store.useDataChannel=!1,this.signal=new IS(US(US({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(c_.RESET_SIGNAL,d_.websocket)}}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in n))break e;n=n[a]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=o[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}r=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=r;function p(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function m(e){this.g=new p,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),v(e)}return e.g.j=null,r.call(e.g,o),v(e)}function v(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function _(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),v(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function E(e,t){return t=new _(new m(t)),u&&e.prototype&&u(t,e.prototype),t}if(p.prototype.o=function(e){this.v=e},p.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},p.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return h(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),v(this))},m.prototype.s=function(e){return h(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),v(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var y=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},w=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,C=T.FormData,R=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,I=T.Request&&T.fetch,O=T.navigator&&T.navigator.sendBeacon,A=T.Element&&T.Element.prototype,N=T.Symbol&&Symbol.toStringTag;N&&(Blob.prototype[N]||(Blob.prototype[N]="Blob"),"File"in T&&!File.prototype[N]&&(File.prototype[N]="File"));try{new File([],"")}catch(e){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N&&Object.defineProperty(e,N,{value:"File"}),e}}var L=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},P=function(e){this.i=[];var t=this;e&&y(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];y(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?y(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?w(e.value):e.value,t.append(e.name,n))}))};if((e=P.prototype).append=function(e,t,n){S(arguments,2),this.i.push(b(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),y(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return E(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),y(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return E(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,f(e,c(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=b(e,t,n),o=!0;y(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return E(e,(function(e){if(1==e.h&&(t=c(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),f(e,i.next().value));n=t.next(),e.h=2}))},P.prototype._asNative=function(){for(var e=new C,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},P.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+L(w(r))+'"\r\n\r\n'+w(e)+"\r\n"):t.push(n+L(w(r))+'"; filename="'+L(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},P.prototype[Symbol.iterator]=function(){return this.entries()},P.prototype.toString=function(){return"[object FormData]"},A&&!A.matches&&(A.matches=A.matchesSelector||A.mozMatchesSelector||A.msMatchesSelector||A.oMatchesSelector||A.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),N&&(P.prototype[N]="FormData"),R){var k=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){k.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof P?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),R.call(this,e)):R.call(this,e)}}I&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof P&&(t.body=t.body._blob()),I.call(this,e,t)}),O&&(T.navigator.sendBeacon=function(e,t){return t instanceof P&&(t=t._asNative()),O.call(this,e,t)}),T.FormData=P}}();const BS=()=>{const e=Wm("AREAS");return 0===e.length&&e.push(E_.GLOBAL),Zn(e).call(e,((e,t,n)=>{const r=FS(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},FS=e=>e===E_.OVERSEA?"".concat(S_.ASIA,",").concat(S_.EUROPE,",").concat(S_.AFRICA,",").concat(S_.NORTH_AMERICA,",").concat(S_.SOUTH_AMERICA,",").concat(S_.OCEANIA):S_[e],GS=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=T_[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},HS={GLOBAL:{ASIA:[E_.CHINA,E_.JAPAN,E_.INDIA,E_.KOREA,E_.HKMC],EUROPE:[],NORTH_AMERICA:[E_.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},WS=Object.keys(HS[E_.GLOBAL]),KS=[E_.CHINA,E_.NORTH_AMERICA,E_.EUROPE,E_.ASIA,E_.JAPAN,E_.INDIA,E_.OCEANIA,E_.SOUTH_AMERICA,E_.AFRICA,E_.KOREA,E_.HKMC,E_.US],qS=function(e,t){let n=[];if(e.includes(E_.GLOBAL)){const o=[E_.GLOBAL,E_.OVERSEA],a=Object.keys(T_);if(t===E_.GLOBAL)throw new ym(Em.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===E_.CHINA)n=[E_.OVERSEA];else if(i=t,WS.includes(i)){const e=(r=t,HS[E_.GLOBAL][r]||[]),i=[...o,t,...e];n=a.filter((e=>!i.includes(e)))}else if(function(e){let t=!1;return WS.forEach((n=>{HS[E_.GLOBAL][n].includes(e)&&(t=!0)})),t}(t)){const e=function(e){let t;return WS.forEach((n=>{HS[E_.GLOBAL][n].includes(e)&&(t=n)})),t}(t),r=[...o,e,t];n=a.filter((e=>!r.includes(e)))}else n=e;n=function(e){const t=[];return KS.forEach((n=>{e.includes(n)&&t.push(n)})),t.concat(e.filter((e=>!KS.includes(e))))}(n)}else n=e;var r,i;return n};function YS(e){if(!e&&Wm("AREAS").includes(E_.EXTENSIONS))return Am.debug("update area from ap : reset"),void zS(km,!0);if(!Wm("AREAS").includes(E_.GLOBAL)||!e)return;let t=T_.EXTENSIONS;t&&(t={CODE:FS(E_.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Am.debug("update area from ap success: ".concat(e,",config is "),t),Hm("AREAS",[E_.EXTENSIONS],!0),Object.keys(t).map((e=>{Hm(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?t[e][0]:t[e])})))}function zS(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=ky.reportApiInvoke(null,{name:mv.SET_AREA,options:e,tag:gv.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!b_.includes(e))throw new ym(Em.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new ym(Em.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?qS(i,n):i}if(!t){if(qm.AREAS){const e=new ym(Em.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void Am.warning("setArea is prohibited because of config-distribute")}if(r.includes(E_.GLOBAL)&&Wm("AREAS")===E_.EXTENSIONS){const e=new ym(Em.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void Am.warning("setArea is prohibited because of ap extensions")}}Hm("AREAS",r,t);const i=GS(r);Object.keys(i).map((e=>{Hm(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),Am.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function JS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JS(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let QS=1;function ZS(e,t,n,r,i){QS+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:QS,requestId:QS,version:Lm,cname:n.cname},a={service_name:t,json_body:JSON.stringify(o)};let s,c,l=e[0];return Sm((async()=>{s=Date.now();const e=await wy(l,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,0!==e.code){const t=new ym(Em.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw Am.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new ym(Em.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw Am.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new ym(Em.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw Am.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(Wm("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return Wm("LIVE_STREAMING_ADDRESS")&&(i.addressList=Wm("LIVE_STREAMING_ADDRESS")instanceof Array?Wm("LIVE_STREAMING_ADDRESS"):[Wm("LIVE_STREAMING_ADDRESS")]),XS(XS({},i),{},{responseTime:c})}),((r,i)=>(ky.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(ky.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==Em.OPERATION_ABORTED&&r.code!==Em.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0))),i)}let $S=1;function eT(e,t,n,r){let{url:i,areaCode:o}=e;const a=Date.now();let s;const[c,l]=oT(t,o,[X_.CHOOSE_SERVER]);let d=Sy.networkState;return Sm((async()=>{d&&Sy.networkState===k_.OFFLINE&&Sy.onlineWaiter&&await Eu.race([Sy.onlineWaiter,Qb(r&&r.maxRetryTimeout||wm.maxRetryTimeout)]),d=Sy.networkState;const{data:e,headers:o}=await wy(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s="1"===o.http3?1:-1,ky.reportResourceTiming(i,t.sid),nT(e,i,t,a,[X_.CHOOSE_SERVER],s);const l=Wb(e,X_.CHOOSE_SERVER);return rT(l),Bb(l,i)}),(e=>(e&&ky.joinChooseServer(t.sid,{lts:a,succ:!0,csAddr:i,opid:l,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[X_.CHOOSE_SERVER].toString(),isHttp3:s}),!1)),(e=>e.code!==Em.OPERATION_ABORTED&&(e.code===Em.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(ky.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:i,serverList:null,opid:l,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[X_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:d}),isHttp3:s}),Am.warning("[".concat(t.clientId,"] Choose server network error, retry"),e),!0))),r)}function tT(e,t,n,r){let i,{url:o,areaCode:a,serviceIds:s}=e;const c=Date.now(),[l,d]=oT(t,a,s);let u;return Sm((async()=>{u&&Sy.networkState===k_.OFFLINE&&Sy.onlineWaiter&&await Eu.race([Sy.onlineWaiter,Qb(r&&r.maxRetryTimeout||wm.maxRetryTimeout)]),u=Sy.networkState;const{data:e,headers:a}=await wy(o,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,ky.reportResourceTiming(o,t.sid),nT(e,o,t,c,s,i);const d=Wb(e,X_.CHOOSE_SERVER),p=Wb(e,"proxy5"===t.cloudProxyServer?X_.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?X_.CLOUD_PROXY:X_.CLOUD_PROXY_FALLBACK);return rT(d),{gatewayInfo:Bb(d,o),proxyInfo:p,url:o}}),(e=>(e.gatewayInfo&&ky.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:d,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:i}),e.proxyInfo&&ky.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1)),(e=>e.code!==Em.OPERATION_ABORTED&&(e.code===Em.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(ky.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:u})}),Am.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const nT=(e,t,n,r,i,o)=>{const a=[],s=a=>{4096===a.flag?ky.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:a.error.message,csIp:a.error.data&&a.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==a.flag&&4194304!==a.flag&&4194310!==a.flag||ky.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:a.error.code,eventType:n.cloudProxyServer,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)Am.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new ym(Em.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};a.push(n),s(n)}if(0!==n){const r=wS(n),i={error:new ym(Em.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?Am.warning(i.error.toString()):a.push(i),s(i)}})),a.length)throw Am.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(a.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new ym(Em.CAN_NOT_GET_GATEWAY_SERVER,a.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!a.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(a.map((e=>{var t,n;return null==e||null===(t=e.error)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.desc})).filter((e=>!!e)))]})},rT=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new ym(Em.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Wm("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?YS(e.detail[23].toLowerCase()):YS()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let t=0;t<n.length;t++){var o;const r=vp(o=n[t]).call(o);e.addresses[t]&&n&&(e.addresses[t].fingerprint=r)}}if(Wm("GATEWAY_ADDRESS")&&Wm("GATEWAY_ADDRESS").length>0){Am.debug("assign gateway address to",Wm("GATEWAY_ADDRESS"));const t=Wm("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},iT=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=wS(t.buffer.code);throw new ym(Em.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw Am.debug("update ticket request received ap response without response body:",t),new ym(Em.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},oT=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:Wm("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},aT=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let sT=0;async function cT(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],a=async()=>{const i=Wm("WEBCS_DOMAIN").slice(0,Wm("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:BS()}))),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),s=await _S({fragementLength:Wm("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Am.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),eT(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await Qb(1e3),null!==i)return i;const a=Wm("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:BS()}))),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((e=>e.url))}),c=await _S({fragementLength:Wm("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(Am.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),eT(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return i=await rS([a(),s()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function lT(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await cT(e,t,n,i);if(Wm("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await pT(e,t,n,i);return e.turnServer&&"auto"!==e.turnServer.mode||(e.turnServer={mode:"manual",servers:o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||Dm.tcpport,udpport:e.udpport||Dm.udpport,username:e.username||Dm.username,password:e.password||Dm.password,forceturn:!1,security:!0})))}),{gatewayInfo:r}}return await cT(e,t,n,i)}const{proxyInfo:a,gatewayInfo:s}=await pT(e,t,n,i),c={gatewayInfo:s};return e.turnServer={mode:"manual",servers:a.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:Dm.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:Dm.udpport,username:e.username||Dm.username,password:e.password||Dm.password,forceturn:"proxy4"!==o,security:"proxy5"===o})))},Am.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),c}async function dT(e,t,n,r,i){const o=Wm("ACCOUNT_REGISTER").slice(0,Wm("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const s=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const o=await async function(e,t,n,r,i){const o=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let s=e[0];const c=await Sm((()=>wy(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw Am.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),ky.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:Em.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new ym(Em.INVALID_UINT_UID_FROM_STRING_UID);return ky.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const i=wS(n.code);return i.retry&&(s=e[(r+1)%e.length]),ky.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry}),((t,n)=>t.code!==Em.OPERATION_ABORTED&&(ky.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=wS(c.code);throw new ym(Em.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},s),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},s),e}}async function uT(e,t,n){const r=Wm("CDS_AP").slice(0,Wm("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))).map((r=>function(e,t,n,r){const i=Vp(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:Lm,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return Sm((()=>wy(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==Em.OPERATION_ABORTED),r)}(r,e,t,n)));let i=null,o=null,a={};try{i=await rS(r)}catch(e){if(e.code===Em.OPERATION_ABORTED)throw e;o=e}if(r.forEach((e=>e.cancel())),ky.reportApiInvoke(e.sid,{name:mv.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:i}}).onSuccess(),i&&i.test_tags)try{a=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=vp(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(i)}catch(e){}return a}async function pT(e,t,n,r){const i=Wm("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let a=null;const s=[],c=async()=>{const i=Wm("WEBCS_DOMAIN").slice(0,Wm("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:BS(),serviceIds:[X_.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?X_.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?X_.CLOUD_PROXY:X_.CLOUD_PROXY_FALLBACK]}})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await _S({fragementLength:Wm("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Am.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),tT(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await Qb(1e3),null!==a)return a;const i=Wm("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:BS(),serviceIds:[X_.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?X_.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?X_.CLOUD_PROXY:X_.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),l=await _S({fragementLength:Wm("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Am.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),tT(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,p;try{({gatewayInfo:d,proxyInfo:u,url:p}=await rS([c(),l()]))}catch(e){throw e[0]}if(s.length&&s.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!d||!u)throw new ym(Em.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=p,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&p){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(p)[1];i.includes(t)&&(e.proxyServer=t,Am.setProxyServer(t),ky.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await Kb(u,d.uid)},a}async function hT(e,t,n,r){const i=Wm("UAP_AP").slice(0,Wm("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await ZS(i,e,t,n,r)}async function fT(e,t,n){const r=Wm("UAP_AP").slice(0,Wm("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))).map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:Lm,cname:t.cname,uid:t.uid.toString(),requestId:$S,seq:$S};$S+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Sm((async()=>{const t=await wy(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new ym(Em.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw Am.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new ym(Em.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw Am.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new ym(Em.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Am.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(Wm("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(Wm("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==Em.OPERATION_ABORTED&&e.code!==Em.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await rS(r);return r.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function mT(e,t,n){let r=null;const i=[],o=async o=>{const a=Wm(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await Qb(1e3),null!==r)?r:await _S({fragementLength:Wm("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(Am.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=aT(t,[X_.CHOOSE_SERVER]);let o=Sy.networkState;return Sm((async()=>{o&&Sy.networkState===k_.OFFLINE&&Sy.onlineWaiter&&await Eu.race([Sy.onlineWaiter,Qb(r&&r.maxRetryTimeout||wm.maxRetryTimeout)]),o=Sy.networkState;const t=await wy(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return iT(t,e)}),(()=>!1),(e=>e.code!==Em.OPERATION_ABORTED&&(e.code===Em.UPDATE_TICKET_FAILED?e.data.retry:(Am.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await rS([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function gT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gT(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class _T extends vm{constructor(){super(),mh(this,"configs",void 0),mh(this,"joinInfo",void 0),mh(this,"cancelToken",void 0),mh(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),mh(this,"interval",void 0),mh(this,"mutex",new Uy("config-distribute")),mh(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),Wm("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),Wm("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ky.reportApiInvoke(null,{options:void 0,name:mv.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:gv.TRACER}).onSuccess(JSON.stringify(qm))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Am.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await uT(this.joinInfo,this.cancelToken,this.retryConfig),Am.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(e){const t=new ym(Em.NETWORK_RESPONSE_ERROR,e);Am.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(C_.UPDATE_BITRATE_LIMIT,e):this.emit(C_.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&vT({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const n=qg(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let t=0;t<n.length;t++)for(let r=n.length-1;r>t;r--){const t=n[r];if("number"==typeof e[t].__priority){const i=e[t].__priority,o=n[r-1];if("number"==typeof e[o].__priority){if(!(i>e[o].__priority))continue;{const e=t;n[r]=n[r-1],n[r-1]=e}}else{const e=t;n[r]=n[r-1],n[r-1]=e}}}const r={};n.forEach((t=>{const n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=vT({value:n[e]},i&&{expires:i}))}))}));try{const e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),Am.debug("Caching global parameters ".concat(e))}catch(e){Am.error("Error caching global parameters:",e.message)}}}function ET(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ET(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ET(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class wT extends vm{constructor(e,t,n,r){super(),mh(this,"spec",void 0),mh(this,"token",void 0),mh(this,"websocket",void 0),mh(this,"pingpongTimer",void 0),mh(this,"reconnectMode","retry"),mh(this,"serviceMode",void 0),mh(this,"reqId",0),mh(this,"commandReqId",0),mh(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),mh(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):this.serviceMode===qv.INJECT?this.emit($v.INJECT_STREAM_STATUS,t):(ky.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===qv.TRANSCODE?1:2}),this.emit($v.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new CS("live-streaming",n),this.websocket.on(Kv.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Kv.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Kv.REQUEST_NEW_URLS,((e,t)=>{iS(this,$v.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(Kv.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new ym(Em.UNEXPECTED_ERROR);const a=yT({command:e,sdkVersion:"4.18.3"===Lm?"0.0.1":Lm,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new ym(Em.WS_DISCONNECT);const s=()=>new Eu(((e,t)=>{this.websocket.once(Kv.CLOSED,(()=>t(new ym(Em.WS_ABORT)))),this.websocket.once(Kv.CONNECTED,e)}));"connected"!==this.websocket.state&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new Eu(((e,t)=>{const n=()=>{t(new ym(Em.WS_ABORT))};this.websocket.once(Kv.RECONNECTING,n),this.websocket.once(Kv.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&ky.workerEvent(this.spec.sid,yT(yT({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(r){if("closed"===this.websocket.state)throw r;return await s(),await this.request(e,t,n)}return r&&ky.workerEvent(this.spec.sid,yT(yT({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.18.3"===Lm?"0.0.1":Lm;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case t_.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Am.warning("live stream response already exists stream");case t_.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case t_.LIVE_STREAM_RESPONSE_BAD_STREAM:case t_.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ym(Em.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case t_.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case t_.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ym(Em.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case t_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new ym(Em.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($v.WARNING,t,e.serverResponse.url)}case t_.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new ym(Em.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($v.WARNING,t,e.serverResponse.url)}case t_.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case t_.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ym(Em.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case t_.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new ym(Em.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($v.WARNING,t,e.serverResponse.url)}case t_.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case t_.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case t_.LIVE_STREAM_RESPONSE_WORKER_LOST:case t_.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case t_.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case t_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ym(Em.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(tS)}),6e3)}}function bT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ST(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bT(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class TT extends vm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wm,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wm;super(),mh(this,"onLiveStreamWarning",void 0),mh(this,"onLiveStreamError",void 0),mh(this,"onInjectStatusChange",void 0),mh(this,"spec",void 0),mh(this,"retryTimeout",1e4),mh(this,"connection",void 0),mh(this,"httpRetryConfig",void 0),mh(this,"wsRetryConfig",void 0),mh(this,"streamingTasks",new Map),mh(this,"isStartingStreamingTask",!1),mh(this,"taskMutex",new Uy("live-streaming")),mh(this,"cancelToken",mm.CancelToken.source()),mh(this,"transcodingConfig",void 0),mh(this,"injectConfig",ST({},Zv)),mh(this,"injectLoopTimes",0),mh(this,"uapResponse",void 0),mh(this,"lastTaskId",1),mh(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=ST(ST({},Qv),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(Am.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>ST(ST(ST({},zv),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){tv(e.width)||Jg(e.width,"config.width",0,1e4),tv(e.height)||Jg(e.height,"config.height",0,1e4),tv(e.videoBitrate)||Jg(e.videoBitrate,"config.videoBitrate",1,1e6),tv(e.videoFrameRate)||Jg(e.videoFrameRate,"config.videoFrameRate"),tv(e.lowLatency)||Yg(e.lowLatency,"config.lowLatency"),tv(e.audioSampleRate)||zg(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),tv(e.audioBitrate)||Jg(e.audioBitrate,"config.audioBitrate",1,128),tv(e.audioChannels)||zg(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),tv(e.videoGop)||Jg(e.videoGop,"config.videoGop"),tv(e.videoCodecProfile)||zg(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),tv(e.userCount)||Jg(e.userCount,"config.userCount",0,17),tv(e.backgroundColor)||Jg(e.backgroundColor,"config.backgroundColor",0,16777215),tv(e.userConfigExtraInfo)||Qg(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!tv(e.transcodingUsers)&&(Zg(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{ev(e.uid),tv(e.x)||Jg(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),tv(e.y)||Jg(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),tv(e.width)||Jg(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),tv(e.height)||Jg(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),tv(e.zOrder)||Jg(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),tv(e.alpha)||Jg(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),tv(e.watermark)||Xv(e.watermark,"watermark"),tv(e.backgroundImage)||Xv(e.backgroundImage,"backgroundImage"),e.images&&!tv(e.images)&&(Zg(e.images,"config.images"),e.images.forEach(((e,t)=>{Xv(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>ST(ST(ST({},Jv),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(ST(ST(ST({},Jv),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(ST(ST(ST({},Jv),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>ST({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?Eu.resolve(e.uid):dT(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await Eu.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Sw(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});Am.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{Am.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{Am.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{Am.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r;if(Array.from(Sw(r=this.streamingTasks).call(r)).find((e=>e.mode===qv.INJECT))&&t===qv.INJECT)return new ym(Em.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===qv.TRANSCODE)throw new ym(Em.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Am.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(e)&&!n)return o(),new ym(Em.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw o(),e}switch(t){case qv.TRANSCODE:i.transcodingConfig=ST({},this.transcodingConfig);break;case qv.RAW:break;case qv.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const a=this.lastTaskId++;try{const r=new Eu(((t,r)=>{Qb(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),s=await Eu.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===qv.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),r]);this.isStartingStreamingTask=!1,Am.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:a}),o()}catch(r){if(o(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new Eu(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new ym(Em.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{Am.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===qv.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===qv.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{Am.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==qv.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===qv.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)})).catch(n)}))}async controlInjectStream(e,t,n,r){const i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==qv.INJECT)throw new ym(Em.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;const t=Array.from(Sw(e=this.streamingTasks).call(e));this.terminate();for(const e of t)this.startLiveStreamingTask(e.url,e.mode).catch((t=>{this.onLiveStreamError&&this.onLiveStreamError(e.url,t)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mm.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new ym(Em.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await iS(this,e_.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new wT(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on($v.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on($v.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on($v.INJECT_STREAM_STATUS,(e=>this.handleInjectStreamServerStatus(e))),this.connection.on($v.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new ym(Em.UNEXPECTED_ERROR,"can not get new live streaming address list"));iS(this,e_.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case t_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case t_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new ym(Em.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return Am.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case t_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new ym(Em.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case t_.LIVE_STREAM_RESPONSE_WORKER_LOST:case t_.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(Sw(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(Am.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new ym(Em.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{Am.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{Am.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Yv.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void Am.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class CT{constructor(){mh(this,"destChannelMediaInfos",new Map),mh(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){y_(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){y_(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){$g(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function RT(e){if(!(e instanceof CT))return new ym(Em.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new ym(Em.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new ym(Em.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class IT extends vm{constructor(e,t,n){super(),mh(this,"ws",void 0),mh(this,"requestId",1),mh(this,"heartBeatTimer",void 0),mh(this,"joinInfo",void 0),mh(this,"clientId",void 0),mh(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),mh(this,"onClose",(e=>{this.emit("close"),this.dispose()})),mh(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new CS("cross-channel-".concat(this.clientId),n),this.ws.on(Kv.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Kv.CONNECTED,this.onOpen),this.ws.on(Kv.ON_MESSAGE,this.onMessage),this.ws.on(Kv.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Eu(((t,n)=>{const r=window.setTimeout((()=>{n(new ym(Em.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new ym(Em.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new ym(Em.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new ym(Em.WS_DISCONNECT);const t=()=>new Eu(((e,t)=>{this.ws.once(Kv.CLOSED,(()=>t(new ym(Em.WS_ABORT)))),this.ws.once(Kv.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new Eu(((e,t)=>{const r=()=>{t(new ym(Em.WS_ABORT))};this.ws.once(Kv.RECONNECTING,r),this.ws.once(Kv.CLOSED,r),this.once("req_".concat(n),e),Qb(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Kv.RECONNECTING,r),this.ws.off(Kv.CLOSED,r),t(new ym(Em.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new ym(Em.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(Kv.REQUEST_NEW_URLS),this.ws.on(Kv.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class OT extends vm{set state(e){e!==this._state&&(e!==o_.RELAY_STATE_FAILURE&&(this.errorCode=a_.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),mh(this,"joinInfo",void 0),mh(this,"sid",void 0),mh(this,"clientId",void 0),mh(this,"cancelToken",mm.CancelToken.source()),mh(this,"workerToken",void 0),mh(this,"requestId",0),mh(this,"signal",void 0),mh(this,"prevChannelMediaConfig",void 0),mh(this,"httpRetryConfig",void 0),mh(this,"_resolution",void 0),mh(this,"_state",o_.RELAY_STATE_IDLE),mh(this,"errorCode",a_.RELAY_OK),mh(this,"onStatus",(e=>{Am.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",i_.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",i_.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=a_.SRC_TOKEN_EXPIRED,this.state=o_.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=a_.DEST_TOKEN_EXPIRED,this.state=o_.RELAY_STATE_FAILURE))})),mh(this,"onReconnect",(async()=>{Am.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",i_.NETWORK_DISCONNECTED),this.state=o_.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==o_.RELAY_STATE_IDLE&&(Am.error("auto restart channel media relay failed",e.toString()),this.errorCode=a_.SERVER_CONNECTION_LOST,this.state=o_.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=eS(),this.signal=new IT(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==o_.RELAY_STATE_IDLE)throw new ym(Em.INVALID_OPERATION);this.state=o_.RELAY_STATE_CONNECTING,await this.connect(),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new ym(Em.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new ym(Em.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new ym(Em.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==o_.RELAY_STATE_RUNNING)throw new ym(Em.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==o_.RELAY_STATE_RUNNING)throw new ym(Em.INVALID_OPERATION);const t=this.genMessage(r_.SetVideoProfile);await this.signal.request(t),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Am.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=o_.RELAY_STATE_IDLE,this.dispose()}dispose(){Am.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mm.CancelToken.source(),this.state=o_.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await fT(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",i_.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(r_.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(r_.SetSdkProfile,e);await this.signal.request(n),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(r_.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",i_.PACKET_JOINED_SRC_CHANNEL),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(r_.SetSourceUserId,e);await this.signal.request(i),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(r_.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",i_.PACKET_JOINED_DEST_CHANNEL),Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(r_.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",i_.PACKET_SENT_TO_DEST_CHANNEL),this.state=o_.RELAY_STATE_RUNNING,Am.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(r_.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",i_.PACKET_UPDATE_DEST_CHANNEL),Am.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(r_.StopPacketTransfer);await this.signal.request(e),Am.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Lm,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.18.3"===o.sdkVersion&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case r_.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case r_.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new ym(Em.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case r_.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new ym(Em.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case r_.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new ym(Em.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case r_.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case r_.Reconnect:return o.clientRequest={command:"Reconnect"},o;case r_.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case r_.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new ym(Em.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case r_.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const AT=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Eu(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await NT(e);n({buffer:r,width:t.width,height:t.height})}else r(new ym(Em.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},NT=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function LT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function PT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LT(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class kT{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(Am.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}constructor(e){mh(this,"trackId",void 0),mh(this,"config",void 0),mh(this,"onFirstVideoFrameDecoded",void 0),mh(this,"freezeTimeCounterList",[]),mh(this,"renderFreezeAccTime",0),mh(this,"isKeepLastFrame",!1),mh(this,"timeUpdatedCount",0),mh(this,"freezeTime",0),mh(this,"playbackTime",0),mh(this,"lastTimeUpdatedTime",0),mh(this,"autoplayFailed",!1),mh(this,"videoTrack",void 0),mh(this,"videoElement",void 0),mh(this,"cacheVideoElement",void 0),mh(this,"videoElementCheckInterval",void 0),mh(this,"_videoElementStatus",sv.NONE),mh(this,"isGettingVideoDimensions",!1),mh(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Am.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),mh(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Hy.curState&&(Am.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Bp())),th()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),mh(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=sv.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=sv.CANPLAY;break;case"stalled":this.videoElementStatus=sv.STALLED;break;case"suspend":this.videoElementStatus=sv.SUSPEND;break;case"pause":this.videoElementStatus=sv.PAUSED,Yp()||nh()||Kp()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(Am.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=sv.WAITING;break;case"abort":this.videoElementStatus=sv.ABORT;break;case"ended":this.videoElementStatus=sv.ENDED;break;case"emptied":this.videoElementStatus=sv.EMPTIED;break;case"error":{this.videoElementStatus=sv.ERROR;const e=this.videoElement.error;e&&Am.error("[".concat(this.trackId,"] media error, code: ").concat(e.code,", message: ").concat(e.message));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,Mb.lastVisibleTime<Mb.lastHiddenTime||n<Mb.lastHiddenTime||n<Mb.lastVisibleTime)return;for(t>Wm("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),mh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(Am.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Bp())),th()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Hy.on(xy.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hy.on(xy.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&ky.autoplayFailed(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(Am.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Am.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=Vp();if(("Safari"===n.name&&15===Number(n.version)||$p())&&t&&t.then&&t.catch){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return Am.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new Eu(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await NT(e);r({buffer:t,width:n.width,height:n.height})}else i(new ym(Em.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await AT(e)}destroy(){Hy.off(xy.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Hy.off(xy.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=sv.INIT,!this.videoElementCheckInterval&&(DT.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=sv.DESTROYED)}),1e3),Wm("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=(e,t)=>{if(this.videoElementStatus===sv.PLAYING){if(n){const e=t.presentationTime-n.presentationTime;e>Wm("VIDEO_FREEZE_DURATION")&&Mb.lastVisibleTime>=Mb.lastHiddenTime&&n.timestamp>Mb.lastVisibleTime&&n.timestamp>Mb.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=PT(PT({},t),{},{timestamp:e})}var i,o;Wm("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(i=(o=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(o,r))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,r)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),ah()&&(this.videoElement.poster="noposter");const n=Vp();"Safari"===n.name&&15===Number(n.version)||$p()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qp()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qp()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{Am.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){DT.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=sv.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{Am.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{Am.error(e)})),this.autoplayFailed=!1,sh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};sh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Ry()}}const DT=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class xT extends kT{constructor(e){super(e),mh(this,"container",void 0),mh(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await AT(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Wm("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function MT(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Vm(e.encoderConfig);return t.width=n.width,t.height=n.height,!ih()&&n.frameRate&&(t.frameRate=n.frameRate),Vp().name===Lp.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),qp()&&(t.frameRate={ideal:30,max:30}),t}function UT(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Wp()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(zp(107)||Jp(107)||Xp(93))&&(n&&(zg(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(zg(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(zg(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(zp(105)||Jp(105)||Xp(91))&&o&&(zg(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const a=e.encoderConfig?jm(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&(a.frameRate&&("number"==typeof a.frameRate?(t.mandatory.maxFrameRate=a.frameRate,t.mandatory.minFrameRate=a.frameRate):(t.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,t.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),t.frameRate=a.frameRate),a.width&&(t.width=a.width),a.height&&(t.height=a.height)),t}function VT(e){const t={};if(ih()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Wp()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Gm(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),ah()&&(t.sampleRate=void 0),t}var jT,BT;!function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"}(jT||(jT={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(BT||(BT={}));var FT,GT,HT,WT,KT,qT,YT,zT,JT,XT,QT,ZT,$T,eC,tC,nC,rC,iC,oC,aC,sC,cC,lC,dC,uC,pC,hC,fC,mC,gC,vC,_C,EC,yC,wC=new class{constructor(){mh(this,"_clientSize",null),mh(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),mh(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),mh(this,"getStyle",(e=>window.getComputedStyle(e,null))),mh(this,"checkCssVisibleProperty",(e=>{let t=!0;const n=this.getStyle(e),{display:r,visibility:i,opacity:o,filter:a}=n;return("none"===r||["hidden","collapse"].includes(i)||Number(o)<.1)&&(t=!1),!!t&&(a&&a.split(" ").filter((e=>{const t=e.split("(")[0];return["brightness","blur","opacity"].includes(t)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[n,r]=e;switch(n){case"brightness":(r<.1||r>3)&&(t=!1);break;case"blur":r>3&&(t=!1);break;case"opacity":r<.1&&(t=!1)}})),t)})),mh(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),mh(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),mh(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}})),mh(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),mh(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),mh(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),mh(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,a=[],s=10**6;for(let e=0;e<5;e++)for(let t=0;t<5;t++){const c=(n*s+(0===e?.1:4===e?(i*e*s-1e5)/s:i*e)*s)/s,l=(r*s+(0===t?.1:4===t?(o*t*s-1e5)/s:o*t)*s)/s;a.push({x:c,y:l})}return[...a]})),mh(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),mh(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),mh(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:a}=this._clientSize;let s,c,l,d;if(e<0)s=0;else{if(!(e<o))return!1;s=e}if(t<0)return!1;if(c=t<o?t:o,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;d=r<i?r:i;const u=c-s,p=d-l;return this.checkSizeIsVisible(u,p,a)})),mh(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),mh(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(jT.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(jT.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(jT.SIZE)}}return this.returnHiddenResult(jT.STYLE)}return this.returnHiddenResult(BT.UNMOUNTED)}return this.returnHiddenResult(BT.INVALID_HTML_ELEMENT)})),mh(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function bC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bC(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let TC=(FT=Py({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),GT=mw(),HT=Py({argsMap:e=>[e.getTrackId()]}),WT=Vy("LocalVideoTrack","_enabledMutex"),KT=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),qT=mw(),YT=Vy("LocalVideoTrack","_enabledMutex"),zT=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),JT=mw(),XT=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),QT=mw(),ZT=mw(),$T=Py({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),eC=mw(),tC=mw(),nC=mw(),rC=mw(),iC=mw(),oC=mw(),aC=mw(),sC=Py({argsMap:(e,t)=>[e.getTrackId(),t.name]}),cC=Py({argsMap:e=>[e.getTrackId()]}),lC=Py({argsMap:e=>[e.getTrackId()]}),dC=Py({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),cy((uC=class e extends jy{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sv.PLAYING)}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),mh(this,"trackMediaType","video"),mh(this,"_player",void 0),mh(this,"_videoVisibleTimer",null),mh(this,"_previousVideoVisibleStatus",void 0),mh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),mh(this,"_encoderConfig",void 0),mh(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),mh(this,"_optimizationMode",void 0),mh(this,"_videoHeight",void 0),mh(this,"_videoWidth",void 0),mh(this,"_forceBitrateLimit",void 0),mh(this,"_enabled",!0),mh(this,"processorDestination",void 0),mh(this,"_processorContext",void 0),Kp()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();this._encoderConfig=t,this._scalabiltyMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(p_.SCREEN_TRACK)&&this.updateBitrateFromProfile(),t&&-1!==this._hints.indexOf(p_.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this.processorContext=new Iw(this.getTrackId(),"local"),this.processorDestination=new Rw(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(Am.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Am.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=SC(SC(SC({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new kT(n):this._player=new xT(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(v_.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),Wm("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Am.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Am.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await oS(this,u_.NEED_DISABLE_TRACK,this)}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void Am.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await oS(this,u_.NEED_ENABLE_TRACK,this)}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Am.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oS(this,u_.NEED_MUTE_TRACK,this):await oS(this,u_.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new ym(Em.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Vm(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=MT({encoderConfig:e});(Kp()||Yp()||nh())&&(t.deviceId=void 0),Am.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new ym(Em.UNEXPECTED_ERROR,e.toString());throw Am.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(p_.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oS(this,u_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}getStats(){return hS((()=>{Am.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),aS(this,u_.GET_STATS)||SC({},Fv)}async setBeautyEffect(e){Am.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await AT(e)}clone(t,n,r,i){const o=this._mediaStreamTrack.clone();return new e(o,t,n,r,i)}async setBitrateLimit(e){if(Am.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await oS(this,u_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void Am.error(Em.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await oS(this,u_.SET_OPTIMIZATION_MODE,this)}catch(e){throw this._optimizationMode=t,Am.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Am.error(Em.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=e,Am.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){nS(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(tS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const[r,i]=function(e,t,n){const r=Wm("BITRATE_ADAPTER_TYPE");let i;const o=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75),a=o;if("STANDARD_BITRATE"===r)i=4*o;else{if("COMPATIABLE_BITRATE"!==r)return;i=2*o}return[Math.floor(i),Math.floor(a)]}(e,t,n)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=i,this._encoderConfig.bitrateMax=r,Am.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(r,", brMin: ").concat(i,"]")))}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=wC.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new ym(Em.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ym(Em.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new ym(Em.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new ym(Em.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(x_.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await oS(this,u_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oS(this,u_.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x_.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(M_.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(M_.REQUEST_CONSTRAINTS)}}).prototype,"play",[FT,GT],Object.getOwnPropertyDescriptor(uC.prototype,"play"),uC.prototype),cy(uC.prototype,"stop",[HT],Object.getOwnPropertyDescriptor(uC.prototype,"stop"),uC.prototype),cy(uC.prototype,"setEnabled",[WT,KT,qT],Object.getOwnPropertyDescriptor(uC.prototype,"setEnabled"),uC.prototype),cy(uC.prototype,"setMuted",[YT,zT,JT],Object.getOwnPropertyDescriptor(uC.prototype,"setMuted"),uC.prototype),cy(uC.prototype,"setEncoderConfiguration",[XT,QT],Object.getOwnPropertyDescriptor(uC.prototype,"setEncoderConfiguration"),uC.prototype),cy(uC.prototype,"getStats",[ZT],Object.getOwnPropertyDescriptor(uC.prototype,"getStats"),uC.prototype),cy(uC.prototype,"setBeautyEffect",[$T,eC],Object.getOwnPropertyDescriptor(uC.prototype,"setBeautyEffect"),uC.prototype),cy(uC.prototype,"getCurrentFrameData",[tC],Object.getOwnPropertyDescriptor(uC.prototype,"getCurrentFrameData"),uC.prototype),cy(uC.prototype,"getCurrentFrameImage",[nC],Object.getOwnPropertyDescriptor(uC.prototype,"getCurrentFrameImage"),uC.prototype),cy(uC.prototype,"setBitrateLimit",[rC],Object.getOwnPropertyDescriptor(uC.prototype,"setBitrateLimit"),uC.prototype),cy(uC.prototype,"setOptimizationMode",[iC],Object.getOwnPropertyDescriptor(uC.prototype,"setOptimizationMode"),uC.prototype),cy(uC.prototype,"setScalabiltyMode",[oC],Object.getOwnPropertyDescriptor(uC.prototype,"setScalabiltyMode"),uC.prototype),cy(uC.prototype,"updateMediaStreamTrackResolution",[aC],Object.getOwnPropertyDescriptor(uC.prototype,"updateMediaStreamTrackResolution"),uC.prototype),cy(uC.prototype,"pipe",[sC],Object.getOwnPropertyDescriptor(uC.prototype,"pipe"),uC.prototype),cy(uC.prototype,"unpipe",[cC],Object.getOwnPropertyDescriptor(uC.prototype,"unpipe"),uC.prototype),cy(uC.prototype,"close",[lC],Object.getOwnPropertyDescriptor(uC.prototype,"close"),uC.prototype),cy(uC.prototype,"replaceTrack",[dC],Object.getOwnPropertyDescriptor(uC.prototype,"replaceTrack"),uC.prototype),uC),CC=(pC=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),hC=mw(),fC=Vy("CameraVideoTrack","_enabledMutex"),mC=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),gC=mw(),vC=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),_C=mw(),EC=Py({argsMap:e=>[e.getTrackId()]}),cy((yC=class extends TC{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,Vm(t.encoderConfig),r,i,o),mh(this,"_config",void 0),mh(this,"_originalConstraints",void 0),mh(this,"_constraints",void 0),mh(this,"_enabled",!0),mh(this,"_deviceName","default"),mh(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{($p()||eh())&&!function(){const e=Vp();if(e.os!==Np.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&rh()&&this._enabled&&!this._isClosed&&(Am.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Vm(this._config.encoderConfig),Hy.on(xy.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Hy.on(xy.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(Am.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await pw.getDeviceById(e),n={};n.video=SC({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await cw(n,this.getTrackId())}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await cw({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await pw.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Am.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await cw({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await oS(this,u_.NEED_ENABLE_TRACK,this)}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),Am.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await oS(this,u_.NEED_DISABLE_TRACK,this)}catch(e){throw Am.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}Am.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new ym(Em.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Vm(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=uS(this._config);n.encoderConfig=e;const r=MT(n);(Kp()||Yp()||nh())&&(r.deviceId=void 0),Am.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new ym(Em.UNEXPECTED_ERROR,e.toString());throw Am.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(p_.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oS(this,u_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Yp()||nh())&&this._enabled&&!this._isClosed&&Hy.duringInterruption){const e=async()=>{Hy.off(xy.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Am.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Hy.on(xy.IOS_INTERRUPTION_END,e)}else Am.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(v_.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=pw.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await cw({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Hy.off(xy.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Hy.off(xy.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(M_.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(M_.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}).prototype,"setDevice",[pC,hC],Object.getOwnPropertyDescriptor(yC.prototype,"setDevice"),yC.prototype),cy(yC.prototype,"setEnabled",[fC,mC,gC],Object.getOwnPropertyDescriptor(yC.prototype,"setEnabled"),yC.prototype),cy(yC.prototype,"setEncoderConfiguration",[vC,_C],Object.getOwnPropertyDescriptor(yC.prototype,"setEncoderConfiguration"),yC.prototype),cy(yC.prototype,"close",[EC],Object.getOwnPropertyDescriptor(yC.prototype,"close"),yC.prototype),yC);class RC{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(e,t){mh(this,"uid",void 0),mh(this,"_uintid",void 0),mh(this,"_trust_in_room_",!0),mh(this,"_trust_audio_enabled_state_",!0),mh(this,"_trust_video_enabled_state_",!0),mh(this,"_trust_audio_mute_state_",!0),mh(this,"_trust_video_mute_state_",!0),mh(this,"_audio_muted_",!1),mh(this,"_video_muted_",!1),mh(this,"_audio_enabled_",!0),mh(this,"_video_enabled_",!0),mh(this,"_audio_added_",!1),mh(this,"_video_added_",!1),mh(this,"_trust_video_stream_added_state_",!0),mh(this,"_trust_audio_stream_added_state_",!0),mh(this,"_audioTrack",void 0),mh(this,"_videoTrack",void 0),mh(this,"_audioSSRC",void 0),mh(this,"_videoSSRC",void 0),mh(this,"_audioOrtc",void 0),mh(this,"_videoOrtc",void 0),mh(this,"_cname",void 0),mh(this,"_rtxSsrcId",void 0),this.uid=e,this._uintid=t}}var IC=_u,OC=fl,AC=bl;Tn({target:"Promise",stat:!0},{try:function(e){var t=OC.f(this),n=AC(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var NC=IC,LC=Tn,PC=h,kC=r,DC=Z_,xC=z,MC=Be,UC=Ln,VC=ig,jC=aE,BC=FE,FC=ce,GC=ot("isConcatSpreadable"),HC=9007199254740991,WC="Maximum allowed index exceeded",KC=PC.TypeError,qC=FC>=51||!kC((function(){var e=[];return e[GC]=!1,e.concat()[0]!==e})),YC=BC("concat"),zC=function(e){if(!xC(e))return!1;var t=e[GC];return void 0!==t?!!t:DC(e)};LC({target:"Array",proto:!0,forced:!qC||!YC},{concat:function(e){var t,n,r,i,o,a=MC(this),s=jC(a,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(zC(o=-1===t?a:arguments[t])){if(c+(i=UC(o))>HC)throw KC(WC);for(n=0;n<i;n++,c++)n in o&&VC(s,c,o[n])}else{if(c>=HC)throw KC(WC);VC(s,c++,o)}return s.length=c,s}});var JC={},XC=x,QC=q,ZC=kr.f,$C=dg,eR="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];JC.f=function(e){return eR&&"Window"==XC(e)?function(e){try{return ZC(e)}catch(e){return $C(eR)}}(e):ZC(QC(e))};var tR={},nR=ot;tR.f=nR;var rR=J,iR=He,oR=tR,aR=Kt.f,sR=function(e){var t=rR.Symbol||(rR.Symbol={});iR(t,e)||aR(t,e,{value:oR.f(e)})},cR=Tn,lR=h,dR=ee,uR=_,pR=T,hR=d,fR=w,mR=ue,gR=r,vR=He,_R=Z_,ER=E,yR=z,wR=u,bR=_e,SR=Qt,TR=Be,CR=q,RR=gt,IR=Lo,OR=L,AR=ki,NR=hi,LR=kr,PR=JC,kR=$r,DR=y,xR=Kt,MR=di,UR=C,VR=fc,jR=Va,BR=Le.exports,FR=Hr,GR=ze,HR=ot,WR=tR,KR=sR,qR=ns,YR=Na,zR=fE.forEach,JR=fr("hidden"),XR="Symbol",QR=HR("toPrimitive"),ZR=YR.set,$R=YR.getterFor(XR),eI=Object.prototype,tI=lR.Symbol,nI=tI&&tI.prototype,rI=lR.TypeError,iI=lR.QObject,oI=dR("JSON","stringify"),aI=DR.f,sI=xR.f,cI=PR.f,lI=UR.f,dI=hR([].push),uI=BR("symbols"),pI=BR("op-symbols"),hI=BR("string-to-symbol-registry"),fI=BR("symbol-to-string-registry"),mI=BR("wks"),gI=!iI||!iI.prototype||!iI.prototype.findChild,vI=fR&&gR((function(){return 7!=AR(sI({},"a",{get:function(){return sI(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=aI(eI,t);r&&delete eI[t],sI(e,t,n),r&&e!==eI&&sI(eI,t,r)}:sI,_I=function(e,t){var n=uI[e]=AR(nI);return ZR(n,{type:XR,tag:e,description:t}),fR||(n.description=t),n},EI=function(e,t,n){e===eI&&EI(pI,t,n),SR(e);var r=RR(t);return SR(n),vR(uI,r)?(n.enumerable?(vR(e,JR)&&e[JR][r]&&(e[JR][r]=!1),n=AR(n,{enumerable:OR(0,!1)})):(vR(e,JR)||sI(e,JR,OR(1,{})),e[JR][r]=!0),vI(e,r,n)):sI(e,r,n)},yI=function(e,t){SR(e);var n=CR(t),r=NR(n).concat(TI(n));return zR(r,(function(t){fR&&!pR(wI,n,t)||EI(e,t,n[t])})),e},wI=function(e){var t=RR(e),n=pR(lI,this,t);return!(this===eI&&vR(uI,t)&&!vR(pI,t))&&(!(n||!vR(this,t)||!vR(uI,t)||vR(this,JR)&&this[JR][t])||n)},bI=function(e,t){var n=CR(e),r=RR(t);if(n!==eI||!vR(uI,r)||vR(pI,r)){var i=aI(n,r);return!i||!vR(uI,r)||vR(n,JR)&&n[JR][r]||(i.enumerable=!0),i}},SI=function(e){var t=cI(CR(e)),n=[];return zR(t,(function(e){vR(uI,e)||vR(FR,e)||dI(n,e)})),n},TI=function(e){var t=e===eI,n=cI(t?pI:CR(e)),r=[];return zR(n,(function(e){!vR(uI,e)||t&&!vR(eI,e)||dI(r,uI[e])})),r};if(mR||(jR(nI=(tI=function(){if(wR(nI,this))throw rI("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?IR(arguments[0]):void 0,t=GR(e),n=function(e){this===eI&&pR(n,pI,e),vR(this,JR)&&vR(this[JR],t)&&(this[JR][t]=!1),vI(this,t,OR(1,e))};return fR&&gI&&vI(eI,t,{configurable:!0,set:n}),_I(t,e)}).prototype,"toString",(function(){return $R(this).tag})),jR(tI,"withoutSetter",(function(e){return _I(GR(e),e)})),UR.f=wI,xR.f=EI,MR.f=yI,DR.f=bI,LR.f=PR.f=SI,kR.f=TI,WR.f=function(e){return _I(HR(e),e)},fR&&sI(nI,"description",{configurable:!0,get:function(){return $R(this).description}})),cR({global:!0,wrap:!0,forced:!mR,sham:!mR},{Symbol:tI}),zR(NR(mI),(function(e){KR(e)})),cR({target:XR,stat:!0,forced:!mR},{for:function(e){var t=IR(e);if(vR(hI,t))return hI[t];var n=tI(t);return hI[t]=n,fI[n]=t,n},keyFor:function(e){if(!bR(e))throw rI(e+" is not a symbol");if(vR(fI,e))return fI[e]},useSetter:function(){gI=!0},useSimple:function(){gI=!1}}),cR({target:"Object",stat:!0,forced:!mR,sham:!fR},{create:function(e,t){return void 0===t?AR(e):yI(AR(e),t)},defineProperty:EI,defineProperties:yI,getOwnPropertyDescriptor:bI}),cR({target:"Object",stat:!0,forced:!mR},{getOwnPropertyNames:SI,getOwnPropertySymbols:TI}),cR({target:"Object",stat:!0,forced:gR((function(){kR.f(1)}))},{getOwnPropertySymbols:function(e){return kR.f(TR(e))}}),oI&&cR({target:"JSON",stat:!0,forced:!mR||gR((function(){var e=tI();return"[null]"!=oI([e])||"{}"!=oI({a:e})||"{}"!=oI(Object(e))}))},{stringify:function(e,t,n){var r=VR(arguments),i=t;if((yR(t)||void 0!==e)&&!bR(e))return _R(t)||(t=function(e,t){if(ER(i)&&(t=pR(i,this,e,t)),!bR(t))return t}),r[1]=t,uR(oI,null,r)}}),!nI[QR]){var CI=nI.valueOf;jR(nI,QR,(function(e){return pR(CI,this)}))}qR(tI,XR),FR[JR]=!0,sR("asyncIterator"),sR("hasInstance"),sR("isConcatSpreadable"),sR("iterator"),sR("match"),sR("matchAll"),sR("replace"),sR("search"),sR("species"),sR("split"),sR("toPrimitive"),sR("toStringTag"),sR("unscopables"),ns(h.JSON,"JSON",!0);var RI=J.Symbol;sR("asyncDispose"),sR("dispose"),sR("matcher"),sR("metadata"),sR("observable"),sR("patternMatch"),sR("replaceAll");var II=RI,OI=tR.f("asyncIterator"),AI=OI;function NI(e){this.wrapped=e}function LI(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof NI;NC.resolve(s?a.wrapped:a).then((function(e){s?r("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new NC((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function PI(e){return function(){return new LI(e.apply(this,arguments))}}function kI(e){return new NI(e)}LI.prototype["function"==typeof II&&AI||"@@asyncIterator"]=function(){return this},LI.prototype.next=function(e){return this._invoke("next",e)},LI.prototype.throw=function(e){return this._invoke("throw",e)},LI.prototype.return=function(e){return this._invoke("return",e)};var DI=tR.f("iterator");function xI(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new NC((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return n[void 0!==II&&DI||"@@iterator"]=function(){return this},n.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return r?(r=!1,e):i("return",e)}),n}var MI=OI,UI={exports:{}};function VI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VI(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function BI(e,t,n,r,i,o,a){let s=[],c=[],l=[],d=[],u=!1,p=!1;if(UI.exports.parse(e).mediaDescriptions.forEach((e=>{a&&a!==e.attributes.direction||("video"!==e.media.mediaType||u||(c=e.attributes.payloads,d=e.attributes.extmaps,u=!0),"audio"!==e.media.mediaType||p||(s=e.attributes.payloads,l=e.attributes.extmaps,p=!0))})),!d||0===c.length)throw new Error("Cannot get video capabilities from SDP.");if(!l||0===s.length)throw new Error("Cannot get audio capabilities from SDP.");return c.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),s.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),t&&(s=s.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),c=c.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),n&&(c=c.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),r&&(s=s.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),i&&(null==i?void 0:i.length)>0&&(s=s.filter((e=>{var t;return i.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),o&&(null==o?void 0:o.length)>0&&(c=c.filter((e=>{var t;return o.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),{audioCodecs:s,videoCodecs:c,audioExtensions:l,videoExtensions:d}}function FI(e){const t=UI.exports.parse(e);let n,r;for(const e of t.mediaDescriptions){if(!n){const t=e.attributes.iceUfrag,r=e.attributes.icePwd;if(!t||!r)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:t,icePwd:r}}if(!r){const t=e.attributes.fingerprints;t.length>0&&(r={fingerprints:t})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function GI(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function HI(e,t){const{cname:n}=e;let r;t&&t.ip&&"number"==typeof t.port?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Am.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Am.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})));const i={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let a;switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}return{dtlsParameters:i,iceParameters:o,candidates:r,rtpCapabilities:$I(e.rtpCapabilities),setup:a,cname:n}}function WI(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:a}=e;const s=$b(8,"track-"),c={ssrcId:o,attributes:jI({label:s,mslabel:n=n||$b(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==a){const e={ssrcId:a,attributes:jI({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,a]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function KI(e,t){t instanceof Rb&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!qp()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function qI(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function YI(e,t){if(!(t instanceof TC&&t._encoderConfig&&-1===t._hints.indexOf(p_.SCREEN_TRACK)))return;const n=t._encoderConfig;J_().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach((e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))})),J_().supportMinBitrate&&!t._hints.includes(p_.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach((e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(Wm("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))}))}function zI(e){if("video"!==e.media.mediaType)return;const t=Vp();if(t.name!==Lp.SAFARI&&t.os!==Np.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function JI(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})})))}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})})))}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function XI(e,t,n){if(qp())return;if("video"!==e.media.mediaType)return;if(!(t instanceof TC))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!Wm("SIMULCAST"))return;if(void 0===t._scalabiltyMode||t._scalabiltyMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabiltyMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let t=1;t<r;t++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+t,attributes:uS(i.attributes)}),a.ssrcIds.push(i.ssrcId+t),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+t,attributes:uS(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+t,o.ssrcIds[1]+t]}));e.attributes.ssrcGroups.unshift(a)}async function QI(e,t,n,r,i){const o=new RTCPeerConnection;o.addTransceiver("video",{direction:"sendonly"}),o.addTransceiver("audio",{direction:"sendonly"}),o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const a=(await o.createOffer()).sdp,s=BI(a,e,t,n,r,i,"sendonly"),c=BI(a,e,t,n,r,i,"recvonly"),l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ZI(s,c,"videoExtensions",l,d,u),ZI(s,c,"videoCodecs",l,d,u),ZI(s,c,"audioExtensions",l,d,u),ZI(s,c,"audioCodecs",l,d,u),Wm("RAISE_H264_BASELINE_PRIORITY")){const e=u.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){const t=u.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){Am.debug("raising H264 baseline profile priority");const n=u.videoCodecs[e];u.videoCodecs.splice(e,1),u.videoCodecs.splice(t,0,n)}-1!==t&&(d.videoCodecs=d.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&Wm("FILTER_SEND_H264_BASELINE")&&(l.videoCodecs=l.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}try{o.close()}catch(e){}return{send:l,recv:d,sendrecv:u}}function ZI(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}}function $I(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function eO(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function tO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e,t){e.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>b,Printer:()=>I,parse:()=>L,print:()=>P});const r="\n",i="".concat("\r").concat(r),o=" ";let a;function s(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="Â€"&&e<="Ã¿"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function p(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>""&&e<"\t"||e>"\v"&&e<"\f"||e>""&&e<"Ã¿"}function m(e){return p(e)||s(e)||"+"===e||"/"===e}function g(e){return s(e)||p(e)||"+"===e||"/"===e||"-"===e||"_"===e}function v(e){return p(e)||s(e)||"+"===e||"/"===e}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class w{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let t=0;t<4;t++)if(n=this.consumeDecimalUChar(e,n),3!==t){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let t=0;t<3&&s(e[n]);t++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||p(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),h(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class b extends w{constructor(){super(),y(this,"records",[]),y(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!e.trim())).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),p=this.parseKey(),h=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:a,emails:s,phones:c,connection:l,bandwidths:d,timeFields:u,key:p,attributes:h,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new T;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>d(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new C(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>d(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t,...n){const r=t.call(this,e.value,e.cur,...n),i=e.value.slice(e.cur,r);return e.cur=r,i}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class S extends w{constructor(...e){super(...e),y(this,"attributes",void 0),y(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,a]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t,...n){if(!e.attValue)throw new Error("Nothing to extract from attValue.");const r=t.call(this,e.attValue,e._cur,...n),i=e.attValue.slice(e._cur,r);return e._cur=r,i}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,s);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=E(E({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends S{constructor(...e){super(...e),y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,v),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class C extends S{constructor(e){super(),y(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=t.trim();const i="string"==typeof n?n.trim():null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>p(e)||s(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I{constructor(){R(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new A(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class O{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class A extends O{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class N extends O{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const e of t)n+=this.printRtpMap(e.payloadType,e.rtpMap),n+=this.printFmtp(e.payloadType,e.fmtp),n+=e.rtcpFeedbacks.map((t=>this.printRTCPFeedback(e.payloadType,t))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function L(e){return(new b).parse(e)}function P(e,t){return(new I).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})()}(UI);class rO{constructor(e){mh(this,"sessionDesc",void 0),mh(this,"localCapabilities",void 0),mh(this,"rtpCapabilities",void 0),mh(this,"candidates",void 0),mh(this,"iceParameters",void 0),mh(this,"dtlsParameters",void 0),mh(this,"setup",void 0),mh(this,"currentMidIndex",void 0),mh(this,"cname",void 0),e=uS(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,sdkCodec:s,cname:c}=e,l=UI.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=a,this.cname=c;for(let e=0;e<l.mediaDescriptions.length;e++){const a=l.mediaDescriptions[e];a.attributes.iceUfrag=t.iceUfrag,a.attributes.icePwd=t.icePwd,a.attributes.fingerprints=n.fingerprints,a.attributes.candidates=r,a.attributes.setup=o,"video"===a.media.mediaType&&(a.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10))),a.attributes.payloads=i.videoCodecs,a.attributes.extmaps=i.videoExtensions),"audio"===a.media.mediaType&&(a.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),a.attributes.payloads=i.audioCodecs,a.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[e]=this.mungMediaDesc(a)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return UI.exports.print(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=WI(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===I_.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),a=r[0].attributes.label,s=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:a,mslabel:s}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{e.includes(t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{i.map((e=>e.ssrcId)).includes(e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===O_.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(nO(nO({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=uS(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=uS(e);return KI(n,t),YI(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===I_.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=uS(e);return qI(t),function(e){const t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}function iO(e){if(Array.isArray(e))return e.map((e=>e));if(!oO(e))return e;const t={};for(const n in e)oO(e[n])||Array.isArray(e[n])?t[n]=iO(e[n]):t[n]=e[n];return t}function oO(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function aO(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function sO(e){return!!window.RTCStatsReport&&e.getStats()instanceof Eu}class cO{constructor(e){mh(this,"input",[]),mh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const lO={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},dO={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:lO,remoteCandidate:lO}},uO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},pO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},hO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},fO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function mO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class vO{constructor(e,t){mh(this,"onFirstVideoReceived",void 0),mh(this,"onFirstVideoDecoded",void 0),mh(this,"onFirstAudioReceived",void 0),mh(this,"onFirstVideoDecodedTimeout",void 0),mh(this,"onFirstAudioDecoded",void 0),mh(this,"onSelectedLocalCandidateChanged",void 0),mh(this,"onSelectedRemoteCandidateChanged",void 0),mh(this,"videoIsReady",!1),mh(this,"videoIsReady2",{}),mh(this,"pc",void 0),mh(this,"options",void 0),mh(this,"intervalTimer",void 0),mh(this,"stats",iO(dO)),mh(this,"isFirstVideoReceived",{}),mh(this,"isFirstVideoDecoded",{}),mh(this,"isFirstAudioReceived",{}),mh(this,"isFirstAudioDecoded",{}),mh(this,"isFirstVideoDecodedTimeout",{}),mh(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Eu((e=>{e({local:gO({},lO),remote:gO({},lO)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,a=0;for(const s of n)e[s].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;const c=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,l=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=c,o+=l):(i+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}}function _O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_O(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class yO extends vO{constructor(){super(...arguments),mh(this,"_stats",dO),mh(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=iO(dO);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{const t=e.id.includes("send");switch("".concat(e.mediaType,"_").concat(t?"send":"recv")){case"video_send":{const t=iO(pO);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=iO(uO),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:EO({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=iO(fO);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=iO(hO);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new Eu(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}}function wO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class SO extends vO{constructor(){super(...arguments),mh(this,"_stats",dO),mh(this,"report",void 0),mh(this,"lastDecodeVideoReceiverStats",new Map),mh(this,"lastVideoFramesRecv",new Map),mh(this,"lastVideoFramesSent",new Map),mh(this,"lastVideoFramesDecode",new Map),mh(this,"lastVideoJBDelay",new Map),mh(this,"lastAudioJBDelay",new Map),mh(this,"mediaBytesSent",new Map),mh(this,"mediaBytesRetransmit",new Map),mh(this,"mediaBytesTargetEncode",new Map),mh(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=iO(dO),this.report.forEach((e=>{switch(e.type){case xp.OUTBOUND:case xp.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===xp.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===xp.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case xp.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case xp.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:bO({},lO),remote:bO({},lO)};return e.forEach((n=>{let r;if(n.type===xp.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===xp.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===xp.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===xp.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===xp.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(bO({},t),bO({},this.stats.selectedCandidatePair.localCandidate)),e.type===xp.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(bO({},t),bO({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=iO(fO),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=iO(uO),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,o=i-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&o>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=o,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&i-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:bO({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=iO(pO),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new cO(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new cO(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new cO(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,xp.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=iO(hO),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,xp.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(Sw(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o;const a=t?this.report.get(t):void 0,s=null!==(r=null==a?void 0:a.framesSent)&&void 0!==r?r:e.framesSent;let c=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(o=null==a?void 0:a.frameHeight)&&void 0!==o?o:e.frameHeight;if("number"!=typeof s)return;"number"==typeof c&&"number"==typeof l||(c=0,l=0);let d=0;const u=Date.now(),p=this.lastVideoFramesSent.get(n.ssrc);p&&u-p.lts>=800?(d=Math.round((s-p.count)/((u-p.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:s,lts:u,rate:d})):p?d=p.rate:this.lastVideoFramesSent.set(n.ssrc,{count:s,lts:u,rate:0}),n.sentFrame={width:c,height:l,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,a,s;const c=t?this.report.get(t):void 0,l=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,d=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,p=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,h=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:r||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0}}if(p&&h){let e=this.lastVideoJBDelay.get(n.ssrc);this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:h}),e||(e={jitterBufferDelay:0,jitterBufferEmittedCount:0});const t=1e3*(p-e.jitterBufferDelay)/(h-e.jitterBufferEmittedCount);n.jitterBufferMs=t,n.currentDelayMs=Math.round(t)}}processAudioTrackSenderStats(e,t,n){var r,i,o,a;const s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,o,a,s,c,l;const d=t?this.report.get(t):void 0,u=null!==(r=null==d?void 0:d.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,p=null!==(i=null==d?void 0:d.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,h=null!==(o=null==d?void 0:d.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(a=null==d?void 0:d.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,m=null!==(s=null==d?void 0:d.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,g=null!==(c=null==d?void 0:d.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,v=null!==(l=null==d?void 0:d.concealedSamples)&&void 0!==l?l:e.concealedSamples;if(u&&p&&(n.accelerateRate=u/p),h&&f){let e=this.lastAudioJBDelay.get(n.ssrc);this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:f}),e||(e={jitterBufferDelay:0,jitterBufferEmittedCount:0});const t=1e3*(h-e.jitterBufferDelay)/(f-e.jitterBufferEmittedCount);n.jitterBufferMs=Math.round(t)}n.outputLevel=m;let _=1920;g&&p&&(_=p/g/50,n.receivedFrames=Math.round(p/_)),v&&(n.droppedFrames=Math.round(v/_))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class TO extends vO{updateStats(){return Eu.resolve()}}function CO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=aO();return o?o<76?new yO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new SO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):sO(e)?new SO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new TO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}var RO;function IO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function OO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let AO=(cy((RO=class e extends Y_{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),mh(this,"store",void 0),mh(this,"peerConnection",void 0),mh(this,"remoteSDP",void 0),mh(this,"initialOffer",void 0),mh(this,"statsFilter",void 0),mh(this,"useRTX",!1),mh(this,"localCapabilities",void 0),mh(this,"localCandidateCount",0),mh(this,"allCandidatesReceived",!1),mh(this,"establishPromise",void 0),mh(this,"mutex",new Uy("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=CO(this.peerConnection,Wm("STATS_UPDATE_INTERVAL"),void 0,qp()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=FI(e.sdp),n=BI(e.sdp,!this.useRTX,Wm("FILTER_VIDEO_FEC"),Wm("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=n,this.initialOffer=e,OO(OO({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new ym(Em.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new rO({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r.send,remoteSetup:i,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:o});const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t){var n=this;return PI((function*(){const r=yield kI(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield kI(n.peerConnection.createOffer()),o=UI.exports.parse(i.sdp),a=e.map((e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let s;try{s=yield a}catch(e){throw r.forEach((e=>{Kp()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,s);const l=n.remoteSDP.toString();return yield kI(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield kI(n.applySendEncodings(r,e)),yield kI(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}}))}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{Kp()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new Eu(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),a=r=>{const s=Vp();if(("Safari"===s.name&&11===Number(s.version)||Yp())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",a)})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await o,id:n}}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(Kp()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(Kp()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return PI((function*(){const n=yield kI(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(J_().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===O_.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Am.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===O_.RELAY)return;e!==O_.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield kI(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=FI(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString();yield kI(t.peerConnection.setLocalDescription(n)),yield kI(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){Am.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Am.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Am.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),Wm("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Uv(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),Wm("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!J_().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let r=0;r<e.length;r++){var n;const i=e[r],o=t[r];if(!o)continue;const a={},s={};if(o instanceof TC)switch(o._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(Wm("DSCP_TYPE")&&oh()){const e=Wm("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(s.networkPriority=e)}const c=i.getParameters(),l=null===(n=c.encodings)||void 0===n?void 0:n[0];l&&Object.assign(l,s),Object.assign(c,a),await i.setParameters(c)}}catch(e){Am.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=UI.exports.parse(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&KI(i,e)})),UI.exports.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new Eu(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),a=t=>{const s=Vp();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",a)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Eu.all(t)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(J_().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"connect"),RO.prototype),cy(RO.prototype,"stopSending",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"stopSending"),RO.prototype),cy(RO.prototype,"receive",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"receive"),RO.prototype),cy(RO.prototype,"stopReceiving",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"stopReceiving"),RO.prototype),cy(RO.prototype,"muteRemote",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"muteRemote"),RO.prototype),cy(RO.prototype,"unmuteRemote",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"unmuteRemote"),RO.prototype),cy(RO.prototype,"muteLocal",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"muteLocal"),RO.prototype),cy(RO.prototype,"unmuteLocal",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"unmuteLocal"),RO.prototype),cy(RO.prototype,"close",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"close"),RO.prototype),cy(RO.prototype,"updateEncoderConfig",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"updateEncoderConfig"),RO.prototype),cy(RO.prototype,"updateSendParameters",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"updateSendParameters"),RO.prototype),cy(RO.prototype,"replaceTrack",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"replaceTrack"),RO.prototype),cy(RO.prototype,"getRemoteSSRC",[NO],Object.getOwnPropertyDescriptor(RO.prototype,"getRemoteSSRC"),RO.prototype),RO);function NO(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function LO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function PO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const kO="9",DO=4e4;class xO{get localCapabilities(){return uS(this._localCapabilities)}get rtpCapabilities(){return uS(this._rtpCapabilities)}get candidates(){return uS(this._candidates)}get iceParameters(){return uS(this._iceParameters)}get dtlsParameters(){return uS(this._dtlsParameters)}constructor(e){mh(this,"sessionDesc",void 0),mh(this,"_localCapabilities",void 0),mh(this,"_rtpCapabilities",void 0),mh(this,"_candidates",void 0),mh(this,"_iceParameters",void 0),mh(this,"_dtlsParameters",void 0),mh(this,"setup",void 0),mh(this,"currentMidIndex",void 0),mh(this,"cname",void 0),mh(this,"firefoxSsrcMidMap",new Map),e=uS(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,cname:s}=e,c=UI.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=s;const l=this.rtpCapabilities.send;for(const e of c.mediaDescriptions){if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType&&(e.media.fmts=l.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=l.videoCodecs,e.attributes.extmaps=l.videoExtensions,Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:DO,rtx:Wm("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=l.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=l.audioCodecs,e.attributes.extmaps=l.audioExtensions,eO(e),Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:2e4}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}preloadRemoteMedia(){const e=Wm("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+2e4,a=2*o+DO,{ssrcs:s,ssrcGroups:c}=WI([{ssrcId:e}],this.cname),{ssrcs:l,ssrcGroups:d}=WI([{ssrcId:a,rtx:Wm("USE_SUB_RTX")?a+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kO,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kO,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return UI.exports.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=WI(t,this.cname,Wm("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(qp()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(Kp()||Qp())||0===t&&Wm("USE_SUB_RTX")||Zp()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=uS(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),qp()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||qp()||Zp()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===O_.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(PO(PO({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=uS(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(qp()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send;let l=[];if(a===I_.VIDEO){var d,u;if(Wm("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(l=s.videoCodecs.filter((e=>{var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===Wm("H264_PROFILE_LEVEL_ID")}))),!l||0===(null===(d=l)||void 0===d?void 0:d.length)){const e=c.videoCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==e.length&&(l=s.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(Wm("USE_PUB_RTX")){const e=l.map((e=>e.payloadType.toString())),t=s.videoCodecs.filter((t=>{var n,r;return"rtx"===(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName)&&e.includes((null===(r=t.fmtp)||void 0===r?void 0:r.parameters.apt)||"")}));l=[...l,...t]}0===l.length&&(Am.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(u=s.videoCodecs[0].rtpMap)||void 0===u?void 0:u.encodingName)),l=s.videoCodecs)}else l=s.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===l.length&&(Am.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),l=s.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));const p=a===I_.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const h="".concat(this.currentMidIndex);let f={media:{mediaType:a,port:kO,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};f=this.mungRecvMediaDsec(f,e,o);const m=this.findFirstClosedMedia(a);if(m){const e=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[e]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,a=e===I_.VIDEO?o.videoCodecs:o.audioCodecs,s=e===I_.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:kO,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=uS(e);return qI(r),KI(r,t),YI(r,t),zI(r),JI(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=uS(e);return JI(n,t,this.localCapabilities.recv),eO(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>qp()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var MO;function UO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function VO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UO(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let jO=(cy((MO=class e extends Y_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t,n;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(n=t.transport)||void 0===n?void 0:n.state)&&void 0!==e?e:null}constructor(t,n){super(t,n),mh(this,"store",void 0),mh(this,"peerConnection",void 0),mh(this,"remoteSDP",void 0),mh(this,"initialOffer",void 0),mh(this,"transportEventReceiver",void 0),mh(this,"statsFilter",void 0),mh(this,"localCapabilities",void 0),mh(this,"localCandidateCount",0),mh(this,"allCandidatesReceived",!1),mh(this,"selectedCandidatePairTimer",void 0),mh(this,"establishPromise",void 0),mh(this,"mutex",new Uy("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=CO(this.peerConnection,Wm("STATS_UPDATE_INTERVAL"),void 0,qp()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=FI(e.sdp),n=await QI(!Wm("USE_PUB_RTX")&&!Wm("USE_SUB_RTX"),Wm("FILTER_VIDEO_FEC"),Wm("FILTER_AUDIO_FEC"));return this.localCapabilities=$I(n),this.initialOffer=e,VO(VO({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new ym(Em.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new xO({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:this.localCapabilities,cname:o});const a=this.remoteSDP.toString(),s=UI.exports.parse(this.initialOffer.sdp),c=s.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&eO(c);const l=UI.exports.print(s),d=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==d||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a});const u=this.peerConnection.getTransceivers()[0];if(null!=u&&u.receiver&&this.tryBindTransportEvents(u.receiver),Wm("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return PI((function*(){const i=yield kI(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)})),qp()&&!0===Wm("SIMULCAST")&&(yield kI(r.applySimulcastForFirefox(o,e)));const a=yield kI(r.peerConnection.createOffer()),s=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(a.sdp,e,s),l=UI.exports.parse(c),d=s.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return GI(t,Wm("USE_PUB_RTX"))}));let u;try{u=yield d}catch(i){u=[],r.remoteSDP.receive(e,t,n,u);const o=r.remoteSDP.toString();throw yield kI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield kI(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield kI(r.stopSending(s,!0)),i}r.remoteSDP.receive(e,t,n,u);const p=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return yield kI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield kI(r.applySimulcastEncodings(o,e)),yield kI(r.applySendEncodings(o,e)),null==h||h(p),yield kI(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),o.map(((e,t)=>{const n=s[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(e){throw e instanceof ym?e:new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Am.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else Am.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Am.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else Am.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return PI((function*(){const n=yield kI(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(J_().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===O_.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Am.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===O_.RELAY)return;e!==O_.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield kI(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=FI(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),a=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield kI(t.peerConnection.setLocalDescription(n)),null==a||a(o),yield kI(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){Am.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?qp()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:VO(VO({},lO),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:VO(VO({},lO),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Am.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Am.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),Wm("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Uv(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),Wm("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Wm("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),Wm("ENABLE_ENCODED_TRANSFORM")&&J_().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(jb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!Wm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();Am.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(e,t){try{if(!J_().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let c=0;c<e.length;c++){const l=e[c],d=t[c];if(d&&d instanceof TC){var n,r;if(this.isVP8Simulcast(d))continue;const e={},t={};switch(d._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var i,o,a,s;if(null!==(n=d._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(i=d._encoderConfig)||void 0===i?void 0:i.bitrateMax)),d._hints.includes(p_.LOW_STREAM)&&(null!==(o=d._encoderConfig)&&void 0!==o&&o.frameRate&&(t.maxFramerate=Fb(d._encoderConfig.frameRate)),null!==(a=d._encoderConfig)&&void 0!==a&&a.scaleResolutionDownBy&&(null===(s=d._encoderConfig)||void 0===s?void 0:s.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=d._encoderConfig.scaleResolutionDownBy)),Wm("DSCP_TYPE")&&oh()){const e=Wm("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(t.networkPriority=e)}const c=l.sender.getParameters(),u=null===(r=c.encodings)||void 0===r?void 0:r[0];qp()&&!u&&(e.encodings=[t]),u&&Object.assign(u,t),Object.assign(c,e),await l.sender.setParameters(c)}}}catch(e){Am.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=UI.exports.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(KI(o,e),XI(o,e,this.store.codec))})),UI.exports.print(r)}mungReceiveAnswerSDP(e,t,n){const r=UI.exports.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===I_.AUDIO&&"audio"===i.media.mediaType&&eO(i),UI.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o;const s=e[a],c=t[a];if(c instanceof TC&&!c._hints.includes(p_.LOW_STREAM)&&null!==(n=c._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=c._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=c._scalabiltyMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=c._scalabiltyMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=s.sender.getParameters();await s.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!qp()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof TC&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i;return!!(e instanceof TC&&Wm("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(p_.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(Wm("SDP_LOGGING"))return Am.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(J_().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"connect"),MO.prototype),cy(MO.prototype,"receive",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"receive"),MO.prototype),cy(MO.prototype,"batchReceive",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"batchReceive"),MO.prototype),cy(MO.prototype,"stopReceiving",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"stopReceiving"),MO.prototype),cy(MO.prototype,"muteRemote",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"muteRemote"),MO.prototype),cy(MO.prototype,"unmuteRemote",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"unmuteRemote"),MO.prototype),cy(MO.prototype,"muteLocal",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"muteLocal"),MO.prototype),cy(MO.prototype,"unmuteLocal",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"unmuteLocal"),MO.prototype),cy(MO.prototype,"close",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"close"),MO.prototype),cy(MO.prototype,"updateEncoderConfig",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"updateEncoderConfig"),MO.prototype),cy(MO.prototype,"updateSendParameters",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"updateSendParameters"),MO.prototype),cy(MO.prototype,"replaceTrack",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"replaceTrack"),MO.prototype),cy(MO.prototype,"getRemoteSSRC",[BO],Object.getOwnPropertyDescriptor(MO.prototype,"getRemoteSSRC"),MO.prototype),MO);function BO(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function FO(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Fb(t.width),r.height=Fb(t.height);const i=Fb(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const a=r.getContext("2d");if(!a)throw new ym(Em.UNEXPECTED_ERROR,"can not get canvas context");const s=J_(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0],l=Jy((()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(Am.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}a.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))})()),i),d=c.stop;return c.stop=()=>{d.call(c),l(),n&&(n.remove(),n=null),r&&(r.width=0,r.remove(),r=null),Am.debug("clean low stream renderer")},c}var GO,HO,WO,KO,qO,YO,zO,JO,XO,QO,ZO,$O;function eA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class nA extends Dy{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat($b(5,""))),mh(this,"_userId",void 0),mh(this,"_uintId",void 0),mh(this,"_isDestroyed",!1),mh(this,"store",void 0),mh(this,"processor",void 0),mh(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Am.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let rA=(GO=Py({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),HO=Py({argsMap:e=>[e.getTrackId()]}),WO=Py({argsMap:(e,t)=>[e.getTrackId(),t.name]}),KO=Py({argsMap:e=>[e.getTrackId()]}),cy((qO=class extends nA{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sv.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),mh(this,"_videoVisibleTimer",null),mh(this,"_previousVideoVisibleStatus",void 0),mh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),mh(this,"trackMediaType","video"),mh(this,"_videoWidth",void 0),mh(this,"_videoHeight",void 0),mh(this,"_player",void 0),mh(this,"processorDestination",void 0),mh(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Iw(this.getTrackId(),"remote"),this.processorDestination=new Rw(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return hS((()=>{Am.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),aS(this,u_.GET_STATS)||tA({},Wv)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(Am.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Am.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=tA(tA({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new kT(n):this._player=new xT(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(__.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(__.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),Wm("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Am.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){nS(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(tS)}_updatePlayerSource(){Am.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=wC.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new ym(Em.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ym(Em.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(x_.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x_.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[GO],Object.getOwnPropertyDescriptor(qO.prototype,"play"),qO.prototype),cy(qO.prototype,"stop",[HO],Object.getOwnPropertyDescriptor(qO.prototype,"stop"),qO.prototype),cy(qO.prototype,"pipe",[WO],Object.getOwnPropertyDescriptor(qO.prototype,"pipe"),qO.prototype),cy(qO.prototype,"unpipe",[KO],Object.getOwnPropertyDescriptor(qO.prototype,"unpipe"),qO.prototype),qO),iA=(YO=Py({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),zO=Py({argsMap:(e,t)=>[e.getTrackId(),t]}),JO=Py({argsMap:e=>[e.getTrackId()]}),XO=Py({argsMap:e=>[e.getTrackId()]}),QO=Py({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ZO=Py({argsMap:e=>[e.getTrackId()]}),cy(($O=class extends nA{get isPlaying(){return this._useAudioElement?fw.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),mh(this,"trackMediaType","audio"),mh(this,"_source",void 0),mh(this,"_useAudioElement",!0),mh(this,"_volume",100),mh(this,"processorContext",void 0),mh(this,"processorDestination",void 0),mh(this,"_played",!1),mh(this,"_bypassWebAudio",!1),Wm("DISABLE_WEBAUDIO")?(this._source=new Nw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Zy(e,!0),Wm("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Dv.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(__.FIRST_FRAME_DECODED)})),this.processorContext=new Aw(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Ow(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Dv.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Dv.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Dv.ON_AUDIO_BUFFER),this._source.on(Dv.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?fw.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new ym(Em.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fw.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return hS((()=>{Am.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),aS(this,u_.GET_STATS)||tA({},Gv)}play(){Am.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Am.debug("[".concat(this.getTrackId(),"] use audio element to play")),fw.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Am.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?fw.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Am.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fw.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ym(Em.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ym(Em.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ym(Em.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(x_.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(x_.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x_.ON_TRACK),this.processorDestination.removeAllListeners(x_.ON_NODE)}}).prototype,"setVolume",[YO],Object.getOwnPropertyDescriptor($O.prototype,"setVolume"),$O.prototype),cy($O.prototype,"setPlaybackDevice",[zO],Object.getOwnPropertyDescriptor($O.prototype,"setPlaybackDevice"),$O.prototype),cy($O.prototype,"play",[JO],Object.getOwnPropertyDescriptor($O.prototype,"play"),$O.prototype),cy($O.prototype,"stop",[XO],Object.getOwnPropertyDescriptor($O.prototype,"stop"),$O.prototype),cy($O.prototype,"pipe",[QO],Object.getOwnPropertyDescriptor($O.prototype,"pipe"),$O.prototype),cy($O.prototype,"unpipe",[ZO],Object.getOwnPropertyDescriptor($O.prototype,"unpipe"),$O.prototype),$O);function oA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class sA extends vm{constructor(){super(),mh(this,"uplinkStatsUploadInterval",void 0),mh(this,"uplinkRelatedStatsUploadInterval",void 0),mh(this,"uplinkDenoiserStatsUploadInterval",void 0),mh(this,"transportStatsUploadInterval",void 0),mh(this,"uplinkExtensionStatsUploadInterval",void 0),mh(this,"downlinkExtensionStatsUploadInterval",void 0),mh(this,"extensionUsageStatsUploadInterval",void 0),mh(this,"downlinkStatsUploadInterval",void 0),mh(this,"downlinkRelatedStatsUploadInterval",void 0),mh(this,"lastStats",void 0),mh(this,"uploadUnplinkStarted",!1),mh(this,"uploadDownlinkStarted",!1),mh(this,"uploadTransportStarted",!1),mh(this,"uploadExtensionUsageStarted",!1),mh(this,"requestStats",void 0),mh(this,"requestLocalMedia",void 0),mh(this,"requestRemoteMedia",void 0),mh(this,"requestAllTracks",void 0),mh(this,"requestVideoIsReady",void 0),mh(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&this.uploadTransportStats(t)}),1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const e=new Map;this.extensionUsageStatsUploadInterval=window.setInterval((async()=>{var t,n,r;const i=Date.now(),o={connectionInterval:Wm("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let a=[];const s=(null===(t=this.requestAllTracks)||void 0===t?void 0:t.call(this))||[];for(const e of s)!e.muted&&e.enabled&&(a=a.concat(await e.getProcessorUsage()));const c=(null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[];for(const[e,t]of c)t.has(I_.VIDEO)&&e.videoTrack&&(a=a.concat(await e.videoTrack.getProcessorUsage())),t.has(I_.AUDIO)&&e.audioTrack&&(a=a.concat(await e.audioTrack.getProcessorUsage()));if(0===a.length)return;o.details=function(e,t){const n={};for(const{id:a,value:s,level:c,direction:l}of e){var r;const e=null!==(r=t.get(a))&&void 0!==r?r:0,d=2===s?e+Wm("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(a,d),n[a]?(2===s&&(n[a].value=s),c>n[a].level&&(n[a].level=c),"remote"===l&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:s,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(a,e);const l=Date.now(),d=l>i?l:i+1;null===(r=this.requestUpload)||void 0===r||r.call(this,Lv.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:d})}),Wm("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&(this.uploadUplinkStats(t),this.lastStats=t)}),3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&this.uploadRelatedUplinkStats(t,this.lastStats),this.lastStats=t}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadDenoiserStats(t)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadExtensionStats(t)}),2e3))}uploadTransportStats(e){dS((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,Lv.TRANSPORT_STATS,function(e){const t={connectionType:100,googRtt:e.rtt};if("relay"===e.selectedCandidatePair.localCandidate.candidateType){const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t.connectionType=101),"tcp"===n&&(t.connectionType=103),"tls"===n&&(t.connectionType=104)}return t}(e))}))}uploadUplinkStats(e){var t;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).forEach((t=>{let[n,{track:r,ssrcs:i}]=t;switch(n){case N_.LocalVideoLowTrack:case N_.LocalVideoTrack:{const t=function(e,t,n){var r;const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const o={id:$b(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:i.ssrc.toString()};switch(o.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.sentFrame&&(o.A_fhs=i.sentFrame.height.toString(),o.A_frs=i.sentFrame.frameRate.toString(),o.A_fws=i.sentFrame.width.toString()),i.adaptionChangeReason){case"none":o.A_ac="0";break;case"cpu":o.A_ac="1";break;case"bandwidth":o.A_ac="2";break;case"other":o.A_ac="3"}return o.A_lvps=cv[n._player?n._player.videoElementStatus:"uninit"].toString(),o.A_nr=null===(r=i.nacksCount)||void 0===r?void 0:r.toString(),i.avgEncodeMs&&(o.A_aem=i.avgEncodeMs.toFixed(0).toString()),o}(i[0].ssrcId,e,r),o=n===N_.LocalVideoTrack?function(e,t,n){var r,i,o,a,s,c,l,d;const u=t.videoSend.find((t=>t.ssrc===e));if(!u)return null;const p={id:$b(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:u.ssrc.toString()},h=null!==(r=null!==(i=null===(o=u.inputFrame)||void 0===o?void 0:o.height)&&void 0!==i?i:null==n?void 0:n._videoHeight)&&void 0!==r?r:0,f=null!==(a=null!==(s=null===(c=u.inputFrame)||void 0===c?void 0:c.width)&&void 0!==s?s:null==n?void 0:n._videoWidth)&&void 0!==a?a:0,m=null!==(l=null===(d=u.inputFrame)||void 0===d?void 0:d.frameRate)&&void 0!==l?l:0;return h&&(p.A_fhi=h+""),f&&(p.A_fwi=f+""),m&&(p.A_fri=m+""),p}(i[0].ssrcId,e,r):null;t&&dS((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,Lv.PUBLISH_STATS,{stream_type:n===N_.LocalVideoLowTrack?"low":"high",stats:aA(aA({},t),o)})}));const a=function(e){const t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);a&&setTimeout((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,Lv.PUBLISH_STATS,{stream_type:n===N_.LocalVideoLowTrack?"low":"high",stats:a})}),1e3);break}case N_.LocalAudioTrack:{const t=function(e,t,n){const r=t.audioSend.find((t=>t.ssrc===e));if(!r)return null;const i={id:$b(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};return i.A_astd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",r.inputLevel?i.A_ail=Math.round(100*r.inputLevel).toString():i.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.aecReturnLoss&&(i.A_ecrl=Math.round(r.aecReturnLoss).toString()),r.aecReturnLossEnhancement&&(i.A_ecrle=Math.round(r.aecReturnLossEnhancement).toString()),i}(i[0].ssrcId,e,r);t&&dS((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,Lv.PUBLISH_STATS,{stream_type:"high",stats:t})}));break}}}))}uploadRelatedUplinkStats(e,t){var n;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((e=>{let[t]=e;return t===N_.LocalVideoLowTrack||t===N_.LocalVideoTrack})).forEach((t=>{let[n,{ssrcs:r}]=t;const i=function(e,t){const n=t.videoSend.find((t=>t.ssrc===e));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(r[0].ssrcId,e);i&&dS((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,Lv.PUBLISH_RELATED_STATS,{stream_type:n===N_.LocalVideoLowTrack?"low":"high",stats:i})}))}))}uploadDenoiserStats(e){for(let i=0;i<e.length;i++){const o=e[i];if(o instanceof Ib){var t,n,r;const e=null===(t=(n=o._external).getDenoiserStats)||void 0===t?void 0:t.call(n);return void(e&&(null===(r=this.requestUpload)||void 0===r||r.call(this,Lv.DENOISER_STATS,e)))}}}uploadExtensionStats(e){for(let t=0;t<e.length;t++)e[t].getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let e;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let t=!1;this.downlinkStatsUploadInterval=window.setInterval((()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&(this.uploadDownlinkStats(r,t,e),e=r),t=!t}),3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&(this.uploadRelatedDownlinkStats(t,this.lastStats),this.lastStats=t)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestRemoteMedia)||void 0===e?void 0:e.call(this);t&&this.uploadDownlinkExtensionStats(t)}),2e3)}uploadDownlinkStats(e,t,n){var r;((null===(r=this.requestRemoteMedia)||void 0===r?void 0:r.call(this))||[]).forEach((r=>{let[i,o]=r;if(o.has(I_.VIDEO)&&i.videoTrack){const r=i.videoTrack?function(e,t,n,r,i){const o=t.videoRecv.find((t=>t.ssrc===e));if(!o)return null;const a={id:$b(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:o.ssrc.toString()};var s,c;if(a.bytesReceived=o.bytes.toString(),a.packetsLost=o.packetsLost.toString(),a.packetsReceived=o.packets.toString(),o.framesRateFirefox&&(a.A_frr=o.framesRateFirefox.toString()),o.receivedFrame?(a.A_frr=o.receivedFrame.frameRate.toString(),a.A_fhr=o.receivedFrame.height.toString(),a.A_fwr=o.receivedFrame.width.toString()):(a.A_fhr=null===(s=r._videoHeight)||void 0===s?void 0:s.toString(),a.A_fwr=null===(c=r._videoWidth)||void 0===c?void 0:c.toString()),a.A_frd=o.decodeFrameRate.toString(),o.outputFrame&&(a.A_fro=o.outputFrame.frameRate.toString()),void 0!==o.jitterBufferMs&&(a.A_jbm=Math.floor(o.jitterBufferMs).toString()),void 0!==o.currentDelayMs&&(a.A_cdm=Math.floor(o.currentDelayMs).toString()),a.A_fs=o.firsCount.toString(),a.A_ns=o.nacksCount.toString(),a.A_ps=o.plisCount.toString(),r&&(a.A_vrtd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),r._player&&r._player.freezeTimeCounterList.length>0&&(a.A_vrft=Math.round(r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),i&&r._player&&"visible"===Mb.visibility){const e=Math.min(6e3,r._player.renderFreezeAccTime);a.A_vrrft=Math.round(e).toString(),r._player.renderFreezeAccTime=Math.max(0,r._player.renderFreezeAccTime-e)}if(a.A_rvps=cv[r._player?r._player.videoElementStatus:"uninit"].toString(),n){const t=n.videoRecv.find((t=>t.ssrc===e));if(t&&void 0!==o.totalInterFrameDelay&&void 0!==o.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=o.totalInterFrameDelay-t.totalInterFrameDelay,n=o.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=o.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,s=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(s)&&i+s>Math.max(3*i,i+150)&&(a.A_ifdsd=s.toString())}}return a}(i._videoSSRC,e,n,i.videoTrack,t):void 0;r&&dS((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,Lv.SUBSCRIBE_STATS,{stream_id:i.uid,stats:r})}))}if(o.has(I_.AUDIO)&&i.audioTrack){const t=i.audioTrack?function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o={id:$b(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};if(o.bytesReceived=i.bytes.toString(),o.packetsLost=i.packetsLost.toString(),o.packetsReceived=i.packets.toString(),i.outputLevel?o.A_aol=Math.round(100*i.outputLevel).toString():o.A_aol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),o.A_apol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),r&&(o.A_artd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),o.A_jr=i.jitterMs.toString(),o.A_jbm=Math.floor(i.jitterBufferMs).toString(),o.A_cdm=Math.floor(i.jitterBufferMs).toString(),o.A_raps=cv[fw.getPlayerState(r.getTrackId())].toString(),n){const t=n.audioRecv.find((t=>t.ssrc===e));if(t){const e=i.concealedSamples-t.concealedSamples;e>0&&(o.A_cs=Math.round(e).toString())}}return o}(i._audioSSRC,e,n,i.audioTrack):void 0;t&&dS((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,Lv.SUBSCRIBE_STATS,{stream_id:i.uid,stats:t})}))}}))}uploadRelatedDownlinkStats(e,t){var n;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((n=>{let[r,i]=n;if(i.has(I_.VIDEO)&&r.videoTrack){var o;const n=!0===(r._videoSSRC&&(null===(o=this.requestVideoIsReady)||void 0===o?void 0:o.call(this,r._videoSSRC))||!1),i=function(e,t,n,r,i,o){const a=n.videoRecv.find((t=>t.ssrc===e)),s=i?i.videoRecv.find((t=>t.ssrc===e)):void 0;if(!a)return null;const c=xb.isRemoteVideoFreeze(o,a,s)&&t,l={mediaType:"video",isVideoMute:!1,peerId:r,frameRateReceived:a.receivedFrame&&a.receivedFrame.frameRate.toString(),frameRateDecoded:a.decodedFrame&&a.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:a.bytes.toString(),packetsReceived:a.packets.toString(),packetsLost:a.packetsLost.toString(),qpSumPerFrame:Math.floor(a.qpSumPerFrame).toString()};return a.framesRateFirefox&&(l.frameRateDecoded=a.framesRateFirefox.toString(),l.frameRateReceived=a.framesRateFirefox.toString()),l}(r._videoSSRC,n,e,r.uid,t,r.videoTrack);i&&dS((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,Lv.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:i})}))}if(i.has(I_.AUDIO)&&r.audioTrack){const t=function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o=xb.isRemoteAudioFreeze(r);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:i.jitterMs.toString(),isFreeze:o,bytesReceived:i.bytes.toString(),packetsReceived:i.packets.toString(),packetsLost:i.packetsLost.toString(),frameReceived:i.receivedFrames.toString(),frameDropped:i.droppedFrames.toString()}}(r._audioSSRC,e,r.uid,r.audioTrack);t&&dS((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,Lv.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:t})}))}}))}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(e){e.forEach((e=>{let[t,n]=e;n.has(I_.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)})),n.has(I_.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}))}}function cA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const dA="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",uA="9",pA=2e4,hA=4e4;class fA{get localCapabilities(){return uS(this._localCapabilities)}get rtpCapabilities(){return uS(this._rtpCapabilities)}get candidates(){return uS(this._candidates)}get iceParameters(){return uS(this._iceParameters)}get dtlsParameters(){return uS(this._dtlsParameters)}constructor(e){mh(this,"sessionDesc",void 0),mh(this,"_localCapabilities",void 0),mh(this,"_rtpCapabilities",void 0),mh(this,"_candidates",void 0),mh(this,"_iceParameters",void 0),mh(this,"_dtlsParameters",void 0),mh(this,"setup",void 0),mh(this,"currentMidIndex",void 0),mh(this,"cname",void 0),mh(this,"firefoxSsrcMidMap",new Map),e=uS(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:a,cname:s}=e,c=UI.exports.parse(dA);this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=s;const l=this.rtpCapabilities.send;for(const e of c.mediaDescriptions){if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=l.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=l.videoCodecs,e.attributes.extmaps=l.videoExtensions,Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:hA,rtx:Wm("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=l.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=l.audioCodecs,e.attributes.extmaps=l.audioExtensions,eO(e),Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:pA}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=UI.exports.parse(dA);this._rtpCapabilities=e;const n=this.rtpCapabilities.send;for(const e of t.mediaDescriptions){if(e.attributes.iceUfrag=this._iceParameters.iceUfrag,e.attributes.icePwd=this._iceParameters.icePwd,e.attributes.fingerprints=this._dtlsParameters.fingerprints,e.attributes.candidates=this._candidates,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=n.videoCodecs,e.attributes.extmaps=n.videoExtensions,Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:hA,rtx:Wm("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=n.audioCodecs,e.attributes.extmaps=n.audioExtensions,Wm("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=WI([{ssrcId:pA}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+pA,a=2*o+hA,{ssrcs:s,ssrcGroups:c}=WI([{ssrcId:e}],this.cname),{ssrcs:l,ssrcGroups:d}=WI([{ssrcId:a,rtx:Wm("USE_SUB_RTX")?a+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:uA,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:uA,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return UI.exports.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=WI(t,this.cname,Wm("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(qp()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||Kp()||Yp()||Qp()||0===t&&Wm("USE_SUB_RTX")?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=uS(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),qp()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||qp()||Kp()||Yp()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===O_.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(lA(lA({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=uS(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(qp()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=this.localCapabilities.send;let l=[];if(a===I_.VIDEO){var d,u;if(Wm("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(l=s.videoCodecs.filter((e=>{var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===Wm("H264_PROFILE_LEVEL_ID")}))),!l||0===(null===(d=l)||void 0===d?void 0:d.length)){const e=c.videoCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==e.length&&(l=s.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(Wm("USE_PUB_RTX")){const e=l.map((e=>e.payloadType.toString())),t=s.videoCodecs.filter((t=>{var n,r;return"rtx"===(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName)&&e.includes((null===(r=t.fmtp)||void 0===r?void 0:r.parameters.apt)||"")}));l=[...l,...t]}0===l.length&&(Am.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(u=s.videoCodecs[0].rtpMap)||void 0===u?void 0:u.encodingName)),l=s.videoCodecs)}else l=s.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===l.length&&(Am.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),l=s.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));const p=a===I_.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const h="".concat(this.currentMidIndex);let f={media:{mediaType:a,port:uA,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};f=this.mungRecvMediaDsec(f,e,o);const m=this.findFirstClosedMedia(a);if(m){const e=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[e]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,a=e===I_.VIDEO?o.videoCodecs:o.audioCodecs,s=e===I_.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:uA,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=uS(e);return qI(r),KI(r,t),YI(r,t),zI(r),JI(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=uS(e);return JI(n,t,this.localCapabilities.recv),eO(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>qp()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var mA;function gA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let _A=(cy((mA=class e extends Y_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(e,t,n){super(e,t),mh(this,"store",void 0),mh(this,"peerConnection",void 0),mh(this,"remoteSDP",void 0),mh(this,"initialOffer",void 0),mh(this,"transportEventReceiver",void 0),mh(this,"statsFilter",void 0),mh(this,"localCapabilities",void 0),mh(this,"localCandidateCount",0),mh(this,"allCandidatesReceived",!1),mh(this,"establishPromise",void 0),mh(this,"mutex",new Uy("NVExtentionsConnection-mutex")),mh(this,"rtcMedia",void 0),this.store=t,this.peerConnection=n,this.statsFilter=CO(this.peerConnection,Wm("STATS_UPDATE_INTERVAL"),void 0,qp()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=FI(e.sdp),n=await QI(!Wm("USE_PUB_RTX")&&!Wm("USE_SUB_RTX"),Wm("FILTER_VIDEO_FEC"),Wm("FILTER_AUDIO_FEC"));return this.localCapabilities=n,this.initialOffer=e,vA(vA({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new ym(Em.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new fA({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:$I(this.localCapabilities),cname:o});const a=this.remoteSDP.toString(),s=UI.exports.parse(this.initialOffer.sdp),c=s.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&eO(c);const l=UI.exports.print(s),d=this.logSDPExchange(l||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==d||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.toString()))}}async updateRemoteConnect(e){var t,n,r;null===(t=this.remoteSDP)||void 0===t||t.updateRemoteRTPCapabilities(e),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);const i=null===(r=this.remoteSDP)||void 0===r?void 0:r.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),Am.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,n){var r=this;return PI((function*(){const i=yield kI(r.mutex.lock("From NVExtentionsConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t)})),qp()&&!0===Wm("SIMULCAST")&&(yield kI(r.applySimulcastForFirefox(o,e)));const a=yield kI(r.peerConnection.createOffer()),s=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(a.sdp,e,s),l=UI.exports.parse(c),d=s.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return GI(t,Wm("USE_PUB_RTX"))}));let u;try{u=yield d}catch(i){u=[],r.remoteSDP.receive(e,t,n,u);const o=r.remoteSDP.toString();throw yield kI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield kI(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield kI(r.stopSending(s,!0)),i}r.remoteSDP.receive(e,t,n,u);const p=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return yield kI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield kI(r.applySimulcastEncodings(o,e)),yield kI(r.applySendEncodings(o,e)),null==h||h(p),yield kI(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),o.map(((e,t)=>{const n=s[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(e){throw e instanceof ym?e:new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Am.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else Am.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i}}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Am.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else Am.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}}))}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return PI((function*(){const n=yield kI(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(J_().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===O_.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Am.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===O_.RELAY)return;e!==O_.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield kI(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=FI(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),a=t.logSDPExchange(n.sdp||"","offer","local","restartICE");yield kI(t.peerConnection.setLocalDescription(n)),null==a||a(o),yield kI(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){Am.warning("restart ICE failed, abort operation",e)}finally{n()}}))()}close(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new ym(Em.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?qp()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return vA(vA({},FI(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Am.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Am.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),Wm("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Uv(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),Wm("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Wm("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(jb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!Wm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!J_().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let c=0;c<e.length;c++){const l=e[c],d=t[c];if(d&&d instanceof TC){var n,r;if(this.isVP8Simulcast(d))continue;const e={},t={};switch(d._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var i,o,a,s;if(null!==(n=d._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(i=d._encoderConfig)||void 0===i?void 0:i.bitrateMax)),d._hints.includes(p_.LOW_STREAM)&&(null!==(o=d._encoderConfig)&&void 0!==o&&o.frameRate&&(t.maxFramerate=Fb(d._encoderConfig.frameRate)),null!==(a=d._encoderConfig)&&void 0!==a&&a.scaleResolutionDownBy&&(null===(s=d._encoderConfig)||void 0===s?void 0:s.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=d._encoderConfig.scaleResolutionDownBy)),Wm("DSCP_TYPE")&&oh()){const e=Wm("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(t.networkPriority=e)}const c=l.sender.getParameters(),u=null===(r=c.encodings)||void 0===r?void 0:r[0];qp()&&!u&&(e.encodings=[t]),u&&Object.assign(u,t),Object.assign(c,e),await l.sender.setParameters(c)}}}catch(e){Am.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,n){const r=UI.exports.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(KI(o,e),XI(o,e,this.store.codec))})),UI.exports.print(r)}mungReceiveAnswerSDP(e,t,n){const r=UI.exports.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===I_.AUDIO&&"audio"===i.media.mediaType&&eO(i),UI.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o;const s=e[a],c=t[a];if(c instanceof TC&&!c._hints.includes(p_.LOW_STREAM)&&null!==(n=c._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=c._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=c._scalabiltyMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=c._scalabiltyMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=s.sender.getParameters();await s.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!qp()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof TC&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i;return!!(e instanceof TC&&Wm("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(p_.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(Wm("SDP_LOGGING"))return Am.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(J_().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"connect"),mA.prototype),cy(mA.prototype,"updateRemoteConnect",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"updateRemoteConnect"),mA.prototype),cy(mA.prototype,"receive",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"receive"),mA.prototype),cy(mA.prototype,"batchReceive",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"batchReceive"),mA.prototype),cy(mA.prototype,"stopReceiving",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"stopReceiving"),mA.prototype),cy(mA.prototype,"muteRemote",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"muteRemote"),mA.prototype),cy(mA.prototype,"unmuteRemote",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"unmuteRemote"),mA.prototype),cy(mA.prototype,"muteLocal",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"muteLocal"),mA.prototype),cy(mA.prototype,"unmuteLocal",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"unmuteLocal"),mA.prototype),cy(mA.prototype,"close",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"close"),mA.prototype),cy(mA.prototype,"updateEncoderConfig",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"updateEncoderConfig"),mA.prototype),cy(mA.prototype,"updateSendParameters",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"updateSendParameters"),mA.prototype),cy(mA.prototype,"replaceTrack",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"replaceTrack"),mA.prototype),cy(mA.prototype,"getRemoteSSRC",[EA],Object.getOwnPropertyDescriptor(mA.prototype,"getRemoteSSRC"),mA.prototype),mA);function EA(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From NVExtentionsConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}var yA;function wA(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=MI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new bA(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function bA(e){function t(e){if(Object(e)!==e)return Eu.reject(new TypeError(e+" is not an object."));var t=e.done;return Eu.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(bA=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Eu.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Eu.reject(e):t(n.apply(this.s,arguments))}},new bA(e)}let SA=(cy((yA=class e extends Y_{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),mh(this,"store",void 0),mh(this,"peerConnection",void 0),mh(this,"cname",void 0),mh(this,"mutex",new Uy("DataChannelConnection-mutex")),mh(this,"dataChannel",void 0),mh(this,"_p2pConnection",void 0),mh(this,"establishPromise",void 0),mh(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new _A(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=null===(e=this._nvMedia)||void 0===e?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,n,r,i,o){return this.cname=o,await this._p2pConnection.connect(e,t,n,r,i,o),await new Eu(((e,t)=>{const r=setTimeout((()=>{this.closeSignal(),t(new ym(Em.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(r),void e()},this.dataChannel.onerror=e=>{this.closeSignal(),t(e)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(e,t,n){var r=this;return PI((function*(){const i=yield kI(r.mutex.lock("From DataChannelConnection.send"));try{return yield*xI(wA(r._p2pConnection.send(e,t,n)),kI)}finally{i()}}))()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async receive(e,t,n,r){return this._nvMedia?(Am.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(Am.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,n,r))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return PI((function*(){return yield*xI(wA(t._p2pConnection.restartICE(e)),kI)}))()}close(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,n,r){if(Wm("SDP_LOGGING"))return Am.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Uv(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),Wm("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Wm("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(jb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!Wm("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return null===(t=this.onICEConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return null===(t=this.onConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return null===(t=this.onDTLSTransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return null===(t=this.onDTLSTransportError)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return null===(t=this.onICETransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return null===(t=this.onFirstAudioReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return null===(t=this.onFirstVideoReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return null===(t=this.onFirstAudioDecoded)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,n)=>{var r;return null===(r=this.onFirstVideoDecoded)||void 0===r?void 0:r.call(this,e,t,n)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return null===(t=this.onFirstVideoDecodedTimeout)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}).prototype,"connect",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"connect"),yA.prototype),cy(yA.prototype,"receive",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"receive"),yA.prototype),cy(yA.prototype,"stopReceiving",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"stopReceiving"),yA.prototype),cy(yA.prototype,"muteRemote",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"muteRemote"),yA.prototype),cy(yA.prototype,"unmuteRemote",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"unmuteRemote"),yA.prototype),cy(yA.prototype,"muteLocal",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"muteLocal"),yA.prototype),cy(yA.prototype,"unmuteLocal",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"unmuteLocal"),yA.prototype),cy(yA.prototype,"close",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"close"),yA.prototype),cy(yA.prototype,"updateEncoderConfig",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"updateEncoderConfig"),yA.prototype),cy(yA.prototype,"updateSendParameters",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"updateSendParameters"),yA.prototype),cy(yA.prototype,"replaceTrack",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"replaceTrack"),yA.prototype),cy(yA.prototype,"getRemoteSSRC",[TA],Object.getOwnPropertyDescriptor(yA.prototype,"getRemoteSSRC"),yA.prototype),yA);function TA(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From DataChannelConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}var CA;function RA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function OA(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=MI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new AA(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function AA(e){function t(e){if(Object(e)!==e)return Eu.reject(new TypeError(e+" is not an object."));var t=e.done;return Eu.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(AA=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Eu.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Eu.reject(e):t(n.apply(this.s,arguments))}},new AA(e)}let NA=(cy((CA=class extends vm{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(P_.StateChange,t,this._state)}constructor(e,t){super(),mh(this,"store",void 0),mh(this,"statsUploader",void 0),mh(this,"connection",void 0),mh(this,"localTrackMap",new Map),mh(this,"remoteUserMap",new Map),mh(this,"pendingLocalTracks",[]),mh(this,"pendingRemoteTracks",[]),mh(this,"statsCollector",void 0),mh(this,"isPlanB",!1),mh(this,"shouldForwardP2PCreation",void 0),mh(this,"iceFailedCount",0),mh(this,"dtlsFailedCount",0),mh(this,"mutex",new Uy("P2PChannel-mutex")),mh(this,"_state",L_.Disconnected),mh(this,"_pcStatsUploadType",Wm("NEW_ICE_RESTART")?A_.FIRST_CONNECTION:A_.OLD_FIRST_CONNECTION),mh(this,"_isInRestartIce",!1),mh(this,"_isStartRestartIce",!1),mh(this,"_restartStates",["disconnected","failed"]),mh(this,"_restartTimer",void 0),mh(this,"_isFirstConnected",!0),mh(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==L_.Connected)return void n(new ym(Em.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createMuteMessage(r);await oS(this,P_.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}})),mh(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==L_.Connected)return void n(new ym(Em.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),J_().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=FO(e,sS(this,P_.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new Eu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnmuteMessage(r);await oS(this,P_.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}})),mh(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get(N_.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==L_.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(P_.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{r()}})),mh(this,"handleSetOptimizationMode",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const n=this.localTrackMap.get(N_.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==L_.Connected)return;const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),mh(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;Am.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==L_.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===N_.LocalVideoTrack&&J_().supportDualStreamEncoding){const t=this.localTrackMap.get(N_.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Eu(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}})),mh(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),mh(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),mh(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),mh(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sA,this.bindStatsUploaderEvents(),this.isPlanB=!J_().supportUnifiedPlan||Wm("CHROME_FORCE_PLAN_B")&&oh(),this.shouldForwardP2PCreation=Wm("FORWARD_P2P_CREATION")&&J_().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SA({},this.store):this.isPlanB?new AO({},this.store):new jO({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=L_.New;const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(Am.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new SA(e,this.store):this.isPlanB?new AO(e,this.store):new jO(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ym(Em.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Wm("NEW_ICE_RESTART")?A_.FIRST_CONNECTION:A_.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,o){if(!this.connection)throw new ym(Em.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof SA?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=L_.Connected)}async preConnect(e,t,n,r,i,o){if(!this.connection)throw new ym(Em.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const a=await this.connection.connect(e,t,n,r,i,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=L_.Connected,a}getEstablishParams(){if(this.connection instanceof SA)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var r=this;return PI((function*(){const i=yield kI(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==L_.Connected){if(r.state===L_.Disconnected)throw new ym(Em.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,Pb.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield kI(r.tryToUnmuteAudio(e)));yield*xI(OA(r.doPublish(r.connection,i)),kI)}finally{i()}}))()}doPublish(e,t){var n=this;return PI((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===N_.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=yield kI(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),i=(yield kI(r.next())).value,o=n.createGatewayPublishMessage(t,i);let a;try{a=yield o}catch(e){throw r.throw(e),(null==e?void 0:e.code)===Em.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const s=n.mapPubResToRemoteConfig(o,a),c=(yield kI(r.next(s))).value;t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,c),n.statsUploader.startUploadUplinkStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===N_.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}publishLowStream(e){var t=this;return PI((function*(){if(!t.connection||t.state!==L_.Connected)return;const n=yield kI(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(N_.LocalVideoTrack);if(!n)throw new ym(Em.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(N_.LocalVideoLowTrack))throw new ym(Em.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:N_.LocalVideoLowTrack}];if(yield*xI(OA(t.doPublish(t.connection,i)),kI),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(N_.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield kI(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(Am.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await iS(this,P_.RequestRePublish,this.pendingLocalTracks),this.emit(P_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:t,kind:n}=this.pendingRemoteTracks[e];(n!==I_.AUDIO||t._audio_added_&&t._audioSSRC)&&(n!==I_.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(e)await iS(this,P_.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===I_.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(P_.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==L_.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==L_.Connected)return;const e=this.localTrackMap.get(N_.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[N_.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==L_.Connected)throw new ym(Em.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let a,s,c;if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new ym(Em.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof jO&&(c=r.transceiver),a=r.track,s=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof jO&&(c=i.transceiver),a=i.track,s=i.id}t===I_.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new iA(a,e.uid,e._uintid,this.store),Am.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new rA(a,e.uid,e._uintid,this.store),Am.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const d=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(P_.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==L_.Connected)throw new ym(Em.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=await this.connection.batchReceive(e.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));e.forEach(((e,n)=>{let{user:r,mediaType:i}=e;const{track:o,id:a,transceiver:s}=t[n];i===I_.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new iA(o,r.uid,r._uintid,this.store),Am.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),s&&r._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new rA(o,r.uid,r._uintid,this.store),Am.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),s&&r._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(r,r._videoTrack));const c=this.remoteUserMap.get(r);c?c.set(i,a):this.remoteUserMap.set(r,new Map([[i,a]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const l=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===r.uid&&i===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(P_.MediaReconnectEnd,r.uid))}))}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===L_.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===I_.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===I_.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==L_.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===I_.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===I_.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===I_.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}})),o}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:n,mediaType:r}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:i}=e;return void 0!==r?t.uid===n.uid&&r===i:t.uid===n.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==L_.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===I_.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===I_.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=Zn(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===I_.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===I_.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===I_.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void Am.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void Am.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===I_.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||Am.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):Am.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(N_.LocalAudioTrack);if((null==t?void 0:t.track)instanceof Ab){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==N_.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===N_.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===N_.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(N_.LocalAudioTrack),o=r?this.localTrackMap.get(N_.LocalVideoLowTrack):this.localTrackMap.get(N_.LocalVideoTrack);ky.publish(this.store.sessionId,{eventElapse:Pb.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(p_.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const a=n.find((e=>e instanceof Rb)),s=r?null===(o=this.localTrackMap.get(N_.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof TC));ky.publish(this.store.sessionId,{eventElapse:Pb.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(p_.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===I_.VIDEO?n._videoSSRC:n._audioSSRC;i&&ky.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===I_.VIDEO,audio:r===I_.AUDIO,peerid:n.uid,subscribeRequestid:r===I_.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Pb.measureFromSubscribeStart(this.store.clientId,i)})}reset(){Am.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Uy("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SA({},this.store):this.isPlanB?new AO({},this.store):new jO({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(N_.LocalAudioTrack);if((null==e?void 0:e.track)instanceof Ab){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=L_.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(N_.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(N_.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof TC||t&&t.track instanceof Rb?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(gy(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(N_.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=qg(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(Am.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=L_.Reconnecting,Wm("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SA({},this.store):this.isPlanB?new AO({},this.store):new jO({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;switch(t){case N_.LocalVideoTrack:n._hints.includes(p_.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case N_.LocalAudioTrack:n instanceof Ab?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case N_.LocalVideoLowTrack:}})),this.emit(P_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(gy(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(P_.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Am.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof RC?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return PI((function*(){if(!t.connection||t.state!==L_.Connected||t.connection instanceof SA)return;const n=yield kI(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield kI(t.connection.restartICE(e));const n=yield kI(r.next());if(n.done)return;const i=n.value,o=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case O_.TCP:t._pcStatsUploadType=A_.TCP_RESTART;break;case O_.RELAY:t._pcStatsUploadType=A_.RELAY_RESTART;break;default:t._pcStatsUploadType=A_.OLD_RESTART}t._isInRestartIce=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(N_.LocalVideoTrack),n=this.localTrackMap.get(N_.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=aS(this,P_.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,p=null==t?void 0:t.track;if(p&&p._encoderConfig&&-1===p._hints.indexOf(p_.SCREEN_TRACK)){const t=p._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return Qm[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===o));if(!a&&!s)return void(t+=1);const c=aS(this,P_.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,p=e.recvPacketLossRate;let h=.7*p*100/50+.3*d/1500;u&&(h=.6*p*100/50+.2*d/1500+.2*u/400),t+=h<.1?1:h<.17?2:h<.36?3:h<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Eu(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=J_(),o=this.getAllTracks();e=lS(e=e.filter((e=>-1===o.indexOf(e))));let a=!1,s=!1;for(const o of e){if(o instanceof TC&&(this.localTrackMap.has(N_.LocalVideoTrack)||a?new ym(Em.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:o,type:N_.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(o,n);r.push({track:e,type:N_.LocalVideoLowTrack})}if(o instanceof Rb){const e=this.localTrackMap.get(N_.LocalAudioTrack);if(e){if(!(e.track instanceof Ab))throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o),this.bindLocalAudioTrackEvents(o,!0)}else if(s){const e=r.find((e=>{let{type:t}=e;return t===N_.LocalAudioTrack}));if(!(e.track instanceof Ab))throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o)}else{if(!i.webAudioMediaStreamDest||o instanceof Ab||o._bypassWebAudio)r.push({track:o,type:N_.LocalAudioTrack});else{const e=new Ab;e.addAudioTrack(o),r.push({track:e,type:N_.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=lS(e=e.filter((e=>-1!==n.indexOf(e))));for(const n of e){if(n instanceof Rb){const e=this.localTrackMap.get(N_.LocalAudioTrack);if(!e)continue;e.track instanceof Ab?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([N_.LocalAudioTrack,e]),e.track.close())):t.push([N_.LocalAudioTrack,e])}if(n instanceof TC){const e=this.localTrackMap.get(N_.LocalVideoTrack);if(!e)continue;t.push([N_.LocalVideoTrack,e]);const n=this.localTrackMap.get(N_.LocalVideoLowTrack);n&&t.push([N_.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case N_.LocalVideoTrack:t.addListener(u_.GET_STATS,this.handleGetLocalVideoStats),t.addListener(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(u_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(u_.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(u_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case N_.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case N_.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof Ab?e.trackList.forEach((e=>{e.addListener(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(u_.GET_STATS,this.handleGetLocalAudioStats),e.addListener(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(u_.GET_STATS,this.handleGetLocalAudioStats),e.addListener(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(u_.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case N_.LocalVideoTrack:t.off(u_.GET_STATS,this.handleGetLocalVideoStats),t.off(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(u_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(u_.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(u_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case N_.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case N_.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof Ab?e.trackList.forEach((e=>{e.off(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(u_.GET_STATS,this.handleGetLocalAudioStats),e.off(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(u_.GET_STATS,this.handleGetLocalAudioStats),e.off(u_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(u_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(u_.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(u_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(u_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof rA&&t.addListener(u_.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof iA&&t.addListener(u_.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(u_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(I_.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(I_.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{let r,i,{track:o,type:a}=e;switch(a){case N_.LocalAudioTrack:r=s_.Audio,i={dtx:o instanceof Ib&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case N_.LocalVideoTrack:r=o._hints.includes(p_.SCREEN_TRACK)?s_.Screen:s_.High,i=IA(IA({},Gb(o)),{},{codec:this.store.codec});break;case N_.LocalVideoLowTrack:r=s_.Low,i=IA(IA({},Gb(o)),{},{codec:this.store.codec})}return{stream_type:r,attributes:i,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case N_.LocalVideoTrack:t=r._hints.includes(p_.SCREEN_TRACK)?s_.Screen:s_.High;break;case N_.LocalAudioTrack:t=s_.Audio;break;case N_.LocalVideoLowTrack:t=s_.Low}return{stream_type:t,ssrcs:i,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(P_.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),Wm("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(Am.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===aS(this,P_.QueryClientConnectionState)&&this.emit(P_.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Am.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(P_.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=Wm("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(Wm("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&J_().supportPCSetConfiguration)t(O_.RELAY),this._restartTimer=window.setTimeout(n,r);else if(qp())t(O_.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(O_.TCP),J_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(O_.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&Wm("ICE_RESTART")&&"CONNECTED"===aS(this,P_.QueryClientConnectionState)&&this.emit(P_.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(Am.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(P_.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(Am.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(P_.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),ky.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:gv.TRACER}).onSuccess(),this.emit(P_.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(gy(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(__.FIRST_FRAME_DECODED),ky.firstRemoteFrame(this.store.sessionId,uv.FIRST_AUDIO_DECODE,pv.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:Pb.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(gy(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&ky.firstRemoteFrame(this.store.sessionId,uv.FIRST_AUDIO_RECEIVED,pv.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:Pb.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(gy(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&ky.firstRemoteFrame(this.store.sessionId,uv.FIRST_VIDEO_RECEIVED,pv.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:Pb.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(P_.ConnectionTypeChange,n),Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yb(t))," -> ").concat(JSON.stringify(Yb(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{Am.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yb(t))," -> ").concat(JSON.stringify(Yb(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(N_.LocalAudioTrack);if(e instanceof Rb&&(null==n?void 0:n.track)instanceof Ab)return n.track.isActive||t.push([N_.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===N_.LocalVideoTrack)){const e=this.localTrackMap.get(N_.LocalVideoLowTrack);e&&t.push([N_.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(N_.LocalAudioTrack);if(e instanceof Rb&&(null==n?void 0:n.track)instanceof Ab)return n.track.isActive&&t.push([N_.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===N_.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(N_.LocalVideoLowTrack);e&&t.push([N_.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case N_.LocalAudioTrack:t=s_.Audio;break;case N_.LocalVideoTrack:t=r._hints.includes(p_.SCREEN_TRACK)?s_.Screen:s_.High;break;case N_.LocalVideoLowTrack:t=s_.Low}return{stream_type:t,ssrcs:i,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case N_.LocalAudioTrack:t=s_.Audio;break;case N_.LocalVideoTrack:t=r._hints.includes(p_.SCREEN_TRACK)?s_.Screen:s_.High;break;case N_.LocalVideoLowTrack:t=s_.Low}return{stream_type:t,ssrcs:i,mid:o}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case I_.VIDEO:return void(n._videoSSRC&&t.push({stream_type:I_.VIDEO,ssrcId:n._videoSSRC}));case I_.AUDIO:return void(n._audioSSRC&&t.push({stream_type:I_.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===I_.VIDEO?e|=l_.Video:e|=l_.Audio,t.set(n,e)}else r===I_.VIDEO?t.set(n,l_.Video):t.set(n,l_.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(N_.LocalVideoTrack),n=this.localTrackMap.get(N_.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Rb){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await oS(this,P_.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(P_.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Qb(bm(this.dtlsFailedCount,wm)),this.emit(P_.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await iS(this,P_.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(P_.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(N_.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof TC))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof TC)).length>1)throw new ym(Em.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof Rb)).length>1&&(e.some((e=>e instanceof Rb&&e._bypassWebAudio))||!J_().webAudioMediaStreamDest))throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof TC&&this.pendingLocalTracks.some((e=>e instanceof TC)))throw new ym(Em.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Rb&&this.pendingLocalTracks.some((e=>e instanceof Rb))&&(!J_().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof Rb&&e._bypassWebAudio))))throw new ym(Em.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=J_().supportDualStreamEncoding,r=IA(IA({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():FO(e,r);const o=$b(8,"track-low-"),a=new TC(i,IA(IA({},n&&{scaleResolutionDownBy:qb(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return a.on(g_.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,h_.LOW_STREAM)})),a._hints.push(p_.LOW_STREAM),e.addListener(u_.NEED_CLOSE,(()=>{a.close()})),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof jO){var i,o,a,s;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:p,remote:h}=await this.connection.getSelectedCandidatePair();ky.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null==p?void 0:p.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=p.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(p.address,":").concat(p.port),selectedRemoteCandidateProtocol:null!==(a=h.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=h.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(h.address,":").concat(h.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(gy(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));ky.firstRemoteVideoDecode(this.store.sessionId,uv.FIRST_VIDEO_DECODE,pv.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:Pb.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){Am.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===L_.Connected?(Am.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===d_.datachannel?new SA({},this.store):this.isPlanB?new AO({},this.store):new jO({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===N_.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,h_.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof jO&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===A_.TCP_RESTART&&e===O_.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,A_.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"startP2PConnection"),CA.prototype),cy(CA.prototype,"connect",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"connect"),CA.prototype),cy(CA.prototype,"preConnect",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"preConnect"),CA.prototype),cy(CA.prototype,"unpublish",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"unpublish"),CA.prototype),cy(CA.prototype,"unpublishLowStream",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"unpublishLowStream"),CA.prototype),cy(CA.prototype,"subscribe",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"subscribe"),CA.prototype),cy(CA.prototype,"massSubscribe",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"massSubscribe"),CA.prototype),cy(CA.prototype,"unsubscribe",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"unsubscribe"),CA.prototype),cy(CA.prototype,"massUnsubscribe",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"massUnsubscribe"),CA.prototype),cy(CA.prototype,"muteRemote",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"muteRemote"),CA.prototype),cy(CA.prototype,"unmuteRemote",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"unmuteRemote"),CA.prototype),cy(CA.prototype,"hasRemoteMediaWithLock",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"hasRemoteMediaWithLock"),CA.prototype),cy(CA.prototype,"disconnectForReconnect",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"disconnectForReconnect"),CA.prototype),cy(CA.prototype,"updateBitrateLimit",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"updateBitrateLimit"),CA.prototype),cy(CA.prototype,"remoteMediaSsrcChanged",[LA],Object.getOwnPropertyDescriptor(CA.prototype,"remoteMediaSsrcChanged"),CA.prototype),CA);function LA(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function PA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PA(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var DA;!function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"}(DA||(DA={}));class xA{constructor(e,t,n,r){mh(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case DA.SET_SESSION_ID:return kA(kA({},e),{},{sessionId:t.sessionId});case DA.SET_P2P_ID:return kA(kA({},e),{},{p2pId:t.p2pId});case DA.SET_UID:return kA(kA({},e),{},{uid:t.uid});case DA.SET_PUB_ID:return kA(kA({},e),{},{pubId:t.pubId});case DA.KEY_METRIC_CLIENT_CREATED:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{clientCreated:t.metric})});case DA.KEY_METRIC_JOIN_START:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{joinStart:t.metric})});case DA.AVOID_JOIN_START:return kA(kA({},e),{},{avoidJoinStart:t.avoidJoinStart});case DA.KEY_METRIC_JOIN_END:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{joinEnd:t.metric})});case DA.KEY_METRIC_REQUEST_AP_START:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{requestAPStart:t.metric})});case DA.KEY_METRIC_REQUEST_AP_END:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{requestAPEnd:t.metric})});case DA.KEY_METRIC_JOIN_GATEWAY_START:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case DA.KEY_METRIC_JOIN_GATEWAY_END:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case DA.KEY_METRIC_PEER_CONNECTION_START:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case DA.KEY_METRIC_PEER_CONNECTION_END:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case DA.KEY_METRIC_DESCRIPTION_START:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{descriptionStart:t.metric})});case DA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case DA.KEY_METRIC_ICE_CONNECTION_END:return kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case DA.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=kA(kA({},n[r]),t.metric),kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{publish:[...n]})})):kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case DA.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=kA(kA({},n[r]),t.metric),kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{subscribe:[...n]})})):kA(kA({},e),{},{keyMetrics:kA(kA({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case DA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case DA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=kA(kA({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case DA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case DA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case DA.SET_USE_DATACHANNEL:return kA(kA({},e),{},{useDataChannel:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:DA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:DA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:DA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:DA.SET_UID,uid:e})}get uid(){return this.state.uid}set pubId(e){this.dispatch({type:DA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:DA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:DA.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:DA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:DA.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:DA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:DA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:DA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:DA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:DA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:DA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:DA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:DA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:DA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:DA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:DA.KEY_METRIC_PUBLISH,metric:kA(kA({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,a){this.dispatch({type:DA.KEY_METRIC_SUBSCRIBE,metric:kA(kA(kA(kA(kA({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:DA.KEY_METRIC_SUBSCRIBE,metric:kA(kA(kA({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:DA.RECORD_JOIN_CHANNEL_SERVICE,record:kA(kA({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:DA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:DA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:DA.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:DA.AVOID_JOIN_START,avoidJoinStart:e})}}let MA;const UA=()=>"HTTPS"===(MA||MA||(MA=(window.location.protocol.split(":")[0]||"").toUpperCase(),MA)),VA=()=>void 0!==window.isSecureContext;function jA(e){let t=XA();return function(e,t){let n=e.appId;void 0!==n&&(dN(t,10),rN(t,n));let r=e.cid;void 0!==r&&(dN(t,16),dN(t,r));let i=e.cname;void 0!==i&&(dN(t,26),rN(t,i));let o=e.deviceId;void 0!==o&&(dN(t,34),rN(t,o));let a=e.elapse;void 0!==a&&(dN(t,40),uN(t,a));let s=e.fileSize;void 0!==s&&(dN(t,48),uN(t,zA(s)));let c=e.height;void 0!==c&&(dN(t,56),uN(t,zA(c)));let l=e.jpg;void 0!==l&&(dN(t,66),dN(t,l.length),function(e,t){let n=eN(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(dN(t,72),uN(t,zA(d)));let u=e.osType;void 0!==u&&(dN(t,80),uN(t,zA(u)));let p=e.requestId;void 0!==p&&(dN(t,90),rN(t,p));let h=e.sdkVersion;void 0!==h&&(dN(t,98),rN(t,h));let f=e.sequence;void 0!==f&&(dN(t,104),uN(t,zA(f)));let m=e.sid;void 0!==m&&(dN(t,114),rN(t,m));let g=e.timestamp;void 0!==g&&(dN(t,120),uN(t,g));let v=e.uid;void 0!==v&&(dN(t,128),dN(t,v));let _=e.vid;void 0!==_&&(dN(t,136),dN(t,_));let E=e.width;void 0!==E&&(dN(t,144),uN(t,zA(E)));let y=e.service;void 0!==y&&(dN(t,152),dN(t,y));let w=e.callbackData;void 0!==w&&(dN(t,162),rN(t,w));let b=e.jpgEncryption;void 0!==b&&(dN(t,168),dN(t,b));let S=e.requestType;void 0!==S&&(dN(t,176),dN(t,S));let T=e.scorePorn;void 0!==T&&(dN(t,185),cN(t,T));let C=e.scoreSexy;void 0!==C&&(dN(t,193),cN(t,C));let R=e.scoreNeutral;void 0!==R&&(dN(t,201),cN(t,R));let I=e.scene;void 0!==I&&(dN(t,208),dN(t,I));let O=e.ossFilePrefix;void 0!==O&&(dN(t,218),rN(t,O));let A=e.serviceVendor;if(void 0!==A)for(let e of A){dN(t,226);let n=XA();GA(e,n),dN(t,n.limit),iN(t,n),QA(n)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function BA(e){return function(e){let t={};e:for(;!$A(e);){let n=lN(e);switch(n>>>3){case 0:break e;case 1:t.code=lN(e);break;case 2:t.msg=nN(e,lN(e));break;case 3:{let n=HA(e);t.data=FA(e),e.limit=n;break}default:WA(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function FA(e){let t={};e:for(;!$A(e);){let n=lN(e);switch(n>>>3){case 0:break e;case 1:t.requestId=nN(e,lN(e));break;case 2:t.requestType=lN(e)>>>0;break;case 3:t.scorePorn=sN(e);break;case 4:t.scoreSexy=sN(e);break;case 5:t.scoreNeutral=sN(e);break;case 6:t.requestScene=lN(e)>>>0;break;case 7:t.scene=lN(e)>>>0;break;default:WA(e,7&n)}}return t}function GA(e,t){let n=e.service;void 0!==n&&(dN(t,8),dN(t,n));let r=e.vendor;void 0!==r&&(dN(t,16),dN(t,r));let i=e.token;void 0!==i&&(dN(t,26),rN(t,i));let o=e.callbackUrl;void 0!==o&&(dN(t,34),rN(t,o))}function HA(e){let t=lN(e),n=e.limit;return e.limit=e.offset+t,n}function WA(e,t){switch(t){case 0:for(;128&oN(e););break;case 2:ZA(e,lN(e));break;case 5:ZA(e,4);break;case 1:ZA(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let KA=new Float32Array(1);new Uint8Array(KA.buffer);let qA=new Float64Array(1),YA=new Uint8Array(qA.buffer);function zA(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let JA=[];function XA(){const e=JA.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function QA(e){JA.push(e)}function ZA(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function $A(e){return e.offset>=e.limit}function eN(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function tN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function nN(e,t){let n=tN(e,t),r=String.fromCharCode,i=e.bytes,o="ï¿½",a="";for(let e=0;e<t;e++){let s,c,l,d,u=i[e+n];0==(128&u)?a+=r(u):192==(224&u)?e+1>=t?a+=o:(s=i[e+n+1],128!=(192&s)?a+=o:(d=(31&u)<<6|63&s,d<128?a+=o:(a+=r(d),e++))):224==(240&u)?e+2>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],32896!=(49344&(s|c<<8))?a+=o:(d=(15&u)<<12|(63&s)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=o:(a+=r(d),e+=2))):240==(248&u)?e+3>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],l=i[e+n+3],8421504!=(12632256&(s|c<<8|l<<16))?a+=o:(d=(7&u)<<18|(63&s)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=o:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),e+=3))):a+=o}return a}function rN(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}dN(e,r);let i=eN(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function iN(e,t){let n=eN(e,t.limit),r=e.bytes,i=t.bytes;for(let e=0,o=t.limit;e<o;e++)r[e+n]=i[e]}function oN(e){return e.bytes[tN(e,1)]}function aN(e,t){let n=eN(e,1);e.bytes[n]=t}function sN(e){let t=tN(e,8),n=e.bytes;return YA[0]=n[t++],YA[1]=n[t++],YA[2]=n[t++],YA[3]=n[t++],YA[4]=n[t++],YA[5]=n[t++],YA[6]=n[t++],YA[7]=n[t++],qA[0]}function cN(e,t){let n=eN(e,8),r=e.bytes;qA[0]=t,r[n++]=YA[0],r[n++]=YA[1],r[n++]=YA[2],r[n++]=YA[3],r[n++]=YA[4],r[n++]=YA[5],r[n++]=YA[6],r[n++]=YA[7]}function lN(e){let t,n=0,r=0;do{t=oN(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function dN(e,t){for(t>>>=0;t>=128;)aN(e,127&t|128),t>>>=7;aN(e,t)}function uN(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=eN(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}const pN=async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(function(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,a)),o),n)}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function c(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}const l=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let d,u,p,h,f,m=1732584193,g=-271733879,v=-1732584194,_=271733878;for(d=0;d<l.length;d+=16)u=m,p=g,h=v,f=_,m=o(m,g,v,_,l[d+0],7,-680876936),_=o(_,m,g,v,l[d+1],12,-389564586),v=o(v,_,m,g,l[d+2],17,606105819),g=o(g,v,_,m,l[d+3],22,-1044525330),m=o(m,g,v,_,l[d+4],7,-176418897),_=o(_,m,g,v,l[d+5],12,1200080426),v=o(v,_,m,g,l[d+6],17,-1473231341),g=o(g,v,_,m,l[d+7],22,-45705983),m=o(m,g,v,_,l[d+8],7,1770035416),_=o(_,m,g,v,l[d+9],12,-1958414417),v=o(v,_,m,g,l[d+10],17,-42063),g=o(g,v,_,m,l[d+11],22,-1990404162),m=o(m,g,v,_,l[d+12],7,1804603682),_=o(_,m,g,v,l[d+13],12,-40341101),v=o(v,_,m,g,l[d+14],17,-1502002290),g=o(g,v,_,m,l[d+15],22,1236535329),m=a(m,g,v,_,l[d+1],5,-165796510),_=a(_,m,g,v,l[d+6],9,-1069501632),v=a(v,_,m,g,l[d+11],14,643717713),g=a(g,v,_,m,l[d+0],20,-373897302),m=a(m,g,v,_,l[d+5],5,-701558691),_=a(_,m,g,v,l[d+10],9,38016083),v=a(v,_,m,g,l[d+15],14,-660478335),g=a(g,v,_,m,l[d+4],20,-405537848),m=a(m,g,v,_,l[d+9],5,568446438),_=a(_,m,g,v,l[d+14],9,-1019803690),v=a(v,_,m,g,l[d+3],14,-187363961),g=a(g,v,_,m,l[d+8],20,1163531501),m=a(m,g,v,_,l[d+13],5,-1444681467),_=a(_,m,g,v,l[d+2],9,-51403784),v=a(v,_,m,g,l[d+7],14,1735328473),g=a(g,v,_,m,l[d+12],20,-1926607734),m=s(m,g,v,_,l[d+5],4,-378558),_=s(_,m,g,v,l[d+8],11,-2022574463),v=s(v,_,m,g,l[d+11],16,1839030562),g=s(g,v,_,m,l[d+14],23,-35309556),m=s(m,g,v,_,l[d+1],4,-1530992060),_=s(_,m,g,v,l[d+4],11,1272893353),v=s(v,_,m,g,l[d+7],16,-155497632),g=s(g,v,_,m,l[d+10],23,-1094730640),m=s(m,g,v,_,l[d+13],4,681279174),_=s(_,m,g,v,l[d+0],11,-358537222),v=s(v,_,m,g,l[d+3],16,-722521979),g=s(g,v,_,m,l[d+6],23,76029189),m=s(m,g,v,_,l[d+9],4,-640364487),_=s(_,m,g,v,l[d+12],11,-421815835),v=s(v,_,m,g,l[d+15],16,530742520),g=s(g,v,_,m,l[d+2],23,-995338651),m=c(m,g,v,_,l[d+0],6,-198630844),_=c(_,m,g,v,l[d+7],10,1126891415),v=c(v,_,m,g,l[d+14],15,-1416354905),g=c(g,v,_,m,l[d+5],21,-57434055),m=c(m,g,v,_,l[d+12],6,1700485571),_=c(_,m,g,v,l[d+3],10,-1894986606),v=c(v,_,m,g,l[d+10],15,-1051523),g=c(g,v,_,m,l[d+1],21,-2054922799),m=c(m,g,v,_,l[d+8],6,1873313359),_=c(_,m,g,v,l[d+15],10,-30611744),v=c(v,_,m,g,l[d+6],15,-1560198380),g=c(g,v,_,m,l[d+13],21,1309151649),m=c(m,g,v,_,l[d+4],6,-145523070),_=c(_,m,g,v,l[d+11],10,-1120210379),v=c(v,_,m,g,l[d+2],15,718787259),g=c(g,v,_,m,l[d+9],21,-343485551),m=r(m,u),g=r(g,p),v=r(v,h),_=r(_,f);return n(m)+n(g)+n(v)+n(_)}(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))},hN=async(e,t,n)=>await pN(e.buffer,t,n);function fN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const mN=new Map([["moderation",1],["supervise",2]]);class gN extends vm{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(j_.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Zn(t=e.map((e=>mN.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),mh(this,"name","AgoraRTCVideoContentInspect"),mh(this,"_connectionState",U_.CONNECTING),mh(this,"_innerConnectionState",void 0),mh(this,"sequence",0),mh(this,"inspectStartTime",void 0),mh(this,"workerManagerConnection",void 0),mh(this,"workerConnection",void 0),mh(this,"workerMessageLengthLimit",void 0),mh(this,"inspectIntervalMinimum",void 0),mh(this,"qualityRatio",void 0),mh(this,"_connectInfo",void 0),mh(this,"_cancelTokenSource",mm.CancelToken.source()),mh(this,"_retryConfig",void 0),mh(this,"wmSequence",0),mh(this,"inspectInterval",void 0),mh(this,"inspectTimer",null),mh(this,"ossFilePrefix",void 0),mh(this,"extraInfo",void 0),mh(this,"_inspectType",void 0),mh(this,"_inspectMode",void 0),mh(this,"_quality",1),mh(this,"qualityTimer",null),mh(this,"_inspectId",void 0),mh(this,"_needWorkUrlOnly",!1),mh(this,"inspectImage",(()=>{if(this.connectionState!==U_.CONNECTED)throw new ym(Em.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===U_.CONNECTED?this.requestToInspectImage():Am.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=$b(5,"inspect-"),this.workerMessageLengthLimit=Wm("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Wm("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Wm("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new CS("worker-manager-"+this._inspectId,wm),this.on(j_.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,Am.debug("[".concat(this._inspectId,"] Inspect operation :").concat(V_[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new CS("worker-"+this._inspectId,wm),this.handleWorkerEvents()}async init(e,t){this.emit(j_.STATE_CHANGE,V_.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Eu(((r,i)=>{this.on(j_.CONNECTION_STATE_CHANGE,((e,t)=>{t===U_.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=Wm("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:l}=t;sT++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:sT,seq:sT,sid:s,token:c,ts:Date.now(),uid:l+""})};let p,h,f=e[0];return Sm((async()=>{p=Date.now();const e=await wy(f,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(h=Date.now()-p,0!==e.code){const t=new ym(Em.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:h});throw Am.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new ym(Em.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:h});throw Am.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new ym(Em.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:h});throw Am.error(e.toString()),e}const r=Wm("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=Wm("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:h}}),((t,n)=>(ky.apworkerEvent(s,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1)),((t,n)=>(ky.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==Em.OPERATION_ABORTED&&t.code!==Em.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(j_.STATE_CHANGE,V_.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(j_.STATE_CHANGE,V_.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Kv.CONNECTED,(async()=>{this.emit(j_.STATE_CHANGE,V_.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Kv.CLOSED,(()=>{this._innerConnectionState<V_.GET_WORKER_MANAGER_RESPONSE&&Am.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Kv.FAILED,(()=>{this._innerConnectionState<V_.GET_WORKER_MANAGER_RESPONSE&&Am.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Kv.RECONNECTING,(()=>{this._innerConnectionState<V_.GET_WORKER_MANAGER_RESPONSE&&Am.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Kv.ON_MESSAGE,(async e=>{this.emit(j_.STATE_CHANGE,V_.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw Am.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new ym(Em.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw Am.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new ym(Em.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=Wm("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(j_.STATE_CHANGE,V_.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(j_.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(Kv.WILL_RECONNECT,((e,t)=>{t(e)})),this.workerManagerConnection.on(Kv.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(Kv.CONNECTED,(async()=>{this.emit(j_.STATE_CHANGE,V_.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=U_.CONNECTED})),this.workerConnection.on(Kv.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=BA(new Uint8Array(e.data));if(Wm("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Am.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(j_.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Zn(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(j_.INSPECT_RESULT,i)}else this.emit(j_.INSPECT_RESULT,void 0,new ym(Em.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(j_.INSPECT_RESULT,void 0,new ym(Em.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else Am.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(j_.INSPECT_RESULT,void 0,new ym(Em.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Kv.CLOSED,(()=>{this.connectionState=U_.CLOSED})),this.workerConnection.on(Kv.FAILED,(()=>{this.connectionState=U_.CLOSED})),this.workerConnection.on(Kv.RECONNECTING,(()=>{this.connectionState=this.connectionState===U_.CONNECTED?U_.RECONNECTING:U_.CONNECTING})),this.workerConnection.on(Kv.WILL_RECONNECT,((e,t)=>{"recover"===e&&t(e),t("tryNext")})),this.workerConnection.on(Kv.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(j_.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=aS(this,j_.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(j_.INSPECT_RESULT,void 0,new ym(Em.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(j_.INSPECT_RESULT,void 0,new ym(Em.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await hN(l,n,r),u=this.sequence+"-"+i+"-"+s+"-"+c+"-"+$b(12,""),p={appId:n,cid:i,cname:r,deviceId:"",elapse:gN.intToLong(Number(c-this.inspectStartTime)),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.18.3",sequence:this.sequence,sid:a,timestamp:gN.intToLong(c),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete p.callbackData,void 0===this.ossFilePrefix&&delete p.ossFilePrefix;const h=jA(p);if(h.byteLength<this.workerMessageLengthLimit){if(Wm("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fN(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},p);delete e.jpg,Am.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return h}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mm.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=U_.CLOSED,this.emit(j_.STATE_CHANGE,V_.CLOSED)}}function vN(e){let t=function(){const e=wN.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(PN(t,10),ON(t,n));let r=e.cid;void 0!==r&&(PN(t,16),PN(t,r));let i=e.cname;void 0!==i&&(PN(t,26),ON(t,i));let o=e.deviceId;void 0!==o&&(PN(t,34),ON(t,o));let a=e.elapse;void 0!==a&&(PN(t,40),DN(t,a));let s=e.fileSize;void 0!==s&&(PN(t,48),DN(t,yN(s)));let c=e.height;void 0!==c&&(PN(t,56),DN(t,yN(c)));let l=e.jpg;void 0!==l&&(PN(t,66),PN(t,l.length),RN(t,l));let d=e.networkType;void 0!==d&&(PN(t,72),DN(t,yN(d)));let u=e.osType;void 0!==u&&(PN(t,80),DN(t,yN(u)));let p=e.requestId;void 0!==p&&(PN(t,90),ON(t,p));let h=e.sdkVersion;void 0!==h&&(PN(t,98),ON(t,h));let f=e.sequence;void 0!==f&&(PN(t,104),DN(t,yN(f)));let m=e.sid;void 0!==m&&(PN(t,114),ON(t,m));let g=e.timestamp;void 0!==g&&(PN(t,120),DN(t,g));let v=e.uid;void 0!==v&&(PN(t,128),PN(t,v));let _=e.vid;void 0!==_&&(PN(t,136),PN(t,_));let E=e.width;void 0!==E&&(PN(t,144),DN(t,yN(E)));let y=e.service;void 0!==y&&(PN(t,152),PN(t,y));let w=e.callbackData;void 0!==w&&(PN(t,162),PN(t,w.length),RN(t,w));let b=e.ticket;void 0!==b&&(PN(t,170),ON(t,b))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function _N(e){return function(e){let t={};e:for(;!SN(e);){let n=LN(e);switch(n>>>3){case 0:break e;case 1:t.code=LN(e);break;case 2:t.msg=IN(e,LN(e));break;case 3:t.requestId=IN(e,LN(e));break;case 4:t.timestamp=kN(e,!1);break;default:EN(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function EN(e,t){switch(t){case 0:for(;128&AN(e););break;case 2:bN(e,LN(e));break;case 5:bN(e,4);break;case 1:bN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function yN(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let wN=[];function bN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function SN(e){return e.offset>=e.limit}function TN(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function CN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function RN(e,t){let n=TN(e,t.length);e.bytes.set(t,n)}function IN(e,t){let n=CN(e,t),r=String.fromCharCode,i=e.bytes,o="ï¿½",a="";for(let e=0;e<t;e++){let s,c,l,d,u=i[e+n];0==(128&u)?a+=r(u):192==(224&u)?e+1>=t?a+=o:(s=i[e+n+1],128!=(192&s)?a+=o:(d=(31&u)<<6|63&s,d<128?a+=o:(a+=r(d),e++))):224==(240&u)?e+2>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],32896!=(49344&(s|c<<8))?a+=o:(d=(15&u)<<12|(63&s)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=o:(a+=r(d),e+=2))):240==(248&u)?e+3>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],l=i[e+n+3],8421504!=(12632256&(s|c<<8|l<<16))?a+=o:(d=(7&u)<<18|(63&s)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=o:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),e+=3))):a+=o}return a}function ON(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}PN(e,r);let i=TN(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function AN(e){return e.bytes[CN(e,1)]}function NN(e,t){let n=TN(e,1);e.bytes[n]=t}function LN(e){let t,n=0,r=0;do{t=AN(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function PN(e,t){for(t>>>=0;t>=128;)NN(e,127&t|128),t>>>=7;NN(e,t)}function kN(e,t){let n,r=0,i=0,o=0;return n=AN(e),r=127&n,128&n&&(n=AN(e),r|=(127&n)<<7,128&n&&(n=AN(e),r|=(127&n)<<14,128&n&&(n=AN(e),r|=(127&n)<<21,128&n&&(n=AN(e),i=127&n,128&n&&(n=AN(e),i|=(127&n)<<7,128&n&&(n=AN(e),i|=(127&n)<<14,128&n&&(n=AN(e),i|=(127&n)<<21,128&n&&(n=AN(e),o=127&n,128&n&&(n=AN(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function DN(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=TN(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}const xN={},MN={},UN=4294967296,VN=0x10000000000000000,jN=VN/2,BN=KN(0,!0),FN=KN(0),GN=qN(0,-2147483648,!1),HN=qN(-1,2147483647,!1),WN=qN(-1,-1,!0);function KN(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=MN[e],r)?r:(n=qN(e,0,!0),i&&(MN[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=xN[e],r)?r:(n=qN(e,e<0?-1:0,!1),i&&(xN[e]=n),n)}function qN(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function YN(e,t){if(isNaN(e))return t?BN:FN;if(t){if(e<0)return BN;if(e>=VN)return WN}else{if(e<=-jN)return GN;if(e+1>=jN)return HN}return e<0?t?BN:FN:qN(e%UN|0,e/UN|0,t)}function zN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class JN extends vm{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(K_.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),mh(this,"name","AgoraRTCImageModeration"),mh(this,"_connectionState",W_.CONNECTING),mh(this,"_sequence",0),mh(this,"_moderationStartTime",void 0),mh(this,"_workerConnection",void 0),mh(this,"_workerMessageLengthLimit",void 0),mh(this,"_qualityRatio",void 0),mh(this,"_connectInfo",void 0),mh(this,"_cancelTokenSource",mm.CancelToken.source()),mh(this,"_retryConfig",void 0),mh(this,"_moderationInterval",void 0),mh(this,"_moderationTimer",null),mh(this,"_moderationMode",1),mh(this,"_quality",1),mh(this,"_qualityTimer",null),mh(this,"_ticket",void 0),mh(this,"_moderationIntervalMinimum",void 0),mh(this,"_uploadFailedNum",0),mh(this,"_uploadNum",0),mh(this,"_uploadTimer",null),mh(this,"_moderationId",void 0),mh(this,"inspectImage",(()=>{if(this.connectionState!==W_.CONNECTED)throw new ym(Em.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===W_.CONNECTED?this.requestToInspectImage():Am.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=$b(5,"image-moderation-"),this._workerMessageLengthLimit=Wm("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Wm("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,this._qualityRatio=Wm("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new CS("worker-"+this._moderationId,wm),this.on(K_.STATE_CHANGE,((e,t)=>{Am.debug("[".concat(this._moderationId,"] Moderation operation :").concat(q_[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(K_.STATE_CHANGE,q_.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Eu(((r,i)=>{this.on(K_.CONNECTION_STATE_CHANGE,((e,t)=>{e===W_.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,Am.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===W_.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=Wm("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:l}=t;sT++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:sT,seq:sT,sid:s,appToken:c,ts:Date.now(),uid:l+""})};let p,h,f=e[0];return Sm((async()=>{p=Date.now();const e=await wy(f,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(h=Date.now()-p,0!==e.code){const t=new ym(Em.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:h});throw Am.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new ym(Em.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:h});throw Am.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new ym(Em.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:h});throw Am.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new ym(Em.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:h});throw Am.error(e.toString()),e}const r=Wm("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:h}}),((t,n)=>(ky.apworkerEvent(s,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1)),((t,n)=>(ky.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==Em.OPERATION_ABORTED&&t.code!==Em.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(K_.STATE_CHANGE,q_.AP_CONNECTED);const{addressList:o,ticket:a}=i;return this._ticket=a,o}async connectWorker(e){this.emit(K_.STATE_CHANGE,q_.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Kv.CONNECTED,(async()=>{this.emit(K_.STATE_CHANGE,q_.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=W_.CONNECTED})),this._workerConnection.on(Kv.CLOSED,(()=>{this.connectionState=W_.CLOSED})),this._workerConnection.on(Kv.FAILED,(()=>{this.connectionState=W_.CLOSED})),this._workerConnection.on(Kv.RECONNECTING,(()=>{this.connectionState=this.connectionState===W_.CONNECTED?W_.RECONNECTING:W_.CONNECTING})),this._workerConnection.on(Kv.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=_N(new Uint8Array(e.data));Wm("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Am.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,Am.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{ky.reportApiInvoke(this._connectInfo.sid||null,{name:mv.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:gv.TRACER}).onError(new ym(Em.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),Wm("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Am.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Kv.WILL_RECONNECT,((e,t)=>{"recover"===e&&t(e),t("tryNext")})),this._workerConnection.on(Kv.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=aS(this,K_.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(Wm("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Am.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else Wm("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Am.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await hN(l,n,r),u=this._sequence+"-"+i+"-"+s+"-"+c+"-"+$b(12,""),p={appId:n,cid:i,cname:r,deviceId:"",elapse:JN.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.18.3",sequence:this._sequence,sid:a,timestamp:YN(c),uid:s,vid:o,service:this._moderationMode,ticket:this._ticket},h=vN(p);if(h.byteLength<this._workerMessageLengthLimit){if(Wm("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zN(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},p);delete e.jpg,Am.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return h}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mm.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=W_.CLOSED,this.emit(K_.STATE_CHANGE,q_.CLOSED)}}var XN,QN,ZN,$N,eL,tL,nL,rL,iL,oL,aL,sL,cL,lL,dL,uL,pL,hL,fL,mL,gL,vL,_L,EL,yL,wL,bL,SL,TL,CL,RL,IL,OL,AL,NL,LL,PL,kL,DL,xL;function ML(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function UL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ML(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ML(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let VL=(XN=Py(),QN=Py({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map((e=>e?Object(e).toString():"null")))}),ZN=Py({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId())))}),$N=Py({argsMap:(e,t,n)=>[t.uid,n]}),eL=Py({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),tL=Py({argsMap:(e,t,n)=>[t.uid,n]}),nL=Py({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),rL=Py(),iL=Py(),oL=Py(),aL=Py(),sL=Py(),cL=Py(),lL=Py(),dL=Py(),uL=Py(),pL=Py(),hL=Py(),fL=Py(),mL=Py(),gL=Py(),vL=Py({argsMap:(e,t)=>[t]}),_L=Py(),EL=Py(),yL=Py(),wL=Py(),bL=Py(),SL=Py(),TL=Py(),CL=Py(),RL=Py(),IL=Py(),OL=Py({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),AL=Py(),NL=Py(),LL=Py(),PL=Py(),kL=Py({reportResult:!0}),DL=Py(),cy((xL=class extends vm{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),mh(this,"store",void 0),mh(this,"_uid",void 0),mh(this,"_channelName",void 0),mh(this,"_uintUid",void 0),mh(this,"_users",[]),mh(this,"_config",void 0),mh(this,"_clientId",void 0),mh(this,"_appId",void 0),mh(this,"_sessionId",null),mh(this,"_key",void 0),mh(this,"_joinInfo",void 0),mh(this,"_gateway",void 0),mh(this,"_statsCollector",void 0),mh(this,"_configDistribute",void 0),mh(this,"_leaveMutex",new Uy("client-leave")),mh(this,"_publishMutex",new Uy("client-publish")),mh(this,"_renewTokenMutex",new Uy("client-renewtoken")),mh(this,"_subscribeMutex",new Uy("client-subscribe")),mh(this,"_encryptionMode","none"),mh(this,"_encryptionSecret",null),mh(this,"_encryptionSalt",null),mh(this,"_proxyServer",void 0),mh(this,"_turnServer",{servers:[],mode:"auto"}),mh(this,"_cloudProxyServerMode","disabled"),mh(this,"_isDualStreamEnabled",!1),mh(this,"_defaultStreamFallbackType",void 0),mh(this,"_lowStreamParameter",void 0),mh(this,"_streamFallbackTypeCacheMap",new Map),mh(this,"_remoteStreamTypeCacheMap",new Map),mh(this,"_axiosCancelSource",mm.CancelToken.source()),mh(this,"_audioVolumeIndicationInterval",void 0),mh(this,"_networkQualityInterval",void 0),mh(this,"_userOfflineTimeout",void 0),mh(this,"_streamRemovedTimeout",void 0),mh(this,"_injectStreamingClient",void 0),mh(this,"_liveTranscodeStreamingClient",void 0),mh(this,"_liveRawStreamingClient",void 0),mh(this,"_channelMediaRelayClient",void 0),mh(this,"_networkQualitySensitivity","normal"),mh(this,"_p2pChannel",void 0),mh(this,"_useLocalAccessPoint",!1),mh(this,"_setLocalAPVersion",void 0),mh(this,"_joinAndNotLeaveYet",!1),mh(this,"_numberOfJoinCount",0),mh(this,"_remoteDefaultVideoStreamType",void 0),mh(this,"_inspect",void 0),mh(this,"_moderation",void 0),mh(this,"_license",void 0),mh(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),mh(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),mh(this,"_handleUserOnline",(e=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(e.uid,this.channelName))return void Am.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&Am.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0;else{const t=new RC(e.uid,e.uint_id||e.uid);this._users.push(t),Am.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(Rv.USER_JOINED,t)}})),mh(this,"_handleUserOffline",(e=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),cS(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),Am.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(Rv.USER_LEAVED,t,e.reason))})),mh(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,a)=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(t,this.channelName))return;const s=this._users.find((e=>e.uid===t));if(!s)return void Am.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Am.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=i||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==r&&(s._cname=r),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==r&&(s._cname=r),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(Am.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(Rv.USER_PUBLISHED,s,e)),"video"===e?ky.onGatewayStream(this._sessionId,uv.ON_ADD_VIDEO_STREAM,pv.ON_ADD_VIDEO_STREAM,{peer:i||t}):ky.onGatewayStream(this._sessionId,uv.ON_ADD_AUDIO_STREAM,pv.ON_ADD_AUDIO_STREAM,{peer:i||t}),this._p2pChannel.remoteMediaSsrcChanged(s,e,n).then((t=>{if(t)return Am.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(s,e,!0).then((()=>this._subscribe(s,e,!0).catch((e=>{Am.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(Am.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch((e=>{Am.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),mh(this,"_handleRemoveStream",(e=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void Am.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Am.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{Am.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Rv.USER_UNPUBLISHED,t,"audio"),Am.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Rv.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{Am.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Rv.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{Am.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Rv.USER_UNPUBLISHED,t,"audio")}),t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0,ky.onGatewayStream(this._sessionId,uv.ON_REMOVE_STREAM,pv.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),mh(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void Am.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Am.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";Am.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Rv.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";Am.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Rv.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(Am.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(Rv.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),Am.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(Rv.USER_UNPUBLISHED,r,e)):void 0})),mh(this,"_handleMuteStream",((e,t,n)=>{if(Wm("BLOCK_LOCAL_CLIENT")&&eg(e,this.channelName))return;Am.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void Am.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";Am.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Rv.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";Am.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Rv.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(Am.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(Rv.USER_PUBLISHED,r,t)):void Am.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),Am.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(Rv.USER_UNPUBLISHED,r,t)}})),mh(this,"_handleP2PLost",(async e=>{Am.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Am.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),mh(this,"_handleTokenWillExpire",(()=>{Am.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Rv.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),mh(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),Am.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),mh(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Rv.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Rv.NETWORK_QUALITY,e)})),this._config=e,this._clientId=$b(5,"client-"),this.store=new xA(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),Am.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Lm," build: ").concat(Nm,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{jv(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(e){Am.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new xb(this.store),this._statsCollector.onStatsException=(e,t,n)=>{Am.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(Rv.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&ky.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useDataChannel=J_().supportDataChannel&&Wm("SIGNAL_CHANNEL"),this._gateway=new jS(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||wm,httpRetryConfig:e.httpRetryConfig||wm,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new _T,this._p2pChannel=new NA(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a=UA(),s=VA()?window.isSecureContext:"Browser Not Support";if(!VA()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";Am.warning(e)}const c=eS();"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),Am.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const l=ky.reportApiInvoke(c,{name:mv.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:gv.TRACER});ky.setAppId(e);try{if(!n&&null!==n)throw new ym(Em.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Qg(n,"token",1,2047),Qg(e,"appid",1,2047),$g(t),r&&ev(r),i&&Qg(i,"optionalInfo",1,2047)}catch(e){throw l.onError(e),e}if(Am.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(Am.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Am.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const e=new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw l.onError(e),e}this._sessionId||(this._sessionId=c,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const d=UL({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(d.stringUid=r,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async e=>{const t=fS("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=Iy(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return mS(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const u=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&u===this._sessionId&&ky.joinChannelTimeout(this._sessionId,5)}),5e3);try{let r;const i=d.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(i)){const e=Wm("PROXY_SERVER_TYPE3");Array.isArray(e)?d.proxyServer=e[0]:d.proxyServer=e}if(ky.setProxyServer(d.proxyServer),Am.setProxyServer(d.proxyServer),this.store.requestAPStart(),d.stringUid&&!d.uid){const e=await dT(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||wm,this.store);Am.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(e)),d.uid=e,r=await lT(d,this._axiosCancelSource.token,this._config.httpRetryConfig||wm,!0,this.store)}else r=await lT(d,this._axiosCancelSource.token,this._config.httpRetryConfig||wm,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(C_.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;const o=r.gatewayInfo;this._joinInfo=UL(UL({},d),{},{cid:o.cid,uid:d.uid?d.uid:o.uid,vid:o.vid,apResponse:o.res,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs});const a=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(a),this._appId=e,this._channelName=d.cname,this._uid=a,this.store.uid=a,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Kp()?"beforeunload":"pagehide",this._handleBeforeUnload)}),0);const s=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return Am.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(s)),setTimeout((()=>{Am.startUpload()}),5e3),this.store.joinEnd(),p=this,Zm.includes(p)||Zm.push(p),a}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===Em.OPERATION_ABORTED?Am.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):Am.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==Em.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(t),t}var p}_joinGateway(){if(!this._joinInfo||!this._key)throw new ym(Em.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!Wm("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((e=>e)).catch((e=>{if(e.code===Em.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Cv.FALLBACK),e;if(e.code===Em.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Cv.FALLBACK),e;throw e})).then((e=>{if(e instanceof ym){if(e.code===Em.INIT_WEBSOCKET_TIMEOUT){if(Am.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new ym(Em.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=Wm("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=t.slice(t.length-2).join(".");e.forEach((e=>{this._joinInfo&&e.includes(n)&&(this._joinInfo.proxyServer=e)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const t=Wm("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return t&&t[1]&&"443"!==t[1]&&Am.setProxyServer(this._joinInfo.proxyServer),"443"!==Wm("STATS_COLLECTOR_PORT").toString()&&ky.setProxyServer(this._joinInfo.proxyServer),ky.reportApiInvoke(this._sessionId,{name:mv.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:gv.TRACER}).onSuccess(),this.safeEmit(Rv.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),Wm("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((e=>{"forceturn"in e&&(e.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(Am.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ym(Em.INVALID_OPERATION);return ky.reportApiInvoke(this._sessionId,{name:mv.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:gv.TRACER}).onSuccess(),this._joinGateway()}return e})).then((e=>e))}async leave(){Am.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Kp()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=Zm.indexOf(e);-1!==t&&Zm.splice(t,1)}(this);const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return Am.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),Am.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Array.isArray(e)||(e=[e]),0===e.length)throw new ym(Em.INVALID_PARAMS,"track list is empty");if("audience"===this._gateway.role)throw new ym(Em.INVALID_OPERATION,"audience can not publish stream");for(const n of e){if(!(n instanceof jy))throw new ym(Em.INVALID_PARAMS,"parameter is not local track");if(!n._enabled&&t)throw new ym(Em.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId()))}Am.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map((e=>"".concat(e.getTrackId()," ")))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof TC&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(e),Am.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw Am.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{n()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new ym(Em.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),Am.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map((e=>"".concat(e.getTrackId()," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublish(e);t&&await this._gateway.unpublish(t,this._uid),Am.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map((e=>"".concat(e.getTrackId())))))}catch(e){throw Am.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(zg(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){const t=new ym(Em.INVALID_REMOTE_USER,"user is not in the channel");throw Am.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new ym(Em.INVALID_REMOTE_USER,"user is not published");throw Am.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new ym(Em.REMOTE_USER_IS_NOT_PUBLISHED);throw Am.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?I_.AUDIO:I_.VIDEO,ssrcId:r},s=await this._subscribeMutex.lock();Am.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{Pb.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,i);try{await this._gateway.subscribe(e.uid,a,!0)}catch(n){if((null==n?void 0:n.code)!==Em.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}Am.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{Am.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const s="audio"===t?e._audioTrack:e._videoTrack;if(!s)throw new ym(Em.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(t){throw Am.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{s()}}async massSubscribe(e){if(Zg(e,"subscribeList"),!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();Am.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:a}=r;if(zg(a,"mediaType",["audio","video"]),!o){const e=new ym(Em.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Am.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find((e=>e===o))){const n=new ym(Em.INVALID_REMOTE_USER,"user is not in the channel");Am.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===a&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new ym(Em.REMOTE_USER_IS_NOT_PUBLISHED);Am.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const s=l_.Video|l_.LwoVideo,c=n.get(o);if(c){if("video"===a?c&s:c&l_.Audio){e.splice(t,1),Am.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(a," twice"));continue}n.set(o,c|("video"===a?s:l_.Audio))}else n.set(o,"video"===a?s:l_.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,a=l_.Video|l_.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^a:r^l_.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);const r=Zn(a=Array.from(n.entries())).call(a,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&l_.Audio&&(i.audio_ssrc=n._audioSSRC),r&l_.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===I_.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===I_.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=Array.from(n.entries()).map((e=>{let t,[n,r]=e;return r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=I_.VIDEO:r.audio_error_code&&(t=I_.AUDIO),{user:this.remoteUsers.find((e=>e.uid===n)),mediaType:t}}));await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=SS(n);Am.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new ym(Em.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;ky.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===I_.VIDEO,audio:e.mediaType===I_.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===I_.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)})),Am.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t){if(t&&zg(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((t=>t===e))){const t=new ym(Em.INVALID_REMOTE_USER,"user is not in the channel");throw Am.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}Am.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const n=await this._subscribeMutex.lock();try{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),Am.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(t){if(t.code===Em.DISCONNECT_P2P)return void Am.warning("disconnecting p2p, abort unsubscribe request.");throw Am.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{n()}}async massUnsubscribe(e){if(Zg(e,"unsubscribeList"),!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Am.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new ym(Em.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Am.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(zg(i,"mediaType",["video","audio",void 0]),!this._users.find((e=>e===r))){Am.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=l_.Video|l_.LwoVideo;if(t.has(r)){const a=t.get(r);let s;switch(i){case"video":s=a&o;break;case"audio":s=a&l_.Audio;break;default:s=a&(l_.Audio|o)}if(s){Am.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,a|l_.Audio):"video"===i&&t.set(r,a|o):t.set(r,a|l_.Audio|o)}else i?"audio"===i?t.set(r,l_.Audio):"video"===i&&t.set(r,o):t.set(r,l_.Audio|o)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),Am.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===Em.DISCONNECT_P2P)return void Am.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Am.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}setLowStreamParameter(e){!function(e){if(!e)throw new ym(Em.INVALID_PARAMS);tv(e.width)||Xg(e.width,"streamParameter.width"),tv(e.height)||Xg(e.height,"streamParameter.height"),tv(e.framerate)||Xg(e.framerate,"streamParameter.framerate"),tv(e.bitrate)||Jg(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&Am.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Am.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!J_().supportDualStream)throw ky.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ym(Em.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ym(Em.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ky.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ky.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Am.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(N_.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ky.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ky.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Am.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){zg(e,"role",["audience","host"])}(e),t&&jv(t),"rtc"===this.mode)throw Am.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new ym(Em.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&"host"===e)throw new ym(Em.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new ym(Em.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,Am.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(Qg(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new ym(Em.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ky.setProxyServer(this._proxyServer),Am.setProxyServer(this._proxyServer),Am.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new ym(Em.INVALID_OPERATION,"You have already set the proxy")}if(Uv(e))return this._turnServer={servers:e,mode:"original-manual"},void Am.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>Vv(e))),this._turnServer={servers:e,mode:"manual"},Am.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"you should set license before join channel");if(Qg(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ym(Em.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Am.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new ym(Em.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new ym(Em.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ym(Em.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,Am.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"Stop proxy server after leave channel");ky.setProxyServer(),Am.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Am.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ym(Em.INVALID_PARAMS,"accessPoints is required.");Zg(e.accessPoints.serverList,"accessPoints.serverList"),Qg(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{Jg(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new ym(Em.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Wm("CLOSE_AFB_FOR_LOCAL_AP")&&(Hm("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Hm("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),a=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Hm("WEBCS_DOMAIN",a),Hm("WEBCS_DOMAIN_BACKUP_LIST",a),Hm("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Zg(e.report.hostname,"report.hostname"),Hm("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Hm("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Hm("EVENT_REPORT_DOMAIN",o[0]),Hm("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),Hm("STATS_COLLECTOR_PORT",s),e.report?Hm("ENABLE_EVENT_REPORT",!0):Hm("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Zg(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),Hm("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Zg(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=o;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),Hm("CDS_AP",d.map((e=>"".concat(e,":").concat(u)))),e.cds?Hm("ENABLE_CONFIG_DISTRIBUTE",!0):Hm("ENABLE_CONFIG_DISTRIBUTE",!1),Am.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Zg(e,"serverList"),Qg(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new ym(Em.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Hm("WEBCS_DOMAIN",e),Hm("WEBCS_DOMAIN_BACKUP_LIST",e),Hm("GATEWAY_DOMAINS",[t]),Hm("EVENT_REPORT_DOMAIN",e[0]),Hm("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Hm("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Am.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(zg(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw Am.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else Am.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){zg(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw Am.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}Am.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){zg(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw Am.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}Am.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(e){zg(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),Qg(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new ym(Em.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ym(Em.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||Am.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=mS(n))}async renewToken(e){if(Qg(e,"token",1,2047),!this._key||!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(Wm("USE_NEW_TOKEN")){Am.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await mT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wm);Am.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else Am.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});Am.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,Am.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Am.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Rv.VOLUME_INDICATOR,e)}),Wm("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new ym(Em.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ym(Em.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ym(Em.LIVE_STREAMING_TASK_CONFLICT);const n=t?qv.TRANSCODE:qv.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(qv.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new ym(Em.INVALID_PARAMS,"can not find live streaming url to stop");await Eu.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(qv.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,qv.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(qv.INJECT),n=Array.from(Sw(e=t.streamingTasks).call(e)).find((e=>e.mode===qv.INJECT));if(!this._joinInfo||!n)throw new ym(Em.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){RT(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){RT(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof e&&(e=(new TextEncoder).encode(e)),new Blob([e]).size>1024)throw new ym(Em.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Nv.DATA_STREAM,{payload:mS(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ym(Em.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Nv.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:mS(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(lv),!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"can not send custom report, not joined");await ky.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){zg(t.spatialLayer,"spatialLayer",[0,1,2,3]),zg(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw Am.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}_reset(){if(Am.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mm.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Uy("client-publish"),this._subscribeMutex=new Uy("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){const n=e||eS();e?Am.debug("[".concat(this._clientId,"] new Session ").concat(n)):Am.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?ky.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?ky.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&ky.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new ym(Em.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&Wm("FORCE_TURN")&&!Wm("TURN_ENABLE_TCP")&&!Wm("TURN_ENABLE_UDP"))throw new ym(Em.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Am.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==Em.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof TC&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===Em.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new ym(Em.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new ym(Em.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Am.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==Em.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===Em.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new ym(Em.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new TT(this._joinInfo,this._config.websocketRetryConfig||wm,this._config.httpRetryConfig||wm),n=e=>{e.onLiveStreamError=(e,t)=>{ky.reportApiInvoke(this._sessionId,{name:mv.ON_LIVE_STREAM_ERROR,options:[e,t],tag:gv.TRACER}).onSuccess(),this.safeEmit(Rv.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{ky.reportApiInvoke(this._sessionId,{name:mv.ON_LIVE_STREAM_WARNING,options:[e,t],tag:gv.TRACER}).onSuccess(),this.safeEmit(Rv.LIVE_STREAMING_WARNING,e,t)},e.on(e_.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new ym(Em.INVALID_OPERATION,"can not find join info to get worker manager"));hT(e,this._joinInfo,this._axiosCancelSource.token,wm).then(t).catch(n)}))};switch(e){case qv.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case qv.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case qv.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(e_.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new ym(Em.INVALID_OPERATION,"can not find join info to get worker manager"));hT(e,this._joinInfo,this._axiosCancelSource.token,wm).then(t).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.emit(Rv.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ym(Em.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new OT(this._joinInfo,this._clientId,this._config.websocketRetryConfig||wm,this._config.httpRetryConfig||wm,n),this._channelMediaRelayClient.on("state",(e=>{e===o_.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Rv.CHANNEL_MEDIA_RELAY_STATE,e)})),this._channelMediaRelayClient.on("event",(e=>{this.safeEmit(Rv.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(c_.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(c_.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===Cv.FALLBACK)return;const i=()=>{this.safeEmit(Rv.CONNECTION_STATE_CHANGE,e,t,n)};if(ky.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:mv.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:gv.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),Am.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._audioSSRC=void 0,e._videoSSRC=void 0,e._videoOrtc=void 0,e._audioOrtc=void 0,e._cname=void 0,e._rtxSsrcId=void 0})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{Am.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{Am.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{Am.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{Am.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{Am.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,"audio",!1)),e._trust_video_mute_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,"video",!1)),e._trust_audio_enabled_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(Am.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(Am.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3)}i()})),this._gateway.on(c_.REQUEST_NEW_GATEWAY_LIST,((e,t)=>{if(!this._joinInfo)return t(new ym(Em.UNEXPECTED_ERROR,"can not recover, no join info"));cT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wm,this.store).then((t=>{this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip),e(t.gatewayInfo.gatewayAddrs.map((e=>{if(this._joinInfo&&this._joinInfo.proxyServer){const t=e.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(t[0],"&p=").concat(t[1])}return"wss://".concat(e.address)})))})).catch(t)})),this._gateway.on(c_.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Rv.NETWORK_QUALITY,e)})),this._gateway.on(c_.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(Rv.STREAM_TYPE_CHANGED,e,t),ky.reportApiInvoke(this._sessionId,{name:mv.STREAM_TYPE_CHANGE,options:[e,t],tag:gv.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(c_.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(c_.NEED_RENEW_SESSION,(()=>{this._startSession()})),this._gateway.on(c_.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(e){n(e)}})),this._gateway.on(c_.JOIN_RESPONSE,((e,t)=>{const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:o,setup:a,cname:s}=HI(e.ortc,t);this._p2pChannel.connect(r,n,i,o,a,s)})),this._gateway.on(c_.REQUEST_DC_CONNECTION_PARAMS,(e=>{e(this._p2pChannel.getEstablishParams())})),this._gateway.on(c_.RESET_SIGNAL,(e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()})),this._gateway.on(c_.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(c_.DATACHANNEL_PRECONNECT,(async(e,t,n,r)=>{var i,o,a,s,c,l;await this._p2pChannel.startP2PConnection({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},!0);const d=function(e,t){let n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Am.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Am.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cid,"_").concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cert),icePwd:"".concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cid,"_").concat(null===(c=this._joinInfo)||void 0===c?void 0:c.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(l=Wm("FINGERPRINT"))&&void 0!==l?l:e.fingerprint}]},d,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Pv.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pv.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pv.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(Pv.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(Pv.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pv.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pv.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,"audio",!0))),this._gateway.signal.on(Pv.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,"audio",!1))),this._gateway.signal.on(Pv.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,"video",!0))),this._gateway.signal.on(Pv.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,"video",!1))),this._gateway.signal.on(Pv.RECEIVE_METADATA,(e=>{const t=fS(e.metadata);this.safeEmit(Rv.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(Pv.ON_DATA_STREAM,(e=>{e.seq&&delete e.seq,e.payload=fS(e.payload),this.safeEmit(Rv.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)})),this._gateway.signal.on(Pv.ON_CRYPT_ERROR,(()=>{hS((()=>{Am.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Rv.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Pv.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pv.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{Am.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(Rv.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Pv.ON_STREAM_FALLBACK_UPDATE,(e=>{Am.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Rv.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(Pv.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),Am.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(Pv.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(Pv.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(Av.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case Nv.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r,i,o;const a=e.some((e=>{let{stream_type:t}=e;return t===s_.Audio})),s=e.some((e=>{let{stream_type:t}=e;return t!==s_.Audio})),c=e.some((e=>{let{stream_type:t}=e;return t===s_.Screen||t===s_.ScreenLow}));"offer"===t.state&&ky.publish(this._joinInfo.sid,{eventElapse:Pb.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Em.TIMEOUT,audio:a,video:s,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:a?null===(n=e.find((e=>{let{stream_type:t}=e;return t===s_.Audio})))||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0,videoName:s?null===(i=e.find((e=>{let{stream_type:t}=e;return t!==s_.Audio})))||void 0===i||null===(o=i.ssrcs[0])||void 0===o?void 0:o.ssrcId.toString():void 0})}break}case Nv.SUBSCRIBE:t&&ky.subscribe(this._joinInfo.sid,{succ:!1,ec:Em.TIMEOUT,audio:t.stream_type===I_.AUDIO,video:t.stream_type===I_.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Pb.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}})),this._gateway.signal.on(Pv.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(Pv.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;Wm("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!eg(e.audio_ssrc,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e.uid===r.stream_id));e?e._trust_in_room_=!0:(e=new RC(r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(Rv.PUBLISHED_USER_LIST).length&&(Am.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Rv.USER_JOINED,e)));const i=l_.Audio&r.stream_type,o=(l_.Video|l_.LwoVideo)&r.stream_type,a=i&&e.hasAudio,s=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!a&&0===this.getListeners(Rv.PUBLISHED_USER_LIST).length&&(Am.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(Rv.USER_PUBLISHED,e,"audio")),o&&!s&&0===this.getListeners(Rv.PUBLISHED_USER_LIST).length&&(Am.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(Rv.USER_PUBLISHED,e,"video")),(i&&!a||o&&!s)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(Am.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{Am.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(Rv.PUBLISHED_USER_LIST).length>0?(Am.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(Rv.PUBLISHED_USER_LIST,t)):Am.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))}))}_handleP2PChannelEvents(){this._p2pChannel.on(P_.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Em.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(P_.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Em.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(P_.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(P_.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===I_.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(P_.RequestUploadStats,((e,t)=>{this._gateway.uploadStats(e,t)})),this._p2pChannel.on(P_.MediaReconnectStart,(e=>{this.safeEmit(Rv.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(P_.MediaReconnectEnd,(e=>{this.safeEmit(Rv.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(P_.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(P_.RequestRestartICE,(async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(P_.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(P_.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:a,iceParameters:s,candidates:c,rtpCapabilities:l,setup:d,cname:u}=HI(i,o);await this._p2pChannel.connect(s,a,c,l,d,u),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(P_.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(P_.P2PLost,(()=>{this.safeEmit(Rv.P2P_LOST,this.store.uid)})),this._p2pChannel.on(P_.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(P_.ConnectionTypeChange,(e=>{this.safeEmit(Rv.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(P_.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(P_.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new ym(Em.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new ym(Em.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach((e=>{if(!["supervise","moderation"].includes(e))throw new ym(Em.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new ym(Em.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new gN(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},wm)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Yg(e,"enabled"),e){if(!t)throw new ym(Em.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(Jg(t.interval,"interval",1e3,1/0),"CONNECTED"!==this.connectionState||!this._joinInfo)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const e=new JN(t);this._moderation=e,this.handleImageModerationEvents(this._moderation),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},wm)}catch(e){throw Array.isArray(e)?e[0]:e}}else{if(!this._moderation)throw new ym(Em.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(K_.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.emit(Rv.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===W_.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new ym(Em.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(K_.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}handleVideoInspectEvents(e){e.on(j_.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.emit(Rv.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===U_.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.emit(Rv.CONTENT_INSPECT_ERROR,new ym(Em.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(j_.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===Em.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return Am.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.emit(Rv.CONTENT_INSPECT_RESULT,e,t)})),e.on(j_.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return Am.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Yg(e,"enabled"),Hm("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[XN],Object.getOwnPropertyDescriptor(xL.prototype,"leave"),xL.prototype),cy(xL.prototype,"publish",[QN],Object.getOwnPropertyDescriptor(xL.prototype,"publish"),xL.prototype),cy(xL.prototype,"unpublish",[ZN],Object.getOwnPropertyDescriptor(xL.prototype,"unpublish"),xL.prototype),cy(xL.prototype,"subscribe",[$N],Object.getOwnPropertyDescriptor(xL.prototype,"subscribe"),xL.prototype),cy(xL.prototype,"massSubscribe",[eL],Object.getOwnPropertyDescriptor(xL.prototype,"massSubscribe"),xL.prototype),cy(xL.prototype,"unsubscribe",[tL],Object.getOwnPropertyDescriptor(xL.prototype,"unsubscribe"),xL.prototype),cy(xL.prototype,"massUnsubscribe",[nL],Object.getOwnPropertyDescriptor(xL.prototype,"massUnsubscribe"),xL.prototype),cy(xL.prototype,"setLowStreamParameter",[rL],Object.getOwnPropertyDescriptor(xL.prototype,"setLowStreamParameter"),xL.prototype),cy(xL.prototype,"enableDualStream",[iL],Object.getOwnPropertyDescriptor(xL.prototype,"enableDualStream"),xL.prototype),cy(xL.prototype,"disableDualStream",[oL],Object.getOwnPropertyDescriptor(xL.prototype,"disableDualStream"),xL.prototype),cy(xL.prototype,"setClientRole",[aL],Object.getOwnPropertyDescriptor(xL.prototype,"setClientRole"),xL.prototype),cy(xL.prototype,"setProxyServer",[sL],Object.getOwnPropertyDescriptor(xL.prototype,"setProxyServer"),xL.prototype),cy(xL.prototype,"setTurnServer",[cL],Object.getOwnPropertyDescriptor(xL.prototype,"setTurnServer"),xL.prototype),cy(xL.prototype,"setLicense",[lL],Object.getOwnPropertyDescriptor(xL.prototype,"setLicense"),xL.prototype),cy(xL.prototype,"startProxyServer",[dL],Object.getOwnPropertyDescriptor(xL.prototype,"startProxyServer"),xL.prototype),cy(xL.prototype,"stopProxyServer",[uL],Object.getOwnPropertyDescriptor(xL.prototype,"stopProxyServer"),xL.prototype),cy(xL.prototype,"setLocalAccessPointsV2",[pL],Object.getOwnPropertyDescriptor(xL.prototype,"setLocalAccessPointsV2"),xL.prototype),cy(xL.prototype,"setLocalAccessPoints",[hL],Object.getOwnPropertyDescriptor(xL.prototype,"setLocalAccessPoints"),xL.prototype),cy(xL.prototype,"setRemoteDefaultVideoStreamType",[fL],Object.getOwnPropertyDescriptor(xL.prototype,"setRemoteDefaultVideoStreamType"),xL.prototype),cy(xL.prototype,"setRemoteVideoStreamType",[mL],Object.getOwnPropertyDescriptor(xL.prototype,"setRemoteVideoStreamType"),xL.prototype),cy(xL.prototype,"setStreamFallbackOption",[gL],Object.getOwnPropertyDescriptor(xL.prototype,"setStreamFallbackOption"),xL.prototype),cy(xL.prototype,"setEncryptionConfig",[vL],Object.getOwnPropertyDescriptor(xL.prototype,"setEncryptionConfig"),xL.prototype),cy(xL.prototype,"renewToken",[_L],Object.getOwnPropertyDescriptor(xL.prototype,"renewToken"),xL.prototype),cy(xL.prototype,"enableAudioVolumeIndicator",[EL],Object.getOwnPropertyDescriptor(xL.prototype,"enableAudioVolumeIndicator"),xL.prototype),cy(xL.prototype,"startLiveStreaming",[yL],Object.getOwnPropertyDescriptor(xL.prototype,"startLiveStreaming"),xL.prototype),cy(xL.prototype,"setLiveTranscoding",[wL],Object.getOwnPropertyDescriptor(xL.prototype,"setLiveTranscoding"),xL.prototype),cy(xL.prototype,"stopLiveStreaming",[bL],Object.getOwnPropertyDescriptor(xL.prototype,"stopLiveStreaming"),xL.prototype),cy(xL.prototype,"addInjectStreamUrl",[SL],Object.getOwnPropertyDescriptor(xL.prototype,"addInjectStreamUrl"),xL.prototype),cy(xL.prototype,"removeInjectStreamUrl",[TL],Object.getOwnPropertyDescriptor(xL.prototype,"removeInjectStreamUrl"),xL.prototype),cy(xL.prototype,"startChannelMediaRelay",[CL],Object.getOwnPropertyDescriptor(xL.prototype,"startChannelMediaRelay"),xL.prototype),cy(xL.prototype,"updateChannelMediaRelay",[RL],Object.getOwnPropertyDescriptor(xL.prototype,"updateChannelMediaRelay"),xL.prototype),cy(xL.prototype,"stopChannelMediaRelay",[IL],Object.getOwnPropertyDescriptor(xL.prototype,"stopChannelMediaRelay"),xL.prototype),cy(xL.prototype,"sendCustomReportMessage",[OL],Object.getOwnPropertyDescriptor(xL.prototype,"sendCustomReportMessage"),xL.prototype),cy(xL.prototype,"pickSVCLayer",[AL],Object.getOwnPropertyDescriptor(xL.prototype,"pickSVCLayer"),xL.prototype),cy(xL.prototype,"enableContentInspect",[NL],Object.getOwnPropertyDescriptor(xL.prototype,"enableContentInspect"),xL.prototype),cy(xL.prototype,"disableContentInspect",[LL],Object.getOwnPropertyDescriptor(xL.prototype,"disableContentInspect"),xL.prototype),cy(xL.prototype,"setImageModeration",[PL],Object.getOwnPropertyDescriptor(xL.prototype,"setImageModeration"),xL.prototype),cy(xL.prototype,"getJoinChannelServiceRecords",[kL],Object.getOwnPropertyDescriptor(xL.prototype,"getJoinChannelServiceRecords"),xL.prototype),cy(xL.prototype,"setPublishAudioFilterEnabled",[DL],Object.getOwnPropertyDescriptor(xL.prototype,"setPublishAudioFilterEnabled"),xL.prototype),xL);class jL extends Qy{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Dv.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),mh(this,"audioBuffer",void 0),mh(this,"sourceNode",void 0),mh(this,"startPlayTime",0),mh(this,"startPlayOffset",0),mh(this,"pausePlayTime",0),mh(this,"options",void 0),mh(this,"currentLoopCount",0),mh(this,"currentPlaybackSpeed",100),mh(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Am.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const BL=new Map;async function FL(e,t){let n=null;if("string"==typeof e){const t=BL.get(e);if(t)return Am.debug("use cached audio resource: ",e),t;try{n=(await Sm((()=>mm.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new ym(Em.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new Eu(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new ym(Em.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new ym(Em.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=Ky();return new Eu(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new ym(Em.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&BL.set(e,r),r}function GL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GL(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function WL(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=HL(HL({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Am.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Am.debug("[".concat(e,"] set content hint failed")))):Am.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const KL=Vp().name;function qL(e,t,n,r){let i,o=0,a=null;return new Eu(((s,c)=>{setTimeout((()=>{i&&(i(),s(o))}),t),i=Jy((()=>{!function(){o>r&&i&&(i(),s(o));const t=n.getContext("2d");if(!t){const e=new ym(Em.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Am.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return o+=1,void(a=l.data);a=l.data}else a=l.data}()}),30)}))}class YL{constructor(e,t){mh(this,"id",0),mh(this,"element",void 0),mh(this,"peerPair",void 0),mh(this,"context",void 0),mh(this,"audioPlayerElement",void 0),mh(this,"audioTrack",void 0),YL.count+=1,this.id=YL.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new Eu((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new ym(Em.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new ym(Em.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new ym(Em.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){Am.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var zL,JL;mh(YL,"count",0);const XL=window.AudioContext||window.webkitAudioContext,QL=new(zL=Py({report:ky}),cy((JL=class{constructor(){mh(this,"units",[]),mh(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return Am.debug("the system does not need to process local aec"),-1;this.context||(this.context=new XL);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new YL(e,this.context),this.units.push(t)),t.startEchoCancellation(),Am.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Vp().name!==Lp.SAFARI}}).prototype,"processExternalMediaAEC",[zL],Object.getOwnPropertyDescriptor(JL.prototype,"processExternalMediaAEC"),JL.prototype),JL);function ZL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZL(Object(n),!0).forEach((function(t){mh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const eP=window||document;function tP(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!eP)return;const n=nP._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(nP.onSecurityPolicyViolation||nP.getListeners(G_.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;Wm("CSP_DETECTED_HOSTNAME_LIST").some((e=>t.includes(e)))&&(nP.onSecurityPolicyViolation&&"function"==typeof nP.onSecurityPolicyViolation&&nP.onSecurityPolicyViolation(e),nP.getListeners(G_.SECURITY_POLICY_VIOLATION).length>0&&nP.safeEmit(G_.SECURITY_POLICY_VIOLATION,e))};n&&eP.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||nP.getListeners(G_.SECURITY_POLICY_VIOLATION).length>0)&&eP.addEventListener("securitypolicyviolation",r),nP._cspEventHandlerPointer=r}Hm("PROCESS_ID","process-".concat($b(8,""),"-").concat($b(4,""),"-").concat($b(4,""),"-").concat($b(4,""),"-").concat($b(12,""))),function(){const e=Vp();z_.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),z_.getStreamFromExtension=e.name===Lp.CHROME&&Number(e.version)>34,z_.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),z_.supportMinBitrate=e.name===Lp.CHROME||e.name===Lp.EDGE,z_.supportSetRtpSenderParameters=function(){const e=Vp();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!oh()||!(!Kp()&&!Fp())||e.name===Lp.FIREFOX&&Number(e.version)>=64)}(),e.name===Lp.SAFARI&&(Number(e.version)>=14?z_.supportDualStream=!0:z_.supportDualStream=!1),z_.webAudioMediaStreamDest=function(){const e=Vp();return!(e.name===Lp.SAFARI&&Number(e.version)<12)}(),z_.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,z_.supportWebGL="undefined"!=typeof WebGLRenderingContext,z_.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,oh()||(z_.webAudioWithAEC=!0),z_.supportShareAudio=function(){const e=Vp();return(e.os===Np.WIN_10||e.os===Np.WIN_81||e.os===Np.WIN_7||e.os===Np.LINUX||e.os===Np.MAC_OS)&&e.name===Lp.CHROME&&Number(e.version)>=74}(),z_.supportDualStreamEncoding=function(){const e=Vp();return!!Wm("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&Wm("CHROME_DUAL_STREAM_USE_ENCODING"))}(),z_.supportDataChannel=!!(zp(76)||function(e){const t=Vp();return!(t.name!==Lp.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||function(e){const t=Vp();return!(t.name!==Lp.SAFARI||!t.osVersion)&&Number(t.version)>=e}(14)),z_.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!qp()&&!!e&&e.prototype.setConfiguration instanceof Function}(),z_.supportWebRTCEncodedTransform=function(){const e=Vp();return"Chrome"===e.name&&Number(e.version)>=86}(),Am.info("browser compatibility",JSON.stringify(z_),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void Am.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Am.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(Km,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;qm[e]=r,Km[e]=r}}))}catch(t){Am.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(qm.AREAS)&&qm.AREAS.length>0&&zS(qm.AREAS,!0);const nP=function(e){const t=new vm,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===G_.SECURITY_POLICY_VIOLATION&&tP(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return $L($L({},n),r)}({__CLIENT_LIST__:Zm,__TRACK_LIST__:$m,VERSION:Lm,BUILD:Nm,setParameter:(e,t,n)=>{Am.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Hm(e,t,n)},getParameter:Wm,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new ym(Em.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=ky.reportApiInvoke(null,{name:mv.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:gv.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r)}catch(e){return Am.error("check system requirement failed: ",e),!1}let n=!1;const r=Vp();r.name===Lp.CHROME&&Number(r.version)>=58&&(!Hp()||Gp())&&(n=!0),r.name===Lp.FIREFOX&&Number(r.version)>=56&&(n=!0),r.name===Lp.OPERA&&Number(r.version)>=45&&(n=!0),r.name===Lp.SAFARI&&Number(r.version)>=11&&(n=!0),(rh()||Vp().name===Lp.QQ)&&(n=!0),Am.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return pw.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return pw.getRecordingDevices(e)},getCameras:function(e){return pw.getCamerasDevices(e)},getElectronScreenSources:tw,getPlaybackDevices:function(e){return pw.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=ky.reportApiInvoke(null,{name:mv.CREATE_CLIENT,options:[e],tag:gv.TRACER});try{Mv(e)}catch(e){throw t.onError(e),e}return void 0===e.audioCodec&&(e.audioCodec="opus"),t.onSuccess(),new VL(UL(UL({forceWaitGatewayResponse:!0},e),{},{role:"rtc"===e.mode?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_CAM_VIDEO_TRACK,options:[HL({},e)]}),n=MT(e),r=$b(8,"track-cam-");let i=null;Am.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{i=(await cw({video:n},r)).getVideoTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new ym(Em.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw()}e.optimizationMode&&WL(r,i,e,Vm(e.encoderConfig));const o=new CC(i,e,n,e.scalabiltyMode?Bm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return t.onSuccess(o.getTrackId()),Am.info("create camera video success, trackId:",r),o},createCustomVideoTrack:function(e){const t=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new TC(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Bm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,$b(8,"track-cus-"),[p_.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),Am.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_SCREEN_VIDEO_TRACK,options:[HL({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=UT(e),i=$b(8,"track-scr-v-");let o=null,a=null;const s=J_();if(!s.supportShareAudio&&"enable"===t){const e=new ym(Em.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw()}Am.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{const e=await cw({screen:r,screenAudio:"auto"===t?s.supportShareAudio:"enable"===t},i);o=e.getVideoTracks()[0]||null,a=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!o){const e=new ym(Em.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw()}if(!a&&"enable"===t){o&&o.stop();const e=new ym(Em.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(WL(i,o,e,e.encoderConfig&&jm(e.encoderConfig)),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const c=new TC(o,e.encoderConfig?jm(e.encoderConfig):{},e.scalabiltyMode?Bm(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[p_.SCREEN_TRACK]);if(!a)return n.onSuccess(c.getTrackId()),Am.info("create screen video track success","video:",c.getTrackId()),c;const l=new Rb(a,void 0,$b(8,"track-scr-a-"),!1,!0);return n.onSuccess([c.getTrackId(),l.getTrackId()]),Am.info("create screen video track success","video:",c.getTrackId(),"audio:",l.getTrackId()),[c,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),r=MT(t),i=VT(e),o=$b(8,"track-mic-"),a=$b(8,"track-cam-");let s=null,c=null;Am.info("start create camera video track(".concat(a,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await cw({audio:i,video:r},"".concat(o,"-").concat(a));s=e.getAudioTracks()[0],c=e.getVideoTracks()[0]}catch(e){throw n.onError(e),e}if(!s||!c){const e=new ym(Em.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(e),e.throw()}t.optimizationMode&&WL(a,c,t,Vm(t.encoderConfig));const l=new Ib(s,e,i,o),d=new CC(c,t,r,t.scalabiltyMode?Bm(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return n.onSuccess([l.getTrackId(),d.getTrackId()]),Am.info("create camera video track(".concat(a,") and microphone audio track(").concat(o,") success")),[l,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=VT(e),r=$b(8,"track-mic-");let i=null;Am.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await cw({audio:n},r)).getAudioTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new ym(Em.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw()}const o=new Ib(i,e,n,r);return t.onSuccess(o.getTrackId()),Am.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){const t=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Rb(e.mediaStreamTrack,e.encoderConfig?Gm(e.encoderConfig):{},$b(8,"track-cus-"),!1,!0);return Am.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(Wm("DISABLE_WEBAUDIO"))throw new ym(Em.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=$b(8,"track-buf-");Am.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await FL(e.source,e.cacheOnlineFile)}catch(e){return t.onError(e),e.throw()}const i=new jL(e.source),o=new Ob(r,i,e.encoderConfig?Gm(e.encoderConfig):{},n);return Am.info("create buffer source audio track success, trackId:",n),t.onSuccess(o.getTrackId()),o},setAppType:function(e){if(Am.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Am.debug("Invalid appType"),new ym(Em.INVALID_PARAMS,"invalid app type",e);Hm("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Am.setLogLevel(e)},enableLogUpload:function(){Wm("USE_NEW_LOG")?Hm("UPLOAD_LOG",!0):Am.enableLogUpload()},disableLogUpload:function(){Wm("USE_NEW_LOG")?Hm("UPLOAD_LOG",!1):Am.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new CT},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Rb||e instanceof iA)){const e=new ym(Em.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Rb?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,a=i;const s=Date.now();return new Eu((i=>{const c=setInterval((()=>{const l=e.getVolumeLevel();o=l>o?l:o,a=l<a?l:a;const d=o-a>1e-4,u=Date.now()-s;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:r,maxVolumeLevel:o,result:t};Am.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=ky.reportApiInvoke(null,{tag:gv.TRACER,name:mv.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof TC||e instanceof rA)){const e=new ym(Em.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}const r=4;t&&t<1e3&&(t=1e3);const i=e instanceof TC?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(Kp()||Fp())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([o]),a.play();const s=document.createElement("canvas");s.width=160,s.height=120;let c=0,l=0;try{const e=Date.now();c=await qL(a,t,s,r),l=Date.now()-e}catch(e){throw n.onError(e),e}KL===Lp.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const d=c>r,u={duration:l,changedPicNum:c,deviceLabel:i,result:d};return Am.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),n.onSuccess(u),d},setArea:zS,audioElementPlayCenter:fw,processExternalMediaAEC:function(e){QL.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach((e=>{const t=e;t.__registered__=!0,t.logger.hookLog=Am.extLog,t.reporter.hookApiInvoke=ky.extApiInvoke,t.parameters&&Object.keys(t.parameters).forEach((e=>{t.parameters[e]=Wm(e)}))}))},ChannelMediaRelayError:a_,ChannelMediaRelayEvent:i_,ChannelMediaRelayState:o_,RemoteStreamFallbackType:m_,RemoteStreamType:f_,ConnectionDisconnectedReason:Cv,AudienceLatencyLevelType:Tv,AREAS:E_});return Object.defineProperties(nP,{onAudioAutoplayFailed:{get:()=>Cy.onAudioAutoplayFailed,set:e=>{Cy.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Cy.onAutoplayFailed,set:e=>{Cy.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nP._onSecurityPolicyViolation,set(e){nP._onSecurityPolicyViolation=e,tP(e)}}}),pw.on(_v.CAMERA_DEVICE_CHANGED,(e=>{Am.info("camera device changed",JSON.stringify(e)),nP.onCameraChanged&&nP.onCameraChanged(e),nP.safeEmit(G_.CAMERA_CHANGED,e)})),pw.on(_v.RECORDING_DEVICE_CHANGED,(e=>{Am.info("microphone device changed",JSON.stringify(e)),nP.onMicrophoneChanged&&nP.onMicrophoneChanged(e),nP.safeEmit(G_.MICROPHONE_CHANGED,e)})),pw.on(_v.PLAYOUT_DEVICE_CHANGED,(e=>{Am.debug("playout device changed",JSON.stringify(e)),nP.onPlaybackDeviceChanged&&nP.onPlaybackDeviceChanged(e),nP.safeEmit(G_.PLAYBACK_DEVICE_CHANGED,e)})),fw.onAutoplayFailed=()=>{Am.info("detect audio element autoplay failed"),Cy.onAudioAutoplayFailed&&Cy.onAudioAutoplayFailed()},Hy.on("autoplay-failed",(()=>{Am.info("detect webaudio autoplay failed"),Cy.onAudioAutoplayFailed&&Cy.onAudioAutoplayFailed(),nP.safeEmit(G_.AUTOPLAY_FAILED)})),window&&(window.__ARTC__=nP),nP}()},471:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(8081),i=n.n(r),o=n(3645),a=n.n(o),s=n(1667),c=n.n(s),l=new URL(n(8996),n.b),d=a()(i()),u=c()(l);d.push([e.id,"body{margin:0;padding:0}#saleassist-video-call-app{border-radius:inherit;height:100%;display:flex;background:#000}#videoCallContainer{height:100%;display:flex;flex-direction:column;border-radius:inherit;position:relative;flex:1}#videoContainer{display:flex;flex:1;flex-wrap:wrap;background-color:#f8f8f8;overflow:hidden;border-radius:inherit}#videoCallMainScreen{flex:1}#videoCallMainScreen div{width:100%;height:100%}#videoCallVideoTiles{position:absolute;left:0;top:30px;overflow-y:auto;overflow-x:hidden;direction:rtl;height:calc(100% - 30px);z-index:1}.video-call-video-tiles-transition:has(.video-call-wrapper){width:130px;padding:8px;transition:width .3s ease}.video-call-video-tiles-transition-expand:has(.video-call-wrapper){width:0px !important;padding:0px;transition:width .3s ease,padding .5s ease}.video-call-wrapper{position:relative;width:114px;height:88px;margin-bottom:10px;background:#000}.video-call-wrapper video{object-fit:contain !important}.video-call-wrapper-maximize{width:114px;height:88px}.video-call-wrapper:last-child{margin-bottom:0px}#videoCallVideoTiles .video-call-wrapper{border-radius:16px;border:2px solid #7d7d7d}#videoCallVideoTiles .video-call-wrapper div{border-radius:16px}#videoCallMainScreen .video-call-wrapper::before{width:90px;height:90px;font-size:30px}.video-call-wrapper::before{content:attr(user-name);position:absolute;width:50px;height:50px;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;place-content:center;place-items:center;font-size:18px;font-weight:bold;border-radius:50%;color:#fff}.video-call-wrapper:nth-child(5n+1)::before{background-color:#e67e22;box-shadow:#e67e22 0px 0px 20px}.video-call-wrapper:nth-child(5n+2)::before{background-color:#f1c40f;box-shadow:#f1c40f 0px 0px 20px}.video-call-wrapper:nth-child(5n+3)::before{background-color:#9b59b6;box-shadow:#9b59b6 0px 0px 20px}.video-call-wrapper:nth-child(5n+4)::before{background-color:#e74c3c;box-shadow:#e74c3c 0px 0px 20px}.video-call-wrapper:nth-child(5n+5)::before{background-color:#1e90ff;box-shadow:#1e90ff 0px 0px 20px}#localVideoContainer.video-call-wrapper::before{background-color:#1e90ff;box-shadow:#1e90ff 0px 0px 20px}#videoCallMainScreen #localUserPlaceholder{width:90px;height:90px;font-size:30px}#localUserPlaceholder{position:absolute;width:50px;height:50px;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;place-content:center;place-items:center;font-size:18px;font-weight:bold;border-radius:50%;background-color:#1e90ff;box-shadow:#1e90ff 0px 0px 20px;color:#fff;z-index:1}video{flex:1;max-width:100%;max-height:100%}#saleassist-video-call-controls{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px;justify-content:center;padding:10px;border-radius:16px;background-color:rgba(255,255,255,.1);z-index:1}.control-button{position:relative;border:none;background-color:#3f3f41;color:#fff;font-size:18px;cursor:pointer;border-radius:8px;padding:10px;height:35px;width:40px;display:flex;place-content:center;place-items:center}#flipCamera{display:none}#screenShare{display:none}#leaveButton{background-color:#eb271e !important}#leaveButton:hover,#leaveButton:focus,#leaveButton:active{background-color:#eb271e !important}#toggleCamera{background-color:#eb271e !important}#toggleCamera:hover,#toggleCamera:focus,#toggleCamera:active{background-color:#eb271e !important}.videoCallVideoTilesToggleBtn{position:absolute;display:none;place-content:center;place-items:center;height:30px;border-radius:0px 8px 8px 0px;filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6));background:rgba(0,0,0,.2);color:#fff;top:0px;left:0px;z-index:2;cursor:pointer}.videoCallVideoTilesToggleBtn svg{transform:rotate(0deg)}#videoCallVideoTiles:has(.video-call-wrapper)~.videoCallVideoTilesToggleBtn{display:flex}.transform-videoCallVideoTilesToggleBtn svg{transform:rotate(180deg)}.mic-status-indicator{position:absolute;bottom:2px;right:2px;display:flex;font-size:16px;padding:2px;border-radius:50%;background:rgba(0,0,0,.2);filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6));color:#fff;z-index:1}.mic-status-indicator::before{content:attr(user-name);font-size:10px;line-height:16px;margin-right:4px;font-weight:500}.mic-status-indicator #mic-off{color:red}#videoCallVideoTiles .mic-status-indicator::before{display:none}.call-recording-indication-popup,.url-copied-indication-popup{position:absolute;top:10px;left:50%;transform:translateX(-50%);width:0;height:0;display:flex;place-content:center;place-items:center;gap:5px;background:#eb271e;border-radius:8px;padding:0px;color:#fff;font-size:12px;font-weight:bold;z-index:1025;overflow:hidden;transition:all .5s ease}.call-recording-indication-popup span,.url-copied-indication-popup span{opacity:0;visibility:hidden;transition:all .1s ease;display:flex}.url-copied-indication-popup{background:green}.call-recording-indication-popup.call-recording-indication-popup-show,.url-copied-indication-popup.url-copied-indication-popup-show{width:240px;height:34px;top:30px;padding:5px;transition:all .5s ease}.call-recording-indication-popup.call-recording-indication-popup-show span,.url-copied-indication-popup.url-copied-indication-popup-show span{opacity:1;visibility:visible;transition:all .5s ease;transition-delay:.32s}.sa-popup-side-indication-bar{width:5px;background:#fff;height:100%;position:absolute;left:0}.sa-video-call-top-bar{position:absolute;top:4px;right:4px;z-index:1025;display:flex;gap:4px}.sa-video-call-top-bar-button{height:25px;width:25px;display:flex;align-items:center;justify-content:center;font-size:16px;background:rgba(255,255,255,.25);color:#fff;border-radius:4px;cursor:pointer;filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6))}.more-option-button{position:relative;border:none;background-color:#3f3f41;color:#fff;font-size:14px;cursor:pointer;border-radius:8px;padding:10px;height:35px;width:20px;display:flex;place-content:center;place-items:center}.more-option-button svg{transform:rotate(90deg);position:absolute}.saleassist-video-call-more-options-control{position:absolute;bottom:82px;left:50%;transform:translateX(-50%);width:0px;height:0px;background:#3f3f41;border-radius:8px;padding:0px 10px;gap:10px;transition:all .5s ease;display:flex;place-content:space-evenly}.saleassist-video-call-more-options-control button{opacity:0;visibility:hidden;transition:all .2s ease}.more-options-control-active{width:142px;height:55px;transition:all .5s ease}.more-options-control-active button{opacity:1;visibility:visible;transition:all .5s ease;transition-delay:.3s}.more-control-button{display:flex;flex-direction:column;height:55px;width:56px;gap:3px;font-size:20px;position:relative}.more-control-helper-text{font-size:10px;text-wrap:nowrap}#inputDeviceSettings{position:absolute;background:#3f3f41;width:250px;top:50%;left:50%;transform:translate(-50%, -50%);padding:15px 0 25px 0;border-radius:16px;display:none;flex-direction:column;gap:15px;z-index:1}.input-device-settings-header{position:relative;text-align:center;color:#fff;display:flex;place-items:center;place-content:center;margin-bottom:8px}#inputDeviceSettingsClose{position:absolute;right:5px;top:-9px;display:flex;font-size:18px;background:red;width:20px;height:20px;place-items:center;place-content:center;border-radius:50%;cursor:pointer}.input-device-settings{color:#fff;display:flex;place-content:center;place-items:center;gap:10px}.input-device-settings span{display:flex;font-size:22px}.input-device-settings select{appearance:none;-webkit-appearance:none;border:none;padding:.5em;font-size:14px;color:#333;position:relative;display:inline-block;background-color:#f2f2f2;border-radius:4px;width:180px;background-image:url("+u+");background-repeat:no-repeat;background-size:1em .5em;background-position:right center;background-clip:border-box;-moz-background-clip:border-box;-webkit-background-clip:border-box}.input-device-settings select::-ms-expand{display:none}.input-device-settings select:focus{outline:none;box-shadow:0 0 3px 1px rgba(0,0,0,.1)}.input-device-settings select:hover{background-color:#e0e0e0}.call-recording-indication-popup{position:absolute;top:10px;left:50%;transform:translateX(-50%);width:0;height:0;display:flex;place-content:center;place-items:center;gap:5px;background:#eb271e;border-radius:20px;padding:0px;color:#fff;font-size:11px;font-weight:bold;z-index:1025;transition:all .5s ease}.call-recording-indication-popup span{opacity:0;visibility:hidden;transition:all .2s ease;display:flex}.call-recording-indication-popup.call-recording-indication-popup-show{width:240px;height:34px;top:30px;padding:5px;transition:all .5s ease}.call-recording-indication-popup.call-recording-indication-popup-show span{opacity:1;visibility:visible;transition:all .5s ease;transition-delay:.275s}.call-recording-indication{position:absolute;z-index:1025;color:red;left:50%;transform:translateX(-50%);height:30px;font-size:22px;display:none;place-content:center;place-items:center;filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6));opacity:0;visibility:hidden;animation:record-icon-opacity-animation .5s .2s forwards,record-icon-transform-animation .5s 1s forwards}@keyframes record-icon-opacity-animation{0%{opacity:0;visibility:hidden}100%{opacity:1;visibility:visible}}@keyframes record-icon-transform-animation{0%{left:50%;transform:translateX(-50%)}100%{left:18px;transform:translateX(0)}}.sa-device-access-error-wrapper{width:100%;height:100%;position:absolute;top:0;z-index:1025;background:rgba(255,255,255,.3)}.sa-device-access-error-cont{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:310px;background:#2d2d2d;padding:20px;display:flex;flex-direction:column;gap:12px;border-radius:15px;box-shadow:rgba(0,0,0,.2) 0px 3px 5px -1px,rgba(0,0,0,.14) 0px 6px 10px 0px,rgba(0,0,0,.12) 0px 1px 18px 0px}.sa-device-access-error-header{font-size:16px;font-weight:bold;text-align:justify;color:#e5e5e5}.sa-device-access-error-body{font-size:14px;text-align:justify;color:#a5a5a5}.sa-device-access-error-footer{display:flex;place-content:flex-end}.sa-device-access-error-footer .sa-device-access-error-dismiss-btn{font-size:14px;font-weight:bold;color:#eb271e;width:max-content;background:rgba(235,39,30,.15);padding:5px 10px;border-radius:5px;cursor:pointer;user-select:none}.sa-live-call-widget-call-timeout-cta-text{font-size:14px;font-weight:bold;color:#6d6d6d;padding-bottom:12px}.saleassist-video-call-chat-container{position:absolute;background:#141414;height:calc(100% - 8px);display:flex;flex-direction:column;border-radius:inherit;z-index:1025;bottom:0;overflow:hidden;box-shadow:0 0 10px rgba(0,0,0,.1)}.saleassist-video-call-chat-container.sa-chat-hidden{width:100%;height:0px;transition:opacity .2s ease,height .5s ease}.saleassist-video-call-chat-container.sa-chat-active{height:100%;width:100%;margin:0px;transition:height .5s ease,opacity .5s ease .2s}.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container{position:relative;background:#141414;height:calc(100% - 8px);display:flex;flex-direction:column;border-radius:8px;overflow:hidden;box-shadow:0 0 10px rgba(0,0,0,.1)}.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container.sa-chat-hidden{width:0px;margin:0px;opacity:0;transition:opacity .2s ease,width .5s ease}.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container.sa-chat-active{width:400px;margin:4px;opacity:1;transition:width .5s ease,opacity .5s ease .2s}.saleassist-video-call-chat-header{position:relative;color:#e1e1e1;display:flex;place-items:center;place-content:space-between;padding:20px 24px;border-bottom:1px solid;margin-bottom:5px}.saleassist-video-call-chat-header span:nth-child(1){font-size:16px;font-weight:bold}.saleassist-video-call-chat-header #saleassistVideoChatCloseButton{cursor:pointer;position:relative;font-size:18px}.saleassist-video-call-chat-header #saleassistVideoChatCloseButton svg{stroke-width:30px}.saleassist-video-call-chat-log{padding:10px;flex:1;overflow-y:auto;display:flex;flex-direction:column}.saleassist-video-call-chat-log .message{padding:5px 10px;margin:5px;border-radius:5px;max-width:80%;word-break:break-word}.saleassist-video-call-chat-log .message-meta-info{padding:0 5px;margin:0 5px;font-size:10.5px;color:#858585}.saleassist-video-call-chat-log .sent{display:flex;flex-direction:column;place-items:end}.saleassist-video-call-chat-log .sent .message{background-color:#525252;color:#fff}.saleassist-video-call-chat-log .received{display:flex;flex-direction:column;place-items:start}.saleassist-video-call-chat-log .received .message{background-color:#292929;color:#fff}.saleassist-video-call-chat-input-box{position:relative;display:flex;padding:10px;flex-direction:column}.chat-input-overlay{width:100%;height:100%;background:rgba(0,0,0,.75);position:absolute;top:0;left:0;display:none;place-content:center;place-items:center}.saleassist-video-call-document-preview-container{gap:5px;display:flex;flex-direction:column}.sa-chat-document-preview{background:#e1e1e1;color:#595959;padding:12px;border-radius:8px;display:flex;place-content:space-between;place-items:center;gap:8px}.sa-chat-document-preview .sa-chat-document-file-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sa-chat-document-preview .sa-chat-document-file-name svg{vertical-align:text-top}.sa-chat-document-preview .sa-chat-remove-document-button{background:#595959;padding:2px;border-radius:50%;color:#e1e1e1;cursor:pointer;line-height:0}.sa-chat-document-preview .sa-chat-remove-document-button svg{stroke-width:30px}.sa-chat-document-preview:last-child{margin-bottom:10px}.sa-chat-document-preview-sent{display:flex;place-content:center;place-items:center;gap:5px;background:#3d3d3d;padding:7px 14px;border-radius:4px;margin:4px 0;color:#fff;text-decoration:none;box-shadow:rgba(0,0,0,.2) 0px 2px 1px -1px,rgba(0,0,0,.14) 0px 1px 1px 0px,rgba(0,0,0,.12) 0px 1px 3px 0px}.sa-chat-document-preview-sent span:nth-child(1){display:flex}.sa-chat-document-preview-sent span:nth-child(2){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.saleassist-video-call-chat-input-container{display:flex}.saleassist-video-call-chat-input-wrapper{flex:1;display:flex;color:#fff;border:none;border-radius:6px;background:#3d3d3d}#saleassistVideoChatMessageInput{flex:1;color:#fff;padding:10px 10px 10px 15px;border-radius:20px;font-size:16px;border:none;background:rgba(0,0,0,0);outline:none;width:200px}#saleassistVideoChatMessageInput::placeholder{color:#ddd}.sa-live-call-widget-expanded-maximize #saleassistVideoChatMessageInput{font-size:18px}#saleassistVideoChatUploadButton{width:41px;height:41px;display:flex;place-content:center;place-items:center;font-size:22px;cursor:pointer}#saleassistVideoChatSendButton{padding:5px 10px;margin-left:10px;background-color:#007bff !important;color:#fff !important;border:none !important;border-radius:6px;cursor:pointer;width:43px;font-size:18px}#saleassistVideoChatSendButton:hover,#saleassistVideoChatSendButton:focus,#saleassistVideoChatSendButton:active{background-color:#007bff !important;color:#fff !important;border:none !important}#saleassistVideoChatSendButton svg{margin-left:4px;vertical-align:middle}#sa-message .sa-message-notification{background:#08ff08;position:absolute;z-index:1;border-radius:50%;display:none;font-size:10px;font-weight:bold;top:-2px;right:-2px;width:12px;height:12px;color:#000;place-content:center;place-items:center}@media screen and (min-width: 450px){.video-call-wrapper-maximize{width:154px;height:118px}.video-call-video-tiles-transition:has(.video-call-wrapper-maximize){width:170px}}@media screen and (min-width: 768px){.video-call-wrapper-maximize{width:200px;height:150px}.video-call-video-tiles-transition:has(.video-call-wrapper-maximize){width:216px}}@media screen and (max-width: 768px){.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container{position:absolute;border-radius:0;z-index:1025;bottom:0}.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container.sa-chat-hidden{width:100%;height:0px;transition:opacity .2s ease,height .5s ease}.sa-live-call-widget-expanded-maximize .saleassist-video-call-chat-container.sa-chat-active{height:100%;width:100%;margin:0px;transition:height .5s ease,opacity .5s ease .2s}}.sa-hold-screen-overlay-wrapper{position:absolute;z-index:1026;background:rgba(0,0,0,0);width:100%;height:100%;top:0;left:0;display:flex;place-content:center;place-items:center;backdrop-filter:blur(10px);border-radius:5px}.sa-hold-screen-wrapper{width:260px;height:325px;border-radius:8px}.sa-hold-screen-header{background:#ccc;width:100%;display:flex;border-radius:inherit;place-items:center;gap:8px;padding:10px;margin-bottom:5px}.sa-hold-screen-icon{background:#e1e1e1;width:40px;height:40px;border-radius:50%;line-height:0;position:relative;font-size:22px;color:red}.sa-hold-screen-icon svg{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.sa-hold-screen-text{font-size:12px;line-height:15px;background:#e1e1e1;padding:5px 10px;flex:1;border-radius:inherit;font-weight:bold}.sa-hold-screen-body{background:#ccc;width:100%;display:flex;border-radius:inherit;height:260px;place-content:center;place-items:center;padding:8px}.sa-hold-screen-waiting-message{max-width:100%;height:100%;border-radius:inherit}.sa-hold-screen-waiting-message img,.sa-hold-screen-waiting-message video{height:100%;width:100%;border-radius:inherit}",""]);const p=d},8235:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(8081),i=n.n(r),o=n(3645),a=n.n(o),s=n(1667),c=n.n(s),l=new URL(n(4778),n.b),d=new URL(n(5991),n.b),u=a()(i()),p=c()(l),h=c()(d);u.push([e.id,'.sa-live-call-widget-call-waiting-container{background-color:#000;background-position:center bottom;background-repeat:no-repeat;background-size:cover;border-radius:inherit;text-align:center;padding:0px;height:100%}.sa-live-call-widget-call-waiting-wrapper{position:relative;top:50px}.sa-live-call-widget-call-waiting-title{border-bottom:none;color:#fff;display:grid;padding:0 15px}.sa-live-call-widget-call-waiting-progress-bar{width:100%;height:5px;background-color:var(--invertColor);position:relative;overflow:hidden;margin:25px 0}.sa-live-call-widget-call-waiting-progress-bar::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background-color:var(--themeColor);animation:sa-live-call-widget-call-waiting-progress-animation 1.5s infinite linear}@keyframes sa-live-call-widget-call-waiting-progress-animation{0%{left:-100%}100%{left:100%}}.sa-live-call-widget-image-waiting-message{height:100%;max-width:100%;border-radius:8px}.sa-live-call-widget-phone-ringing-animation-wrapper{width:48px;height:48px;display:flex;align-items:center;justify-content:center;background:#01994d;border-radius:50%;position:relative;margin:40px auto 24px auto}.sa-live-call-widget-phone-ringing-animation-wrapper::after,.sa-live-call-widget-phone-ringing-animation-wrapper::before{content:"";width:100px;height:100px;display:block;background:#0c6;border-radius:50%;position:absolute;top:50%;left:50%;margin-top:-50px;margin-left:-50px;animation:pulse 3s linear infinite;opacity:0}.sa-live-call-widget-phone-ringing-animation-wrapper::after{animation:pulse 2s linear 2.3s infinite}@keyframes pulse{0%{transform:scale(0);opacity:1}100%{transform:scale(1.3);opacity:0}}.sa-live-call-widget-phone-ringing-animation-phone-icon{position:relative;width:24px;height:24px;font-size:25vmin}.sa-live-call-widget-phone-ringing-animation-phone-icon::after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background-position:50% 50%;background-repeat:no-repeat;background-size:cover}.sa-live-call-widget-call-waiting-container-video_call .sa-live-call-widget-phone-ringing-animation-phone-icon::after{background-image:url('+p+")}.sa-live-call-widget-call-waiting-container-audio_call .sa-live-call-widget-phone-ringing-animation-phone-icon::after{background-image:url("+h+")}.sa-live-call-widget-phone-ringing-animation-phone-icon::after{animation:phone-icon 3000ms infinite}@keyframes phone-icon{0%{transform:translate3d(0em, 0, 0)}2%{transform:translate3d(0.01em, 0, 0)}4%{transform:translate3d(-0.01em, 0, 0)}6%{transform:translate3d(0.01em, 0, 0)}8%{transform:translate3d(-0.01em, 0, 0)}10%{transform:translate3d(0.01em, 0, 0)}12%{transform:translate3d(-0.01em, 0, 0)}14%{transform:translate3d(0.01em, 0, 0)}16%{transform:translate3d(-0.01em, 0, 0)}18%{transform:translate3d(0.01em, 0, 0)}20%{transform:translate3d(-0.01em, 0, 0)}22%{transform:translate3d(0.01em, 0, 0)}24%{transform:translate3d(-0.01em, 0, 0)}26%{transform:translate3d(0.01em, 0, 0)}28%{transform:translate3d(-0.01em, 0, 0)}30%{transform:translate3d(0.01em, 0, 0)}32%{transform:translate3d(-0.01em, 0, 0)}34%{transform:translate3d(0.01em, 0, 0)}36%{transform:translate3d(-0.01em, 0, 0)}38%{transform:translate3d(0.01em, 0, 0)}40%{transform:translate3d(-0.01em, 0, 0)}42%{transform:translate3d(0.01em, 0, 0)}44%{transform:translate3d(-0.01em, 0, 0)}46%{transform:translate3d(0em, 0, 0)}}",""]);const f=u},7892:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(8081),i=n.n(r),o=n(3645),a=n.n(o)()(i());a.push([e.id,"@import url(https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i&display=swap);"]),a.push([e.id,':root{--themeColor: #3684f2;--invertColor: #fff;--boxShadow: 4px 4px 15px rgba(0, 0, 0, 0.123);--saLiveWidgetBtnPosition: auto 10px 10px auto;--saLiveCallWidgetDefaultContainerPaddingTop: 15px;--themeColorWithOpacity: #3684f260;--sa-live-call-widget-font-family: "Roboto", -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;--sal-live-call-widget-text-sm: 14px}.saleassist *,.saleassist *::before,.saleassist *::after{margin:0;padding:0;box-sizing:border-box;font-family:var(--sa-live-call-widget-font-family) !important;line-height:1}.saleassist img,.saleassist video{max-width:100%;max-height:100%}.saleassist input,.saleassist input[type=number]{font-size:var(--sal-live-call-widget-text-sm);max-width:100%}#sa-live-call-widget-lead-capture-form input::-webkit-input-placeholder,#sa-live-call-widget-feedback-form input::-webkit-input-placeholder{font-size:calc(var(--sal-live-call-widget-text-sm) - 1px);color:#969ba6}#sa-live-call-widget-lead-capture-form input::-moz-placeholder,#sa-live-call-widget-feedback-form input::-moz-placeholder{font-size:calc(var(--sal-live-call-widget-text-sm) - 1px);color:#969ba6}#sa-live-call-widget-lead-capture-form input :-ms-input-placeholder,#sa-live-call-widget-feedback-form input :-ms-input-placeholder{font-size:calc(var(--sal-live-call-widget-text-sm) - 1px);color:#969ba6}.sa-live-call-widget-expanded{height:576px;width:324px;position:fixed;z-index:2147483647 !important;border-radius:5px;inset:var(--saLiveWidgetBtnPosition);box-shadow:rgba(0,0,0,.2) 0px 2px 4px -1px,rgba(0,0,0,.14) 0px 4px 5px 0px,rgba(0,0,0,.12) 0px 1px 10px 0px}.sa-live-call-widget-expanded-maximize{height:100%;width:100%;inset:unset;border-radius:0;top:0}.sa-live-call-widget-expanded-inner-wrapper{width:100%;height:100%;border-radius:inherit;background:#fff !important}.sa-live-call-widget-expanded-inner-wrapper.sa-live-call-widget-powered-by-true{padding-bottom:21.5px !important}.sa-live-call-widget-chat-first-approach-btn{display:inline-flex;align-items:center;justify-content:center;gap:2px;background:var(--themeColor) !important;color:var(--invertColor) !important;font-size:14px;font-weight:bold;padding:8px 24px;border:none !important;border-radius:36px;box-shadow:rgba(0,0,0,.2) 0px 3px 3px -2px,rgba(0,0,0,.14) 0px 3px 4px 0px,rgba(0,0,0,.12) 0px 1px 8px 0px;cursor:pointer}.sa-live-call-widget-chat-first-approach-btn:hover,.sa-live-call-widget-chat-first-approach-btn:focus,.sa-live-call-widget-chat-first-approach-btn:active{background:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-expanded-cta-btn-wrapper{width:100%;display:flex;flex-direction:column;gap:10px;position:absolute;bottom:7%;left:50%;transform:translateX(-50%);z-index:2147483610 !important;text-align:center}.sa-live-call-widget-expanded-cta-btn-wrapper-2{display:flex;gap:10px;justify-content:center}.sa-btn-cta-icon-box-expanded{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:space-around;padding:5px;color:var(--invertColor);background-color:var(--themeColor);min-width:75px;max-width:75px;height:65px;border-radius:10px;font-size:12px;font-weight:bold;text-align:center;cursor:pointer;z-index:1024;user-select:none;box-shadow:rgba(0,0,0,.2) 0px 2px 4px -1px,rgba(0,0,0,.14) 0px 4px 5px 0px,rgba(0,0,0,.12) 0px 1px 10px 0px}.sa-btn-cta-icon-box-expanded svg,.sa-btn-cta-icon-box-expanded span{filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6))}.sa-live-call-widget-one-cta .sa-btn-cta-icon-box-expanded{flex-direction:row;min-width:180px;height:40px;justify-content:center;gap:10px}.sa-live-call-widget-close-expanded-widget-btn{position:absolute;top:6px;right:4px;z-index:2147483610 !important;height:26px;width:26px;display:flex;align-items:center;justify-content:center;font-size:14px;background:rgba(0,0,0,.1);color:#fff;border-radius:50%;cursor:pointer;filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.6))}.sa-live-call-widget-logo-wrapper{min-height:48px;position:absolute;top:0;left:0;z-index:2147483610 !important;background:rgba(0,0,0,0);padding:6px}.sa-live-call-widget-logo{height:35px;width:auto;border-radius:4px}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper .sa-live-call-widget-call-waiting-container) .sa-live-call-widget-logo-wrapper{display:none}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper #saleassist-video-call-app) .sa-live-call-widget-logo-wrapper{display:none}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper #saleassist-video-call-app) .sa-live-call-widget-close-expanded-widget-btn{display:none}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper #sa-live-call-widget-hls-video) .sa-live-call-widget-powered-by-strip{background-color:var(--themeColorWithOpacity) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper #sa-live-call-widget-hls-video) .sa-live-call-widget-powered-by-strip:hover{background-color:var(--themeColor) !important}.sa-live-call-widget-form-header{width:100%;position:absolute;top:0;background:#fff;color:#000;padding:10px;display:flex;align-items:center;justify-content:center;gap:10px;text-transform:capitalize;border-top-right-radius:5px;border-top-left-radius:5px;min-height:var(--saLiveCallWidgetDefaultContainerPaddingTop)}.sa-live-call-widget-form-header p{font-weight:500;color:#332f2f}.sa-live-call-widget-default-container{height:100%;width:100%;padding:var(--saLiveCallWidgetDefaultContainerPaddingTop) 10px 10px 10px}.sa-live-call-widget-expanded-inner-wrapper.sa-live-call-widget-powered-by-true .sa-live-call-widget-default-container{padding-bottom:0 !important}.sa-live-call-widget-page-title{font-size:18px;color:#1f1f1f;font-weight:700;opacity:.8}.sa-live-call-widget-intent-container{width:100%;display:flex;gap:10px;justify-content:center;padding:2px 0;overflow:auto}.sa-live-call-widget-intent-vertical-container{flex-direction:column;width:100%;padding-left:32px;padding-right:32px}.sa-live-call-widget-intent-box{color:#fff;background:rgba(0,0,0,.5);padding:5px 10px;font-size:12px;border:1px solid #fff;border-radius:20px;cursor:pointer;user-select:none;display:flex;gap:8px;align-items:center}.sa-live-call-widget-intent-box.sa-live-call-widget-intent-box-home{display:none}.sa-live-call-widget-intent-number{width:16px;height:16px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#fff;color:#000;font-size:11px;font-weight:500}.sa-live-call-widget-intent-title{position:absolute;top:55px;left:0;color:#fff;text-shadow:#000 .05em 0px,#000 0px .05em,#000 -0.05em 0px,#000 0px -0.05em,#000 -0.05em -0.05em,#000 -0.05em .05em,#000 .05em -0.05em,#000 .05em .05em;font-weight:bold;padding:5px 12px 5px 10px;border-radius:0 15px 15px 0;background:linear-gradient(to right, rgb(0, 0, 0), rgba(0, 0, 0, 0));display:none}@keyframes intentTitleSlide{from{left:-450px}to{left:0px}}.sa-live-call-widget-powered-by-strip{display:block;position:absolute;bottom:0;left:0;right:0;z-index:2147483610 !important;background-color:#fff !important;color:#555 !important;width:100%;display:flex;align-items:center;justify-content:center;border-top:1px solid #dfdfdf;border-bottom-right-radius:5px;border-bottom-left-radius:5px;font-size:10px;text-decoration:none;padding:5px;color:#555 !important}.sa-live-call-widget-powered-by-strip:hover{text-decoration:underline}.sa-live-call-widget-powered-by-strip .sa-live-call-widget-powered-by-strip-saleassist-logo{height:10px;width:9px;margin-right:5px}.sa-live-call-widget-embed-page .sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper video#sa-live-call-widget-hls-video) .sa-live-call-widget-close-expanded-widget-btn{display:none !important}.sa-live-call-widget-embed-page .sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper video#sa-live-call-widget-hls-video) .sa-live-call-widget-mute-unmute-video-btn{top:8px !important}.sa-live-call-widget-embed-page .sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper video#sa-live-call-widget-hls-video) .sa-live-call-widget-logo-wrapper{padding-top:8px !important}.sa-live-call-widget-d-hidden{display:none !important}.sa-live-call-widget-rotate-180{transform:rotate(180deg)}.sa-live-call-widget-bold{font-weight:bold}::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:#f1f1f1}::-webkit-scrollbar-thumb{background:rgba(0,0,0,.3)}::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.3)}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;margin:0}.sa-live-call-widget-btn-container{position:fixed;z-index:2147483647 !important;inset:var(--saLiveWidgetBtnPosition)}.sa-live-call-widget-btn-container .sa-live-call-widget-btn{width:100%;height:100%;cursor:pointer}.sa-live-call-widget-btn-container-type-video_icon,.sa-live-call-widget-btn-container-type-video_message,.sa-live-call-widget-btn-container-type-shoppable_video{width:80px;height:80px}.sa-live-call-widget-btn-container-type-video_icon .sa-live-call-widget-btn,.sa-live-call-widget-btn-container-type-video_message .sa-live-call-widget-btn,.sa-live-call-widget-btn-container-type-shoppable_video .sa-live-call-widget-btn{border-radius:50%;object-fit:cover;border:1px inset var(--themeColor);box-shadow:var(--boxShadow)}.sa-live-call-widget-btn-container-type-video_icon img.sa-live-call-widget-btn,.sa-live-call-widget-btn-container-type-video_message img.sa-live-call-widget-btn,.sa-live-call-widget-btn-container-type-shoppable_video img.sa-live-call-widget-btn{width:auto !important;border:none !important;border-radius:0 !important}.sa-live-call-widget-btn-container-type-video_icon .sa-live-call-widget-close-pop-up-video-btn,.sa-live-call-widget-btn-container-type-video_message .sa-live-call-widget-close-pop-up-video-btn,.sa-live-call-widget-btn-container-type-shoppable_video .sa-live-call-widget-close-pop-up-video-btn{visibility:hidden}.sa-live-call-widget-btn-container-pop-up-video{animation:1s ease 5s 1 normal forwards running sa-live-call-widget-zoom-in-animation}.sa-live-call-widget-btn-container-pop-up-video .sa-live-call-widget-btn{animation:1s ease 5s normal forwards running sa-live-call-widget-border-animation}.sa-live-call-widget-btn-container-pop-up-video .sa-live-call-widget-close-pop-up-video-btn{animation:1s ease 5s 1 normal forwards running sa-live-call-widget-visibility-animation}.sa-live-call-widget-btn-container.sa-live-call-widget-btn-container-type-shoppable_video.sa-live-call-widget-btn-container-pop-up-video{animation-delay:0ms !important}.sa-live-call-widget-btn-container.sa-live-call-widget-btn-container-type-shoppable_video.sa-live-call-widget-btn-container-pop-up-video .sa-live-call-widget-btn{animation-delay:0ms !important}.sa-live-call-widget-btn-container.sa-live-call-widget-btn-container-type-shoppable_video.sa-live-call-widget-btn-container-pop-up-video .sa-live-call-widget-close-pop-up-video-btn{animation-delay:0ms !important}.sa-live-call-widget-btn-container-type-icon{width:60px;height:60px}.sa-live-call-widget-btn-container-type-icon .sa-live-call-widget-btn{width:auto;max-width:fit-content}@keyframes sa-live-call-widget-zoom-in-animation{from{width:80px;height:80px}to{width:180px;height:280px}}@keyframes sa-live-call-widget-border-animation{0%{border:none;border-radius:50%}100%{border-radius:5px;border:none}}@keyframes sa-live-call-widget-visibility-animation{0%{visibility:hidden}100%{visibility:visible}}.sa-live-call-widget-close-pop-up-video-btn{position:absolute;top:5px;right:5px;z-index:1025;height:16px;width:16px;display:flex;align-items:center;justify-content:center;font-size:14px;background:rgba(0,0,0,.3);color:#fff;border-radius:50%;cursor:pointer}.sa-live-call-widget-icon-btn-bottom_right,.sa-live-call-widget-icon-btn-top_right,.sa-live-call-widget-btn-bottom_right,.sa-live-call-widget-btn-top_right{float:right}.sa-live-call-widget-icon-btn-bottom_left,.sa-live-call-widget-icon-btn-top_left,.sa-live-call-widget-btn-bottom_left,.sa-live-call-widget-btn-top_left{float:left}.sa-live-call-widget-trigger-message-container{position:absolute;z-index:2147483610 !important}.sa-live-call-widget-trigger-message-container-bottom_right,.sa-live-call-widget-trigger-message-container-top_right{right:0px}.sa-live-call-widget-trigger-message-container-bottom_left,.sa-live-call-widget-trigger-message-container-top_left{left:0px}.sa-live-call-widget-trigger-message-container-bottom_right .sa-live-call-widget-close-trigger-message-btn{right:0;top:-24px}.sa-live-call-widget-trigger-message-container-top_right .sa-live-call-widget-close-trigger-message-btn{right:0;bottom:-24px}.sa-live-call-widget-trigger-message-container-bottom_left .sa-live-call-widget-close-trigger-message-btn{left:0;top:-24px}.sa-live-call-widget-trigger-message-container-top_left .sa-live-call-widget-close-trigger-message-btn{left:0;bottom:-24px}.sa-live-call-widget-trigger-message-cta-wrapper{display:flex;gap:10px;position:relative}.sa-live-call-widget-trigger-message-cta-wrapper-bottom_right .sa-btn-cta-icon-box,.sa-live-call-widget-trigger-message-cta-wrapper-bottom_left .sa-btn-cta-icon-box{margin-bottom:10px}.sa-live-call-widget-trigger-message-cta-wrapper-bottom_left,.sa-live-call-widget-trigger-message-cta-wrapper-top_left{justify-content:start}.sa-live-call-widget-trigger-message-cta-wrapper-bottom_right,.sa-live-call-widget-trigger-message-cta-wrapper-top_right{justify-content:end}.sa-live-call-widget-trigger-message-cta-wrapper .sa-btn-cta-icon-box{background:#fff;color:#646a73;cursor:pointer;width:58px;height:58px;border-radius:6px;box-shadow:rgba(0,0,0,.24) 0px 3px 8px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:5px 2px}.sa-live-call-widget-trigger-message-cta-wrapper .sa-btn-cta-icon-box:first-child{background:var(--themeColor)}.sa-live-call-widget-trigger-message-cta-wrapper .sa-btn-cta-icon-text{all:unset;font-size:10px;line-height:12px;font-family:var(--sa-live-call-widget-font-family);color:#202020;text-align:center}.sa-live-call-widget-trigger-message-cta-wrapper .sa-btn-cta-icon-text:first-child{color:var(--invertColor)}.sa-live-call-widget-close-trigger-message-btn{position:absolute;background:#fff;padding:3px;cursor:pointer;border-radius:4px;box-shadow:rgba(0,0,0,.24) 0px 3px 8px;display:flex;align-items:center;justify-content:center;transition-property:transform,color;transition-duration:.3s}.sa-live-call-widget-close-trigger-message-btn .sa-live-call-widget-close-trigger-message-btn-icon{color:#1f1f1f}.sa-live-call-widget-close-trigger-message-btn:hover{transform:scale(0.9)}.sa-live-call-widget-close-trigger-message-btn:hover .sa-live-call-widget-close-trigger-message-btn-icon{color:#be0a3c}.sa-live-call-widget-trigger-message-wrapper{width:max-content !important;background-color:#fff;box-shadow:rgba(0,0,0,.35) 0px 5px 15px;max-width:210px !important;min-height:20px;border:1px solid #ccc;border-radius:5px;padding:4px 8px;position:relative;margin-left:auto;cursor:default}.sa-live-call-widget-trigger-message-wrapper::after{content:" ";position:absolute;width:2rem;height:1rem;background-color:inherit;cursor:default}.sa-live-call-widget-trigger-message-wrapper .sa-live-call-widget-trigger-message{font-family:var(--sa-live-call-widget-font-family);font-size:14px;line-height:1.3;color:#202020;cursor:default}.sa-live-call-widget-trigger-message-wrapper-bottom_right::after{top:100%;right:20px;clip-path:polygon(0 0, 80% 0, 100% 100%)}.sa-live-call-widget-trigger-message-wrapper-bottom_left::after{top:100%;left:20px;clip-path:polygon(20% 0%, 100% 0%, 0% 100%)}.sa-live-call-widget-trigger-message-wrapper-top_right::after{bottom:98%;right:20px;clip-path:polygon(0% 100%, 80% 100%, 100% 0%)}.sa-live-call-widget-trigger-message-wrapper-top_left::after{bottom:98%;left:20px;clip-path:polygon(20% 100%, 100% 100%, 0% 0%)}#sa-live-call-widget-hls-video{height:100%;width:100%;border-radius:inherit;object-fit:cover;position:absolute !important;inset:0 !important}.sa-live-call-widget-mute-unmute-video-btn{background:rgba(0,0,0,0) !important;border:none !important;cursor:pointer;position:absolute !important;top:60px !important;right:4px !important;z-index:2147483610 !important;display:flex !important;align-items:center !important;justify-content:space-between !important}.sa-live-call-widget-mute-unmute-video-btn:hover,.sa-live-call-widget-mute-unmute-video-btn:focus .sa-live-call-widget-mute-unmute-video-btn:active{background:rgba(0,0,0,0) !important;border:none !important}.sa-live-call-widget-mute-unmute-video-btn svg{color:#fff;font-size:24px;padding:3px;background:rgba(0,0,0,.1);border-radius:50%;box-sizing:unset}.sa-live-call-widget-mute-unmute-video-btn .sa-live-call-widget-unmute-icon{display:none}.sa-live-call-widget-play-video-btn,.sa-live-call-widget-pause-video-btn{background-color:rgba(255,255,255,.6) !important;border:none !important;cursor:pointer;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);z-index:2147483610 !important;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center}.sa-live-call-widget-play-video-btn:hover,.sa-live-call-widget-play-video-btn:focus,.sa-live-call-widget-play-video-btn:active,.sa-live-call-widget-pause-video-btn:hover,.sa-live-call-widget-pause-video-btn:focus,.sa-live-call-widget-pause-video-btn:active{background-color:rgba(255,255,255,.6) !important;border:none !important}.sa-live-call-widget-play-video-btn .sa-live-call-widget-pause-icon,.sa-live-call-widget-play-video-btn .sa-live-call-widget-play-icon,.sa-live-call-widget-pause-video-btn .sa-live-call-widget-pause-icon,.sa-live-call-widget-pause-video-btn .sa-live-call-widget-play-icon{width:16px;height:16px}.sa-live-call-widget-play-video-btn .sa-live-call-widget-play-icon,.sa-live-call-widget-pause-video-btn .sa-live-call-widget-play-icon{margin-left:4px}.sa-live-call-widget-lead-capture-form-container{position:absolute;top:0;bottom:0;left:0;right:0;z-index:999999999 !important;background:#f5f5f5;padding:0 20px;color:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:inherit;border:"1px solid blue"}#sa-live-call-widget-lead-capture-form{position:relative;background:#fff;padding:24px 0 16px 0;border-radius:8px;width:100%;box-shadow:0px 3px 3px -2px rgba(0,0,0,.2),0px 3px 4px 0px rgba(0,0,0,0.1411764706),0px 1px 8px 0px rgba(0,0,0,0.1215686275);margin-top:52px}#sa-live-call-widget-lead-capture-form .sa-live-call-widget-lead-capture-form-icon{position:absolute;top:-21px;padding:8px;border-radius:50%;left:43%;display:flex;align-items:center;justify-content:center;font-size:24px;background-color:var(--themeColor);color:var(--invertColor);box-shadow:0px 3px 3px -2px rgba(0,0,0,.2),0px 3px 4px 0px rgba(0,0,0,0.1411764706),0px 1px 8px 0px rgba(0,0,0,0.1215686275)}.sa-live-call-widget-lead-capture-form-fields-container{width:100%;max-height:370px;overflow-y:auto;padding:0 16px}#input-field-number{position:relative}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper{width:calc(100% - 32px);margin:12px auto 0}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper .sa-live-call-widget-lead-capture-form-microphone-permission-icon-wrapper{display:flex;gap:10px}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper .sa-live-call-widget-lead-capture-form-microphone-permission-icon-wrapper .sa-live-call-widget-lead-capture-form-microphone-permission-icon{color:green}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper .sa-live-call-widget-lead-capture-form-microphone-permission-icon-wrapper .sa-live-call-widget-lead-capture-form-microphone-permission-icon-text{color:red;max-width:255px;text-align:justify;font-size:11px;color:#555;word-spacing:5px}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper #sa-live-call-widget-lead-capture-form-microphone-permission-btn{width:100%;display:flex;place-content:center;border:1px solid green !important;border-radius:8px;height:40px;place-items:center;margin:5px 0;font-weight:bold;font-size:14px;color:green !important;cursor:pointer;user-select:none;background-color:#fff !important}.sa-live-call-widget-lead-capture-form-submit-btn-wrapper #sa-live-call-widget-lead-capture-form-microphone-permission-btn:hover,.sa-live-call-widget-lead-capture-form-submit-btn-wrapper #sa-live-call-widget-lead-capture-form-microphone-permission-btn:focus,.sa-live-call-widget-lead-capture-form-submit-btn-wrapper #sa-live-call-widget-lead-capture-form-microphone-permission-btn:active{background-color:green !important;color:#fff !important;border:1px solid green !important}.sa-live-call-widget-required-field-error{width:calc(100% - 32px);margin:12px auto 0}.sa-live-call-widget-lead-capture-form-group{padding-bottom:16px}.sa-live-call-widget-lead-capture-form-field-label{color:#3d3939 !important;font-size:15px !important;display:block;padding-bottom:8px;width:100%}.sa-live-call-widget-lead-capture-form-field-label span{color:#242424 !important;font-size:15px !important}.sa-live-call-widget-lead-capture-form-field-label .sa-form-input-required{color:red !important}.sa-live-call-widget-lead-capture-form-checkbox-wrapper{margin-bottom:4px}.sa-live-call-widget-lead-capture-form-checkbox-field-label{color:#242424 !important;font-size:14px !important}.sa-live-call-widget-lead-capture-form-field{padding:6px 12px;border-radius:5px;width:100%;outline:none;border:1px solid #ddd;position:relative}textarea.sa-live-call-widget-lead-capture-form-field{resize:none}.sa-live-call-widget-lead-capture-form-submit-btn{display:block;width:100%;background-color:var(--themeColor) !important;color:var(--invertColor) !important;font-size:14px;padding:10px 20px;outline:none;border:none !important;border-radius:6px;cursor:pointer;line-height:1}.sa-live-call-widget-lead-capture-form-submit-btn:hover,.sa-live-call-widget-lead-capture-form-submit-btn:focus,.sa-live-call-widget-lead-capture-form-submit-btn:active{background-color:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-lead-capture-form-media-permission-denied-overlay{position:absolute;top:0px;width:100%;height:100%;z-index:101;background:rgba(0,0,0,.5);backdrop-filter:blur(5px);display:flex;align-items:center;justify-content:center}.sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card{width:85%;background:#f2d1d1;color:#731010;font-size:14px;border:1px solid #ecbbbb;border-radius:8px;padding:10px}.sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card-title{display:flex;font-weight:bold;margin-bottom:5px}.sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card-image{width:100%;border-radius:8px;margin-top:10px}.sa-live-call-widget-required-field-error{font-size:14px;text-align:center;color:red;display:none}.sa-live-call-widget-mobile-number-input-wrapper{display:flex;align-items:center;border-radius:5px;border:1px solid #ddd;padding:6px 12px}.sa-live-call-widget-mobile-number-input-wrapper .sa-live-call-widget-selected-country-wrapper{cursor:pointer;display:flex;align-items:center;gap:2px;padding-right:4px;border-right:1px solid #ccc}.sa-live-call-widget-mobile-number-input-wrapper .sa-live-call-widget-selected-country-wrapper .sa-live-call-widget-selected-country{font-size:13px;font-family:var(--sa-live-call-widget-font-family)}.sa-live-call-widget-mobile-number-input-wrapper .sa-live-call-widget-selected-country-wrapper .sa-live-call-widget-select-country-arrow{position:relative;display:block;width:14px;height:14px;transition:transform .3s linear}.sa-live-call-widget-mobile-number-input-wrapper .sa-live-call-widget-selected-country-wrapper .sa-live-call-widget-select-country-arrow::after{content:"";display:block;box-sizing:border-box;position:absolute;width:7px;height:7px;border-bottom:1px solid;border-right:1px solid;transform:rotate(45deg);left:4px;top:2px}.sa-live-call-widget-mobile-number-input-wrapper .sa-live-call-widget-mobile-number-input{margin-left:6px;width:100%;height:auto;outline:none;position:relative;border:none;padding:0 !important}.sa-live-call-widget-country-list{width:calc(100% + 1px) !important;border-radius:.25rem !important;max-height:130px !important;outline:none;z-index:1;list-style:none;margin:10px 0 10px -1px;box-shadow:1px 2px 10px rgba(0,0,0,.35);background-color:#fff;overflow-y:scroll;border-radius:0 0 3px 3px;font-size:13px}.sa-live-call-widget-country-list .sa-live-call-widget-country{padding:7px 9px;cursor:pointer}.sa-live-call-widget-country-list .sa-live-call-widget-country:hover{background-color:#f1f1f1}.sa-live-call-widget-schedule-meeting-container{overflow-y:auto;height:100%;display:flex;flex-direction:column;user-select:none;padding-left:2px;padding-right:12px;padding-bottom:10px}.sa-live-call-widget-schedule-meeting-title{font-size:18px;font-weight:bold;color:#1f1f1f;margin-bottom:10px}.sa-live-call-widget-schedule-meeting-caption{font-size:14px;color:#6d6d6d}.sa-live-call-widget-schedule-meeting-caption span{display:block;margin:5px 0;font-size:12px}.sa-live-call-widget-schedule-meeting-date-container{margin:10px 0 15px}.sa-live-call-widget-schedule-meeting-divider{background:linear-gradient(to left, rgba(217, 83, 79, 0), var(--themeColor), rgba(217, 83, 79, 0));margin:0 auto;width:90%;height:2px}.sa-live-call-widget-schedule-meeting-time-container{position:relative;width:90%;margin:0 auto}.sa-live-call-widget-time-custom-select{width:100%;padding:12px 50px 12px 12px;font-size:16px;margin:20px 0;border-radius:8px;background:#fff;border-color:#adadad;appearance:none;background-image:linear-gradient(45deg, transparent 50%, gray 50%),linear-gradient(135deg, gray 50%, transparent 50%),linear-gradient(to right, #ccc, #ccc);background-position:calc(100% - 20px) calc(1em + 3px),calc(100% - 15px) calc(1em + 3px),calc(100% - 2.5em) .55em;background-size:5px 5px,5px 5px,1px 1.5em;background-repeat:no-repeat}.sa-live-call-widget-time-custom-select:focus{outline:0}.sa-live-call-widget-time-custom-select-label{position:absolute;font-size:12px;font-weight:bold;top:10px;background:#fff;color:#6d6d6d;padding:3px 4px;left:10px}.sa-live-call-widget-schedule-meeting-invite-friends-container{display:flex;flex-direction:column;place-content:center;place-items:center}.sa-live-call-widget-schedule-meeting-invite-friends-container img{width:55%}.sa-live-call-widget-schedule-meeting-invite-friends-text{font-size:16px;font-weight:bold;text-align:center;margin:20px 0 5px;color:#1f1f1f}.sa-live-call-widget-schedule-meeting-invite-friends-textarea{width:calc(100% - 30px);min-height:60px;padding:8px;border-color:#adadad;border-radius:8px;outline:none;resize:none;margin:5px 0px;font-size:12px}.sa-live-call-widget-schedule-meeting-confirm-btn{background:var(--themeColor) !important;color:var(--invertColor) !important;width:calc(100% - 30px);border-radius:8px;border:none !important;font-size:18px;font-weight:bold;padding:10px 0;margin:15px auto 0;cursor:pointer;box-shadow:rgba(0,0,0,.2) 0px 3px 3px -2px,rgba(0,0,0,.14) 0px 3px 4px 0px,rgba(0,0,0,.12) 0px 1px 8px 0px}.sa-live-call-widget-schedule-meeting-confirm-btn:hover,.sa-live-call-widget-schedule-meeting-confirm-btn:focus,.sa-live-call-widget-schedule-meeting-confirm-btn:active{background:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-slider{width:100%;max-width:600px;margin:0 auto;overflow:hidden;position:relative}.sa-live-call-widget-slider-wrapper{margin:0 12px;overflow:hidden}.sa-live-call-widget-slider-track{display:flex;transition:transform .3s ease;place-items:center}.sa-live-call-widget-slide{flex:0 0 calc((100% - 20px)/3);margin-right:10px;display:flex;place-content:center}.sa-live-call-widget-slide:last-child{margin-right:0}.sa-live-call-widget-slide img{width:100%;height:auto}.sa-live-call-widget-slide-content{text-align:center;padding:10px;background:var(--invertColor);color:var(--themeColor);border-radius:8px;width:74px;height:74px;display:flex;place-content:center;flex-direction:column;gap:5px;user-select:none;cursor:pointer;box-shadow:rgba(0,0,0,.2) 0px 3px 3px -2px,rgba(0,0,0,.14) 0px 3px 4px 0px,rgba(0,0,0,.12) 0px 1px 8px 0px}.sa-live-call-widget-slide-content h1,.sa-live-call-widget-slide-content p{margin:0}.sa-live-call-widget-slide-active .sa-live-call-widget-slide-content{background:var(--themeColor);color:var(--invertColor);width:80px;height:80px}.sa-live-call-widget-slider-nav{display:block;position:absolute;top:50%;transform:translateY(-50%);background-color:rgba(0,0,0,0);color:#000;border:none;cursor:pointer;font-size:24px;font-weight:bold;user-select:none}.sa-live-call-widget-slider-nav.prev{left:-8px}.sa-live-call-widget-slider-nav.next{right:-8px}.sa-live-call-widget-loader-spinner>div{width:16px;height:16px;background-color:var(--invertColor);border-radius:100%;display:inline-block;-webkit-animation:sk-bouncedelay 1.4s infinite ease-in-out both;animation:sk-bouncedelay 1.4s infinite ease-in-out both}.sa-live-call-widget-loader-spinner .sa-live-call-widget-loader-bounce1{-webkit-animation-delay:-0.32s;animation-delay:-0.32s}.sa-live-call-widget-loader-spinner .sa-live-call-widget-loader-bounce2{-webkit-animation-delay:-0.16s;animation-delay:-0.16s}@-webkit-keyframes sk-bouncedelay{0%,80%,100%{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes sk-bouncedelay{0%,80%,100%{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.sa-live-call-widget-ball-scale-multiple{position:absolute;left:50%;top:22px;margin-top:-30px;margin-left:-30px;z-index:0}.sa-live-call-widget-ball-scale-multiple div{position:absolute;left:0;top:0;width:60px;height:60px;background:var(--invertColor);border-radius:100%;opacity:0;animation:ball-scale-multiple 1.5s linear infinite}.sa-live-call-widget-ball-scale-multiple div:nth-child(2){-webkit-animation-delay:.2s}.sa-live-call-widget-ball-scale-multiple div:nth-child(3){-webkit-animation-delay:.4s}@-webkit-keyframes ball-scale-multiple{0%{-webkit-transform:scale(0);opacity:0}5%{opacity:.35}100%{-webkit-transform:scale(1);opacity:0}}.sa-live-call-widget-thankyou-wrapper{width:100%;height:100%}.sa-live-call-widget-thankyou-container{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thank-you-title{margin:20px 0px}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thank-you-message{font-size:14px;margin:0px;text-align:center;color:#5d5d5d;z-index:1}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn{width:50%;font-weight:bold;border:none !important;display:flex;align-items:center;justify-content:center;gap:8px;border-radius:10px;background-color:var(--themeColor) !important;color:var(--invertColor) !important;padding:0 10px;font-size:14px;height:40px;margin-top:10px;cursor:pointer}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn.schedule-meeting-startover-btn{justify-content:flex-start;margin-right:auto;border-top-left-radius:0;border-bottom-left-radius:0}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn:hover,.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn:focus,.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn:active{background:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-thankyou-container .sa-live-call-widget-thankyou-startover-btn.marginTop50{margin-top:50px}.sa-live-call-widget-thankyou-container .thankyou-share-text-container{display:flex;justify-content:space-between;padding-left:10px;width:100%}.sa-live-call-widget-thankyou-container .thankyou-share-text-container .thankyou-share-text{align-self:flex-end}.sa-live-call-widget-thankyou-container .thankyou-share-text-container img{height:100px}.sa-live-call-widget-thankyou-container .thankyou-share-text{color:#010101;font-weight:600;padding-top:24px;text-align:left;font-size:14px}.sa-live-call-widget-thankyou-container .thankyou-share-text span{color:#ff7b16}.sa-live-call-widget-thankyou-container .sa-live-call-widget-bubble{width:200px;height:200px;border-radius:50%;position:absolute;opacity:.3;background-color:var(--themeColor)}.sa-live-call-widget-thankyou-container .sa-live-call-widget-bubble-position-one{top:-75px;left:-75px}.sa-live-call-widget-thankyou-container .sa-live-call-widget-bubble-position-two{right:-110px}.sa-live-call-widget-thankyou-container .sa-live-call-widget-schedule-mail-text{font-size:10px;margin-top:4px;color:#5d5d5d}.sa-live-call-widget-scheduled-on-container{width:80%;display:flex;gap:8px;place-content:center;place-items:center;box-shadow:0px 3px 3px -2px rgba(0,0,0,.2),0px 3px 4px 0px rgba(0,0,0,.1411764706),0px 1px 8px 0px rgba(0,0,0,.1215686275);padding:8px;border-radius:8px;margin-top:20px;background:#fff;z-index:1}.sa-live-call-widget-scheduled-on-container .sa-live-call-widget-scheduled-on-title{font-size:11px;line-height:10px;font-weight:bold}.sa-live-call-widget-scheduled-on-container .sa-live-call-widget-scheduled-on-title .sa-live-call-widget-scheduled-on-date{color:green}.sa-live-call-widget-feedback-form-container{position:absolute;top:0;bottom:0;left:0;right:0;z-index:100;background:#f5f5f5;padding:0 20px;color:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:inherit}#sa-live-call-widget-feedback-form{position:relative;background:#fff;padding:24px 0 16px 0;border-radius:8px;width:100%;box-shadow:0px 3px 3px -2px rgba(0,0,0,.2),0px 3px 4px 0px rgba(0,0,0,0.1411764706),0px 1px 8px 0px rgba(0,0,0,0.1215686275);margin-top:52px}#sa-live-call-widget-feedback-form .sa-live-call-widget-feedback-form-icon{position:absolute;top:-21px;padding:8px;border-radius:50%;left:43%;display:flex;align-items:center;justify-content:center;font-size:24px;background-color:var(--themeColor);color:var(--invertColor);box-shadow:0px 3px 3px -2px rgba(0,0,0,.2),0px 3px 4px 0px rgba(0,0,0,0.1411764706),0px 1px 8px 0px rgba(0,0,0,0.1215686275)}.sa-live-call-widget-feedback-form-fields-container{width:100%;max-height:320px;overflow-y:auto;padding:0 16px}.sa-live-call-widget-feedback-form-submit-btn-wrapper{width:calc(100% - 32px);margin:12px auto 0}.sa-live-call-widget-feedback-form-submit-btn{display:block;width:100%;background-color:var(--themeColor) !important;color:var(--invertColor) !important;font-size:14px;padding:10px 20px;outline:none;border:none !important;border-radius:6px;cursor:pointer}.sa-live-call-widget-feedback-form-submit-btn:hover,.sa-live-call-widget-feedback-form-submit-btn:focus,.sa-live-call-widget-feedback-form-submit-btn:active{background-color:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-live-call-widget-feedback-form-star-rating-title{font-size:14px;text-align:center;font-weight:600;color:#4b4b4b}.sa-live-call-widget-feedback-form-star-rating{display:flex;flex-direction:column;align-items:center;padding:24px 4px 12px 4px}.sa-live-call-widget-feedback-form-star{fill:#e0e0e0;transition:fill .3s;width:24px;height:24px;cursor:pointer}.sa-live-call-widget-feedback-form-star:hover{fill:#ff9800}.sa-live-call-widget-feedback-form-stars-wrapper{display:flex;gap:8px}.sa-live-call-widget-feedback-form-star{cursor:pointer;stroke:#aaa;transition:stroke .3s}.sa-live-call-widget-feedback-form-star:hover{stroke:#ff9800}.sa-live-call-widget-feedback-form-star polygon.filled-star{fill:#ff9800 !important}.sa-live-call-widget-feedback-form-star polygon.unfilled-star{fill:rgba(0,0,0,0) !important}.sa-live-call-widget-feedback-form-star-description{width:100%;display:flex;justify-content:space-around;padding-top:4px}.sa-live-call-widget-feedback-form-star-description p{font-size:13px;color:#909090}.sa-live-call-widget-video-message-page{width:100%;height:100%;padding-bottom:24px}.sa-live-call-widget-video-message-page p{font-size:18px;font-weight:700;color:#1f1f1f;opacity:.8;padding-bottom:12px}.sa-live-call-widget-video-message-page .sa-live-call-widget-video-message-preview-wrapper{width:100%;height:85%;background:#1f1f1f;border-radius:8px;margin-bottom:12px;position:relative}.sa-live-call-widget-video-message-page .sa-live-call-widget-video-message-preview{width:100%;height:100%;object-fit:cover;border-radius:8px}.sa-live-call-widget-video-message-controls-btn-wrapper{display:flex;align-items:center;gap:10px;padding:0 16px}.sa-live-call-widget-video-message-start-stop-recording-btn{display:block;width:100%;background-color:#4285f4 !important;color:#fff !important;font-size:14px;padding:12px;outline:none;border:none !important;border-radius:8px;cursor:pointer;font-size:14px;font-weight:700;text-align:center;margin:0 auto}.sa-live-call-widget-video-message-start-stop-recording-btn:hover,.sa-live-call-widget-video-message-start-stop-recording-btn:focus,.sa-live-call-widget-video-message-start-stop-recording-btn:active{background-color:#4285f4 !important;color:#fff !important;border:none !important}.sa-live-call-widget-recorded-video-message{width:100%;height:100%;object-fit:cover;border-radius:8px}.sa-live-call-widget-video-message-toggle-recording-btn-wrapper{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}.sa-live-call-widget-video-message-toggle-recording-btn{width:68px;display:flex;flex-direction:column;place-items:center;gap:2px;background:#515151 !important;color:#fff !important;border:none !important;border-radius:8px;padding:5px 22px;font-size:10px;cursor:pointer}.sa-live-call-widget-video-message-toggle-recording-btn:hover,.sa-live-call-widget-video-message-toggle-recording-btn:focus,.sa-live-call-widget-video-message-toggle-recording-btn:active{background:#515151 !important;color:#fff !important;border:none !important}.sa-live-call-widget-video-message-video-recording-icon{color:#4bbf73}.sa-live-call-widget-video-message-screen-recording-icon{color:#fff}.sa-live-call-widget-audio-message-page{width:100%;height:100%;padding-bottom:24px}.sa-live-call-widget-audio-message-page p{font-size:18px;font-weight:700;color:#1f1f1f;opacity:.8;padding-bottom:12px}.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper{width:100%;height:85%;background:#1f1f1f;border-radius:8px;margin-bottom:12px;position:relative}.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-speaking-icon{width:20px;position:absolute;right:10px;top:10px}.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-waves{width:100%;position:absolute;top:50%;transform:translateY(-50%);display:none}.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-play-pause-btn{display:none;flex-direction:column;place-items:center;gap:2px;width:68px;box-sizing:content-box;background:#515151 !important;color:#fff !important;border:none !important;border-radius:8px;backdrop-filter:blur(4px);font-size:10px;padding:5px 22px;position:absolute;bottom:10px;left:50%;transform:translateX(-50%);cursor:pointer}.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-play-pause-btn:hover,.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-play-pause-btn:focus,.sa-live-call-widget-audio-message-page .sa-live-call-widget-audio-message-preview-wrapper .sa-live-call-widget-audio-message-play-pause-btn:active{background:#515151 !important;color:#fff !important;border:none !important}.sa-live-call-widget-audio-message-controls-btn-wrapper{display:flex;align-items:center;gap:10px;padding:0 16px}.sa-live-call-widget-audio-message-start-stop-recording-btn{display:block;width:100%;background-color:#4285f4 !important;color:#fff !important;font-size:14px;padding:12px;outline:none;border:none !important;border-radius:8px;cursor:pointer;font-size:14px;font-weight:700;text-align:center;margin:0 auto}.sa-live-call-widget-audio-message-start-stop-recording-btn:hover,.sa-live-call-widget-audio-message-start-stop-recording-btn:focus,.sa-live-call-widget-audio-message-start-stop-recording-btn:active{background-color:#4285f4 !important;color:#fff !important;border:none !important}.sa-live-call-widget-text-message-page-container{width:100%;height:100%;display:flex;flex-direction:column;padding-bottom:24px}.sa-live-call-widget-audio-message-textarea{min-height:80px;width:100%;resize:none;box-sizing:border-box;font-size:14px;background-image:url("https://static.saleassist.ai/images/textarea.png");background-repeat:no-repeat;background-size:50px;background-position:center;border-radius:5px;border:1px solid #ccc;margin-top:16px;flex:85%;padding:6px 12px;outline:none}.sa-live-call-widget-audio-message-textarea:focus{outline:none}.sa-live-call-widget-audio-message-submit-btn{background:var(--themeColor) !important;color:var(--invertColor) !important;width:100%;border-radius:8px;border:none !important;font-size:18px;font-weight:bold;padding:10px 0;margin:15px auto 0;cursor:pointer;box-shadow:rgba(0,0,0,.2) 0px 3px 3px -2px,rgba(0,0,0,.14) 0px 3px 4px 0px,rgba(0,0,0,.12) 0px 1px 8px 0px}.sa-live-call-widget-audio-message-submit-btn:hover,.sa-live-call-widget-audio-message-submit-btn:focus,.sa-live-call-widget-audio-message-submit-btn:active{background:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}.sa-ai-chat-container{display:flex;flex-direction:column;height:100%}.sa-ai-chat-header hr{width:90%;margin:auto}.sa-ai-chat-header-title{padding:15px;font-size:16px;font-weight:500;text-align:center}.sa-ai-chat-header-content{padding:15px 20px;display:flex;place-items:center;gap:18px}.sa-ai-chat-chatbot-icon{font-size:20px;color:#007bff;width:20px;height:20px;position:relative}.sa-ai-chat-chatbot-icon .sa-ai-chat-indicator{background:#228b22;width:8px;height:8px;position:absolute;border-radius:50%;top:-8px}.sa-ai-chat-chatbot-text{flex:1;display:flex;flex-direction:column;gap:2px}.sa-ai-chat-chatbot-text span:nth-child(1){display:block;font-size:12px;font-weight:500}.sa-ai-chat-chatbot-text span:nth-child(2){font-size:10px}.sa-ai-chat-like-dislike{font-size:24px;display:flex;gap:10px}.sa-ai-chat-like-dislike svg{cursor:pointer}.sa-ai-chat-log{flex:1;background:#f5f5f5;padding:15px;box-shadow:0px 21px 10px -26px rgba(0,0,0,.5) inset,0px -21px 10px -28px rgba(0,0,0,.5) inset;overflow-y:auto}.sa-ai-chat-log .message{position:relative;padding:10px;margin:5px;border-radius:5px;max-width:80%;font-size:12px;word-break:break-word;box-shadow:rgba(0,0,0,.1) 0px 1px 2px}.sa-ai-chat-log .message a{color:inherit;font-weight:500}.sa-ai-chat-log .message-meta-info{position:relative;padding:0 5px;margin:0 5px;font-size:10.5px;color:#5f5f5f}.sa-ai-chat-log .message-meta-info span{position:absolute;left:-17px;top:50%;font-size:12px;background:#fff;height:20px;width:20px;display:flex;place-content:center;place-items:center;border-radius:50%;color:#007bff;transform:translateY(-50%)}.sa-ai-chat-log .sent{display:flex;flex-direction:column;place-items:end}.sa-ai-chat-log .sent .message{background-color:var(--themeColor);color:var(--invertColor)}.sa-ai-chat-log .received{display:flex;flex-direction:column;place-items:start}.sa-ai-chat-log .received .message{background-color:#fff;color:#222}.sa-message-not-sent-error{position:absolute;right:-18px;color:red;font-size:16px;line-height:10px}.sa-ai-chat-input-box{position:relative;display:flex;padding:5px 8px;flex-direction:column}.sa-ai-chat-input-overlay{width:100%;height:100%;background:rgba(0,0,0,.75);position:absolute;top:0;left:0;display:none;place-content:center;place-items:center}.sa-ai-chat-document-preview-container{gap:5px;display:flex;flex-direction:column}.sa-ai-chat-input-container{display:flex}.sa-ai-chat-input-wrapper{flex:1;display:flex;border:none;border-radius:6px;color:#222}#saleassistAiChatMessageInput{flex:1;padding:0px 0px 0px 5px;border-radius:20px;font-size:14px;border:none;background:rgba(0,0,0,0);outline:none;width:200px;color:#222}#saleassistAiChatMessageInput::placeholder{color:#999}#saleassistAiChatUploadButton{width:35px;height:35px;display:flex;place-content:center;place-items:center;font-size:22px;cursor:pointer}#saleassistAiChatSendButton{margin-left:0px;color:#007bff !important;border:none !important;cursor:pointer;width:35px;font-size:22px;background:rgba(0,0,0,0) !important}#saleassistAiChatSendButton:hover,#saleassistAiChatSendButton:focus,#saleassistAiChatSendButton:active{background:rgba(0,0,0,0) !important;color:#007bff !important;border:none !important}#saleassistAiChatSendButton svg{margin-left:4px;margin-top:-4px;vertical-align:middle}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper .sa-ai-chat-container) .sa-live-call-widget-close-expanded-widget-btn{background:none;color:#000;filter:unset;top:10px;right:10px}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper .sa-ai-chat-container) .sa-live-call-widget-close-expanded-widget-btn svg{width:14px;height:14px}.sa-live-call-widget-expanded:has(.sa-live-call-widget-expanded-inner-wrapper .sa-ai-chat-container) .sa-live-call-widget-logo-wrapper{left:10px}.sa-live-call-widget-payment-request-page{padding:0 12px !important}.sa-live-call-widget-payment-request-page .sa-live-call-widget-payment-request-description{padding-bottom:12px}#sa-live-call-widget-advance-payment-btn{display:block;width:100%;background-color:var(--themeColor) !important;color:var(--invertColor) !important;font-size:14px;padding:10px 20px;outline:none;border:none !important;border-radius:6px;cursor:pointer;line-height:1}#sa-live-call-widget-advance-payment-btn:hover,#sa-live-call-widget-advance-payment-btn:focus,#sa-live-call-widget-advance-payment-btn:active{background-color:var(--themeColor) !important;color:var(--invertColor) !important;border:none !important}',""]);const s=a},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);r&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},1667:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},7484:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",o="minute",a="hour",s="day",c="week",l="month",d="quarter",u="year",p="date",h="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,l),o=n-i<0,a=t.clone().add(r+(o?-1:1),l);return+(-(r+(n-i)/(o?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:u,w:c,d:s,D:p,h:a,m:o,s:i,ms:r,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},E="en",y={};y[E]=g;var w="$isDayjsObject",b=function(e){return e instanceof R||!(!e||!e[w])},S=function e(t,n,r){var i;if(!t)return E;if("string"==typeof t){var o=t.toLowerCase();y[o]&&(i=o),n&&(y[o]=n,i=o);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var s=t.name;y[s]=t,i=s}return!r&&i&&(E=i),i||!r&&E},T=function(e,t){if(b(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new R(n)},C=_;C.l=S,C.i=b,C.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var R=function(){function g(e){this.$L=S(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=g.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(C.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(f);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return C},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(e,t){var n=T(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return T(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<T(e)},v.$g=function(e,t,n){return C.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,r=!!C.u(t)||t,d=C.p(e),h=function(e,t){var i=C.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(s)},f=function(e,t){return C.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,g=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case u:return r?h(1,0):h(31,11);case l:return r?h(1,g):h(0,g+1);case c:var E=this.$locale().weekStart||0,y=(m<E?m+7:m)-E;return h(r?v-y:v+(6-y),g);case s:case p:return f(_+"Hours",0);case a:return f(_+"Minutes",1);case o:return f(_+"Seconds",2);case i:return f(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=C.p(e),d="set"+(this.$u?"UTC":""),h=(n={},n[s]=d+"Date",n[p]=d+"Date",n[l]=d+"Month",n[u]=d+"FullYear",n[a]=d+"Hours",n[o]=d+"Minutes",n[i]=d+"Seconds",n[r]=d+"Milliseconds",n)[c],f=c===s?this.$D+(t-this.$W):t;if(c===l||c===u){var m=this.clone().set(p,1);m.$d[h](f),m.init(),this.$d=m.set(p,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[C.p(e)]()},v.add=function(r,d){var p,h=this;r=Number(r);var f=C.p(d),m=function(e){var t=T(h);return C.w(t.date(t.date()+Math.round(e*r)),h)};if(f===l)return this.set(l,this.$M+r);if(f===u)return this.set(u,this.$y+r);if(f===s)return m(1);if(f===c)return m(7);var g=(p={},p[o]=t,p[a]=n,p[i]=e,p)[f]||1,v=this.$d.getTime()+r*g;return C.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=C.z(this),o=this.$H,a=this.$m,s=this.$M,c=n.weekdays,l=n.months,d=n.meridiem,u=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},p=function(e){return C.s(o%12||12,e,"0")},f=d||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(m,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return C.s(t.$y,4,"0");case"M":return s+1;case"MM":return C.s(s+1,2,"0");case"MMM":return u(n.monthsShort,s,l,3);case"MMMM":return u(l,s);case"D":return t.$D;case"DD":return C.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(n.weekdaysMin,t.$W,c,2);case"ddd":return u(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(o);case"HH":return C.s(o,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(o,a,!0);case"A":return f(o,a,!1);case"m":return String(a);case"mm":return C.s(a,2,"0");case"s":return String(t.$s);case"ss":return C.s(t.$s,2,"0");case"SSS":return C.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,p,h){var f,m=this,g=C.p(p),v=T(r),_=(v.utcOffset()-this.utcOffset())*t,E=this-v,y=function(){return C.m(m,v)};switch(g){case u:f=y()/12;break;case l:f=y();break;case d:f=y()/3;break;case c:f=(E-_)/6048e5;break;case s:f=(E-_)/864e5;break;case a:f=E/n;break;case o:f=E/t;break;case i:f=E/e;break;default:f=E}return h?f:C.a(f)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return y[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=S(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return C.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),I=R.prototype;return T.prototype=I,[["$ms",r],["$s",i],["$m",o],["$H",a],["$W",s],["$M",l],["$y",u],["$D",p]].forEach((function(e){I[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),T.extend=function(e,t){return e.$i||(e(t,R,T),e.$i=!0),T},T.locale=S,T.isDayjs=b,T.unix=function(e){return T(1e3*e)},T.en=y[E],T.Ls=y,T.p={},T}()},2025:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0zm0 0h24v24H0z"></path>\n  <path\n    d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"\n  ></path>\n</svg>'},useData:!0})},2500:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0z"></path>\n  <path\n    d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"\n  ></path>\n</svg>'},useData:!0})},7651:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 512 512"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M400 145.49L366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49z"\n  ></path>\n</svg>'},useData:!0})},5583:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="none"\n  stroke-width="2"\n  viewBox="0 0 24 24"\n  aria-hidden="true"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    stroke-linecap="round"\n    stroke-linejoin="round"\n    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"\n  ></path>\n</svg>'},useData:!0})},8738:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0z"></path>\n  <path\n    d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 01-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 00-2.67-1.85.996.996 0 01-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"\n  ></path>\n</svg>'},useData:!0})},429:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 384 512"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"\n  ></path>\n</svg>'},useData:!0})},296:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0z"></path>\n  <path\n    d="M20 5h-3.17L15 3H9L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-8 13c-2.76 0-5-2.24-5-5H5l2.5-2.5L10 13H8c0 2.21 1.79 4 4 4 .58 0 1.13-.13 1.62-.35l.74.74c-.71.37-1.5.61-2.36.61zm4.5-2.5L14 13h2c0-2.21-1.79-4-4-4-.58 0-1.13.13-1.62.35l-.74-.73C10.35 8.24 11.14 8 12 8c2.76 0 5 2.24 5 5h2l-2.5 2.5z"\n  ></path>\n</svg>'},useData:!0})},8437:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  style="font-size: 24px;"\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"\n  ></path>\n</svg>'},useData:!0})},9346:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="none"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="16"\n  width="16"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path d="M3 3H9V5H5V9H3V3Z" fill="currentColor"></path>\n  <path d="M3 21H9V19H5V15H3V21Z" fill="currentColor"></path>\n  <path d="M15 21H21V15H19V19H15V21Z" fill="currentColor"></path>\n  <path d="M21 3H15V5H19V9H21V3Z" fill="currentColor"></path>\n</svg>'},useData:!0})},8073:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M20 2H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h3v3.767L13.277 18H20c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zm0 14h-7.277L9 18.233V16H4V4h16v12z"\n  ></path>\n  <path d="M7 7h10v2H7zm0 4h7v2H7z"></path>\n</svg>'},useData:!0})},8958:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  id="mic-off"\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0zm0 0h24v24H0z"></path>\n  <path\n    d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"\n  ></path>\n</svg>'},useData:!0})},5494:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  id="mic-on"\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0z"></path>\n  <path\n    d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"\n  >\n  </path>\n</svg>'},useData:!0})},5321:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="none"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="16"\n  width="16"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path d="M9 9H3V7H7V3H9V9Z" fill="currentColor"></path>\n  <path d="M9 15H3V17H7V21H9V15Z" fill="currentColor"></path>\n  <path d="M21 15H15V21H17V17H21V15Z" fill="currentColor"></path>\n  <path\n    d="M15 9.00012H21V7.00012H17V3.00012H15V9.00012Z"\n    fill="currentColor"\n  ></path>\n</svg>'},useData:!0})},4925:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="none"\n  stroke-width="2"\n  viewBox="0 0 24 24"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <circle cx="12" cy="12" r="1"></circle>\n  <circle cx="19" cy="12" r="1"></circle>\n  <circle cx="5" cy="12" r="1"></circle>\n</svg>'},useData:!0})},9219:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="none"\n  stroke-width="2"\n  viewBox="0 0 24 24"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path\n    d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"\n  ></path>\n  <path d="M20 3l0 4"></path>\n  <path d="M16 3l0 4"></path>\n</svg>'},useData:!0})},5072:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0V0z"></path>\n  <path\n    d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"\n  ></path>\n</svg>'},useData:!0})},1673:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 16 16"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm0 1A5 5 0 1 0 8 3a5 5 0 0 0 0 10z"\n  >\n  </path>\n  <path d="M10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"></path>\n</svg>'},useData:!0})},9847:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0V0z"></path>\n  <path\n    d="M21.22 18.02l2 2H24v-2h-2.78zm.77-2l.01-10a2 2 0 00-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74zM2.39 1.73L1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10a2 2 0 002 2H0v2h18.13l2.71 2.71 1.27-1.27L2.39 1.73zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47z"\n  ></path>\n</svg>'},useData:!0})},710:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0V0z"></path>\n  <path\n    d="M20 18c1.1 0 1.99-.9 1.99-2L22 6a2 2 0 00-2-2H4c-1.11 0-2 .89-2 2v10a2 2 0 002 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z"\n  ></path>\n</svg>'},useData:!0})},8873:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 512 512"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path d="M16 464l480-208L16 48v160l320 48-320 48z"></path>\n</svg>'},useData:!0})},3618:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 1024 1024"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M512.5 390.6c-29.9 0-57.9 11.6-79.1 32.8-21.1 21.2-32.8 49.2-32.8 79.1 0 29.9 11.7 57.9 32.8 79.1 21.2 21.1 49.2 32.8 79.1 32.8 29.9 0 57.9-11.7 79.1-32.8 21.1-21.2 32.8-49.2 32.8-79.1 0-29.9-11.7-57.9-32.8-79.1a110.96 110.96 0 0 0-79.1-32.8zm412.3 235.5l-65.4-55.9c3.1-19 4.7-38.4 4.7-57.7s-1.6-38.8-4.7-57.7l65.4-55.9a32.03 32.03 0 0 0 9.3-35.2l-.9-2.6a442.5 442.5 0 0 0-79.6-137.7l-1.8-2.1a32.12 32.12 0 0 0-35.1-9.5l-81.2 28.9c-30-24.6-63.4-44-99.6-57.5l-15.7-84.9a32.05 32.05 0 0 0-25.8-25.7l-2.7-.5c-52-9.4-106.8-9.4-158.8 0l-2.7.5a32.05 32.05 0 0 0-25.8 25.7l-15.8 85.3a353.44 353.44 0 0 0-98.9 57.3l-81.8-29.1a32 32 0 0 0-35.1 9.5l-1.8 2.1a445.93 445.93 0 0 0-79.6 137.7l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.2 56.5c-3.1 18.8-4.6 38-4.6 57 0 19.2 1.5 38.4 4.6 57l-66 56.5a32.03 32.03 0 0 0-9.3 35.2l.9 2.6c18.1 50.3 44.8 96.8 79.6 137.7l1.8 2.1a32.12 32.12 0 0 0 35.1 9.5l81.8-29.1c29.8 24.5 63 43.9 98.9 57.3l15.8 85.3a32.05 32.05 0 0 0 25.8 25.7l2.7.5a448.27 448.27 0 0 0 158.8 0l2.7-.5a32.05 32.05 0 0 0 25.8-25.7l15.7-84.9c36.2-13.6 69.6-32.9 99.6-57.5l81.2 28.9a32 32 0 0 0 35.1-9.5l1.8-2.1c34.8-41.1 61.5-87.4 79.6-137.7l.9-2.6c4.3-12.4.6-26.3-9.5-35zm-412.3 52.2c-97.1 0-175.8-78.7-175.8-175.8s78.7-175.8 175.8-175.8 175.8 78.7 175.8 175.8-78.7 175.8-175.8 175.8z"\n  ></path>\n</svg>'},useData:!0})},7458:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 640 512"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"\n  ></path>\n</svg>'},useData:!0})},9644:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 256 256"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M209.66,122.34a8,8,0,0,1,0,11.32l-82.05,82a56,56,0,0,1-79.2-79.21L147.67,35.73a40,40,0,1,1,56.61,56.55L105,193A24,24,0,1,1,71,159L154.3,74.38A8,8,0,1,1,165.7,85.6L82.39,170.31a8,8,0,1,0,11.27,11.36L192.93,81A24,24,0,1,0,159,47L59.76,147.68a40,40,0,1,0,56.53,56.62l82.06-82A8,8,0,0,1,209.66,122.34Z"\n  ></path>\n</svg>'},useData:!0})},4699:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M13.939 4.939 6.879 12l7.06 7.061 2.122-2.122L11.121 12l4.94-4.939z"\n  ></path>\n</svg>'},useData:!0})},6240:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-device-access-error-wrapper">\n  <div class="sa-device-access-error-cont">\n    <div class="sa-device-access-error-header">'+e.escapeExpression(typeof(a=null!=(a=d(n,"headerText")||(null!=t?d(t,"headerText"):t))?a:c)===l?a.call(s,{name:"headerText",hash:{},data:i,loc:{start:{line:3,column:47},end:{line:3,column:61}}}):a)+'</div>\n    <div class="sa-device-access-error-body">'+(null!=(o=typeof(a=null!=(a=d(n,"bodyText")||(null!=t?d(t,"bodyText"):t))?a:c)===l?a.call(s,{name:"bodyText",hash:{},data:i,loc:{start:{line:4,column:45},end:{line:4,column:59}}}):a)?o:"")+'</div>\n    <div class="sa-device-access-error-footer">\n      <div class="sa-device-access-error-dismiss-btn">Dismiss</div>\n    </div>\n  </div>\n</div>'},useData:!0})},8540:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-hold-screen-overlay-wrapper">\n  <div class="sa-hold-screen-wrapper">\n    <div class="sa-hold-screen-header">\n      <span class="sa-hold-screen-icon">'+(null!=(o="function"==typeof(a=null!=(a=s(n,"phoneHold")||(null!=t?s(t,"phoneHold"):t))?a:e.hooks.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"phoneHold",hash:{},data:i,loc:{start:{line:4,column:40},end:{line:4,column:55}}}):a)?o:"")+'</span>\n      <span class="sa-hold-screen-text">Please be on Hold,<br />We will be back\n        shortly.</span>\n    </div>\n    <div class="sa-hold-screen-body">\n      <div class="sa-hold-screen-waiting-message"></div>\n    </div>\n  </div>\n</div>'},useData:!0})},2615:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",d=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div id="videoCallContainer">\n  <div class="call-recording-indication-popup">\n    <span>'+(null!=(o=typeof(a=null!=(a=u(n,"infoIcon")||(null!=t?u(t,"infoIcon"):t))?a:c)===l?a.call(s,{name:"infoIcon",hash:{},data:i,loc:{start:{line:3,column:10},end:{line:3,column:24}}}):a)?o:"")+'</span>\n    <span>This call is being recorded for future quality purpose!</span>\n  </div>\n\n  <div class="call-recording-indication">'+(null!=(o=typeof(a=null!=(a=u(n,"recordIcon")||(null!=t?u(t,"recordIcon"):t))?a:c)===l?a.call(s,{name:"recordIcon",hash:{},data:i,loc:{start:{line:7,column:41},end:{line:7,column:57}}}):a)?o:"")+'</div>\n\n  <div class="url-copied-indication-popup">\n    <span class="sa-popup-side-indication-bar"></span>\n    <span>URL Copied To Clipboard!</span>\n  </div>\n\n  <div class="sa-video-call-top-bar">\n    <div id="sa-pip-mode" class="sa-video-call-top-bar-button">\n      '+(null!=(o=typeof(a=null!=(a=u(n,"pipMode")||(null!=t?u(t,"pipMode"):t))?a:c)===l?a.call(s,{name:"pipMode",hash:{},data:i,loc:{start:{line:16,column:6},end:{line:16,column:19}}}):a)?o:"")+'\n    </div>\n    <div id="videoCallShareUrlCopyButton" class="sa-video-call-top-bar-button">\n      '+(null!=(o=typeof(a=null!=(a=u(n,"shareUrl")||(null!=t?u(t,"shareUrl"):t))?a:c)===l?a.call(s,{name:"shareUrl",hash:{},data:i,loc:{start:{line:19,column:6},end:{line:19,column:20}}}):a)?o:"")+'\n    </div>\n    <div id="videoCallMaximizeButton" class="sa-video-call-top-bar-button">\n      '+(null!=(o=typeof(a=null!=(a=u(n,"maximize")||(null!=t?u(t,"maximize"):t))?a:c)===l?a.call(s,{name:"maximize",hash:{},data:i,loc:{start:{line:22,column:6},end:{line:22,column:20}}}):a)?o:"")+'\n    </div>\n  </div>\n\n  <div id="videoContainer">\n    <div id="videoCallMainScreen">\n      <div\n        id="localVideoContainer"\n        class="video-call-wrapper"\n        user-name="'+d(typeof(a=null!=(a=u(n,"user_display_name_first_letter")||(null!=t?u(t,"user_display_name_first_letter"):t))?a:c)===l?a.call(s,{name:"user_display_name_first_letter",hash:{},data:i,loc:{start:{line:31,column:19},end:{line:31,column:53}}}):a)+'"\n      >\n        <span id="localUserPlaceholder">\n          '+d(typeof(a=null!=(a=u(n,"user_display_name_first_letter")||(null!=t?u(t,"user_display_name_first_letter"):t))?a:c)===l?a.call(s,{name:"user_display_name_first_letter",hash:{},data:i,loc:{start:{line:34,column:10},end:{line:34,column:44}}}):a)+'\n        </span>\n        <span class="mic-status-indicator" user-name="'+d(typeof(a=null!=(a=u(n,"user_display_name")||(null!=t?u(t,"user_display_name"):t))?a:c)===l?a.call(s,{name:"user_display_name",hash:{},data:i,loc:{start:{line:36,column:54},end:{line:36,column:75}}}):a)+'">\n          '+(null!=(o=typeof(a=null!=(a=u(n,"toggleAudio")||(null!=t?u(t,"toggleAudio"):t))?a:c)===l?a.call(s,{name:"toggleAudio",hash:{},data:i,loc:{start:{line:37,column:10},end:{line:37,column:27}}}):a)?o:"")+'\n        </span>\n      </div>\n    </div>\n    <div\n      id="videoCallVideoTiles"\n      class="video-call-video-tiles-transition"\n    ></div>\n    <div class="videoCallVideoTilesToggleBtn">'+(null!=(o=typeof(a=null!=(a=u(n,"videoCallTileToggle")||(null!=t?u(t,"videoCallTileToggle"):t))?a:c)===l?a.call(s,{name:"videoCallTileToggle",hash:{},data:i,loc:{start:{line:45,column:46},end:{line:45,column:71}}}):a)?o:"")+'</div>\n  </div>\n\n  <div class="saleassist-video-call-more-options-control">\n    <button id="sa-settings" class="control-button more-control-button">\n      '+(null!=(o=typeof(a=null!=(a=u(n,"settings")||(null!=t?u(t,"settings"):t))?a:c)===l?a.call(s,{name:"settings",hash:{},data:i,loc:{start:{line:50,column:6},end:{line:50,column:20}}}):a)?o:"")+'\n      <span class="more-control-helper-text">Settings</span>\n    </button>\n  </div>\n\n  <div id="saleassist-video-call-controls">\n    <button id="screenShare" class="control-button">'+(null!=(o=typeof(a=null!=(a=u(n,"screenShare")||(null!=t?u(t,"screenShare"):t))?a:c)===l?a.call(s,{name:"screenShare",hash:{},data:i,loc:{start:{line:56,column:52},end:{line:56,column:69}}}):a)?o:"")+'</button>\n    <button id="toggleCamera" class="control-button">'+(null!=(o=typeof(a=null!=(a=u(n,"toggleCamera")||(null!=t?u(t,"toggleCamera"):t))?a:c)===l?a.call(s,{name:"toggleCamera",hash:{},data:i,loc:{start:{line:57,column:53},end:{line:57,column:71}}}):a)?o:"")+'</button>\n    <button id="toggleAudio" class="control-button">'+(null!=(o=typeof(a=null!=(a=u(n,"toggleAudio")||(null!=t?u(t,"toggleAudio"):t))?a:c)===l?a.call(s,{name:"toggleAudio",hash:{},data:i,loc:{start:{line:58,column:52},end:{line:58,column:69}}}):a)?o:"")+'</button>\n    <button id="flipCamera" class="control-button">'+(null!=(o=typeof(a=null!=(a=u(n,"flipCamera")||(null!=t?u(t,"flipCamera"):t))?a:c)===l?a.call(s,{name:"flipCamera",hash:{},data:i,loc:{start:{line:59,column:51},end:{line:59,column:67}}}):a)?o:"")+'</button>\n    <button id="sa-message" class="control-button">\n      <span class="sa-message-notification"></span>\n      '+(null!=(o=typeof(a=null!=(a=u(n,"message")||(null!=t?u(t,"message"):t))?a:c)===l?a.call(s,{name:"message",hash:{},data:i,loc:{start:{line:62,column:6},end:{line:62,column:19}}}):a)?o:"")+'\n    </button>\n    <button id="leaveButton" class="control-button">'+(null!=(o=typeof(a=null!=(a=u(n,"endCall")||(null!=t?u(t,"endCall"):t))?a:c)===l?a.call(s,{name:"endCall",hash:{},data:i,loc:{start:{line:64,column:52},end:{line:64,column:65}}}):a)?o:"")+'</button>\n    <button id="moreButton" class="more-option-button">'+(null!=(o=typeof(a=null!=(a=u(n,"moreOption")||(null!=t?u(t,"moreOption"):t))?a:c)===l?a.call(s,{name:"moreOption",hash:{},data:i,loc:{start:{line:65,column:55},end:{line:65,column:71}}}):a)?o:"")+'</button>\n  </div>\n\n  <div id="inputDeviceSettings">\n    <div class="input-device-settings-header">\n      <span>Device Setting</span>\n      <span id="inputDeviceSettingsClose">'+(null!=(o=typeof(a=null!=(a=u(n,"closeBtn")||(null!=t?u(t,"closeBtn"):t))?a:c)===l?a.call(s,{name:"closeBtn",hash:{},data:i,loc:{start:{line:71,column:42},end:{line:71,column:56}}}):a)?o:"")+'</span>\n    </div>\n    <div id="videoInputDeviceSetting" class="input-device-settings">\n      <span>'+(null!=(o=typeof(a=null!=(a=u(n,"videoInputDeivce")||(null!=t?u(t,"videoInputDeivce"):t))?a:c)===l?a.call(s,{name:"videoInputDeivce",hash:{},data:i,loc:{start:{line:74,column:12},end:{line:74,column:34}}}):a)?o:"")+'</span>\n    </div>\n    <div id="audioInputDeviceSetting" class="input-device-settings">\n      <span>'+(null!=(o=typeof(a=null!=(a=u(n,"toggleAudio")||(null!=t?u(t,"toggleAudio"):t))?a:c)===l?a.call(s,{name:"toggleAudio",hash:{},data:i,loc:{start:{line:77,column:12},end:{line:77,column:29}}}):a)?o:"")+'</span>\n    </div>\n  </div>\n</div>\n\n<div class="saleassist-video-call-chat-container sa-chat-hidden">\n\n  <div class="saleassist-video-call-chat-header">\n    <span>In-Call Message</span>\n    <span id="saleassistVideoChatCloseButton">'+(null!=(o=typeof(a=null!=(a=u(n,"closeBtn")||(null!=t?u(t,"closeBtn"):t))?a:c)===l?a.call(s,{name:"closeBtn",hash:{},data:i,loc:{start:{line:86,column:46},end:{line:86,column:60}}}):a)?o:"")+'</span>\n  </div>\n\n  <div class="saleassist-video-call-chat-log" id="saleassistVideoChatLog">\n    \x3c!-- Chat messages will be displayed here --\x3e\n  </div>\n\n  <div class="saleassist-video-call-chat-input-box">\n    <span class="chat-input-overlay">'+(null!=(o=typeof(a=null!=(a=u(n,"threeDotsLoader")||(null!=t?u(t,"threeDotsLoader"):t))?a:c)===l?a.call(s,{name:"threeDotsLoader",hash:{},data:i,loc:{start:{line:94,column:37},end:{line:94,column:58}}}):a)?o:"")+'</span>\n    <div class="saleassist-video-call-document-preview-container">\n      \x3c!-- Uploaded files will be displayed here --\x3e\n    </div>\n\n    <div class="saleassist-video-call-chat-input-container">\n      <div class="saleassist-video-call-chat-input-wrapper">\n        <input\n          type="text"\n          id="saleassistVideoChatMessageInput"\n          placeholder="Type Your Message"\n        />\n        <label htmlFor="upload-file">\n          <span id="saleassistVideoChatUploadButton">\n            '+(null!=(o=typeof(a=null!=(a=u(n,"uploadBtn")||(null!=t?u(t,"uploadBtn"):t))?a:c)===l?a.call(s,{name:"uploadBtn",hash:{},data:i,loc:{start:{line:108,column:12},end:{line:108,column:27}}}):a)?o:"")+'\n            <input\n              type="file"\n              id="upload-file"\n              style="display:none"\n              accept="*"\n              multiple\n            />\n          </span>\n        </label>\n      </div>\n      <button id="saleassistVideoChatSendButton">'+(null!=(o=typeof(a=null!=(a=u(n,"sendBtn")||(null!=t?u(t,"sendBtn"):t))?a:c)===l?a.call(s,{name:"sendBtn",hash:{},data:i,loc:{start:{line:119,column:49},end:{line:119,column:62}}}):a)?o:"")+"</button>\n    </div>\n  </div>\n</div>"},useData:!0})},6315:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-ai_chat-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="0 0 459.579 459.579"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M429.579,14.7H139.935c-16.569,0-30,13.431-30,30v80.993h30V44.7h289.644v183.393h-48.495v30h48.495c16.568,0,30-13.431,30-30V44.7C459.579,28.132,446.148,14.7,429.579,14.7z"\n      fill="var(--invertColor)"\n    />\n    <path\n      d="M319.644,155.693H30c-16.565,0-30,13.427-30,30v183.393c0,16.569,13.431,30,30,30h92.333l29.531,35.11c11.99,14.255,33.945,14.234,45.917,0l29.531-35.11h92.333c9.32,0,17.647-4.25,23.149-10.917c0.306-0.37,0.603-0.748,0.891-1.133c3.743-5.005,5.96-11.219,5.96-17.95V185.693C349.644,169.126,336.214,155.693,319.644,155.693z M319.644,369.086h-106.3l-38.522,45.799L136.3,369.086H30V185.693h289.644V369.086z"\n      fill="var(--invertColor)"\n    />\n    <path\n      d="M80.011,257.792h189.621c8.284,0,15-6.716,15-15s-6.716-15-15-15H80.011c-8.284,0-15,6.716-15,15S71.727,257.792,80.011,257.792z"\n      fill="var(--invertColor)"\n    />\n    <path\n      d="M80.011,325.573h77.621c8.284,0,15-6.716,15-15s-6.716-15-15-15H80.011c-8.284,0-15,6.716-15,15S71.727,325.573,80.011,325.573z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:30,column:4},end:{line:30,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},1717:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-audio_call-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <div class="sa-live-call-widget-ball-scale-multiple">\n    <div></div>\n    <div></div>\n    <div></div>\n  </div>\n  <svg\n    width="20"\n    height="20"\n    viewBox="2 2 16 16"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M6.98706 2.06589L6.27036 2.28192C4.96684 2.67484 4.00944 3.78801 3.81598 5.13565C3.519 7.20438 4.18323 9.62242 5.78368 12.3945C7.38077 15.1607 9.13867 16.9433 11.0739 17.7231C12.3435 18.2346 13.7948 17.9592 14.7886 17.018L15.3314 16.5039C16.0589 15.815 16.1643 14.694 15.5781 13.8815L14.2215 12.0014C13.8458 11.4807 13.1805 11.2569 12.5665 11.4446L10.5158 12.0716L10.4628 12.082C10.2366 12.115 9.7154 11.6259 9.06527 10.4999C8.38512 9.32181 8.24417 8.63298 8.43194 8.45541L9.47529 7.48248C10.2572 6.75332 10.4882 5.60728 10.0499 4.63213L9.38841 3.16075C8.97652 2.24451 7.94888 1.77597 6.98706 2.06589ZM8.47634 3.57077L9.13779 5.04215C9.40063 5.62682 9.26212 6.31395 8.7933 6.75113L7.74739 7.72645C7.0783 8.35918 7.29992 9.44218 8.19924 10.9999C9.04545 12.4655 9.81744 13.1898 10.6469 13.0642L10.7713 13.0376L12.8589 12.4009C13.0635 12.3383 13.2853 12.413 13.4105 12.5865L14.7671 14.4666C15.0603 14.8729 15.0076 15.4334 14.6438 15.7778L14.101 16.2919C13.3911 16.9642 12.3545 17.1609 11.4476 16.7955C9.74957 16.1113 8.14475 14.484 6.64971 11.8945C5.15161 9.29969 4.54531 7.09254 4.80583 5.27775C4.94402 4.31515 5.62787 3.52003 6.55896 3.23937L7.27566 3.02334C7.75657 2.87838 8.27039 3.11265 8.47634 3.57077Z"\n      fill="var(--invertColor)"\n    ></path>\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:23,column:4},end:{line:23,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},5801:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-audio_feedback-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="0 0 122.88 113.8"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      fill="var(--invertColor)"\n      d="M0,67.6c-.06-5.83,2.16-11,7.37-12.69l.13-.22a2.91,2.91,0,0,1,.6-.8,3.1,3.1,0,0,1,1.05-.5l.29-.11C34.7,44,46.09,30.07,52.64,20.61c0,9.29,2.33,21.4,6.43,33.12,4.21,12,10.29,23.71,17.71,31.76h0c-7.73-2.2-17.43-5-33.21-2.85a15.17,15.17,0,0,0-1.12,5.06,3.9,3.9,0,0,0,1,3l.24.22c1,.91,1.49,1.36,1.71,2.17a9.17,9.17,0,0,1-.13,3.22l-.09.67c-.37,2.93,1.05,3.53,2.46,4.13s2.51,1.08,3.08,2.69a.68.68,0,0,1,0,.4c-.58,3-2.5,4.64-4.43,6.29-.47.41-.95.82-1.36,1.21l-.06,0c-3.92,3.14-6.57,2.3-8.58-.22-1.58-2-2.68-5-3.7-7.81l-.44-1.22a122.88,122.88,0,0,1-4-15.09l-.34-1.5c-.87.24-1.78.51-2.73.79h0c-1.2.35-2.4.73-3.59,1.11l-.38.14a1.21,1.21,0,0,1-1.33,0C13.47,90,8.2,87,4.68,82a25,25,0,0,1-3.41-6.9A25.74,25.74,0,0,1,0,67.6ZM87.81,16.16a3,3,0,0,1-4.23-.6l-.07-.09a3.05,3.05,0,0,1,.63-4.19C89,7.69,93.84,4.07,98.7.56A3.09,3.09,0,0,1,100.92,0a3.06,3.06,0,0,1,2,1.21l0,.05a3,3,0,0,1,.52,2.23,3,3,0,0,1-1.21,2L87.81,16.16Zm15.79,57.7h0a3,3,0,0,1-2.11-.93,3,3,0,0,1-.85-2.14v-.07a3,3,0,0,1,3.07-3c5.37,0,10.83.2,16.2.3a3.07,3.07,0,0,1,3,3.1,3.09,3.09,0,0,1-.93,2.15,3,3,0,0,1-2.16.86l-16.19-.31Zm.47-15.71a3,3,0,0,1-3.25-2.78V55.3a3.07,3.07,0,0,1,2.77-3.23c5-.4,10.09-.83,15.1-1.15a3.06,3.06,0,0,1,3.24,2.81h0a3,3,0,0,1-.73,2.21A3.08,3.08,0,0,1,119.12,57c-4.85.48-10.18.88-15.05,1.14Zm-2.16-14.59a3.06,3.06,0,0,1-3.78-2.11v0a3,3,0,0,1,.27-2.3,3.1,3.1,0,0,1,1.83-1.46c5.21-1.37,10.4-3.05,15.61-4.45a3,3,0,0,1,2.3.27,3.08,3.08,0,0,1,1.45,1.8v0a3.07,3.07,0,0,1-2.1,3.78l-15.59,4.45Zm-6.3-14.32a3.05,3.05,0,0,1-4.09-1.37,3,3,0,0,1-.17-2.33,3.09,3.09,0,0,1,1.53-1.77l15-7.49a3,3,0,0,1,4.09,1.37,3,3,0,0,1,.16,2.33,3.07,3.07,0,0,1-1.53,1.76l-15,7.5ZM58.75,12c.13-.15.27-.29.4-.42a4.46,4.46,0,0,1,1.48-1.11h0a3.58,3.58,0,0,1,2-.08c2.25.36,4.66,2,7.11,4.51,6,6.19,12.32,18,16.82,30.41s7.2,25.36,5.85,33.77c-.51,3.13-1.57,5.66-3.31,7.33l-.09.07a5.64,5.64,0,0,1-2.47,1,2.43,2.43,0,0,0-.25-.2C80.3,83,75,75.9,70.54,67.55c1.14.22,2.6-.63,4-2.08,7-7.38,3.56-20.28-5.17-23.27C65.81,41,62.27,41,60.87,41.69l-.15.08C57.52,29.42,56.61,18,58.75,12Z"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},4516:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M20 3H6.693A2.01 2.01 0 0 0 4.82 4.298l-2.757 7.351A1 1 0 0 0 2 12v2c0 1.103.897 2 2 2h5.612L8.49 19.367a2.004 2.004 0 0 0 .274 1.802c.376.52.982.831 1.624.831H12c.297 0 .578-.132.769-.36l4.7-5.64H20c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zm-8.469 17h-1.145l1.562-4.684A1 1 0 0 0 11 14H4v-1.819L6.693 5H16v9.638L11.531 20zM18 14V5h2l.001 9H18z"\n  ></path>\n</svg>'},useData:!0})},9001:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2zM4 10h2v9H4v-9zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7v1.819z"\n  ></path>\n</svg>'},useData:!0})},2461:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  role="img"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <title></title>\n  <path\n    d="M11.999 0c-2.25 0-4.5.06-6.6.21a5.57 5.57 0 00-5.19 5.1c-.24 3.21-.27 6.39-.06 9.6a5.644 5.644 0 005.7 5.19h3.15v-3.9h-3.15c-.93.03-1.74-.63-1.83-1.56-.18-3-.15-6 .06-9 .06-.84.72-1.47 1.56-1.53 2.04-.15 4.2-.21 6.36-.21s4.32.09 6.36.18c.81.06 1.5.69 1.56 1.53.24 3 .24 6 .06 9-.12.93-.9 1.62-1.83 1.59h-3.15l-6 3.9V24l6-3.9h3.15c2.97.03 5.46-2.25 5.7-5.19.21-3.18.18-6.39-.03-9.57a5.57 5.57 0 00-5.19-5.1c-2.13-.18-4.38-.24-6.63-.24zm-5.04 8.76c-.36 0-.66.3-.66.66v2.34c0 .33.18.63.48.78 1.62.78 3.42 1.2 5.22 1.26 1.8-.06 3.6-.48 5.22-1.26.3-.15.48-.45.48-.78V9.42c0-.09-.03-.15-.09-.21a.648.648 0 00-.87-.36c-1.5.66-3.12 1.02-4.77 1.05-1.65-.03-3.27-.42-4.77-1.08a.566.566 0 00-.24-.06z"\n  ></path>\n</svg>'},useData:!0})},6189:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="1em"\n  width="1em"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="M11.953 2C6.465 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.493 2 11.953 2zM12 20c-4.411 0-8-3.589-8-8s3.567-8 7.953-8C16.391 4 20 7.589 20 12s-3.589 8-8 8z"\n  ></path>\n  <path d="M11 7h2v7h-2zm0 8h2v2h-2z"></path>\n</svg>'},useData:!0})},6113:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-feedback_form-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="3 3 14 14"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7H13.5C13.7761 7 14 6.77614 14 6.5C14 6.22386 13.7761 6 13.5 6H6.5ZM6 9.5C6 9.22386 6.22386 9 6.5 9H10.5C10.7761 9 11 9.22386 11 9.5C11 9.77614 10.7761 10 10.5 10H6.5C6.22386 10 6 9.77614 6 9.5ZM6.5 12C6.22386 12 6 12.2239 6 12.5C6 12.7761 6.22386 13 6.5 13H13.5C13.7761 13 14 12.7761 14 12.5C14 12.2239 13.7761 12 13.5 12H6.5ZM17 5.5C17 4.11929 15.8807 3 14.5 3H5.5C4.11929 3 3 4.11929 3 5.5V14.5C3 15.8807 4.11929 17 5.5 17H14.5C15.8807 17 17 15.8807 17 14.5V5.5ZM5.5 4H14.5C15.3284 4 16 4.67157 16 5.5V14.5C16 15.3284 15.3284 16 14.5 16H5.5C4.67157 16 4 15.3284 4 14.5V5.5C4 4.67157 4.67157 4 5.5 4Z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},9103:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({1:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div\n      id="sa-live-call-widget-trigger-message-container"\n      class="sa-live-call-widget-trigger-message-container sa-live-call-widget-trigger-message-container-'+l(typeof(o=null!=(o=d(n,"button_position")||(null!=t?d(t,"button_position"):t))?o:s)===c?o.call(a,{name:"button_position",hash:{},data:i,loc:{start:{line:7,column:105},end:{line:7,column:124}}}):o)+'"\n    >\n      <div\n        class="sa-live-call-widget-trigger-message-cta-wrapper sa-live-call-widget-trigger-message-cta-wrapper-'+l(typeof(o=null!=(o=d(n,"button_position")||(null!=t?d(t,"button_position"):t))?o:s)===c?o.call(a,{name:"button_position",hash:{},data:i,loc:{start:{line:10,column:111},end:{line:10,column:130}}}):o)+'"\n      >\n      </div>\n      <div\n        class="sa-live-call-widget-trigger-message-wrapper sa-live-call-widget-trigger-message-wrapper-'+l(typeof(o=null!=(o=d(n,"button_position")||(null!=t?d(t,"button_position"):t))?o:s)===c?o.call(a,{name:"button_position",hash:{},data:i,loc:{start:{line:14,column:103},end:{line:14,column:122}}}):o)+'"\n      >\n        <p class="sa-live-call-widget-trigger-message">\n        </p>\n      </div>\n    </div>\n'},3:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <img\n      class="sa-live-call-widget-btn sa-live-call-widget-icon-btn-'+l(typeof(o=null!=(o=d(n,"button_position")||(null!=t?d(t,"button_position"):t))?o:s)===c?o.call(a,{name:"button_position",hash:{},data:i,loc:{start:{line:23,column:66},end:{line:23,column:85}}}):o)+'"\n      src='+l(typeof(o=null!=(o=d(n,"source_image_url")||(null!=t?d(t,"source_image_url"):t))?o:s)===c?o.call(a,{name:"source_image_url",hash:{},data:i,loc:{start:{line:24,column:10},end:{line:24,column:30}}}):o)+'\n      alt="source image"\n    />\n'},5:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(o=a(n,"if").call(null!=t?t:e.nullContext||{},null!=t?a(t,"isWelcomeImage"):t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i,loc:{start:{line:28,column:4},end:{line:45,column:11}}}))?o:""},6:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <img\n        src="'+l(typeof(o=null!=(o=d(n,"source_welcome_video_url")||(null!=t?d(t,"source_welcome_video_url"):t))?o:s)===c?o.call(a,{name:"source_welcome_video_url",hash:{},data:i,loc:{start:{line:30,column:13},end:{line:30,column:41}}}):o)+'"\n        alt=""\n        class="sa-live-call-widget-btn sa-live-call-widget-btn-'+l(typeof(o=null!=(o=d(n,"button_position")||(null!=t?d(t,"button_position"):t))?o:s)===c?o.call(a,{name:"button_position",hash:{},data:i,loc:{start:{line:32,column:63},end:{line:32,column:82}}}):o)+'"\n      />\n'},8:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <video\n        class="sa-live-call-widget-btn"\n        poster="https://static.saleassist.ai/gifs/loader.gif"\n        src="'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"source_welcome_video_url")||(null!=t?a(t,"source_welcome_video_url"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"source_welcome_video_url",hash:{},data:i,loc:{start:{line:38,column:13},end:{line:38,column:41}}}):o)+'"\n        playsInline\n        autoplay\n        loop\n        muted\n      >\n      </video>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",d=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  class="sa-live-call-widget-btn-container sa-live-call-widget-btn-container-type-'+d(typeof(a=null!=(a=u(n,"button_type")||(null!=t?u(t,"button_type"):t))?a:c)===l?a.call(s,{name:"button_type",hash:{},data:i,loc:{start:{line:2,column:82},end:{line:2,column:97}}}):a)+" "+d(typeof(a=null!=(a=u(n,"buttonPositionOldClassName")||(null!=t?u(t,"buttonPositionOldClassName"):t))?a:c)===l?a.call(s,{name:"buttonPositionOldClassName",hash:{},data:i,loc:{start:{line:2,column:98},end:{line:2,column:128}}}):a)+'"\n>\n'+(null!=(o=u(n,"if").call(s,null!=t?u(t,"allow_trigger_messages"):t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i,loc:{start:{line:4,column:2},end:{line:20,column:9}}}))?o:"")+(null!=(o=u(n,"if").call(s,null!=t?u(t,"isIconButton"):t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i,loc:{start:{line:21,column:2},end:{line:46,column:9}}}))?o:"")+"</div>"},useData:!0})},7289:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div>\n  <div\n    class="sa-live-call-widget-lead-capture-form-microphone-permission-icon-wrapper"\n  >\n    <svg\n      class="sa-live-call-widget-lead-capture-form-microphone-permission-icon"\n      stroke="currentColor"\n      fill="currentColor"\n      stroke-width="0"\n      viewBox="0 0 16 16"\n      height="1em"\n      width="1em"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"></path>\n      <path\n        d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"\n      ></path>\n    </svg>\n    <p\n      class="sa-live-call-widget-lead-capture-form-microphone-permission-icon-text"\n    >Please allow access to microphone when prompted.</p>\n  </div>\n  <button\n    type="button"\n    id="sa-live-call-widget-lead-capture-form-microphone-permission-btn"\n  >\n    Grant Permission</button>\n</div>'},useData:!0})},5366:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-schedule_meeting-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="3 3 14 14"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M7 11C7.55228 11 8 10.5523 8 10C8 9.44771 7.55228 9 7 9C6.44772 9 6 9.44771 6 10C6 10.5523 6.44772 11 7 11ZM8 13C8 13.5523 7.55228 14 7 14C6.44772 14 6 13.5523 6 13C6 12.4477 6.44772 12 7 12C7.55228 12 8 12.4477 8 13ZM10 11C10.5523 11 11 10.5523 11 10C11 9.44771 10.5523 9 10 9C9.44771 9 9 9.44771 9 10C9 10.5523 9.44771 11 10 11ZM11 13C11 13.5523 10.5523 14 10 14C9.44771 14 9 13.5523 9 13C9 12.4477 9.44771 12 10 12C10.5523 12 11 12.4477 11 13ZM13 11C13.5523 11 14 10.5523 14 10C14 9.44771 13.5523 9 13 9C12.4477 9 12 9.44771 12 10C12 10.5523 12.4477 11 13 11ZM17 5.5C17 4.11929 15.8807 3 14.5 3H5.5C4.11929 3 3 4.11929 3 5.5V14.5C3 15.8807 4.11929 17 5.5 17H14.5C15.8807 17 17 15.8807 17 14.5V5.5ZM4 7H16V14.5C16 15.3284 15.3284 16 14.5 16H5.5C4.67157 16 4 15.3284 4 14.5V7ZM5.5 4H14.5C15.3284 4 16 4.67157 16 5.5V6H4V5.5C4 4.67157 4.67157 4 5.5 4Z"\n      fill="var(--invertColor)"\n    ></path>\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},5622:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-shoppable_video-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    fill="var(--invertColor)"\n    stroke-width="0"\n    viewBox="0 0 16 16"\n    height="1em"\n    width="1em"\n    xmlns="http://www.w3.org/2000/svg"\n  ><path\n      d="M8 1a2 2 0 0 0-2 2v2H5V3a3 3 0 1 1 6 0v2h-1V3a2 2 0 0 0-2-2zM5 5H3.36a1.5 1.5 0 0 0-1.483 1.277L.85 13.13A2.5 2.5 0 0 0 3.322 16h9.355a2.5 2.5 0 0 0 2.473-2.87l-1.028-6.853A1.5 1.5 0 0 0 12.64 5H11v1.5a.5.5 0 0 1-1 0V5H6v1.5a.5.5 0 0 1-1 0V5z"\n    ></path></svg>\n  <span>'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:15,column:8},end:{line:15,column:17}}}):o)+"</span>\n</div>"},useData:!0})},8666:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<button\n  type="submit"\n  class="sa-live-call-widget-lead-capture-form-submit-btn"\n>Submit</button>'},useData:!0})},9022:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-text_feedback-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="3 3 16 16"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M5 3C3.89543 3 3 3.89543 3 5V15C3 16.1046 3.89543 17 5 17H9.22047L9.43163 16.1553C9.44469 16.1031 9.45904 16.0513 9.47466 16H5C4.44772 16 4 15.5523 4 15V5C4 4.44772 4.44772 4 5 4H15C15.5523 4 16 4.44772 16 5V9.23163C16.3194 9.09477 16.6586 9.01856 17 9.00299V5C17 3.89543 16.1046 3 15 3H5ZM9.5 14H10.9427L11.9427 13H9.5C9.22386 13 9 13.2239 9 13.5C9 13.7761 9.22386 14 9.5 14ZM7.5 7.25C7.5 7.66421 7.16421 8 6.75 8C6.33579 8 6 7.66421 6 7.25C6 6.83579 6.33579 6.5 6.75 6.5C7.16421 6.5 7.5 6.83579 7.5 7.25ZM6.75 11C7.16421 11 7.5 10.6642 7.5 10.25C7.5 9.83579 7.16421 9.5 6.75 9.5C6.33579 9.5 6 9.83579 6 10.25C6 10.6642 6.33579 11 6.75 11ZM6.75 14C7.16421 14 7.5 13.6642 7.5 13.25C7.5 12.8358 7.16421 12.5 6.75 12.5C6.33579 12.5 6 12.8358 6 13.25C6 13.6642 6.33579 14 6.75 14ZM9.5 7C9.22386 7 9 7.22386 9 7.5C9 7.77614 9.22386 8 9.5 8H13.5C13.7761 8 14 7.77614 14 7.5C14 7.22386 13.7761 7 13.5 7H9.5ZM9.5 10C9.22386 10 9 10.2239 9 10.5C9 10.7761 9.22386 11 9.5 11H13.5C13.7761 11 14 10.7761 14 10.5C14 10.2239 13.7761 10 13.5 10H9.5ZM10.9798 15.3772L15.8092 10.5478C16.5395 9.81741 17.7237 9.81741 18.454 10.5478C19.1843 11.2781 19.1843 12.4622 18.454 13.1926L13.6246 18.022C13.343 18.3036 12.9902 18.5033 12.6039 18.5999L11.106 18.9744C10.4546 19.1372 9.86451 18.5472 10.0274 17.8958L10.4018 16.3979C10.4984 16.0116 10.6982 15.6588 10.9798 15.3772Z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},8095:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-text_message-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="2 2 16 16"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M10 2C14.4183 2 18 5.58172 18 10C18 14.4183 14.4183 18 10 18C8.72679 18 7.49591 17.7018 6.38669 17.1393L6.266 17.075L2.62109 17.9851C2.31127 18.0625 2.02622 17.8369 2.00131 17.5438L2.00114 17.4624L2.01493 17.3787L2.925 13.735L2.86169 13.6153C2.4066 12.7186 2.12433 11.7422 2.03275 10.7283L2.00738 10.3463L2 10C2 5.58172 5.58172 2 10 2ZM10 3C6.13401 3 3 6.13401 3 10C3 11.217 3.31054 12.3878 3.89352 13.4249C3.94046 13.5084 3.9621 13.603 3.95692 13.6973L3.94274 13.7912L3.187 16.812L6.21104 16.0583C6.27294 16.0429 6.33662 16.0396 6.39873 16.0479L6.4903 16.0691L6.57701 16.1075C7.61362 16.6898 8.7837 17 10 17C13.866 17 17 13.866 17 10C17 6.13401 13.866 3 10 3ZM10.5 11C10.7761 11 11 11.2239 11 11.5C11 11.7455 10.8231 11.9496 10.5899 11.9919L10.5 12H7.5C7.22386 12 7 11.7761 7 11.5C7 11.2545 7.17688 11.0504 7.41012 11.0081L7.5 11H10.5ZM12.5 8C12.7761 8 13 8.22386 13 8.5C13 8.74546 12.8231 8.94961 12.5899 8.99194L12.5 9H7.5C7.22386 9 7 8.77614 7 8.5C7 8.25454 7.17688 8.05039 7.41012 8.00806L7.5 8H12.5Z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},3378:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-video_call-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <div class="sa-live-call-widget-ball-scale-multiple">\n    <div></div>\n    <div></div>\n    <div></div>\n  </div>\n  <svg\n    stroke="var(--invertColor)"\n    fill="none"\n    stroke-width="1.5"\n    viewBox="0 0 24 24"\n    aria-hidden="true"\n    height="20"\n    width="20"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      stroke-linecap="round"\n      d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n    ></path>\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:26,column:4},end:{line:26,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},8617:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-video_feedback-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    stroke="var(--invertColor)"\n    fill="none"\n    stroke-width="1.5"\n    viewBox="0 0 24 24"\n    aria-hidden="true"\n    height="20"\n    width="20"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      stroke-linecap="round"\n      d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n    ></path>\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:21,column:4},end:{line:21,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},5761:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-video_message-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    stroke="var(--invertColor)"\n    fill="none"\n    stroke-width="1.5"\n    viewBox="0 0 24 24"\n    aria-hidden="true"\n    height="20"\n    width="20"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      stroke-linecap="round"\n      d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n    ></path>\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:21,column:4},end:{line:21,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},3209:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-voice_message-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="2 2 16 16"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      d="M10 13C11.6569 13 13 11.6568 13 9.99998V5C13 3.34315 11.6569 2 10 2C8.34315 2 7 3.34315 7 5V9.99998C7 11.6568 8.34315 13 10 13ZM10 12C8.89543 12 8 11.1046 8 9.99998V5C8 3.89543 8.89543 3 10 3C11.1046 3 12 3.89543 12 5V9.99998C12 11.1046 11.1046 12 10 12ZM5 9.49998C5.27614 9.49998 5.5 9.72384 5.5 9.99998C5.5 12.4853 7.51472 14.5 10 14.5C12.4853 14.5 14.5 12.4853 14.5 9.99998C14.5 9.72384 14.7239 9.49998 15 9.49998C15.2761 9.49998 15.5 9.72384 15.5 9.99998C15.5 12.869 13.3033 15.2249 10.5 15.4776V17.5C10.5 17.7761 10.2761 18 10 18C9.72386 18 9.5 17.7761 9.5 17.5V15.4776C6.69675 15.2249 4.5 12.869 4.5 9.99998C4.5 9.72384 4.72386 9.49998 5 9.49998Z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:18,column:4},end:{line:18,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},8310:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  id="sa-live-call-widget-whatsapp_message-btn"\n  class="sa-btn-cta-icon-box-expanded"\n>\n  <svg\n    width="20"\n    height="20"\n    viewBox="2 2.9 15.5 14.85"\n    fill="none"\n    xmlns="http://www.w3.org/2000/svg"\n  >\n    <path\n      fill-rule="evenodd"\n      clip-rule="evenodd"\n      d="M15.3358 4.69419C14.6428 3.99659 13.8182 3.44345 12.9099 3.06681C12.0015 2.69018 11.0275 2.49752 10.0442 2.50002C5.92083 2.50002 2.56417 5.85586 2.5625 9.98086C2.5625 11.2992 2.90667 12.5859 3.56083 13.7209L2.5 17.5967L6.46583 16.5559C7.56283 17.153 8.79183 17.4661 10.0408 17.4667H10.0442C14.1667 17.4667 17.5233 14.1109 17.525 9.98586C17.5278 9.00293 17.3358 8.02918 16.9601 7.12091C16.5843 6.21263 16.0323 5.38783 15.3358 4.69419ZM10.0442 16.2042H10.0417C8.92793 16.2043 7.83469 15.9047 6.87667 15.3367L6.65 15.2017L4.29667 15.8192L4.92417 13.525L4.77667 13.29C4.15399 12.2987 3.82436 11.1515 3.82583 9.98086C3.8275 6.55252 6.61667 3.76336 10.0467 3.76336C10.8635 3.76154 11.6727 3.92176 12.4272 4.23473C13.1818 4.54771 13.8667 5.00723 14.4425 5.58669C15.0213 6.16339 15.4802 6.8491 15.7924 7.60419C16.1047 8.35927 16.2641 9.16876 16.2617 9.98586C16.26 13.4142 13.4708 16.2042 10.0442 16.2042ZM13.455 11.5467C13.2675 11.4525 12.3492 11.0009 12.1775 10.9384C12.0067 10.8759 11.8825 10.845 11.7575 11.0317C11.6325 11.2184 11.2742 11.6392 11.165 11.7642C11.0558 11.8892 10.9467 11.9042 10.76 11.8109C10.5733 11.7175 9.97083 11.52 9.25667 10.8834C8.70083 10.3875 8.32583 9.77586 8.21667 9.58836C8.1075 9.40086 8.205 9.30002 8.29917 9.20669C8.38333 9.12336 8.48583 8.98836 8.57917 8.87919C8.6725 8.77002 8.70333 8.69252 8.76583 8.56752C8.82833 8.44252 8.7975 8.33336 8.75 8.24002C8.70333 8.14586 8.32917 7.22586 8.17333 6.85169C8.0225 6.48919 7.86833 6.53752 7.75333 6.53252C7.63423 6.52765 7.51503 6.52543 7.39583 6.52586C7.30105 6.52827 7.20778 6.55025 7.12188 6.5904C7.03599 6.63055 6.95931 6.68801 6.89667 6.75919C6.725 6.94669 6.2425 7.39836 6.2425 8.31836C6.2425 9.23836 6.9125 10.1275 7.00583 10.2525C7.09917 10.3775 8.32417 12.265 10.1992 13.075C10.6458 13.2675 10.9942 13.3825 11.265 13.4692C11.7125 13.6117 12.12 13.5909 12.4425 13.5434C12.8017 13.49 13.5483 13.0917 13.7042 12.655C13.86 12.2184 13.86 11.8442 13.8133 11.7659C13.7667 11.6875 13.6408 11.64 13.455 11.5467Z"\n      fill="var(--invertColor)"\n    />\n  </svg>\n  <span>\n    '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:20,column:4},end:{line:20,column:13}}}):o)+"\n  </span>\n</div>"},useData:!0})},6254:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div\n  class="sa-live-call-widget-lead-capture-form-media-permission-denied-overlay"\n>\n  <div\n    class="sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card"\n  >\n    <p\n      class="sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card-title"\n    >\n      <svg\n        stroke="currentColor"\n        fill="currentColor"\n        stroke-width="0"\n        viewBox="0 0 24 24"\n        height="1em"\n        width="1em"\n        xmlns="http://www.w3.org/2000/svg"\n        style="margin-right: 5px; font-size: 18px;"\n      >\n        <path fill="none" d="M0 0h24v24H0V0z"></path>\n        <path\n          d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"\n        ></path>\n      </svg>\n      You denied Permission:\n    </p>\n    <p>\n      We cannot place a call without access to microphone/camera.</p>\n    <img\n      src="https://d33v4339jhl8k0.cloudfront.net/docs/assets/543e7a20e4b046886e46282c/images/5e7b98c22c7d3a7e9ae9c5ff/file-po90FSIQT6.png"\n      alt="media-permission-denied"\n      class="sa-live-call-widget-lead-capture-form-media-permission-denied-overlay-card-image"\n    /></div>\n</div>'},useData:!0})},1587:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-ai-chat-container">\n  <div class="sa-ai-chat-header">\n    <div class="sa-ai-chat-header-title">Chat with us!</div>\n    <hr />\n    <div class="sa-ai-chat-header-content">\n      <span class="sa-ai-chat-chatbot-icon">\n        '+(null!=(o=typeof(a=null!=(a=d(n,"chatBotIcon")||(null!=t?d(t,"chatBotIcon"):t))?a:c)===l?a.call(s,{name:"chatBotIcon",hash:{},data:i,loc:{start:{line:7,column:8},end:{line:7,column:25}}}):a)?o:"")+'\n        <span class="sa-ai-chat-indicator"></span>\n      </span>\n      <div class="sa-ai-chat-chatbot-text">\n        <span>ChatBot</span>\n        <span>Support Agent</span>\n      </div>\n      <div class="sa-ai-chat-like-dislike">\n        '+(null!=(o=typeof(a=null!=(a=d(n,"chatLike")||(null!=t?d(t,"chatLike"):t))?a:c)===l?a.call(s,{name:"chatLike",hash:{},data:i,loc:{start:{line:15,column:8},end:{line:15,column:22}}}):a)?o:"")+"\n        "+(null!=(o=typeof(a=null!=(a=d(n,"chatDislike")||(null!=t?d(t,"chatDislike"):t))?a:c)===l?a.call(s,{name:"chatDislike",hash:{},data:i,loc:{start:{line:16,column:8},end:{line:16,column:25}}}):a)?o:"")+'\n      </div>\n    </div>\n  </div>\n\n  <div class="sa-ai-chat-log" id="saleassistAiChatLog">\n    \x3c!-- Chat messages will be displayed here --\x3e\n  </div>\n\n  <div class="sa-ai-chat-input-box">\n    <span class="sa-ai-chat-input-overlay">\n      '+(null!=(o=typeof(a=null!=(a=d(n,"threeDotsLoader")||(null!=t?d(t,"threeDotsLoader"):t))?a:c)===l?a.call(s,{name:"threeDotsLoader",hash:{},data:i,loc:{start:{line:27,column:6},end:{line:27,column:27}}}):a)?o:"")+'\n    </span>\n\n    <div class="sa-ai-chat-document-preview-container">\n      \x3c!-- Uploaded files will be displayed here --\x3e\n    </div>\n\n    <div class="sa-ai-chat-input-container">\n      <div class="sa-ai-chat-input-wrapper">\n        <input\n          type="text"\n          id="saleassistAiChatMessageInput"\n          placeholder="Type Your Message"\n        />\n        <label htmlFor="ai-chat-upload-file">\n          <span id="saleassistAiChatUploadButton">\n            '+(null!=(o=typeof(a=null!=(a=d(n,"uploadBtn")||(null!=t?d(t,"uploadBtn"):t))?a:c)===l?a.call(s,{name:"uploadBtn",hash:{},data:i,loc:{start:{line:43,column:12},end:{line:43,column:27}}}):a)?o:"")+'\n            <input\n              type="file"\n              id="ai-chat-upload-file"\n              style="display:none"\n              accept="*"\n              multiple\n            />\n          </span>\n        </label>\n      </div>\n      <button id="saleassistAiChatSendButton">\n        '+(null!=(o=typeof(a=null!=(a=d(n,"sendBtn")||(null!=t?d(t,"sendBtn"):t))?a:c)===l?a.call(s,{name:"sendBtn",hash:{},data:i,loc:{start:{line:55,column:8},end:{line:55,column:21}}}):a)?o:"")+"\n      </button>\n    </div>\n  </div>\n</div>"},useData:!0})},7685:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-default-container">\n  <div class="sa-live-call-widget-audio-message-page">\n    <p>\n      '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:4,column:6},end:{line:4,column:15}}}):o)+'\n    </p>\n    <div class="sa-live-call-widget-audio-message-preview-wrapper">\n      <img\n        src="https://client-static.saleassist.ai/74c28198-7762-40d3-8925-5cc00dc99e98/speaking-icon.png"\n        alt="speaking"\n        class="sa-live-call-widget-audio-message-speaking-icon"\n      />\n      <img\n        src="https://client-static.saleassist.ai/74c28198-7762-40d3-8925-5cc00dc99e98/audio-waves.png"\n        alt="audio-waves"\n        class="sa-live-call-widget-audio-message-waves"\n      />\n      <button class="sa-live-call-widget-audio-message-play-pause-btn"><svg\n          stroke="currentColor"\n          fill="currentColor"\n          stroke-width="0"\n          viewBox="0 0 16 16"\n          height="24"\n          width="24"\n          xmlns="http://www.w3.org/2000/svg"\n        ><path\n            d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"\n          ></path></svg>Play</button>\n    </div>\n    <div class="sa-live-call-widget-audio-message-controls-btn-wrapper">\n      <button\n        class="sa-live-call-widget-audio-message-start-stop-recording-btn"\n      >Start Recording</button>\n    </div>\n  </div>\n</div>'},useData:!0})},3525:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  class="sa-live-call-widget-thankyou-wrapper sa-live-call-widget-call-timeout-page"\n>\n  <div class="sa-live-call-widget-thankyou-container">\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-one"\n    >\n    </div>\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-two"\n    >\n    </div>\n    <svg\n      stroke="currentColor"\n      fill="currentColor"\n      stroke-width="0"\n      version="1"\n      viewBox="0 0 48 48"\n      enableBackground="new 0 0 48 48"\n      height="1em"\n      width="1em"\n      xmlns="http://www.w3.org/2000/svg"\n      style="font-size: 38px;"\n    ><g fill="#F44336"><polygon\n          points="30.3,12.9 24,19.2 15.7,10.9 12.9,13.7 24,24.8 33.1,15.7"\n        ></polygon><polygon points="36,19 27,10 36,10"></polygon></g><path\n        fill="#009688"\n        d="M44.5,30.8l-2.4-2.4c-8.5-8.3-28.9-7.1-36.2,0l-2.4,2.4c-0.7,0.7-0.7,1.7,0,2.4l4.8,4.7 c0.7,0.7,1.7,0.7,2.4,0l5.3-5.1l-0.4-5.6c1.7-1.7,15.1-1.7,16.8,0L32.1,33l5.1,4.9c0.7,0.7,1.7,0.7,2.4,0l4.8-4.7 C45.2,32.5,45.2,31.4,44.5,30.8z"\n      ></path></svg>\n    <h2 class="sa-live-call-widget-thank-you-title">We Missed You!</h2>\n    <p class="sa-live-call-widget-thank-you-message">'+l(typeof(o=null!=(o=d(n,"timeoutMessage")||(null!=t?d(t,"timeoutMessage"):t))?o:s)===c?o.call(a,{name:"timeoutMessage",hash:{},data:i,loc:{start:{line:31,column:53},end:{line:31,column:71}}}):o)+'</p>\n    <div style="padding-top: 48px;">\n      <p class="sa-live-call-widget-call-timeout-cta-text">'+l(typeof(o=null!=(o=d(n,"ctaText")||(null!=t?d(t,"ctaText"):t))?o:s)===c?o.call(a,{name:"ctaText",hash:{},data:i,loc:{start:{line:33,column:59},end:{line:33,column:70}}}):o)+'</p>\n      <div class="sa-live-call-widget-expanded-cta-btn-wrapper-2">\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0})},3903:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div\n  class="sa-live-call-widget-call-waiting-container sa-live-call-widget-call-waiting-container-'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"messageType")||(null!=t?a(t,"messageType"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"messageType",hash:{},data:i,loc:{start:{line:2,column:95},end:{line:2,column:110}}}):o)+'"\n>\n  <div class="sa-live-call-widget-call-waiting-wrapper">\n    <div class="sa-live-call-widget-call-waiting-title">\n      Hello! Welcome to our live video call.\n      <br />An agent will be joining now to assist you.\n    </div>\n    <div class="sa-live-call-widget-call-waiting-progress-bar"></div>\n    <div class="sa-live-call-widget-phone-ringing-animation-wrapper">\n      <div class="sa-live-call-widget-phone-ringing-animation-phone-icon">\n      </div>\n    </div>\n    <div class="sa-live-call-widget-call-waiting-messages-container"></div>\n  </div>\n</div>'},useData:!0})},8345:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-thankyou-wrapper">\n  <div\n    class="sa-live-call-widget-thankyou-container sa-live-call-widget-payment-request-page"\n  >\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-one"\n    ></div>\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-two"\n    ></div>\n    <h2 class="sa-live-call-widget-thank-you-title">Premium paid service</h2>\n    <p\n      class="sa-live-call-widget-thank-you-message sa-live-call-widget-payment-request-description"\n    >Please make a payment while we try to connect you.</p>\n    <button id="sa-live-call-widget-advance-payment-btn">Pay\n      '+l(typeof(o=null!=(o=d(n,"paymentCurrency")||(null!=t?d(t,"paymentCurrency"):t))?o:s)===c?o.call(a,{name:"paymentCurrency",hash:{},data:i,loc:{start:{line:16,column:6},end:{line:16,column:25}}}):o)+"\n      "+l(typeof(o=null!=(o=d(n,"paymentAmount")||(null!=t?d(t,"paymentAmount"):t))?o:s)===c?o.call(a,{name:"paymentAmount",hash:{},data:i,loc:{start:{line:17,column:6},end:{line:17,column:23}}}):o)+"</button>\n  </div>\n</div>"},useData:!0})},4582:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-default-container">\n  <div class="sa-live-call-widget-schedule-meeting-container">\n    <div class="sa-live-call-widget-schedule-meeting-title">\n      '+l(typeof(o=null!=(o=d(n,"title")||(null!=t?d(t,"title"):t))?o:s)===c?o.call(a,{name:"title",hash:{},data:i,loc:{start:{line:4,column:6},end:{line:4,column:15}}}):o)+'\n    </div>\n    <div class="sa-live-call-widget-schedule-meeting-caption">\n      '+l(typeof(o=null!=(o=d(n,"caption")||(null!=t?d(t,"caption"):t))?o:s)===c?o.call(a,{name:"caption",hash:{},data:i,loc:{start:{line:7,column:6},end:{line:7,column:17}}}):o)+"\n      <br />\n      <span>Timezone: "+l(typeof(o=null!=(o=d(n,"timeZone")||(null!=t?d(t,"timeZone"):t))?o:s)===c?o.call(a,{name:"timeZone",hash:{},data:i,loc:{start:{line:9,column:22},end:{line:9,column:34}}}):o)+'</span>\n    </div>\n    <div class="sa-live-call-widget-schedule-meeting-date-container"></div>\n    <div class="sa-live-call-widget-schedule-meeting-divider"></div>\n    <div class="sa-live-call-widget-schedule-meeting-time-container"></div>\n    <div class="sa-live-call-widget-schedule-meeting-divider"></div>\n    <div class="sa-live-call-widget-schedule-meeting-invite-friends-container">\n      <div\n        class="sa-live-call-widget-schedule-meeting-invite-friends-text"\n      >Invite Friends & Family</div>\n      <img\n        src="https://client-static.saleassist.ai/74c28198-7762-40d3-8925-5cc00dc99e98/invite-friends-family.jpeg"\n        alt="invite freinds & family"\n      />\n      <textarea\n        class="sa-live-call-widget-schedule-meeting-invite-friends-textarea"\n        placeholder="Enter emails, numbers by comma separated."\n      ></textarea>\n    </div>\n    <button class="sa-live-call-widget-schedule-meeting-confirm-btn">Confirm\n      Slot</button>\n  </div>\n</div>'},useData:!0})},8141:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-default-container">\n  <div class="sa-live-call-widget-text-message-page-container">\n    <p class="sa-live-call-widget-page-title">\n      '+l(typeof(o=null!=(o=d(n,"title")||(null!=t?d(t,"title"):t))?o:s)===c?o.call(a,{name:"title",hash:{},data:i,loc:{start:{line:4,column:6},end:{line:4,column:15}}}):o)+'\n    </p>\n    <textarea\n      placeholder="'+l(typeof(o=null!=(o=d(n,"placeholder")||(null!=t?d(t,"placeholder"):t))?o:s)===c?o.call(a,{name:"placeholder",hash:{},data:i,loc:{start:{line:7,column:19},end:{line:7,column:34}}}):o)+'"\n      class="sa-live-call-widget-audio-message-textarea"\n    ></textarea>\n    <button class="sa-live-call-widget-audio-message-submit-btn">Submit</button>\n  </div>\n</div>'},useData:!0})},8922:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({1:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <div class="sa-live-call-widget-scheduled-on-container">\n        <p class="sa-live-call-widget-scheduled-on-title">\n          SCHEDULED ON:\n          <span class="sa-live-call-widget-scheduled-on-date">\n            '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"scheduledTime")||(null!=t?a(t,"scheduledTime"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"scheduledTime",hash:{},data:i,loc:{start:{line:16,column:12},end:{line:16,column:29}}}):o)+'\n          </span>\n        </p>\n      </div>\n      <p class="sa-live-call-widget-schedule-mail-text">please check mail for\n        meeting details.</p>\n      <button class="sa-live-call-widget-thankyou-startover-btn schedule-meeting-startover-btn marginTop50 sa-live-call-widget-go-back-btn">\n        <svg\n          stroke="var(--invertColor)"\n          fill="var(--invertColor)"\n          stroke-width="0"\n          viewBox="0 0 448 512"\n          height="16"\n          width="16"\n          xmlns="http://www.w3.org/2000/svg"\n        ><path\n            d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"\n          ></path></svg>\n        <span>\n          Go back\n        </span>\n      </button>\n      <button id="sa-live-call-widget-share-meeting-btn" class="sa-live-call-widget-thankyou-startover-btn schedule-meeting-startover-btn">\n        <svg\n          stroke="var(--invertColor)"\n          fill="var(--invertColor)"\n          stroke-width="0"\n          viewBox="0 0 448 512"\n          height="16"\n          width="16"\n          xmlns="http://www.w3.org/2000/svg"\n        ><path\n            d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z"\n          ></path></svg>\n        <span>\n          Invite Friends\n        </span>\n      </button>\n      <div class="thankyou-share-text-container">\n        <p class="thankyou-share-text">\n          Invite Friends &\n          <span>Video</span>\n          <br />\n          <span>Shop</span>\n          with them together!\n        </p>\n        <img src="https://client-static.saleassist.ai/74c28198-7762-40d3-8925-5cc00dc99e98/shopping.png" alt="" />\n      </div>\n'},3:function(e,t,n,r,i){return'      <button class="sa-live-call-widget-thankyou-startover-btn marginTop50 sa-live-call-widget-go-back-btn">\n        <span>\n          Go back\n        </span>\n      </button>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.hooks.helperMissing,l="function",d=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-thankyou-wrapper">\n  <div class="sa-live-call-widget-thankyou-container">\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-one"\n    ></div>\n    <div\n      class="sa-live-call-widget-bubble sa-live-call-widget-bubble-position-two"\n    ></div>\n    <h2 class="sa-live-call-widget-thank-you-title">Thank You</h2>\n    <p class="sa-live-call-widget-thank-you-message">'+d(typeof(a=null!=(a=u(n,"defaultMessage")||(null!=t?u(t,"defaultMessage"):t))?a:c)===l?a.call(s,{name:"defaultMessage",hash:{},data:i,loc:{start:{line:10,column:53},end:{line:10,column:71}}}):a)+"<br /><span>"+d(typeof(a=null!=(a=u(n,"thankyouMessage")||(null!=t?u(t,"thankyouMessage"):t))?a:c)===l?a.call(s,{name:"thankyouMessage",hash:{},data:i,loc:{start:{line:10,column:83},end:{line:10,column:102}}}):a)+"</span></p>\n"+(null!=(o=u(n,"if").call(s,null!=t?u(t,"scheduleMeeting"):t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i,loc:{start:{line:11,column:4},end:{line:70,column:11}}}))?o:"")+"  </div>\n</div>"},useData:!0})},1223:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div id="saleassist-video-call-app"></div>'},useData:!0})},289:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-default-container">\n  <div class="sa-live-call-widget-video-message-page">\n    <p>\n      '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"title")||(null!=t?a(t,"title"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:4,column:6},end:{line:4,column:15}}}):o)+'\n    </p>\n    <div class="sa-live-call-widget-video-message-preview-wrapper">\n      <video class="sa-live-call-widget-video-message-preview"></video>\n      <div\n        class="sa-live-call-widget-video-message-toggle-recording-btn-wrapper"\n      >\n        <button\n          class="sa-live-call-widget-video-message-toggle-recording-btn sa-live-call-widget-video-message-toggle-video-recording-btn"\n        >\n          <svg\n            stroke="currentColor"\n            fill="currentColor"\n            stroke-width="0"\n            viewBox="0 0 576 512"\n            color="#fff"\n            height="24"\n            width="24"\n            xmlns="http://www.w3.org/2000/svg"\n            class="sa-live-call-widget-video-message-video-recording-icon"\n          ><path\n              d="M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"\n            ></path></svg>\n          <span>Video</span>\n        </button>\n        <button\n          class="sa-live-call-widget-video-message-toggle-recording-btn sa-live-call-widget-video-message-toggle-screen-recording-btn"\n        >\n          <svg\n            stroke="currentColor"\n            fill="currentColor"\n            stroke-width="0"\n            viewBox="0 0 24 24"\n            color="#fff"\n            height="24"\n            width="24"\n            xmlns="http://www.w3.org/2000/svg"\n            class="sa-live-call-widget-video-message-screen-recording-icon"\n          ><path fill="none" d="M0 0h24v24H0V0z"></path><path\n              d="M21 3H3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h18c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 16.02H3V4.98h18v14.04zM10 12H8l4-4 4 4h-2v4h-4v-4z"\n            ></path></svg>\n          <span>Screen</span>\n        </button>\n      </div>\n    </div>\n    <div class="sa-live-call-widget-video-message-controls-btn-wrapper">\n      <button\n        class="sa-live-call-widget-video-message-start-stop-recording-btn"\n      >Start Recording</button>\n    </div>\n  </div>\n</div>'},useData:!0})},6269:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div>\n  <p class="sa-live-call-widget-feedback-form-star-rating-title">How was your\n    experience with us?</p>\n  <div class="sa-live-call-widget-feedback-form-star-rating">\n    <div class="sa-live-call-widget-feedback-form-stars-wrapper">\n      <svg\n        class="sa-live-call-widget-feedback-form-star"\n        xmlns="http://www.w3.org/2000/svg"\n        width="24"\n        height="24"\n        viewBox="0 0 24 24"\n        data-star="1"\n      >\n        <polygon\n          points="12 2 14.61 7.68 20.49 8.78 16.42 12.72 17.54 18.61 12 16.34 6.46 18.61 7.58 12.72 3.51 8.78 9.39 7.68 12 2"\n          fill="transparent"\n        />\n      </svg>\n      <svg\n        class="sa-live-call-widget-feedback-form-star"\n        xmlns="http://www.w3.org/2000/svg"\n        width="24"\n        height="24"\n        viewBox="0 0 24 24"\n        data-star="2"\n      >\n        <polygon\n          points="12 2 14.61 7.68 20.49 8.78 16.42 12.72 17.54 18.61 12 16.34 6.46 18.61 7.58 12.72 3.51 8.78 9.39 7.68 12 2"\n          fill="transparent"\n        />\n      </svg><svg\n        class="sa-live-call-widget-feedback-form-star"\n        xmlns="http://www.w3.org/2000/svg"\n        width="24"\n        height="24"\n        viewBox="0 0 24 24"\n        data-star="3"\n      >\n        <polygon\n          points="12 2 14.61 7.68 20.49 8.78 16.42 12.72 17.54 18.61 12 16.34 6.46 18.61 7.58 12.72 3.51 8.78 9.39 7.68 12 2"\n          fill="transparent"\n        />\n      </svg><svg\n        class="sa-live-call-widget-feedback-form-star"\n        xmlns="http://www.w3.org/2000/svg"\n        width="24"\n        height="24"\n        viewBox="0 0 24 24"\n        data-star="4"\n      >\n        <polygon\n          points="12 2 14.61 7.68 20.49 8.78 16.42 12.72 17.54 18.61 12 16.34 6.46 18.61 7.58 12.72 3.51 8.78 9.39 7.68 12 2"\n          fill="transparent"\n        />\n      </svg><svg\n        class="sa-live-call-widget-feedback-form-star"\n        xmlns="http://www.w3.org/2000/svg"\n        width="24"\n        height="24"\n        viewBox="0 0 24 24"\n        data-star="5"\n      >\n        <polygon\n          points="12 2 14.61 7.68 20.49 8.78 16.42 12.72 17.54 18.61 12 16.34 6.46 18.61 7.58 12.72 3.51 8.78 9.39 7.68 12 2"\n          fill="transparent"\n        />\n      </svg>\n    </div>\n    <div class="sa-live-call-widget-feedback-form-star-description">\n      <p>Very poor</p>\n      <p>Very good</p>\n    </div>\n  </div>\n</div>'},useData:!0})},53:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div class="sa-live-call-widget-feedback-form-container">\n  <div class="sa-live-call-widget-form-header">\n    <p>Feedback</p>\n  </div>\n  <form id="sa-live-call-widget-feedback-form">\n    <div class="sa-live-call-widget-feedback-form-fields-container">\n      <div class="sa-live-call-widget-feedback-form-icon">\n        <svg\n          stroke="currentColor"\n          fill="currentColor"\n          stroke-width="0"\n          viewBox="0 0 24 24"\n          height="1em"\n          width="1em"\n          xmlns="http://www.w3.org/2000/svg"\n        ><path\n            d="M20 2H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h3v3.767L13.277 18H20c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zm0 14h-7.277L9 18.233V16H4V4h16v12z"\n          >\n          </path>\n          <path\n            d="m13.803 9.189-1.399-1.398-3.869 3.864v1.399h1.399zm.327-3.123 1.398 1.399-1.066 1.066-1.399-1.398z"\n          >\n          </path>\n        </svg>\n      </div>\n    </div>\n    <div class="sa-live-call-widget-feedback-form-submit-btn-wrapper">\n      <button\n        type="submit"\n        class="sa-live-call-widget-feedback-form-submit-btn"\n      >Submit</button>\n    </div>\n  </form>\n</div>'},useData:!0})},9004:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-lead-capture-form-container">\n  <div class="sa-live-call-widget-form-header">\n    <p>'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"conversationName")||(null!=t?a(t,"conversationName"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"conversationName",hash:{},data:i,loc:{start:{line:3,column:7},end:{line:3,column:27}}}):o)+'</p>\n  </div>\n  <form id="sa-live-call-widget-lead-capture-form">\n    <div class="sa-live-call-widget-lead-capture-form-fields-container">\n      <div class="sa-live-call-widget-lead-capture-form-icon">\n        <svg\n          stroke="currentColor"\n          fill="currentColor"\n          stroke-width="0"\n          viewBox="0 0 16 16"\n          height="1em"\n          width="1em"\n          xmlns="http://www.w3.org/2000/svg"\n        >\n          <path\n            d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"\n          ></path>\n        </svg>\n      </div>\n    </div>\n    <p class="sa-live-call-widget-required-field-error">Required fields can\'t be\n      empty.</p>\n    <div class="sa-live-call-widget-lead-capture-form-submit-btn-wrapper">\n      <button\n        type="submit"\n        class="sa-live-call-widget-lead-capture-form-submit-btn"\n      >Submit</button>\n    </div>\n  </form>\n</div>'},useData:!0})},9923:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({1:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <img id="sa-live-call-widget-hls-video" src="'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"sourceWelcomeVideo")||(null!=t?a(t,"sourceWelcomeVideo"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"sourceWelcomeVideo",hash:{},data:i,loc:{start:{line:2,column:47},end:{line:2,column:69}}}):o)+'" alt="" />\n'},3:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'  <video\n    id="sa-live-call-widget-hls-video"\n    src="'+l(typeof(o=null!=(o=d(n,"sourceWelcomeVideo")||(null!=t?d(t,"sourceWelcomeVideo"):t))?o:s)===c?o.call(a,{name:"sourceWelcomeVideo",hash:{},data:i,loc:{start:{line:7,column:9},end:{line:7,column:31}}}):o)+'"\n    loop\n    playsinline\n    '+l(typeof(o=null!=(o=d(n,"isMuted")||(null!=t?d(t,"isMuted"):t))?o:s)===c?o.call(a,{name:"isMuted",hash:{},data:i,loc:{start:{line:10,column:4},end:{line:10,column:15}}}):o)+"\n  ></video>\n"},5:function(e,t,n,r,i){return""},7:function(e,t,n,r,i){return'\n  <button class="sa-live-call-widget-mute-unmute-video-btn">\n    <svg\n      stroke="currentColor"\n      fill="none"\n      stroke-width="2"\n      viewBox="0 0 24 24"\n      aria-hidden="true"\n      height="22"\n      width="22"\n      xmlns="http://www.w3.org/2000/svg"\n      class="sa-live-call-widget-mute-icon"\n    ><path\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"\n      ></path></svg>\n    <svg\n      stroke="currentColor"\n      fill="none"\n      stroke-width="2"\n      viewBox="0 0 24 24"\n      aria-hidden="true"\n      height="22"\n      width="22"\n      xmlns="http://www.w3.org/2000/svg"\n      class="sa-live-call-widget-unmute-icon"\n    ><path\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"\n        clip-rule="evenodd"\n      ></path><path\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"\n      ></path></svg>\n  </button>\n  <button\n    class="sa-live-call-widget-play-video-btn sa-live-call-widget-d-hidden"\n  >\n    <svg\n      width="20"\n      height="20"\n      viewBox="0 0 20 23"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n      class="sa-live-call-widget-play-icon"\n    ><path\n        d="M18.7691 11.0709L1.62084 0.290562C1.52697 0.231639 1.41606 0.19634 1.30041 0.188579C1.18475 0.180818 1.06887 0.200898 0.965613 0.246592C0.862352 0.292286 0.775744 0.361811 0.715386 0.447459C0.655028 0.533106 0.62328 0.631531 0.623661 0.731824L0.623661 22.2925C0.623847 22.3926 0.655943 22.4908 0.716421 22.5761C0.776899 22.6614 0.863417 22.7307 0.966471 22.7763C1.06952 22.8219 1.18512 22.8421 1.30057 22.8346C1.41601 22.8271 1.52682 22.7922 1.62084 22.7338L18.7691 11.9467C18.8501 11.8971 18.9162 11.8315 18.9618 11.7553C19.0074 11.6791 19.0312 11.5946 19.0312 11.5088C19.0312 11.423 19.0074 11.3385 18.9618 11.2623C18.9162 11.1861 18.8501 11.1205 18.7691 11.0709Z"\n        fill="black"\n        fill-opacity="0.8"\n      ></path></svg>\n  </button>\n  <button\n    class="sa-live-call-widget-pause-video-btn sa-live-call-widget-d-hidden"\n  >\n    <svg\n      width="16"\n      height="16"\n      viewBox="0 0 20 20"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n      class="sa-live-call-widget-pause-icon"\n    ><path d="M0 0H7.5V20H0V0ZM12.5 0H20V20H12.5V0Z" fill="black"></path></svg>\n  </button>\n'},9:function(e,t,n,r,i){return'  <p class="sa-live-call-widget-intent-title"></p>\n'},11:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div\n      class="sa-live-call-widget-intent-container '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"verticalContainerClass")||(null!=t?a(t,"verticalContainerClass"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"verticalContainerClass",hash:{},data:i,loc:{start:{line:86,column:50},end:{line:86,column:76}}}):o)+'"\n    >\n      <div\n        class="sa-live-call-widget-intent-box sa-live-call-widget-intent-box-home"\n      >\n        <span class="sa-live-call-widget-intent-number">\n          <svg\n            stroke="currentColor"\n            fill="currentColor"\n            stroke-width="0"\n            viewBox="0 0 24 24"\n            height="1em"\n            width="1em"\n            xmlns="http://www.w3.org/2000/svg"\n          ><path\n              d="M3 13h1v7c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2v-7h1a1 1 0 0 0 .707-1.707l-9-9a.999.999 0 0 0-1.414 0l-9 9A1 1 0 0 0 3 13zm7 7v-5h4v5h-4zm2-15.586 6 6V15l.001 5H16v-5c0-1.103-.897-2-2-2h-4c-1.103 0-2 .897-2 2v5H6v-9.586l6-6z"\n            ></path></svg>\n        </span>\n        Home\n      </div>\n    </div>\n'},13:function(e,t,n,r,i){return'    <div>\n      <button\n        id="sa-live-call-widget-chat-first-approach-btn"\n        class="sa-live-call-widget-chat-first-approach-btn"\n      >\n        <svg\n          focusable="false"\n          width="20"\n          height="20"\n          viewBox="-3 -3 20 20"\n          xmlns="http://www.w3.org/2000/svg"\n          style="vertical-align: top;"\n        >\n          <g transform="translate(-24.000000, -12.000000)"><path\n              d="M25.4036262,27.3409362 C24.4176893,27.8509036 23.8195834,27.3951055 24.0683403,26.3201996 L25.0887779,21.910776 C25.2131242,21.3734618 25.7510472,20.8884231 26.3078778,20.8254187 L32.503417,20.1244045 C34.151155,19.9379658 34.1569707,19.6389088 32.503417,19.4549971 L26.3078778,18.7659164 C25.7589338,18.7048617 25.2129433,18.217839 25.0887779,17.6798715 L24.0683403,13.2586546 C23.8198614,12.1820783 24.408944,11.7182276 25.4036262,12.2327184 L38.22304,18.8634497 C39.208977,19.373417 39.2177223,20.1957141 38.22304,20.7102049 L25.4036262,27.3409362 Z"\n              fill="#ffffff"\n            ></path></g></svg>\n        Send us a message\n      </button>\n    </div>\n'},15:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <h5 style="color: white; padding-bottom: 10px">'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"ctaText")||(null!=t?a(t,"ctaText"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ctaText",hash:{},data:i,loc:{start:{line:131,column:51},end:{line:131,column:62}}}):o)+"</h5>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=s(n,"if").call(a,null!=t?s(t,"isWelcomeImage"):t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i,loc:{start:{line:1,column:0},end:{line:12,column:7}}}))?o:"")+(null!=(o=s(n,"if").call(a,null!=t?s(t,"isWelcomeImage"):t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i,loc:{start:{line:13,column:0},end:{line:79,column:7}}}))?o:"")+(null!=(o=s(n,"if").call(a,null!=t?s(t,"intents"):t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i,loc:{start:{line:80,column:0},end:{line:82,column:7}}}))?o:"")+'<div class="sa-live-call-widget-expanded-cta-btn-wrapper">\n'+(null!=(o=s(n,"if").call(a,null!=t?s(t,"intents"):t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i,loc:{start:{line:84,column:2},end:{line:107,column:9}}}))?o:"")+(null!=(o=s(n,"if").call(a,null!=t?s(t,"chatFirstApproach"):t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i,loc:{start:{line:108,column:2},end:{line:129,column:9}}}))?o:"")+(null!=(o=s(n,"if").call(a,null!=t?s(t,"ctaText"):t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i,loc:{start:{line:130,column:2},end:{line:132,column:9}}}))?o:"")+'  <div class="sa-live-call-widget-expanded-cta-btn-wrapper-2">\n  </div>\n</div>'},useData:!0})},8001:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({1:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="sa-live-call-widget-logo-wrapper">\n      <img src='+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"logo")||(null!=t?a(t,"logo"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"logo",hash:{},data:i,loc:{start:{line:4,column:15},end:{line:4,column:23}}}):o)+' alt="" class="sa-live-call-widget-logo" />\n    </div>\n'},3:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <img\n        id="sa-live-call-widget-hls-video"\n        src="'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"sourceWelcomeVideo")||(null!=t?a(t,"sourceWelcomeVideo"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"sourceWelcomeVideo",hash:{},data:i,loc:{start:{line:13,column:13},end:{line:13,column:35}}}):o)+'"\n        alt=""\n      />\n'},5:function(e,t,n,r,i){var o,a=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,c="function",l=e.escapeExpression,d=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'      <video\n        id="sa-live-call-widget-hls-video"\n        src="'+l(typeof(o=null!=(o=d(n,"sourceWelcomeVideo")||(null!=t?d(t,"sourceWelcomeVideo"):t))?o:s)===c?o.call(a,{name:"sourceWelcomeVideo",hash:{},data:i,loc:{start:{line:19,column:13},end:{line:19,column:35}}}):o)+'"\n        autoplay\n        loop\n        playsinline\n        '+l(typeof(o=null!=(o=d(n,"isMuted")||(null!=t?d(t,"isMuted"):t))?o:s)===c?o.call(a,{name:"isMuted",hash:{},data:i,loc:{start:{line:23,column:8},end:{line:23,column:19}}}):o)+"\n      ></video>\n"},7:function(e,t,n,r,i){return""},9:function(e,t,n,r,i){return'\n      <button class="sa-live-call-widget-mute-unmute-video-btn">\n        <svg\n          stroke="currentColor"\n          fill="none"\n          stroke-width="2"\n          viewBox="0 0 24 24"\n          aria-hidden="true"\n          height="22"\n          width="22"\n          xmlns="http://www.w3.org/2000/svg"\n          class="sa-live-call-widget-mute-icon"\n        ><path\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"\n          ></path></svg>\n        <svg\n          stroke="currentColor"\n          fill="none"\n          stroke-width="2"\n          viewBox="0 0 24 24"\n          aria-hidden="true"\n          height="22"\n          width="22"\n          xmlns="http://www.w3.org/2000/svg"\n          class="sa-live-call-widget-unmute-icon"\n        ><path\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"\n            clip-rule="evenodd"\n          ></path><path\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"\n          ></path></svg>\n      </button>\n      <button\n        class="sa-live-call-widget-play-video-btn sa-live-call-widget-d-hidden"\n      >\n        <svg\n          width="20"\n          height="20"\n          viewBox="0 0 20 23"\n          fill="none"\n          xmlns="http://www.w3.org/2000/svg"\n          class="sa-live-call-widget-play-icon"\n        ><path\n            d="M18.7691 11.0709L1.62084 0.290562C1.52697 0.231639 1.41606 0.19634 1.30041 0.188579C1.18475 0.180818 1.06887 0.200898 0.965613 0.246592C0.862352 0.292286 0.775744 0.361811 0.715386 0.447459C0.655028 0.533106 0.62328 0.631531 0.623661 0.731824L0.623661 22.2925C0.623847 22.3926 0.655943 22.4908 0.716421 22.5761C0.776899 22.6614 0.863417 22.7307 0.966471 22.7763C1.06952 22.8219 1.18512 22.8421 1.30057 22.8346C1.41601 22.8271 1.52682 22.7922 1.62084 22.7338L18.7691 11.9467C18.8501 11.8971 18.9162 11.8315 18.9618 11.7553C19.0074 11.6791 19.0312 11.5946 19.0312 11.5088C19.0312 11.423 19.0074 11.3385 18.9618 11.2623C18.9162 11.1861 18.8501 11.1205 18.7691 11.0709Z"\n            fill="black"\n            fill-opacity="0.8"\n          ></path></svg>\n      </button>\n      <button\n        class="sa-live-call-widget-pause-video-btn sa-live-call-widget-d-hidden"\n      >\n        <svg\n          width="16"\n          height="16"\n          viewBox="0 0 20 20"\n          fill="none"\n          xmlns="http://www.w3.org/2000/svg"\n          class="sa-live-call-widget-pause-icon"\n        ><path\n            d="M0 0H7.5V20H0V0ZM12.5 0H20V20H12.5V0Z"\n            fill="black"\n          ></path></svg>\n      </button>\n'},11:function(e,t,n,r,i){return'      <p class="sa-live-call-widget-intent-title"></p>\n'},13:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div\n          class="sa-live-call-widget-intent-container\n            '+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"verticalContainerClass")||(null!=t?a(t,"verticalContainerClass"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"verticalContainerClass",hash:{},data:i,loc:{start:{line:103,column:12},end:{line:103,column:38}}}):o)+'"\n        >\n          <div\n            class="sa-live-call-widget-intent-box sa-live-call-widget-intent-box-home"\n          >\n            <span class="sa-live-call-widget-intent-number">\n              <svg\n                stroke="currentColor"\n                fill="currentColor"\n                stroke-width="0"\n                viewBox="0 0 24 24"\n                height="1em"\n                width="1em"\n                xmlns="http://www.w3.org/2000/svg"\n              ><path\n                  d="M3 13h1v7c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2v-7h1a1 1 0 0 0 .707-1.707l-9-9a.999.999 0 0 0-1.414 0l-9 9A1 1 0 0 0 3 13zm7 7v-5h4v5h-4zm2-15.586 6 6V15l.001 5H16v-5c0-1.103-.897-2-2-2h-4c-1.103 0-2 .897-2 2v5H6v-9.586l6-6z"\n                ></path></svg>\n            </span>\n            Home\n          </div>\n        </div>\n'},15:function(e,t,n,r,i){return'        <div>\n          <button\n            id="sa-live-call-widget-chat-first-approach-btn"\n            class="sa-live-call-widget-chat-first-approach-btn"\n          >\n            <svg\n              focusable="false"\n              width="20"\n              height="20"\n              viewBox="-3 -3 20 20"\n              xmlns="http://www.w3.org/2000/svg"\n              style="vertical-align: top;"\n            >\n              <g transform="translate(-24.000000, -12.000000)"><path\n                  d="M25.4036262,27.3409362 C24.4176893,27.8509036 23.8195834,27.3951055 24.0683403,26.3201996 L25.0887779,21.910776 C25.2131242,21.3734618 25.7510472,20.8884231 26.3078778,20.8254187 L32.503417,20.1244045 C34.151155,19.9379658 34.1569707,19.6389088 32.503417,19.4549971 L26.3078778,18.7659164 C25.7589338,18.7048617 25.2129433,18.217839 25.0887779,17.6798715 L24.0683403,13.2586546 C23.8198614,12.1820783 24.408944,11.7182276 25.4036262,12.2327184 L38.22304,18.8634497 C39.208977,19.373417 39.2177223,20.1957141 38.22304,20.7102049 L25.4036262,27.3409362 Z"\n                  fill="#ffffff"\n                ></path></g></svg>\n            Send us a message\n          </button>\n        </div>\n'},17:function(e,t,n,r,i){var o,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <h5 style="color: white; padding-bottom: 10px">'+e.escapeExpression("function"==typeof(o=null!=(o=a(n,"ctaText")||(null!=t?a(t,"ctaText"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ctaText",hash:{},data:i,loc:{start:{line:148,column:55},end:{line:148,column:66}}}):o)+"</h5>\n"},19:function(e,t,n,r,i){return'    <a\n      href="https://www.saleassist.ai/"\n      target="_blank"\n      class="sa-live-call-widget-powered-by-strip"\n    >\n      <img\n        src="https://www.saleassist.ai/logo.png"\n        class="sa-live-call-widget-powered-by-strip-saleassist-logo"\n      />\n      Powered by&nbsp;\n      <span class="sa-live-call-widget-bold">SaleAssist.ai</span>\n    </a>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){var o,a,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="sa-live-call-widget-expanded">\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"logo"):t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i,loc:{start:{line:2,column:2},end:{line:6,column:9}}}))?o:"")+'  <div\n    class="sa-live-call-widget-expanded-inner-wrapper sa-live-call-widget-powered-by-'+e.escapeExpression("function"==typeof(a=null!=(a=c(n,"poweredBy")||(null!=t?c(t,"poweredBy"):t))?a:e.hooks.helperMissing)?a.call(s,{name:"poweredBy",hash:{},data:i,loc:{start:{line:8,column:85},end:{line:8,column:98}}}):a)+'"\n  >\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"isWelcomeImage"):t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i,loc:{start:{line:10,column:4},end:{line:25,column:11}}}))?o:"")+"    "+(null!=(o=c(n,"if").call(s,null!=t?c(t,"isWelcomeImage"):t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i,loc:{start:{line:26,column:4},end:{line:95,column:11}}}))?o:"")+(null!=(o=c(n,"if").call(s,null!=t?c(t,"intents"):t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i,loc:{start:{line:96,column:4},end:{line:98,column:11}}}))?o:"")+'    <div class="sa-live-call-widget-expanded-cta-btn-wrapper">\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"intents"):t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i,loc:{start:{line:100,column:6},end:{line:124,column:13}}}))?o:"")+(null!=(o=c(n,"if").call(s,null!=t?c(t,"chatFirstApproach"):t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i,loc:{start:{line:125,column:6},end:{line:146,column:13}}}))?o:"")+(null!=(o=c(n,"if").call(s,null!=t?c(t,"ctaText"):t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i,loc:{start:{line:147,column:6},end:{line:149,column:13}}}))?o:"")+'      <div class="sa-live-call-widget-expanded-cta-btn-wrapper-2">\n      </div>\n    </div>\n  </div>\n  <div class="sa-live-call-widget-close-expanded-widget-btn">\n    <svg\n      stroke="currentColor"\n      fill="currentColor"\n      stroke-width="0"\n      viewBox="0 0 24 24"\n      height="17"\n      width="17"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        fill="none"\n        stroke="currentColor"\n        stroke-width="3"\n        d="M3,3 L21,21 M3,21 L21,3"\n      ></path>\n    </svg>\n  </div>\n'+(null!=(o=c(n,"if").call(s,null!=t?c(t,"poweredBy"):t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i,loc:{start:{line:172,column:2},end:{line:185,column:9}}}))?o:"")+"</div>"},useData:!0})},3585:(e,t,n)=>{var r=n(202);e.exports=(r.default||r).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,r,i){return'<div class="sa-live-call-widget-loader-spinner">\n  <div class="sa-live-call-widget-loader-bounce1"></div>\n  <div class="sa-live-call-widget-loader-bounce2"></div>\n  <div class="sa-live-call-widget-loader-bounce3"></div>\n</div>'},useData:!0})},6834:(e,t,n)=>{"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var o=i(n(2067)),a=r(n(5558)),s=r(n(8728)),c=i(n(2392)),l=i(n(1628)),d=r(n(3982));function u(){var e=new o.HandlebarsEnvironment;return c.extend(e,o),e.SafeString=a.default,e.Exception=s.default,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=l,e.template=function(t){return l.template(t,e)},e}var p=u();p.create=u,d.default(p),p.default=p,t.default=p,e.exports=t.default},2067:(e,t,n)=>{"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.HandlebarsEnvironment=u;var i=n(2392),o=r(n(8728)),a=n(2638),s=n(881),c=r(n(8037)),l=n(6293);t.VERSION="4.7.7";t.COMPILER_REVISION=8;t.LAST_COMPATIBLE_COMPILER_REVISION=7;t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var d="[object Object]";function u(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},a.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}u.prototype={constructor:u,logger:c.default,log:c.default.log,registerHelper:function(e,t){if(i.toString.call(e)===d){if(t)throw new o.default("Arg not supported with multiple helpers");i.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(i.toString.call(e)===d)i.extend(this.partials,e);else{if(void 0===t)throw new o.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(i.toString.call(e)===d){if(t)throw new o.default("Arg not supported with multiple decorators");i.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){l.resetLoggedProperties()}};var p=c.default.log;t.log=p,t.createFrame=i.createFrame,t.logger=c.default},881:(e,t,n)=>{"use strict";t.__esModule=!0,t.registerDefaultDecorators=function(e){o.default(e)};var r,i=n(5670),o=(r=i)&&r.__esModule?r:{default:r}},5670:(e,t,n)=>{"use strict";t.__esModule=!0;var r=n(2392);t.default=function(e){e.registerDecorator("inline",(function(e,t,n,i){var o=e;return t.partials||(t.partials={},o=function(i,o){var a=n.partials;n.partials=r.extend({},a,t.partials);var s=e(i,o);return n.partials=a,s}),t.partials[i.args[0]]=i.fn,o}))},e.exports=t.default},8728:(e,t)=>{"use strict";t.__esModule=!0;var n=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function r(e,t){var i=t&&t.loc,o=void 0,a=void 0,s=void 0,c=void 0;i&&(o=i.start.line,a=i.end.line,s=i.start.column,c=i.end.column,e+=" - "+o+":"+s);for(var l=Error.prototype.constructor.call(this,e),d=0;d<n.length;d++)this[n[d]]=l[n[d]];Error.captureStackTrace&&Error.captureStackTrace(this,r);try{i&&(this.lineNumber=o,this.endLineNumber=a,Object.defineProperty?(Object.defineProperty(this,"column",{value:s,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=s,this.endColumn=c))}catch(e){}}r.prototype=new Error,t.default=r,e.exports=t.default},2638:(e,t,n)=>{"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.registerDefaultHelpers=function(e){i.default(e),o.default(e),a.default(e),s.default(e),c.default(e),l.default(e),d.default(e)},t.moveHelperToHooks=function(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])};var i=r(n(7342)),o=r(n(6822)),a=r(n(4905)),s=r(n(7405)),c=r(n(5702)),l=r(n(7593)),d=r(n(3978))},7342:(e,t,n)=>{"use strict";t.__esModule=!0;var r=n(2392);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,n){var i=n.inverse,o=n.fn;if(!0===t)return o(this);if(!1===t||null==t)return i(this);if(r.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):i(this);if(n.data&&n.ids){var a=r.createFrame(n.data);a.contextPath=r.appendContextPath(n.data.contextPath,n.name),n={data:a}}return o(t,n)}))},e.exports=t.default},6822:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(2392),o=n(8728),a=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new a.default("Must pass iterator to #each");var r,o=t.fn,s=t.inverse,c=0,l="",d=void 0,u=void 0;function p(t,n,r){d&&(d.key=t,d.index=n,d.first=0===n,d.last=!!r,u&&(d.contextPath=u+t)),l+=o(e[t],{data:d,blockParams:i.blockParams([e[t],t],[u+t,null])})}if(t.data&&t.ids&&(u=i.appendContextPath(t.data.contextPath,t.ids[0])+"."),i.isFunction(e)&&(e=e.call(this)),t.data&&(d=i.createFrame(t.data)),e&&"object"==typeof e)if(i.isArray(e))for(var h=e.length;c<h;c++)c in e&&p(c,c,c===e.length-1);else if(n.g.Symbol&&e[n.g.Symbol.iterator]){for(var f=[],m=e[n.g.Symbol.iterator](),g=m.next();!g.done;g=m.next())f.push(g.value);for(h=(e=f).length;c<h;c++)p(c,c,c===e.length-1)}else r=void 0,Object.keys(e).forEach((function(e){void 0!==r&&p(r,c-1),r=e,c++})),void 0!==r&&p(r,c-1,!0);return 0===c&&(l=s(this)),l}))},e.exports=t.default},4905:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(8728),o=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new o.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},7405:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(2392),o=n(8728),a=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new a.default("#if requires exactly one argument");return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,n){if(2!=arguments.length)throw new a.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}))},e.exports=t.default},5702:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],n=arguments[arguments.length-1],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var i=1;null!=n.hash.level?i=n.hash.level:n.data&&null!=n.data.level&&(i=n.data.level),t[0]=i,e.log.apply(e,t)}))},e.exports=t.default},7593:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,n){return e?n.lookupProperty(e,t):e}))},e.exports=t.default},3978:(e,t,n)=>{"use strict";t.__esModule=!0;var r,i=n(2392),o=n(8728),a=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new a.default("#with requires exactly one argument");i.isFunction(e)&&(e=e.call(this));var n=t.fn;if(i.isEmpty(e))return t.inverse(this);var r=t.data;return t.data&&t.ids&&((r=i.createFrame(t.data)).contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:r,blockParams:i.blockParams([e],[r&&r.contextPath])})}))},e.exports=t.default},8572:(e,t,n)=>{"use strict";t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.extend.apply(void 0,[Object.create(null)].concat(t))};var r=n(2392)},6293:(e,t,n)=>{"use strict";t.__esModule=!0,t.createProtoAccessControl=function(e){var t=Object.create(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var n=Object.create(null);return n.__proto__=!1,{properties:{whitelist:r.createNewLookupObject(n,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:r.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,n){return a("function"==typeof e?t.methods:t.properties,n)},t.resetLoggedProperties=function(){Object.keys(o).forEach((function(e){delete o[e]}))};var r=n(8572),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8037)),o=Object.create(null);function a(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==o[e]&&(o[e]=!0,i.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}},5005:(e,t)=>{"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){if("function"!=typeof e)return e;return function(){return arguments[arguments.length-1]=t(arguments[arguments.length-1]),e.apply(this,arguments)}}},8037:(e,t,n)=>{"use strict";t.__esModule=!0;var r=n(2392),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=r.indexOf(i.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=i.lookupLevel(e),"undefined"!=typeof console&&i.lookupLevel(i.level)<=e){var t=i.methodMap[e];console[t]||(t="log");for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];console[t].apply(console,r)}}};t.default=i,e.exports=t.default},3982:(e,t,n)=>{"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n.g?n.g:window,r=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=r),e}},e.exports=t.default},1628:(e,t,n)=>{"use strict";t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=s.COMPILER_REVISION;if(t>=s.LAST_COMPATIBLE_COMPILER_REVISION&&t<=s.COMPILER_REVISION)return;if(t<s.LAST_COMPATIBLE_COMPILER_REVISION){var r=s.REVISION_CHANGES[n],i=s.REVISION_CHANGES[t];throw new a.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+i+").")}throw new a.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")},t.template=function(e,t){if(!t)throw new a.default("No environment passed to template");if(!e||!e.main)throw new a.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n=e.compiler&&7===e.compiler[0];var r={strict:function(e,t,n){if(!e||!(t in e))throw new a.default('"'+t+'" not defined in '+e,{loc:n});return r.lookupProperty(e,t)},lookupProperty:function(e,t){var n=e[t];return null==n||Object.prototype.hasOwnProperty.call(e,t)||d.resultIsAllowed(n,r.protoAccessControl,t)?n:void 0},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++){if(null!=(e[i]&&r.lookupProperty(e[i],t)))return e[i][t]}},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:i.escapeExpression,invokePartial:function(n,r,o){o.hash&&(r=i.extend({},r,o.hash),o.ids&&(o.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,r,o);var s=i.extend({},o,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),c=t.VM.invokePartial.call(this,n,r,s);if(null==c&&t.compile&&(o.partials[o.name]=t.compile(n,e.compilerOptions,t),c=o.partials[o.name](r,s)),null!=c){if(o.indent){for(var l=c.split("\n"),d=0,u=l.length;d<u&&(l[d]||d+1!==u);d++)l[d]=o.indent+l[d];c=l.join("\n")}return c}throw new a.default("The partial "+o.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,i){var o=this.programs[e],a=this.fn(e);return t||i||r||n?o=u(this,e,a,t,n,r,i):o||(o=this.programs[e]=u(this,e,a)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=i.extend({},t,e)),n},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function o(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=n.data;o._setup(n),!n.partial&&e.useData&&(i=function(e,t){t&&"root"in t||((t=t?s.createFrame(t):{}).root=e);return t}(t,i));var a=void 0,c=e.useBlockParams?[]:void 0;function l(t){return""+e.main(r,t,r.helpers,r.partials,i,c,a)}return e.useDepths&&(a=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(l=h(e.main,l,r,n.depths||[],i,c))(t,n)}return o.isTop=!0,o._setup=function(o){if(o.partial)r.protoAccessControl=o.protoAccessControl,r.helpers=o.helpers,r.partials=o.partials,r.decorators=o.decorators,r.hooks=o.hooks;else{var a=i.extend({},t.helpers,o.helpers);!function(e,t){Object.keys(e).forEach((function(n){var r=e[n];e[n]=function(e,t){var n=t.lookupProperty;return l.wrapHelper(e,(function(e){return i.extend({lookupProperty:n},e)}))}(r,t)}))}(a,r),r.helpers=a,e.usePartial&&(r.partials=r.mergeIfNeeded(o.partials,t.partials)),(e.usePartial||e.useDecorators)&&(r.decorators=i.extend({},t.decorators,o.decorators)),r.hooks={},r.protoAccessControl=d.createProtoAccessControl(o);var s=o.allowCallsToHelperMissing||n;c.moveHelperToHooks(r,"helperMissing",s),c.moveHelperToHooks(r,"blockHelperMissing",s)}},o._child=function(t,n,i,o){if(e.useBlockParams&&!i)throw new a.default("must pass block params");if(e.useDepths&&!o)throw new a.default("must pass parent depths");return u(r,t,e[t],n,0,i,o)},o},t.wrapProgram=u,t.resolvePartial=function(e,t,n){e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name];return e},t.invokePartial=function(e,t,n){var r=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var o=void 0;n.fn&&n.fn!==p&&function(){n.data=s.createFrame(n.data);var e=n.fn;o=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=s.createFrame(n.data),n.data["partial-block"]=r,e(t,n)},e.partials&&(n.partials=i.extend({},n.partials,e.partials))}();void 0===e&&o&&(e=o);if(void 0===e)throw new a.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=p;var r,i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2392)),o=n(8728),a=(r=o)&&r.__esModule?r:{default:r},s=n(2067),c=n(2638),l=n(5005),d=n(6293);function u(e,t,n,r,i,o,a){function s(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=a;return!a||t==a[0]||t===e.nullContext&&null===a[0]||(s=[t].concat(a)),n(e,t,e.helpers,e.partials,i.data||r,o&&[i.blockParams].concat(o),s)}return(s=h(n,s,e,a,r,o)).program=t,s.depth=a?a.length:0,s.blockParams=i||0,s}function p(){return""}function h(e,t,n,r,o,a){if(e.decorator){var s={};t=e.decorator(t,s,n,r&&r[0],o,a,r),i.extend(t,s)}return t}},5558:(e,t)=>{"use strict";function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default},2392:(e,t)=>{"use strict";t.__esModule=!0,t.extend=a,t.indexOf=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}if(!i.test(e))return e;return e.replace(r,o)},t.isEmpty=function(e){return!e&&0!==e||!(!l(e)||0!==e.length)},t.createFrame=function(e){var t=a({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},r=/[&<>"'`=]/g,i=/[&<>"'`=]/;function o(e){return n[e]}function a(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var s=Object.prototype.toString;t.toString=s;var c=function(e){return"function"==typeof e};c(/x/)&&(t.isFunction=c=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),t.isFunction=c;var l=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};t.isArray=l},202:(e,t,n)=>{e.exports=n(6834).default},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var c=e[s],l=r.base?c[0]+r.base:c[0],d=o[l]||0,u="".concat(l," ").concat(d);o[l]=d+1;var p=n(u),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var f=i(h,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:f,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var c=r(e,i),l=0;l<o.length;l++){var d=n(o[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=c}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4778:e=>{"use strict";e.exports="data:image/svg+xml;charset=UTF-8, %3csvg stroke=%27%23fff%27 fill=%27none%27 stroke-width=%271.5%27 viewBox=%270 0 24 24%27 aria-hidden=%27true%27 height=%2720%27 width=%2720%27 xmlns=%27http://www.w3.org/2000/svg%27 %3e%3cpath stroke-linecap=%27round%27 d=%27M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z%27 %3e%3c/path%3e%3c/svg%3e"},5991:e=>{"use strict";e.exports="data:image/svg+xml;charset=UTF-8, %3csvg width=%2720%27 height=%2720%27 viewBox=%272 2 16 16%27 fill=%27none%27 xmlns=%27http://www.w3.org/2000/svg%27 %3e%3cpath d=%27M6.98706 2.06589L6.27036 2.28192C4.96684 2.67484 4.00944 3.78801 3.81598 5.13565C3.519 7.20438 4.18323 9.62242 5.78368 12.3945C7.38077 15.1607 9.13867 16.9433 11.0739 17.7231C12.3435 18.2346 13.7948 17.9592 14.7886 17.018L15.3314 16.5039C16.0589 15.815 16.1643 14.694 15.5781 13.8815L14.2215 12.0014C13.8458 11.4807 13.1805 11.2569 12.5665 11.4446L10.5158 12.0716L10.4628 12.082C10.2366 12.115 9.7154 11.6259 9.06527 10.4999C8.38512 9.32181 8.24417 8.63298 8.43194 8.45541L9.47529 7.48248C10.2572 6.75332 10.4882 5.60728 10.0499 4.63213L9.38841 3.16075C8.97652 2.24451 7.94888 1.77597 6.98706 2.06589ZM8.47634 3.57077L9.13779 5.04215C9.40063 5.62682 9.26212 6.31395 8.7933 6.75113L7.74739 7.72645C7.0783 8.35918 7.29992 9.44218 8.19924 10.9999C9.04545 12.4655 9.81744 13.1898 10.6469 13.0642L10.7713 13.0376L12.8589 12.4009C13.0635 12.3383 13.2853 12.413 13.4105 12.5865L14.7671 14.4666C15.0603 14.8729 15.0076 15.4334 14.6438 15.7778L14.101 16.2919C13.3911 16.9642 12.3545 17.1609 11.4476 16.7955C9.74957 16.1113 8.14475 14.484 6.64971 11.8945C5.15161 9.29969 4.54531 7.09254 4.80583 5.27775C4.94402 4.31515 5.62787 3.52003 6.55896 3.23937L7.27566 3.02334C7.75657 2.87838 8.27039 3.11265 8.47634 3.57077Z%27 fill=%27%23fff%27 %3e%3c/path%3e%3c/svg%3e"},8996:e=>{"use strict";e.exports="data:image/svg+xml;charset=utf8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 version=%271.1%27 height=%2710px%27 width=%2715px%27%3E%3Ctext x=%270%27 y=%2710%27 fill=%27gray%27%3E%E2%96%BE%3C/text%3E%3C/svg%3E"}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.b=document.baseURI||self.location.href,n.nc=void 0;var r={};return(()=>{"use strict";n.r(r);var e={};n.r(e),n.d(e,{Decoder:()=>qi,Encoder:()=>Wi,PacketType:()=>Hi,protocol:()=>Gi});var t="https://platform.saleassist.ai",i={saleassist:"#3684F2",primary:"#545cd8",secondary:"#6c757d",success:"#4BBF73",info:"#1F9BCF",warning:"#f0ad4e",danger:"#d9534f",focus:"#444054",alternate:"#83588a",light:"#f8f9fa",dark:"#495057",white:"#fff",text:"#6d6d6d",title:"#1f1f1f"},o={BASE:t,SOCKET_URL:"https://sockets.saleassist.ai",BILLING:t+"/billing",CLIENT_USER_MAPPINGS:t+"/client_user_mappings",CLIENTS:t+"/clients",CONSUMPTION_LOGS:t+"/consumption_logs",CONVERSATIONS:t+"/conversations",EVENTS:t+"/events",FORMS:t+"/forms",FORM:t+"/form",SOURCES:t+"/sources",SOURCE:t+"/source",EVENT:"https://platform.saleassist.ai",MEETING_TOKENS:t+"/meeting_tokens",MEETINGS:t+"/meetings",MISSED_CALLS:t+"/missed_calls",PAYMENT_PLANS:t+"/payment_plans",PAYMENTS:t+"/payments",STORAGE:t+"/storage",MEDIA:t+"/media",USERS:t+"/users",WEBHOOKS:t+"/webhooks",ACTIONS:t+"/actions"},a={nudge:"nudge",icon:"icon",video_icon:"video_icon",shoppable_video:"shoppable_video",share_button:"share_button",video_call_button:"video_call_button",audio_call_button:"audio_call_button",video_message_button:"video_message_button",voice_message_button:"voice_message_button",text_message_button:"text_message_button",ai_chat_button:"ai_chat_button",live_message_button:"live_message_button",whatsapp_message_button:"whatsapp_message_button",live_chat_button:"live_chat_button",schedule_meeting_button:"schedule_meeting_button",close_window:"close_window",call_to_action_link:"call_to_action_link",audio_feedback_button:"audio_feedback_button",video_feedback_button:"video_feedback_button",text_feedback_button:"text_feedback_button",form_feedback_button:"form_feedback_button",sound_alert_on:!0,widget_close_btn_sound_on:!0},s={url:o,clicked_on:a,colors:i,razorpay_key_id:t.startsWith("http://localhost:")?"rzp_test_6qMDYgeHkcDSNX":"rzp_live_lRWsGAT43CwVBu",razorpay_key_secret:"ktpf01IfB8d4PBBLYkXYDlpN"};function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(){l=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new I(i||[]);return r(a,"_invoke",{value:S(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h={};function f(){}function m(){}function g(){}var v={};d(v,o,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(O([])));E&&E!==t&&n.call(E,o)&&(v=E);var y=g.prototype=f.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(r,o,a,s){var l=p(e[r],e,o);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==c(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return i("throw",e,a,s)}))}s(l.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function S(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function T(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return m.prototype=g,r(y,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:m,configurable:!0}),m.displayName=d(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},w(b.prototype),d(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(y),d(y,s,"Generator"),d(y,o,(function(){return this})),d(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function d(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var u={get:function(e,t){return p.apply(this,arguments)},post:function(e,t,n){return new Promise((function(r,i){var o=e+t,a={method:"POST",headers:{"Content-Type":"application/json",referrer:window.location.href},body:JSON.stringify(n)};fetch(o,a).then(h).then((function(e){return r(e)})).catch((function(e){return i(e)}))}))}};function p(){var e;return e=l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=t+n,o={method:"GET",headers:{referrer:window.location.href}};fetch(i,o).then(h).then((function(t){return e(t)})).catch((function(e){return r(e)}))})));case 1:case"end":return e.stop()}}),e)})),p=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){d(o,r,i,a,s,"next",e)}function s(e){d(o,r,i,a,s,"throw",e)}a(void 0)}))},p.apply(this,arguments)}function h(e){return e.text().then((function(t){var n=t&&JSON.parse(t);if(!e.ok){var r=n&&n.message||e.statusText;return Promise.reject(r)}return n}))}var f=n(3379),m=n.n(f),g=n(7795),v=n.n(g),_=n(569),E=n.n(_),y=n(3565),w=n.n(y),b=n(9216),S=n.n(b),T=n(4589),C=n.n(T),R=n(7892),I={};I.styleTagTransform=C(),I.setAttributes=w(),I.insert=E().bind(null,"head"),I.domAPI=v(),I.insertStyleElement=S();m()(R.Z,I);R.Z&&R.Z.locals&&R.Z.locals;function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}var A=function(e){return"object"===O(e)&&null!==e&&!Array.isArray(e)};function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==N(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===N(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D={},x={},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A(e)?D=P(P({},D),e):console.error("Data is not an object.")},U=function(){return D},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A(e)?x=P(P({},x),e):console.error("Data is not an object.")},j=function(){return x},B=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelector("video#sa-live-call-widget-hls-video");n&&(t?n.play():n.pause())},F=function(e){return e?(e=e.replace(/_([a-z])/g,(function(e){return" "+e[1].toUpperCase()}))).charAt(0).toUpperCase()+e.slice(1):e},G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;try{var r={value:t,expiry:(new Date).getTime()+1e3*n*60*60};return window.localStorage.setItem(e,JSON.stringify(r)),t}catch(e){return null}},H=function(e){try{var t=window.localStorage.getItem(e);if(!t)return null;var n=JSON.parse(t);return(new Date).getTime()>n.expiry?(window.localStorage.removeItem(e),null):n.value}catch(e){return null}},W=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))};const K=[{name:"Afghanistan",code:"AF",dial_code:"+93"},{name:"Albania",code:"AL",dial_code:"+355"},{name:"Algeria",code:"DZ",dial_code:"+213"},{name:"Andorra",code:"AD",dial_code:"+376"},{name:"Angola",code:"AO",dial_code:"+244"},{name:"Antigua and Barbuda",code:"AG",dial_code:"+1268"},{name:"Argentina",code:"AR",dial_code:"+54"},{name:"Armenia",code:"AM",dial_code:"+374"},{name:"Aruba",code:"AW",dial_code:"+297"},{name:"Australia",code:"AU",dial_code:"+61"},{name:"Austria",code:"AT",dial_code:"+43"},{name:"Azerbaijan",code:"AZ",dial_code:"+994"},{name:"Bahamas",code:"BS",dial_code:"+1242"},{name:"Bahrain",code:"BH",dial_code:"+973"},{name:"Bangladesh",code:"BD",dial_code:"+880"},{name:"Barbados",code:"BB",dial_code:"+1246"},{name:"Belarus",code:"BY",dial_code:"+375"},{name:"Belgium",code:"BE",dial_code:"+32"},{name:"Belize",code:"BZ",dial_code:"+501"},{name:"Benin",code:"BJ",dial_code:"+229"},{name:"Bhutan",code:"BT",dial_code:"+975"},{name:"Bolivia",code:"BO",dial_code:"+591"},{name:"Bosnia and Herzegovina",code:"BA",dial_code:"+387"},{name:"Botswana",code:"BW",dial_code:"+267"},{name:"Brazil",code:"BR",dial_code:"+55"},{name:"British Indian Ocean Territory",code:"IO",dial_code:"+246"},{name:"Brunei",code:"BN",dial_code:"+673"},{name:"Bulgaria",code:"BG",dial_code:"+359"},{name:"Burkina Faso",code:"BF",dial_code:"+226"},{name:"Burundi",code:"BI",dial_code:"+257"},{name:"Cambodia",code:"KH",dial_code:"+855"},{name:"Cameroon",code:"CM",dial_code:"+237"},{name:"Canada",code:"CA",dial_code:"+1"},{name:"Cape Verde",code:"CV",dial_code:"+238"},{name:"Cayman Islands",code:"KY",dial_code:"+345"},{name:"Central African Republic",code:"CF",dial_code:"+236"},{name:"Chad",code:"TD",dial_code:"+235"},{name:"Chile",code:"CL",dial_code:"+56"},{name:"China",code:"CN",dial_code:"+86"},{name:"Colombia",code:"CO",dial_code:"+57"},{name:"Comoros",code:"KM",dial_code:"+269"},{name:"Congo",code:"CG",dial_code:"+242"},{name:"Congo, The Democratic Republic of the Congo",code:"CD",dial_code:"+243"},{name:"Cote d'Ivoire",code:"CI",dial_code:"+225"},{name:"Croatia",code:"HR",dial_code:"+385"},{name:"Cuba",code:"CU",dial_code:"+53"},{name:"Cyprus",code:"CY",dial_code:"+357"},{name:"Czech Republic",code:"CZ",dial_code:"+420"},{name:"Denmark",code:"DK",dial_code:"+45"},{name:"Djibouti",code:"DJ",dial_code:"+253"},{name:"Dominica",code:"DM",dial_code:"+1767"},{name:"Dominican Republic",code:"DO",dial_code:"+1849"},{name:"Ecuador",code:"EC",dial_code:"+593"},{name:"Egypt",code:"EG",dial_code:"+20"},{name:"El Salvador",code:"SV",dial_code:"+503"},{name:"Equatorial Guinea",code:"GQ",dial_code:"+240"},{name:"Eritrea",code:"ER",dial_code:"+291"},{name:"Estonia",code:"EE",dial_code:"+372"},{name:"Ethiopia",code:"ET",dial_code:"+251"},{name:"Falkland Islands (Malvinas)",code:"FK",dial_code:"+500"},{name:"Faroe Islands",code:"FO",dial_code:"+298"},{name:"Fiji",code:"FJ",dial_code:"+679"},{name:"Finland",code:"FI",dial_code:"+358"},{name:"France",code:"FR",dial_code:"+33"},{name:"French Guiana",code:"GF",dial_code:"+594"},{name:"French Polynesia",code:"PF",dial_code:"+689"},{name:"French Southern Territories",code:"TF",dial_code:"+262"},{name:"Gabon",code:"GA",dial_code:"+241"},{name:"Gambia",code:"GM",dial_code:"+220"},{name:"Georgia",code:"GE",dial_code:"+995"},{name:"Germany",code:"DE",dial_code:"+49"},{name:"Ghana",code:"GH",dial_code:"+233"},{name:"Gibraltar",code:"GI",dial_code:"+350"},{name:"Greece",code:"GR",dial_code:"+30"},{name:"Greenland",code:"GL",dial_code:"+299"},{name:"Grenada",code:"GD",dial_code:"+1473"},{name:"Guadeloupe",code:"GP",dial_code:"+590"},{name:"Guam",code:"GU",dial_code:"+1671"},{name:"Guatemala",code:"GT",dial_code:"+502"},{name:"Guinea",code:"GN",dial_code:"+224"},{name:"Guinea-Bissau",code:"GW",dial_code:"+245"},{name:"Guyana",code:"GY",dial_code:"+592"},{name:"Haiti",code:"HT",dial_code:"+509"},{name:"Heard Island and Mcdonald Islands",code:"HM",dial_code:"+672"},{name:"Hong Kong",code:"HK",dial_code:"+852"},{name:"Hungary",code:"HU",dial_code:"+36"},{name:"Iceland",code:"IS",dial_code:"+354"},{name:"India",code:"IN",dial_code:"+91"},{name:"Indonesia",code:"ID",dial_code:"+62"},{name:"Iran, Islamic Republic of Persian Gulf",code:"IR",dial_code:"+98"},{name:"Iraq",code:"IQ",dial_code:"+964"},{name:"Ireland",code:"IE",dial_code:"+353"},{name:"Isle of Man",code:"IM",dial_code:"+44"},{name:"Israel",code:"IL",dial_code:"+972"},{name:"Italy",code:"IT",dial_code:"+39"},{name:"Jamaica",code:"JM",dial_code:"+1876"},{name:"Japan",code:"JP",dial_code:"+81"},{name:"Jordan",code:"JO",dial_code:"+962"},{name:"Kazakhstan",code:"KZ",dial_code:"+7"},{name:"Kenya",code:"KE",dial_code:"+254"},{name:"Kiribati",code:"KI",dial_code:"+686"},{name:"Korea, Democratic People's Republic of Korea",code:"KP",dial_code:"+850"},{name:"Korea, Republic of South Korea",code:"KR",dial_code:"+82"},{name:"Kosovo",code:"XK",dial_code:"+383"},{name:"Kuwait",code:"KW",dial_code:"+965"},{name:"Kyrgyzstan",code:"KG",dial_code:"+996"},{name:"Laos",code:"LA",dial_code:"+856"},{name:"Latvia",code:"LV",dial_code:"+371"},{name:"Lebanon",code:"LB",dial_code:"+961"},{name:"Lesotho",code:"LS",dial_code:"+266"},{name:"Liberia",code:"LR",dial_code:"+231"},{name:"Libyan Arab Jamahiriya",code:"LY",dial_code:"+218"},{name:"Liechtenstein",code:"LI",dial_code:"+423"},{name:"Lithuania",code:"LT",dial_code:"+370"},{name:"Luxembourg",code:"LU",dial_code:"+352"},{name:"Macao",code:"MO",dial_code:"+853"},{name:"Macedonia",code:"MK",dial_code:"+389"},{name:"Madagascar",code:"MG",dial_code:"+261"},{name:"Malawi",code:"MW",dial_code:"+265"},{name:"Malaysia",code:"MY",dial_code:"+60"},{name:"Maldives",code:"MV",dial_code:"+960"},{name:"Mali",code:"ML",dial_code:"+223"},{name:"Malta",code:"MT",dial_code:"+356"},{name:"Marshall Islands",code:"MH",dial_code:"+692"},{name:"Martinique",code:"MQ",dial_code:"+596"},{name:"Mauritania",code:"MR",dial_code:"+222"},{name:"Mauritius",code:"MU",dial_code:"+230"},{name:"Mexico",code:"MX",dial_code:"+52"},{name:"Moldova",code:"MD",dial_code:"+373"},{name:"Monaco",code:"MC",dial_code:"+377"},{name:"Mongolia",code:"MN",dial_code:"+976"},{name:"Montenegro",code:"ME",dial_code:"+382"},{name:"Montserrat",code:"MS",dial_code:"+1664"},{name:"Morocco",code:"MA",dial_code:"+212"},{name:"Mozambique",code:"MZ",dial_code:"+258"},{name:"Myanmar",code:"MM",dial_code:"+95"},{name:"Namibia",code:"NA",dial_code:"+264"},{name:"Nauru",code:"NR",dial_code:"+674"},{name:"Nepal",code:"NP",dial_code:"+977"},{name:"Netherlands",code:"NL",dial_code:"+31"},{name:"New Zealand",code:"NZ",dial_code:"+64"},{name:"Nicaragua",code:"NI",dial_code:"+505"},{name:"Niger",code:"NE",dial_code:"+227"},{name:"Nigeria",code:"NG",dial_code:"+234"},{name:"Niue",code:"NU",dial_code:"+683"},{name:"Norfolk Island",code:"NF",dial_code:"+672"},{name:"Norway",code:"NO",dial_code:"+47"},{name:"Oman",code:"OM",dial_code:"+968"},{name:"Pakistan",code:"PK",dial_code:"+92"},{name:"Palau",code:"PW",dial_code:"+680"},{name:"Palestinian Territory, Occupied",code:"PS",dial_code:"+970"},{name:"Panama",code:"PA",dial_code:"+507"},{name:"Papua New Guinea",code:"PG",dial_code:"+675"},{name:"Paraguay",code:"PY",dial_code:"+595"},{name:"Peru",code:"PE",dial_code:"+51"},{name:"Philippines",code:"PH",dial_code:"+63"},{name:"Pitcairn",code:"PN",dial_code:"+64"},{name:"Poland",code:"PL",dial_code:"+48"},{name:"Portugal",code:"PT",dial_code:"+351"},{name:"Puerto Rico",code:"PR",dial_code:"+1939"},{name:"Qatar",code:"QA",dial_code:"+974"},{name:"Romania",code:"RO",dial_code:"+40"},{name:"Russia",code:"RU",dial_code:"+7"},{name:"Rwanda",code:"RW",dial_code:"+250"},{name:"Reunion",code:"RE",dial_code:"+262"},{name:"Saint Barthelemy",code:"BL",dial_code:"+590"},{name:"Saint Helena, Ascension and Tristan Da Cunha",code:"SH",dial_code:"+290"},{name:"San Marino",code:"SM",dial_code:"+378"},{name:"Sao Tome and Principe",code:"ST",dial_code:"+239"},{name:"Saudi Arabia",code:"SA",dial_code:"+966"},{name:"Senegal",code:"SN",dial_code:"+221"},{name:"Seychelles",code:"SC",dial_code:"+248"},{name:"Sierra Leone",code:"SL",dial_code:"+232"},{name:"Singapore",code:"SG",dial_code:"+65"},{name:"Slovakia",code:"SK",dial_code:"+421"},{name:"Slovenia",code:"SI",dial_code:"+386"},{name:"Solomon Islands",code:"SB",dial_code:"+677"},{name:"Somalia",code:"SO",dial_code:"+252"},{name:"South Africa",code:"ZA",dial_code:"+27"},{name:"South Sudan",code:"SS",dial_code:"+211"},{name:"South Georgia and the South Sandwich Islands",code:"GS",dial_code:"+500"},{name:"Sudan",code:"SD",dial_code:"+249"},{name:"Suriname",code:"SR",dial_code:"+597"},{name:"Svalbard and Jan Mayen",code:"SJ",dial_code:"+47"},{name:"Swaziland",code:"SZ",dial_code:"+268"},{name:"Sweden",code:"SE",dial_code:"+46"},{name:"Syrian Arab Republic",code:"SY",dial_code:"+963"},{name:"Taiwan",code:"TW",dial_code:"+886"},{name:"Tajikistan",code:"TJ",dial_code:"+992"},{name:"Tanzania, United Republic of Tanzania",code:"TZ",dial_code:"+255"},{name:"Thailand",code:"TH",dial_code:"+66"},{name:"Timor-Leste",code:"TL",dial_code:"+670"},{name:"Togo",code:"TG",dial_code:"+228"},{name:"Tokelau",code:"TK",dial_code:"+690"},{name:"Tonga",code:"TO",dial_code:"+676"},{name:"Trinidad and Tobago",code:"TT",dial_code:"+1868"},{name:"Tunisia",code:"TN",dial_code:"+216"},{name:"Turkey",code:"TR",dial_code:"+90"},{name:"Turkmenistan",code:"TM",dial_code:"+993"},{name:"Turks and Caicos Islands",code:"TC",dial_code:"+1649"},{name:"Tuvalu",code:"TV",dial_code:"+688"},{name:"Uganda",code:"UG",dial_code:"+256"},{name:"Ukraine",code:"UA",dial_code:"+380"},{name:"United Arab Emirates",code:"AE",dial_code:"+971"},{name:"United Kingdom",code:"GB",dial_code:"+44"},{name:"United States",code:"US",dial_code:"+1"},{name:"Uruguay",code:"UY",dial_code:"+598"},{name:"Uzbekistan",code:"UZ",dial_code:"+998"},{name:"Vanuatu",code:"VU",dial_code:"+678"},{name:"Venezuela, Bolivarian Republic of Venezuela",code:"VE",dial_code:"+58"},{name:"Vietnam",code:"VN",dial_code:"+84"},{name:"Virgin Islands, British",code:"VG",dial_code:"+1284"},{name:"Virgin Islands, U.S.",code:"VI",dial_code:"+1340"},{name:"Wallis and Futuna",code:"WF",dial_code:"+681"},{name:"Zimbabwe",code:"ZW",dial_code:"+263"}];var q=function(e){var t="",n="";K.forEach((function(e){n+="<li\n      data-country-code=".concat(e.code,"\n      data-country-dial-code=").concat(e.dial_code,'\n      class="sa-live-call-widget-country"\n    >\n      ').concat(e.name," ").concat(e.dial_code,"\n    </li>")}));return e.forEach((function(e){if(e.name){if("text"===e.type&&(t+='<div\n          class="sa-live-call-widget-lead-capture-form-group"\n          id='.concat("mobile_number"===e.name?"input-field-number":"",'\n        >\n          <label\n            for="').concat(e.name,'"\n            class="sa-live-call-widget-lead-capture-form-field-label"\n          >\n            ').concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"","</span\n            >\n          </label>\n          ").concat(function(e){return"mobile_number"===e.name?'<div\n          class="sa-live-call-widget-mobile-number-input-wrapper"\n        >\n          <div class="sa-live-call-widget-selected-country-wrapper">\n            <p class="sa-live-call-widget-selected-country">+91</p>\n            <div class="sa-live-call-widget-select-country-arrow"></div>\n          </div>\n          <input\n            type="number"\n            id="'.concat(e.name,'"\n            name="').concat(e.name,'"\n            value="').concat(e.value||"",'"\n            placeholder="').concat(e.placeholder?e.placeholder:"",'"\n            ').concat(e.required?" required ":" ",'\n            class="sa-live-call-widget-lead-capture-form-field sa-live-call-widget-mobile-number-input"\n          />\n        </div>\n        <ul\n          class="sa-live-call-widget-country-list sa-live-call-widget-d-hidden"\n        >\n          ').concat(n,"\n        </ul> "):'<input\n        type="'.concat(e.subtype?e.subtype:e.type,'"\n        id="').concat(e.name,'"\n        name="').concat(e.name,'"\n        value="').concat(e.value||"",'"\n        maxlength="').concat(e.maxlength||"",'"\n        placeholder="').concat(e.placeholder?e.placeholder:"",'"\n        ').concat(e.required?" required ":" ",'\n        class="sa-live-call-widget-lead-capture-form-field"\n        }\n      />')}(e),"\n        </div>")),"number"===e.type&&(t+='<div\n          class="sa-live-call-widget-lead-capture-form-group"\n        >\n          <label\n            for="'.concat(e.name,'"\n            class="sa-live-call-widget-lead-capture-form-field-label"\n          >\n            ').concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"",'</span\n            >\n          </label>\n          <input\n            type="').concat(e.type,'"\n            id="').concat(e.name,'"\n            name="').concat(e.name,'"\n            value="').concat(e.value,'"\n            min="').concat(e.min||"",'"\n            max="').concat(e.max||"",'"\n            step="').concat(e.step||"",'"\n            placeholder="').concat(e.placeholder?e.placeholder:"",'"\n            ').concat(e.required?" required ":" ",'\n            class="sa-live-call-widget-lead-capture-form-field"\n          />\n        </div>')),"textarea"===e.type&&(t+='<div class="sa-live-call-widget-lead-capture-form-group">\n          <label\n            for="'.concat(e.name,'"\n            class="sa-live-call-widget-lead-capture-form-field-label"\n          >\n            ').concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"",'</span\n            >\n          </label>\n          <textarea\n            id="').concat(e.name,'"\n            name="').concat(e.name,'"\n            placeholder="').concat(e.placeholder?e.placeholder:"",'"\n            rows="').concat(e.rows||"",'"\n            maxlength="').concat(e.maxlength||"",'"\n            ').concat(e.required?" required ":" ",'\n            class="sa-live-call-widget-lead-capture-form-field"\n          >\n').concat(e.value||"","</textarea\n          >\n        </div>")),"select"===e.type){var r,i="";null===(r=e.values)||void 0===r||r.map((function(e){i+='<option value="'.concat(e.value,'">\n            ').concat(e.label,"\n          </option>")})),t+='<div class="sa-live-call-widget-lead-capture-form-group">\n          <label\n            for="'.concat(e.name,'"\n            class="sa-live-call-widget-lead-capture-form-field-label"\n          >\n            ').concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"",'</span\n            >\n          </label>\n          <select\n            name="').concat(e.name,'"\n            id="').concat(e.name,'"\n            ').concat(e.required?" required ":" ","\n            ").concat(e.multiple?" multiple ":" ",'\n            class="sa-live-call-widget-lead-capture-form-field"\n          >\n            ').concat(i,"\n          </select>\n        </div>")}if("radio-group"===e.type){var o,a="";null===(o=e.values)||void 0===o||o.map((function(t){a+='<div>\n            <input\n              type="radio"\n              id="'.concat(t.value,'"\n              name="').concat(e.name,'"\n              value="').concat(t.value,'"\n              ').concat(t.selected?"checked":"",'\n              class="sa-live-call-widget-lead-capture-form-field-radio"\n            />\n            <label for="').concat(t.value,'">').concat(t.label,"</label>\n          </div>")})),t+='<div class="sa-live-call-widget-lead-capture-form-group">\n          <p class="sa-live-call-widget-lead-capture-form-field-label">\n            '.concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"",'</span\n            >\n          </p>\n          <div\n            class="sa-live-call-widget-lead-capture-form-radio-fields-wrapper"\n          >\n            ').concat(a,"\n          </div>\n        </div>")}if("checkbox-group"===e.type){var s,c="";null===(s=e.values)||void 0===s||s.map((function(t){c+='<div\n            class="sa-live-call-widget-lead-capture-form-checkbox-wrapper"\n          >\n            <input\n              type="checkbox"\n              id="checkbox-'.concat(t.value,'"\n              name="').concat(e.name,'"\n              value="').concat(t.value,'"\n              ').concat(t.selected?"checked":"",'\n              class="sa-live-call-widget-lead-capture-form-field-checkbox"\n            />\n            <label\n              class="sa-live-call-widget-lead-capture-form-checkbox-field-label"\n              for="checkbox-').concat(t.value,'"\n              >').concat(t.label,"</label\n            >\n          </div>")})),t+='<div class="sa-live-call-widget-lead-capture-form-group">\n          <p\n            class="sa-live-call-widget-lead-capture-form-field-label"\n          >\n            '.concat(e.label,'<span class="sa-form-input-required"\n              >').concat(e.required?" *":"","</span\n            >\n          </p>\n         ").concat(c,"\n        </div>")}}"paragraph"===e.type&&(t+='<div class="sa-live-call-widget-lead-capture-form-group">\n        <p class="sa-live-call-widget-lead-capture-form-field-label">\n          '.concat(e.label,"\n        </p>\n      </div>"))})),t},Y=function(){var e=document.querySelector(".sa-live-call-widget-slider"),t=e.querySelector(".sa-live-call-widget-slider-track"),n=e.querySelectorAll(".sa-live-call-widget-slide"),r=e.querySelector(".sa-live-call-widget-slider-nav.prev"),i=e.querySelector(".sa-live-call-widget-slider-nav.next"),o=n[0].offsetWidth,a=3,s=0,c=o+10;r.addEventListener("click",(function(e){e.preventDefault(),s=Math.max(s-1,0),u()})),i.addEventListener("click",(function(e){e.preventDefault(),s=Math.min(s+1,n.length-a),u()})),e.addEventListener("touchstart",(function(e){l=e.touches[0].clientX}),!1),e.addEventListener("touchmove",(function(e){d=e.touches[0].clientX}),!1),e.addEventListener("touchend",(function(){l-d>50?s=Math.min(s+1,n.length-a):d-l>50&&(s=Math.max(s-1,0));u()}),!1);var l=0,d=0;function u(){var e=-s*c;t.style.transform="translateX("+e+"px)"}window.addEventListener("resize",(function(){o=n[0].offsetWidth,c=o+10,s=Math.min(s,n.length-a),u()})),u()};function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function J(){J=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==z(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function X(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){X(o,r,i,a,s,"next",e)}function s(e){X(o,r,i,a,s,"throw",e)}a(void 0)}))}}var Z=n(8922),$=n(4582),ee=n(3585),te=function(){var e=Q(J().mark((function e(t,n){var r,i,o,a,c,l,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",i="",o=[],a=Intl.DateTimeFormat().resolvedOptions().timeZone,e.next=6,u.get(s.url.SOURCE,"/".concat(n,"/get_available_slots/").concat(H("form_data").form_id,"/schedule?timezone=").concat(a));case 6:c=e.sent,l="",r=Object.keys(c)[0],i=c[r][0],Object.keys(c).map((function(e,t){var n=new Date(e);l+="<div\n                  data-key=".concat(t,"\n                  id=").concat(e,' \n                  class="sa-live-call-widget-slide ').concat(r==e?"sa-live-call-widget-slide-active":"",'"\n                >\n                  <div class="sa-live-call-widget-slide-content">\n                    <p>').concat(n.toString().split(" ")[0],"</p>\n                    <h1>").concat(n.toString().split(" ")[2],"</h1>\n                  </div>\n                </div>")})),t.innerHTML=$({title:"Schedule Meeting",caption:"When would you like to take this call?",timeZone:a}),document.querySelector(".sa-live-call-widget-schedule-meeting-date-container").innerHTML='<div class="sa-live-call-widget-slider">\n    <div class="sa-live-call-widget-slider-wrapper">\n      <div class="sa-live-call-widget-slider-track">\n        '.concat(l,'\n      </div>\n    </div>\n    <button class="sa-live-call-widget-slider-nav prev">\n      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" data-role="none" class="slick-arrow slick-prev slick-disabled" currentSlide="0" slideCount="15" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="display: block;"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg>\n    </button>\n    <button class="sa-live-call-widget-slider-nav next">\n      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" data-role="none" class="slick-arrow slick-next" currentSlide="0" slideCount="15" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="display: block;"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"></path></svg>\n    </button>\n  </div>'),Y(),d=function(e,t){document.querySelector(".sa-live-call-widget-schedule-meeting-time-container").innerHTML='<label\n        class="sa-live-call-widget-time-custom-select-label"\n        >Available Slots</label\n      >\n      <select\n        id="sa-schedule-meeting-custom-select"\n        class="sa-live-call-widget-time-custom-select"\n        name="time-slots"\n      >\n        '.concat(e[t].map((function(e){return'<option value="'.concat(e,'">').concat(e,"</option>")})),"\n      </select>"),document.getElementById("sa-schedule-meeting-custom-select").addEventListener("change",(function(e){i=e.target.value}))},d(c,r),document.querySelectorAll(".sa-live-call-widget-slide").forEach((function(e){e.addEventListener("click",(function(){document.getElementById(r).classList.remove("sa-live-call-widget-slide-active"),r=e.id,e.classList.add("sa-live-call-widget-slide-active"),d(c,r)}))})),document.querySelector(".sa-live-call-widget-schedule-meeting-invite-friends-textarea").addEventListener("change",(function(e){o=e.target.value.split(",").map((function(e){return e.trim()}))})),document.querySelector(".sa-live-call-widget-schedule-meeting-confirm-btn").addEventListener("click",function(){var e=Q(J().mark((function e(c){var l,d,p,h,f,m,g,v,_;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.target.disabled=!0,c.target.innerHTML=ee({}),c.target.style.cursor="not-allowed",e.prev=3,e.next=6,u.post(s.url.SOURCE,"/".concat(n,"/schedule_meeting_v2"),{meta:[{message:""}],timezone:a,date:r,time:i,invite_friends:o,form_id:H("form_data").form_id,session_id:H("form_data").session_id,people_id:H("form_data").people_id,unique_field_value:H("form_data").unique_field_value,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href});case 6:(l=e.sent)&&(f=(null===(d=l.meta[0])||void 0===d?void 0:d.date)||0,m=new Date(f),g={weekday:"short",month:"short",day:"numeric"},v=m.toLocaleDateString("en-US",g),V({message:"Your meeting has been scheduled.",scheduled_on_date:v,scheduled_on_time:(null===(p=l.meta[0])||void 0===p?void 0:p.time)||"",meeting_id:l.meeting_id,widgetName:"thankyouMessage"}),_="".concat(v," | ").concat((null===(h=l.meta[0])||void 0===h?void 0:h.time)||""),t.innerHTML=Z({scheduleMeeting:!0,defaultMessage:U().message,thankyouMessage:U().thankyou_message,scheduledTime:_}),lc(),document.getElementById("sa-live-call-widget-share-meeting-btn").addEventListener("click",(function(){var e="Your friend has invited you for group shopping on ".concat(_),t="".concat(s.url.ACTIONS,"/join_meeting/").concat(U().meeting_id,"/ask");window.open("https://api.whatsapp.com/send?text=".concat(e," ").concat(encodeURIComponent(t)),"_blank","noopener")}))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("time out");case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}());case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ne=n(8424),re=n.n(ne),ie=n(471),oe={};oe.styleTagTransform=C(),oe.setAttributes=w(),oe.insert=E().bind(null,"head"),oe.domAPI=v(),oe.insertStyleElement=S();m()(ie.Z,oe);ie.Z&&ie.Z.locals&&ie.Z.locals;function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function se(){se=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ae(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ce(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function le(e,t){return de.apply(this,arguments)}function de(){var e;return e=se().mark((function e(t,n){var r,i;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"!==t){e.next=5;break}return r=this.videoInputDevices.find((function(e){return e.label===n})),e.next=4,this.localVideoTrack.setDevice(r.deviceId);case 4:(r.label.toLowerCase().includes("back")||r.label.toLowerCase().includes("rear"))&&(document.querySelector("#localVideoContainer video").style.transform="rotateY(0deg)");case 5:if("audio"!==t){e.next=9;break}return i=this.audioInputDevices.find((function(e){return e.label===n})),e.next=9,this.localAudioTrack.setDevice(i.deviceId);case 9:case"end":return e.stop()}}),e,this)})),de=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ce(o,r,i,a,s,"next",e)}function s(e){ce(o,r,i,a,s,"throw",e)}a(void 0)}))},de.apply(this,arguments)}var ue=function(e){var t=document.getElementById("inputDeviceSettings");if("open"===e){var n=document.querySelector(".saleassist-video-call-more-options-control");t.style.display="flex",n.classList.remove("more-options-control-active")}"close"===e&&(t.style.display="none")};function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function he(){he=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==pe(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function fe(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function me(e){return ge.apply(this,arguments)}function ge(){var e;return e=he().mark((function e(t){var n,r=this;return he().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.videoInputDevices.length>1)){e.next=5;break}return this.videoInputDevices[0].label===this.localVideoTrack._deviceName?this.videoInputDevices.map((function(e,i){(e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear"))&&(n=r.videoInputDevices[i],t.selectedIndex=i)})):(n=this.videoInputDevices[0],t.selectedIndex=0),e.next=4,this.localVideoTrack.setDevice(n.deviceId);case 4:(n.label.toLowerCase().includes("back")||n.label.toLowerCase().includes("rear"))&&(document.querySelector("#localVideoContainer video").style.transform="rotateY(0deg)");case 5:case"end":return e.stop()}}),e,this)})),ge=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){fe(o,r,i,a,s,"next",e)}function s(e){fe(o,r,i,a,s,"throw",e)}a(void 0)}))},ge.apply(this,arguments)}function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function _e(){_e=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ve(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ee(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function ye(e){return we.apply(this,arguments)}function we(){var e;return e=_e().mark((function e(t){var n,r,i,o;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"video_call"!==this.message_type){e.next=9;break}return e.next=4,t.getCameras();case 4:this.videoInputDevices=e.sent,n=document.getElementById("videoInputDeviceSetting"),r="",this.videoInputDevices.map((function(e){r+='<option value="'.concat(e.label,'">').concat(e.label.length>24?e.label.slice(0,21)+"...":e.label,"</option>")})),n.innerHTML+="<select>".concat(r,"</select>");case 9:return this.videoInputDevices&&this.videoInputDevices.length>1&&(document.getElementById("flipCamera").style.display="flex"),e.next=12,t.getMicrophones();case 12:this.audioInputDevices=e.sent,i=document.getElementById("audioInputDeviceSetting"),o="",this.audioInputDevices.map((function(e){o+='<option value="'.concat(e.label,'">').concat(e.label.length>24?e.label.slice(0,21)+"...":e.label,"</option>")})),i.innerHTML+="<select>".concat(o,"</select>"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0);case 22:case"end":return e.stop()}}),e,this,[[0,19]])})),we=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ee(o,r,i,a,s,"next",e)}function s(e){Ee(o,r,i,a,s,"throw",e)}a(void 0)}))},we.apply(this,arguments)}var be=n(6240);function Se(e){var t,n,r=document.getElementById("videoCallContainer");"NotAllowedError"===e&&(t="Your camera and microphone are blocked",n='Meet requires access to your camera and microphone. Click the camera blocked icon <img alt="" aria-hidden="true" style="width:1.5rem;height:1.5rem;vertical-align:middle" src="//www.gstatic.com/meet/ic_blocked_camera_7ca83311f629f64699401950ceaed61e.svg">  in your browser\'s address bar and then refresh.'),"NotReadableError"===e&&(t="Something is worng with your camera or microphone",n="Meet is unable to access your camera or microphone, but you will be still able to join the call.");var i=document.createElement("div");i.innerHTML=be({headerText:t,bodyText:n}),r.appendChild(i),i.querySelector(".sa-device-access-error-dismiss-btn").addEventListener("click",(function(){r.removeChild(i)}))}function Te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Re=function(e){if(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(e)){var t=Te(e.split("@"),2),n=t[0];t[1];return n}if(/^\+?\d{1,3}[-.\s]?\d{1,14}$/.test(e)){var r=e.match(/\d/g).slice(-4).join("");return e.replace(r,"***")}return e};function Ie(e){var t=document.getElementById("videoCallMainScreen"),n=document.querySelector("#videoCallMainScreen div"),r=document.querySelectorAll("#videoCallVideoTiles .video-call-wrapper"),i=document.getElementById("videoCallVideoTiles");e.id!==n.id&&r.forEach((function(r){r.id===e.id&&(i.appendChild(n),t.appendChild(r))}))}function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function Ae(){Ae=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Oe(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ne(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Le(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ne(o,r,i,a,s,"next",e)}function s(e){Ne(o,r,i,a,s,"throw",e)}a(void 0)}))}}var Pe=n(5494),ke=n(8958),De=n(2025);function xe(e){return Me.apply(this,arguments)}function Me(){return Me=Le(Ae().mark((function e(t){var n,r,i,o,a,c,l,d,p=this;return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.client.on("user-published",function(){var e=Le(Ae().mark((function e(t,n){return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.client.subscribe(t,n);case 2:"video"===n&&t.videoTrack.play("remoteVideo_".concat(t.uid)),"audio"===n&&(t.audioTrack.play(),document.querySelector("#remoteVideo_".concat(t.uid," .mic-status-indicator")).innerHTML=Pe());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.client.on("user-joined",function(){var e=Le(Ae().mark((function e(t){var n,r,i,o;return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.get(s.url.ACTIONS,"/meeting/".concat(p.copy_url_id));case 2:n=e.sent,r=Re(n.uid_map[t.uid].user_display_name),p.remoteUsers[t.uid]=t,document.getElementById("remoteVideo_".concat(t.uid))||((i=document.createElement("div")).id="remoteVideo_".concat(t.uid),i.className="video-call-wrapper",i.setAttribute("user-name",r[0].toUpperCase()),i.addEventListener("click",(function(){Ie(i)})),(o=document.createElement("span")).className="mic-status-indicator",o.setAttribute("user-name",r),o.innerHTML=ke(),i.appendChild(o),document.getElementById("videoCallVideoTiles").appendChild(i),Ie(i));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.client.on("user-left",(function(e){var t=e.uid;delete p.remoteUsers[t];var n=document.getElementById("remoteVideo_".concat(e.uid));if(n){n.remove();var r=document.querySelectorAll("#videoCallVideoTiles .video-call-wrapper"),i=document.querySelectorAll("#videoCallMainScreen .video-call-wrapper"),o=document.getElementById("videoCallMainScreen");r.length>0&&0===i.length&&o.appendChild(r[0])}})),this.client.on("user-unpublished",function(){var e=Le(Ae().mark((function e(t,n){return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"audio"===n&&(document.querySelector("#remoteVideo_".concat(t.uid," .mic-status-indicator")).innerHTML=ke());case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=7,this.client.join(this.agoraAppId,this.agoraChannelName,this.agoraToken,this.agoraUID);case 7:return e.next=9,t.createMicrophoneAudioTrack({encoderConfig:"music_standard"});case 9:if(this.localAudioTrack=e.sent,"video_call"!==this.message_type){e.next=19;break}return e.next=13,t.createCameraVideoTrack();case 13:return this.localVideoTrack=e.sent,this.localVideoTrack.play("localVideoContainer"),e.next=17,this.localVideoTrack.setMuted(!0);case 17:return e.next=19,this.client.publish([this.localAudioTrack,this.localVideoTrack]);case 19:if("audio_call"!==this.message_type){e.next=22;break}return e.next=22,this.client.publish([this.localAudioTrack]);case 22:(n=document.getElementById("localVideoContainer")).addEventListener("click",(function(){Ie(n)})),(r=document.querySelector(".videoCallVideoTilesToggleBtn")).addEventListener("click",(function(){var e,t;e=r,t=document.getElementById("videoCallVideoTiles"),e.classList.toggle("transform-videoCallVideoTilesToggleBtn"),t.classList.toggle("video-call-video-tiles-transition-expand")})),e.next=49;break;case 28:if(e.prev=28,e.t0=e.catch(0),!e.t0.message.includes("NotReadableError")){e.next=48;break}return e.next=33,this.client.publish([this.localAudioTrack]);case 33:return e.next=35,this.localAudioTrack.setMuted(!0);case 35:i=document.getElementById("toggleCamera"),o=document.getElementById("toggleAudio"),a=document.querySelector("#localVideoContainer .mic-status-indicator"),this.localVideoTrackMuted=!0,this.localAudioTrackMuted=!0,i.style.background="#eb271e",o.style.background="#eb271e",i.innerHTML=De(),o.innerHTML=ke(),a.innerHTML=ke(),Se("NotReadableError"),e.next=49;break;case 48:e.t0.message.includes("NotAllowedError")?(c=document.getElementById("toggleCamera"),l=document.getElementById("toggleAudio"),d=document.querySelector("#localVideoContainer .mic-status-indicator"),this.localVideoTrackMuted=!0,this.localAudioTrackMuted=!0,c.style.background="#eb271e",l.style.background="#eb271e",c.innerHTML=De(),l.innerHTML=ke(),d.innerHTML=ke(),Se("NotAllowedError")):console.error("Failed to join the channel:",e.t0.message);case 49:case"end":return e.stop()}}),e,this,[[0,28]])}))),Me.apply(this,arguments)}function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function Ve(){Ve=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Ue(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Ue(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ue(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function He(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ge(o,r,i,a,s,"next",e)}function s(e){Ge(o,r,i,a,s,"throw",e)}a(void 0)}))}}var We=n(53),Ke=n(6269),qe=n(3585),Ye=n(8922),ze=function(){var e=U().id,t="string"==typeof U().feedback_form?JSON.parse(U().feedback_form):[],n=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper");n.innerHTML=We({logo:U().source_image_url});var r=document.getElementById("sa-live-call-widget-feedback-form"),i=document.querySelector(".sa-live-call-widget-feedback-form-fields-container");if(U().custom_feedback_form){i.insertAdjacentHTML("afterbegin",q(t));var o=document.querySelector(".sa-live-call-widget-lead-capture-form-radio-fields-wrapper");o&&(o.style.cssText="display: flex; gap: 12px"),r.addEventListener("submit",function(){var t=He(Ve().mark((function t(i){var o,a,c,l,d,p,h;return Ve().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.preventDefault(),(o=document.querySelector(".sa-live-call-widget-feedback-form-submit-btn")).innerHTML=qe({}),o.style.cursor="not-allowed",a=r.querySelectorAll(".sa-live-call-widget-lead-capture-form-field"),c=r.querySelectorAll(".sa-live-call-widget-lead-capture-form-field-radio"),l=r.querySelectorAll(".sa-live-call-widget-lead-capture-form-field-checkbox"),d={},a.forEach((function(e){if("select"===e.tagName.toLocaleLowerCase()){var t=Array.from(e.querySelectorAll("option:checked"),(function(e){return e.value}));d[e.name]=t}else d[e.name]=e.value})),p=function(e){var t=[];e.forEach((function(e){e.checked&&t.push(e.value)})),d[e[0].getAttribute("name")]=t},c.length&&p(c),l.length&&p(l),t.next=14,u.post(s.url.SOURCE,"/".concat(e,"/form"),Be(Be({},H("form_data")),{},{collection_id:e,relates_to_collection:"sources",data:d}));case 14:if(!(h=t.sent)){t.next=22;break}return t.next=18,u.post(s.url.SOURCE,"/".concat(e,"/conversation"),Be({meeting_id:j().meeting_id,message_content:h.id,message_from:H("form_data").people_id,message_type:"feedback_form",meta:[d],source_id:e,source_name:U().name,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href,source_type:U().source_type},H("form_data")));case 18:t.sent,V({message:"Your feedback has been received",widgetName:"thankyouMessage"}),n.innerHTML=Ye({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc();case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else{i.insertAdjacentHTML("afterbegin",Ke({}));var a=null,c=document.querySelectorAll(".sa-live-call-widget-feedback-form-star");c.forEach((function(e,t){e.addEventListener("mouseover",(function(){c.forEach((function(e,n){var r=e.querySelector("polygon");n<=t||r.classList.contains("filled-star")?e.style.stroke="#ff9800":e.style.stroke="#aaa"}))}))})),c.forEach((function(e){e.addEventListener("mouseout",(function(){c.forEach((function(e){e.querySelector("polygon").classList.contains("filled-star")?e.style.stroke="#ff9800":e.style.stroke="#aaa"}))}))})),c.forEach((function(e,t){e.addEventListener("click",(function(){a=e.getAttribute("data-star"),c.forEach((function(e,n){if(n<=t){var r=e.querySelector("polygon");r.removeAttribute("class"),r.classList.add("filled-star"),e.style.stroke="#ff9800"}else{var i=e.querySelector("polygon");i.removeAttribute("class"),i.classList.add("unfilled-star"),e.style.stroke="#aaa"}}))}))})),r.addEventListener("submit",function(){var t=He(Ve().mark((function t(r){var i,o;return Ve().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.preventDefault(),(i=document.querySelector(".sa-live-call-widget-feedback-form-submit-btn")).innerHTML=qe({}),i.style.cursor="not-allowed",t.next=6,u.post(s.url.SOURCE,"/".concat(e,"/form"),Be(Be({},H("form_data")),{},{collection_id:e,relates_to_collection:"sources",data:{star_rating:a}}));case 6:if(!(o=t.sent)){t.next=14;break}return t.next=10,u.post(s.url.SOURCE,"/".concat(e,"/conversation"),Be({meeting_id:j().meeting_id,message_content:o.id,message_from:H("form_data").people_id,message_type:"feedback_form",meta:[{star_rating:a}],source_id:e,source_name:U().name,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href,source_type:U().source_type},H("form_data")));case 10:t.sent,V({message:"Your feedback has been received",widgetName:"thankyouMessage"}),n.innerHTML=Ye({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}};function Je(e,t,n){try{var r=new Date;r.setTime(r.getTime()+60*n*60*1e3);var i="expires="+r.toUTCString();document.cookie=e+"="+JSON.stringify(t)+";"+i+";path=/;SameSite=Strict;Secure"}catch(e){return null}}function Xe(e){try{for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return JSON.parse(i.substring(t.length,i.length))}}catch(e){}return""}function Qe(e){return""!==Xe(e)}function Ze(e){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ze(e)}function $e(){$e=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Ze(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function et(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function tt(){return nt.apply(this,arguments)}function nt(){var e;return e=$e().mark((function e(){var t;return $e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.localVideoTrack&&"video_call"===this.message_type&&(this.localVideoTrack.stop(),this.localVideoTrack.close()),this.localAudioTrack&&(this.localAudioTrack.stop(),this.localAudioTrack.close()),this.localScreenTrack&&(this.localScreenTrack.stop(),this.localScreenTrack.close()),this.remoteUsers={},!this.localVideoTrack||!this.localAudioTrack||"video_call"!==this.message_type){e.next=8;break}return e.next=8,this.client.unpublish([this.localAudioTrack,this.localVideoTrack]);case 8:if(!this.localAudioTrack||"audio_call"!==this.message_type){e.next=11;break}return e.next=11,this.client.unpublish([this.localAudioTrack]);case 11:return e.next=13,this.client.leave();case 13:Je("widget_call","",1),this.socket.disconnect(),"function"==typeof window.stopCoBrowsing&&window.stopCoBrowsing(),null==(t=document.querySelector(".sa-live-call-widget-expanded"))||t.classList.remove("sa-live-call-widget-expanded-maximize"),ze(),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("Failed to leave the channel:",e.t0);case 24:case"end":return e.stop()}}),e,this,[[0,21]])})),nt=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){et(o,r,i,a,s,"next",e)}function s(e){et(o,r,i,a,s,"throw",e)}a(void 0)}))},nt.apply(this,arguments)}var rt=n(9346),it=n(5321),ot=function(e){var t=document.querySelector(".call-recording-indication");if("record_started"===e){var n=document.querySelector(".call-recording-indication-popup");n.classList.add("call-recording-indication-popup-show"),setTimeout((function(){n.classList.remove("call-recording-indication-popup-show"),t.style.display="flex"}),5e3)}"record_ended"===e&&(t.style.display="none")};function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function st(){st=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==at(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ct(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function lt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ct(o,r,i,a,s,"next",e)}function s(e){ct(o,r,i,a,s,"throw",e)}a(void 0)}))}}var dt=n(710),ut=n(9847);function pt(e,t){return ht.apply(this,arguments)}function ht(){return(ht=lt(st().mark((function e(t,n){var r,i=this;return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=document.getElementById("localUserPlaceholder"),0!=this.isSharingEnabled){e.next=19;break}return e.next=5,t.createScreenVideoTrack();case 5:if(this.localScreenTrack=e.sent,"video_call"!==this.message_type){e.next=10;break}return e.next=9,this.client.unpublish(this.localVideoTrack);case 9:this.localVideoTrack.stop();case 10:return r.style.display="none",this.localScreenTrack.play("localVideoContainer"),this.localScreenTrack.on("track-ended",lt(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.client.unpublish(i.localScreenTrack);case 2:if(i.localScreenTrack.close(),"video_call"!==i.message_type){e.next=7;break}return i.localVideoTrack.play("localVideoContainer"),e.next=7,i.client.publish(i.localVideoTrack);case 7:i.localVideoTrack.getMediaStreamTrack().enabled?r.style.display="none":r.style.display="flex",n.innerHTML=dt(),i.isSharingEnabled=!1;case 10:case"end":return e.stop()}}),e)})))),e.next=15,this.client.publish(this.localScreenTrack);case 15:n.innerHTML=ut(),this.isSharingEnabled=!0,e.next=29;break;case 19:return e.next=21,this.client.unpublish(this.localScreenTrack);case 21:if(this.localScreenTrack.close(),"video_call"!==this.message_type){e.next=26;break}return this.localVideoTrack.play("localVideoContainer"),e.next=26,this.client.publish(this.localVideoTrack);case 26:this.localVideoTrack.getMediaStreamTrack().enabled?r.style.display="none":r.style.display="flex",n.innerHTML=dt(),this.isSharingEnabled=!1;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(0),console.error("Screen sharing failed:",e.t0);case 34:case"end":return e.stop()}}),e,this,[[0,31]])})))).apply(this,arguments)}function ft(e){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ft(e)}function mt(){mt=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ft(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function gt(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var vt=n(5494),_t=n(8958);function Et(e){return yt.apply(this,arguments)}function yt(){var e;return e=mt().mark((function e(t){var n;return mt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localAudioTrack){e.next=19;break}if(n=document.querySelector("#localVideoContainer .mic-status-indicator"),this.localAudioTrackMuted){e.next=11;break}return e.next=5,this.localAudioTrack.setMuted(!0);case 5:this.localAudioTrackMuted=!0,t.style.background="#eb271e",t.innerHTML=_t(),n.innerHTML=_t(),e.next=17;break;case 11:return e.next=13,this.localAudioTrack.setMuted(!1);case 13:this.localAudioTrackMuted=!1,t.style.background="#3f3f41",t.innerHTML=vt(),n.innerHTML=vt();case 17:e.next=20;break;case 19:Se("NotAllowedError");case 20:case"end":return e.stop()}}),e,this)})),yt=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){gt(o,r,i,a,s,"next",e)}function s(e){gt(o,r,i,a,s,"throw",e)}a(void 0)}))},yt.apply(this,arguments)}function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function bt(){bt=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==wt(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function St(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var Tt=n(2500),Ct=n(2025);function Rt(e,t){return It.apply(this,arguments)}function It(){var e;return e=bt().mark((function e(t,n){var r;return bt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localVideoTrack){e.next=20;break}if(r=document.getElementById("localUserPlaceholder"),this.localVideoTrackMuted){e.next=11;break}return e.next=5,this.localVideoTrack.setMuted(!0);case 5:this.localVideoTrackMuted=!0,t.style.background="#eb271e",t.innerHTML=Ct(),r.style.display="flex",e.next=17;break;case 11:return e.next=13,this.localVideoTrack.setMuted(!1);case 13:this.localVideoTrackMuted=!1,t.style.background="#3f3f41",t.innerHTML=Tt(),r.style.display="none";case 17:this.isSharingEnabled&&(r.style.display="none"),e.next=35;break;case 20:return e.prev=20,e.next=23,n.createCameraVideoTrack();case 23:return this.localVideoTrack=e.sent,this.localVideoTrack.play("localVideoContainer"),e.next=27,this.client.publish([this.localAudioTrack,this.localVideoTrack]);case 27:this.localVideoTrackMuted=!1,t.style.background="#3f3f41",t.innerHTML=Tt(),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(20),e.t0.message.includes("NotReadableError")?Se("NotReadableError"):e.t0.message.includes("NotAllowedError")?Se("NotAllowedError"):console.error("Error:",e.t0.message);case 35:case"end":return e.stop()}}),e,this,[[20,32]])})),It=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){St(o,r,i,a,s,"next",e)}function s(e){St(o,r,i,a,s,"throw",e)}a(void 0)}))},It.apply(this,arguments)}function Ot(){var e="".concat(s.url.BASE,"/actions/join_meeting/").concat(this.copy_url_id,"/ask"),t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("value",e),document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t);var n=document.querySelector(".url-copied-indication-popup");n.classList.add("url-copied-indication-popup-show"),setTimeout((function(){n.classList.remove("url-copied-indication-popup-show")}),3e3)}function At(e,t){return function(){return e.apply(t,arguments)}}const{toString:Nt}=Object.prototype,{getPrototypeOf:Lt}=Object,Pt=(e=>t=>{const n=Nt.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),kt=e=>(e=e.toLowerCase(),t=>Pt(t)===e),Dt=e=>t=>typeof t===e,{isArray:xt}=Array,Mt=Dt("undefined");const Ut=kt("ArrayBuffer");const Vt=Dt("string"),jt=Dt("function"),Bt=Dt("number"),Ft=e=>null!==e&&"object"==typeof e,Gt=e=>{if("object"!==Pt(e))return!1;const t=Lt(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Ht=kt("Date"),Wt=kt("File"),Kt=kt("Blob"),qt=kt("FileList"),Yt=kt("URLSearchParams");function zt(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),xt(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const i=n?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let a;for(r=0;r<o;r++)a=i[r],t.call(null,e[a],a,e)}}function Jt(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Xt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Qt=e=>!Mt(e)&&e!==Xt;const Zt=($t="undefined"!=typeof Uint8Array&&Lt(Uint8Array),e=>$t&&e instanceof $t);var $t;const en=kt("HTMLFormElement"),tn=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),nn=kt("RegExp"),rn=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};zt(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},on="abcdefghijklmnopqrstuvwxyz",an="0123456789",sn={DIGIT:an,ALPHA:on,ALPHA_DIGIT:on+on.toUpperCase()+an};const cn=kt("AsyncFunction"),ln={isArray:xt,isArrayBuffer:Ut,isBuffer:function(e){return null!==e&&!Mt(e)&&null!==e.constructor&&!Mt(e.constructor)&&jt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||jt(e.append)&&("formdata"===(t=Pt(e))||"object"===t&&jt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ut(e.buffer),t},isString:Vt,isNumber:Bt,isBoolean:e=>!0===e||!1===e,isObject:Ft,isPlainObject:Gt,isUndefined:Mt,isDate:Ht,isFile:Wt,isBlob:Kt,isRegExp:nn,isFunction:jt,isStream:e=>Ft(e)&&jt(e.pipe),isURLSearchParams:Yt,isTypedArray:Zt,isFileList:qt,forEach:zt,merge:function e(){const{caseless:t}=Qt(this)&&this||{},n={},r=(r,i)=>{const o=t&&Jt(n,i)||i;Gt(n[o])&&Gt(r)?n[o]=e(n[o],r):Gt(r)?n[o]=e({},r):xt(r)?n[o]=r.slice():n[o]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&zt(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(zt(t,((t,r)=>{n&&jt(t)?e[r]=At(t,n):e[r]=t}),{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&Lt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Pt,kindOfTest:kt,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(xt(e))return e;let t=e.length;if(!Bt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:en,hasOwnProperty:tn,hasOwnProp:tn,reduceDescriptors:rn,freezeMethods:e=>{rn(e,((t,n)=>{if(jt(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];jt(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return xt(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Jt,global:Xt,isContextDefined:Qt,ALPHABET:sn,generateString:(e=16,t=sn.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&jt(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Ft(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=xt(e)?[]:{};return zt(e,((e,t)=>{const o=n(e,r+1);!Mt(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:cn,isThenable:e=>e&&(Ft(e)||jt(e))&&jt(e.then)&&jt(e.catch)};function dn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}ln.inherits(dn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ln.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const un=dn.prototype,pn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{pn[e]={value:e}})),Object.defineProperties(dn,pn),Object.defineProperty(un,"isAxiosError",{value:!0}),dn.from=(e,t,n,r,i,o)=>{const a=Object.create(un);return ln.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),dn.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const hn=dn,fn=null;function mn(e){return ln.isPlainObject(e)||ln.isArray(e)}function gn(e){return ln.endsWith(e,"[]")?e.slice(0,-2):e}function vn(e,t,n){return e?e.concat(t).map((function(e,t){return e=gn(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const _n=ln.toFlatObject(ln,{},null,(function(e){return/^is[A-Z]/.test(e)}));const En=function(e,t,n){if(!ln.isObject(e))throw new TypeError("target must be an object");t=t||new(fn||FormData);const r=(n=ln.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!ln.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&ln.isSpecCompliantForm(t);if(!ln.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(ln.isDate(e))return e.toISOString();if(!s&&ln.isBlob(e))throw new hn("Blob is not supported. Use a Buffer instead.");return ln.isArrayBuffer(e)||ln.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(ln.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(ln.isArray(e)&&function(e){return ln.isArray(e)&&!e.some(mn)}(e)||(ln.isFileList(e)||ln.endsWith(n,"[]"))&&(s=ln.toArray(e)))return n=gn(n),s.forEach((function(e,r){!ln.isUndefined(e)&&null!==e&&t.append(!0===a?vn([n],r,o):null===a?n:n+"[]",c(e))})),!1;return!!mn(e)||(t.append(vn(i,n,o),c(e)),!1)}const d=[],u=Object.assign(_n,{defaultVisitor:l,convertValue:c,isVisitable:mn});if(!ln.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!ln.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),ln.forEach(n,(function(n,o){!0===(!(ln.isUndefined(n)||null===n)&&i.call(t,n,ln.isString(o)?o.trim():o,r,u))&&e(n,r?r.concat(o):[o])})),d.pop()}}(e),t};function yn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function wn(e,t){this._pairs=[],e&&En(e,this,t)}const bn=wn.prototype;bn.append=function(e,t){this._pairs.push([e,t])},bn.toString=function(e){const t=e?function(t){return e.call(this,t,yn)}:yn;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Sn=wn;function Tn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Cn(e,t,n){if(!t)return e;const r=n&&n.encode||Tn,i=n&&n.serialize;let o;if(o=i?i(t,n):ln.isURLSearchParams(t)?t.toString():new Sn(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const Rn=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ln.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},In={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},On={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Sn,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};const An=function(e){function t(e,n,r,i){let o=e[i++];const a=Number.isFinite(+o),s=i>=e.length;if(o=!o&&ln.isArray(r)?r.length:o,s)return ln.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a;r[o]&&ln.isObject(r[o])||(r[o]=[]);return t(e,n,r[o],i)&&ln.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!a}if(ln.isFormData(e)&&ln.isFunction(e.entries)){const n={};return ln.forEachEntry(e,((e,r)=>{t(function(e){return ln.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const Nn={transitional:In,adapter:On.isNode?"http":"xhr",transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=ln.isObject(e);i&&ln.isHTMLForm(e)&&(e=new FormData(e));if(ln.isFormData(e))return r&&r?JSON.stringify(An(e)):e;if(ln.isArrayBuffer(e)||ln.isBuffer(e)||ln.isStream(e)||ln.isFile(e)||ln.isBlob(e))return e;if(ln.isArrayBufferView(e))return e.buffer;if(ln.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return En(e,new On.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return On.isNode&&ln.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=ln.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return En(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(ln.isString(e))try{return(t||JSON.parse)(e),ln.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Nn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&ln.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw hn.from(e,hn.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:On.classes.FormData,Blob:On.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ln.forEach(["delete","get","head","post","put","patch"],(e=>{Nn.headers[e]={}}));const Ln=Nn,Pn=ln.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),kn=Symbol("internals");function Dn(e){return e&&String(e).trim().toLowerCase()}function xn(e){return!1===e||null==e?e:ln.isArray(e)?e.map(xn):String(e)}function Mn(e,t,n,r,i){return ln.isFunction(r)?r.call(this,t,n):(i&&(t=n),ln.isString(t)?ln.isString(r)?-1!==t.indexOf(r):ln.isRegExp(r)?r.test(t):void 0:void 0)}class Un{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=Dn(t);if(!i)throw new Error("header name must be a non-empty string");const o=ln.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=xn(e))}const o=(e,t)=>ln.forEach(e,((e,n)=>i(e,n,t)));return ln.isPlainObject(e)||e instanceof this.constructor?o(e,t):ln.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&Pn[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=Dn(e)){const n=ln.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(ln.isFunction(t))return t.call(this,e,n);if(ln.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Dn(e)){const n=ln.findKey(this,e);return!(!n||void 0===this[n]||t&&!Mn(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=Dn(e)){const i=ln.findKey(n,e);!i||t&&!Mn(0,n[i],i,t)||(delete n[i],r=!0)}}return ln.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!Mn(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return ln.forEach(this,((r,i)=>{const o=ln.findKey(n,i);if(o)return t[o]=xn(r),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();a!==i&&delete t[i],t[a]=xn(r),n[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ln.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&ln.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[kn]=this[kn]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Dn(e);t[r]||(!function(e,t){const n=ln.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return ln.isArray(e)?e.forEach(r):r(e),this}}Un.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ln.reduceDescriptors(Un.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),ln.freezeMethods(Un);const Vn=Un;function jn(e,t){const n=this||Ln,r=t||n,i=Vn.from(r.headers);let o=r.data;return ln.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function Bn(e){return!(!e||!e.__CANCEL__)}function Fn(e,t,n){hn.call(this,null==e?"canceled":e,hn.ERR_CANCELED,t,n),this.name="CanceledError"}ln.inherits(Fn,hn,{__CANCEL__:!0});const Gn=Fn;const Hn=On.isStandardBrowserEnv?{write:function(e,t,n,r,i,o){const a=[];a.push(e+"="+encodeURIComponent(t)),ln.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ln.isString(r)&&a.push("path="+r),ln.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function Wn(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Kn=On.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=ln.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};const qn=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=r[a];i||(i=c),n[o]=s,r[o]=c;let d=a,u=0;for(;d!==o;)u+=n[d++],d%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),c-i<t)return;const p=l&&c-l;return p?Math.round(1e3*u/p):void 0}};function Yn(e,t){let n=0;const r=qn(50,250);return i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,s=o-n,c=r(s);n=o;const l={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:i};l[t?"download":"upload"]=!0,e(l)}}const zn="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const i=Vn.from(e.headers).normalize(),o=e.responseType;let a;function s(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}ln.isFormData(r)&&(On.isStandardBrowserEnv||On.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const l=Wn(e.baseURL,e.url);function d(){if(!c)return;const r=Vn.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new hn("Request failed with status code "+n.status,[hn.ERR_BAD_REQUEST,hn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),s()}),(function(e){n(e),s()}),{data:o&&"text"!==o&&"json"!==o?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),Cn(l,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(d)},c.onabort=function(){c&&(n(new hn("Request aborted",hn.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new hn("Network Error",hn.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||In;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new hn(t,r.clarifyTimeoutError?hn.ETIMEDOUT:hn.ECONNABORTED,e,c)),c=null},On.isStandardBrowserEnv){const t=(e.withCredentials||Kn(l))&&e.xsrfCookieName&&Hn.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in c&&ln.forEach(i.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),ln.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),o&&"json"!==o&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",Yn(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",Yn(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{c&&(n(!t||t.type?new Gn(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const u=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(l);u&&-1===On.protocols.indexOf(u)?n(new hn("Unsupported protocol "+u+":",hn.ERR_BAD_REQUEST,e)):c.send(r||null)}))},Jn={http:fn,xhr:zn};ln.forEach(Jn,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Xn={getAdapter:e=>{e=ln.isArray(e)?e:[e];const{length:t}=e;let n,r;for(let i=0;i<t&&(n=e[i],!(r=ln.isString(n)?Jn[n.toLowerCase()]:n));i++);if(!r){if(!1===r)throw new hn(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(ln.hasOwnProp(Jn,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!ln.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:Jn};function Qn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Gn(null,e)}function Zn(e){Qn(e),e.headers=Vn.from(e.headers),e.data=jn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Xn.getAdapter(e.adapter||Ln.adapter)(e).then((function(t){return Qn(e),t.data=jn.call(e,e.transformResponse,t),t.headers=Vn.from(t.headers),t}),(function(t){return Bn(t)||(Qn(e),t&&t.response&&(t.response.data=jn.call(e,e.transformResponse,t.response),t.response.headers=Vn.from(t.response.headers))),Promise.reject(t)}))}const $n=e=>e instanceof Vn?e.toJSON():e;function er(e,t){t=t||{};const n={};function r(e,t,n){return ln.isPlainObject(e)&&ln.isPlainObject(t)?ln.merge.call({caseless:n},e,t):ln.isPlainObject(t)?ln.merge({},t):ln.isArray(t)?t.slice():t}function i(e,t,n){return ln.isUndefined(t)?ln.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!ln.isUndefined(t))return r(void 0,t)}function a(e,t){return ln.isUndefined(t)?ln.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t)=>i($n(e),$n(t),!0)};return ln.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,a=o(e[r],t[r],r);ln.isUndefined(a)&&o!==s||(n[r]=a)})),n}const tr="1.5.0",nr={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{nr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const rr={};nr.transitional=function(e,t,n){function r(e,t){return"[Axios v1.5.0] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new hn(r(i," has been removed"+(t?" in "+t:"")),hn.ERR_DEPRECATED);return t&&!rr[i]&&(rr[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};const ir={assertOptions:function(e,t,n){if("object"!=typeof e)throw new hn("options must be an object",hn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],a=t[o];if(a){const t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new hn("option "+o+" must be "+n,hn.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new hn("Unknown option "+o,hn.ERR_BAD_OPTION)}},validators:nr},or=ir.validators;class ar{constructor(e){this.defaults=e,this.interceptors={request:new Rn,response:new Rn}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=er(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&ir.assertOptions(n,{silentJSONParsing:or.transitional(or.boolean),forcedJSONParsing:or.transitional(or.boolean),clarifyTimeoutError:or.transitional(or.boolean)},!1),null!=r&&(ln.isFunction(r)?t.paramsSerializer={serialize:r}:ir.assertOptions(r,{encode:or.function,serialize:or.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&ln.merge(i.common,i[t.method]);i&&ln.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=Vn.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){const e=[Zn.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let p=t;for(u=0;u<d;){const e=a[u++],t=a[u++];try{p=e(p)}catch(e){t.call(this,e);break}}try{l=Zn.call(this,p)}catch(e){return Promise.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Cn(Wn((e=er(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ln.forEach(["delete","get","head","options"],(function(e){ar.prototype[e]=function(t,n){return this.request(er(n||{},{method:e,url:t,data:(n||{}).data}))}})),ln.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(er(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ar.prototype[e]=t(),ar.prototype[e+"Form"]=t(!0)}));const sr=ar;class cr{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new Gn(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new cr((function(t){e=t})),cancel:e}}}const lr=cr;const dr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(dr).forEach((([e,t])=>{dr[t]=e}));const ur=dr;const pr=function e(t){const n=new sr(t),r=At(sr.prototype.request,n);return ln.extend(r,sr.prototype,n,{allOwnKeys:!0}),ln.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(er(t,n))},r}(Ln);pr.Axios=sr,pr.CanceledError=Gn,pr.CancelToken=lr,pr.isCancel=Bn,pr.VERSION=tr,pr.toFormData=En,pr.AxiosError=hn,pr.Cancel=pr.CanceledError,pr.all=function(e){return Promise.all(e)},pr.spread=function(e){return function(t){return e.apply(null,t)}},pr.isAxiosError=function(e){return ln.isObject(e)&&!0===e.isAxiosError},pr.mergeConfig=er,pr.AxiosHeaders=Vn,pr.formToJSON=e=>An(ln.isHTMLForm(e)?new FormData(e):e),pr.getAdapter=Xn.getAdapter,pr.HttpStatusCode=ur,pr.default=pr;const hr=pr;function fr(){return{referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href}}function mr(e){var t=e.replace(/([^:]\/)\/+/g,"$1").replace(/\/+$/,"");return t.split("/").length<=4?t+"/":t}function gr(e){var t=e.url,n=void 0===t?s.url.BASE:t,r=e.path,i=void 0===r?"":r,o=e.data,a=void 0===o?{}:o,c=e.onSuccess,l=void 0===c?function(){}:c,d=e.onFailure,u=void 0===d?function(){}:d,p={};return p.headers=fr(),hr.post(mr(n+"/"+i),a,p).then((function(e){l(e)})).catch((function(e){u(e)}))}var vr=n(7651),_r=n(429),Er=n(5583);function yr(){var e=new Date,t=e.getHours()>12?e.getHours()-12:e.getHours(),n=e.getHours()>=12?"PM":"AM",r=e.getMinutes().toString().padStart(2,"0");return"".concat(t,":").concat(r," ").concat(n)}function wr(e){var t=document.querySelector(".saleassist-video-call-chat-container"),n=document.querySelectorAll(".saleassist-video-call-chat-log .unread"),r=document.querySelectorAll(".sa-message-notification");if("open"===e){var i=document.querySelector(".saleassist-video-call-more-options-control");t.classList.remove("sa-chat-hidden"),t.classList.add("sa-chat-active"),n&&n.forEach((function(e){return e.classList.remove("unread")})),r&&r.forEach((function(e){e.style.display="none",e.innerText=""})),i.classList.remove("more-options-control-active")}"close"===e&&(t.classList.remove("sa-chat-active"),t.classList.add("sa-chat-hidden"))}function br(){var e=this,t=document.getElementById("saleassistVideoChatMessageInput"),n=document.querySelector(".saleassist-video-call-document-preview-container"),r=t.value;if(this.files[0]){var i=document.querySelector(".saleassist-video-call-chat-input-box .chat-input-overlay");i.style.display="flex",function(e){var t=e.url,n=void 0===t?s.url.BASE:t,r=e.path,i=void 0===r?"":r,o=e.files,a=void 0===o?[]:o,c=e.onSuccess,l=void 0===c?function(){}:c,d=e.onFailure,u=void 0===d?function(){}:d,p={};p.headers=fr();var h=new FormData;a.map((function(e){return h.append("files",e)})),hr.post(mr(n+"/"+i),h,p).then((function(e){l(e)})).catch((function(e){u(e)}))}({url:s.url.BASE,path:"/meeting/".concat(this.copy_url_id,"/media"),files:this.files,onSuccess:function(o){e.files.forEach((function(e,t){r+='\n            <a class="sa-chat-document-preview-sent" href="'.concat(o.data[t].url,'" target=â€_blankâ€>\n              <span>').concat(Er(),"</span>\n              <span>").concat(e.name,"</span>\n            </a>")})),e.socket.emit("chat_message",{text:r}),Sr("You",r,!0),e.files=[],t.value="",n.innerHTML="",i.style.display="none"},onFailure:function(t){e.files=[],i.style.display="none",console.warn("Unable to Send the document. "+(t.response&&t.response.data.detail||t.toString()))}})}""===r.trim()||this.files[0]||(this.socket.emit("chat_message",{text:r}),Sr("You",r,!0),t.value="")}function Sr(e,t,n){var r=document.getElementById("saleassistVideoChatLog"),i=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),s=document.querySelector(".sa-message-notification").innerText||0;n?i.classList.add("sent"):(i.classList.add("received"),document.querySelector(".sa-chat-hidden")&&(i.classList.add("unread"),s=+s+1,document.querySelectorAll(".sa-message-notification").forEach((function(e){return e.innerText=s})))),o.classList.add("message"),a.classList.add("message-meta-info"),o.innerHTML=t,r.lastChild&&(n&&"sent"===r.lastChild.className&&r.lastChild.outerText.includes(yr())||!n&&"received"===r.lastChild.className&&r.lastChild.outerText.includes(yr()))&&(r.lastChild.lastChild.innerHTML=""),a.innerHTML="".concat(n?"":"".concat(e," | ")," ").concat(yr()),i.appendChild(o),i.appendChild(a),r.appendChild(i),r.scrollTop=r.scrollHeight}function Tr(e){var t=document.getElementById("".concat(e)),n=this.files.findIndex((function(t){return t.name===e}));-1!==n&&this.files.splice(n,1),t.remove()}function Cr(e){var t=this,n=document.querySelector(".saleassist-video-call-document-preview-container");if(e.target.files&&e.target.files.length>0)for(var r=e.target.files,i=function(){t.files.push(r[o]);var e=document.createElement("div");e.className="sa-chat-document-preview",e.id="".concat(r[o].name),e.innerHTML='\n        <span class="sa-chat-document-file-name">\n          '.concat(_r()+" "+r[o].name,'\n        </span>\n        <span class="sa-chat-remove-document-button">').concat(vr(),"</span>\n      "),n.appendChild(e),e.querySelector(".sa-chat-remove-document-button").addEventListener("click",(function(){Tr.call(t,e.id)}))},o=0;o<r.length;o++)i()}function Rr(){var e=document.querySelector(".saleassist-video-call-chat-log"),t=document.querySelectorAll(".sa-message-notification");null!==e.querySelector(".unread")?t.forEach((function(e){return e.style.display="flex"})):t.forEach((function(e){return e.style.display="none"}))}var Ir=n(8540),Or=n(9219);function Ar(e){var t=document.getElementById("videoCallContainer"),n=document.querySelector(".sa-hold-screen-container"),r=document.createElement("div");if(r.className="sa-hold-screen-container",r.innerHTML=Ir({phoneHold:Or()}),!0===e&&(n||(t.appendChild(r),Nr())),!1===e&&n){t.removeChild(n);var i=j().holdScreenTimers;Array.isArray(i)&&Go(i)}}var Nr=function(){var e=U(),t=[],n=0,r=0,i=setInterval((function(){0==parseInt(n%e.message_interval)&&(Lr(e.wait_messages[r]),(r+=1)>=e.wait_messages.length&&(r=0)),n+=1}),1e3);t.push(i),V({holdScreenTimers:t})},Lr=function(e){var t,n=document.querySelector(".sa-hold-screen-waiting-message");t=/\.(jpg|jpeg|png|webp|avif|gif|svg)$/.test(e)?'<img alt=""src="'.concat(e,'"/>'):/\.(mp4|mov|wmv|avi|avchd|mkv|webm|swf)$/.test(e)?'\n        <video\n          src="'.concat(e,'"\n          muted\n          autoplay\n          loop\n          playsinline\n          controls\n        />'):'<img alt="" src="https://img.freepik.com/free-vector/product-presentation-concept-illustration_114360-8416.jpg?size=626&ext=jpg&ga=GA1.1.601405383.1694137917&semt=ais"/>',n&&t&&(n.innerHTML=t)};const Pr=Object.create(null);Pr.open="0",Pr.close="1",Pr.ping="2",Pr.pong="3",Pr.message="4",Pr.upgrade="5",Pr.noop="6";const kr=Object.create(null);Object.keys(Pr).forEach((e=>{kr[Pr[e]]=e}));const Dr={type:"error",data:"parser error"},xr="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Mr="function"==typeof ArrayBuffer,Ur=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Vr=({type:e,data:t},n,r)=>xr&&t instanceof Blob?n?r(t):jr(t,r):Mr&&(t instanceof ArrayBuffer||Ur(t))?n?r(t):jr(new Blob([t]),r):r(Pr[e]+(t||"")),jr=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Br(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Fr;const Gr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hr="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)Hr[Gr.charCodeAt(e)]=e;const Wr="function"==typeof ArrayBuffer,Kr=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Yr(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:qr(e.substring(1),t)};return kr[n]?e.length>1?{type:kr[n],data:e.substring(1)}:{type:kr[n]}:Dr},qr=(e,t)=>{if(Wr){const n=(e=>{let t,n,r,i,o,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const l=new ArrayBuffer(a),d=new Uint8Array(l);for(t=0;t<s;t+=4)n=Hr[e.charCodeAt(t)],r=Hr[e.charCodeAt(t+1)],i=Hr[e.charCodeAt(t+2)],o=Hr[e.charCodeAt(t+3)],d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&o;return l})(e);return Yr(n,t)}return{base64:!0,data:e}},Yr=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,zr=String.fromCharCode(30);function Jr(){return new TransformStream({transform(e,t){!function(e,t){xr&&e.data instanceof Blob?e.data.arrayBuffer().then(Br).then(t):Mr&&(e.data instanceof ArrayBuffer||Ur(e.data))?t(Br(e.data)):Vr(e,!1,(e=>{Fr||(Fr=new TextEncoder),t(Fr.encode(e))}))}(e,(n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{i=new Uint8Array(9);const e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(i[0]|=128),t.enqueue(i),t.enqueue(n)}))}})}let Xr;function Qr(e){return e.reduce(((e,t)=>e+t.length),0)}function Zr(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function $r(e){if(e)return function(e){for(var t in $r.prototype)e[t]=$r.prototype[t];return e}(e)}$r.prototype.on=$r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},$r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},$r.prototype.off=$r.prototype.removeListener=$r.prototype.removeAllListeners=$r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},$r.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},$r.prototype.emitReserved=$r.prototype.emit,$r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},$r.prototype.hasListeners=function(e){return!!this.listeners(e).length};const ei="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function ti(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const ni=ei.setTimeout,ri=ei.clearTimeout;function ii(e,t){t.useNativeTimers?(e.setTimeoutFn=ni.bind(ei),e.clearTimeoutFn=ri.bind(ei)):(e.setTimeoutFn=ei.setTimeout.bind(ei),e.clearTimeoutFn=ei.clearTimeout.bind(ei))}class oi extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class ai extends $r{constructor(e){super(),this.writable=!1,ii(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new oi(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Kr(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}const si="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ci=64,li={};let di,ui=0,pi=0;function hi(e){let t="";do{t=si[e%ci]+t,e=Math.floor(e/ci)}while(e>0);return t}function fi(){const e=hi(+new Date);return e!==di?(ui=0,di=e):e+"."+hi(ui++)}for(;pi<ci;pi++)li[si[pi]]=pi;let mi=!1;try{mi="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const gi=mi;function vi(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||gi))return new XMLHttpRequest}catch(e){}if(!t)try{return new(ei[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function _i(){}const Ei=null!=new vi({xdomain:!1}).responseType;class yi extends $r{constructor(e,t){super(),ii(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=ti(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new vi(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=yi.requestsCount++,yi.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=_i,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete yi.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(yi.requestsCount=0,yi.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",wi);else if("function"==typeof addEventListener){addEventListener("onpagehide"in ei?"pagehide":"unload",wi,!1)}function wi(){for(let e in yi.requests)yi.requests.hasOwnProperty(e)&&yi.requests[e].abort()}const bi="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Si=ei.WebSocket||ei.MozWebSocket,Ti="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Ci={websocket:class extends ai{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Ti?{}:ti(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Ti?new Si(e,t,n):t?new Si(e,t):new Si(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;Vr(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}r&&bi((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=fi()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Si}},webtransport:class extends ai{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){Xr||(Xr=new TextDecoder);const n=[];let r=0,i=-1,o=!1;return new TransformStream({transform(a,s){for(n.push(a);;){if(0===r){if(Qr(n)<1)break;const e=Zr(n,1);o=128==(128&e[0]),i=127&e[0],r=i<126?3:126===i?1:2}else if(1===r){if(Qr(n)<2)break;const e=Zr(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(Qr(n)<8)break;const e=Zr(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),o=t.getUint32(0);if(o>Math.pow(2,21)-1){s.enqueue(Dr);break}i=o*Math.pow(2,32)+t.getUint32(4),r=3}else{if(Qr(n)<i)break;const e=Zr(n,i);s.enqueue(Kr(o?e:Xr.decode(e),t)),r=0}if(0===i||i>e){s.enqueue(Dr);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Jr();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const i=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),i())})).catch((e=>{}))};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this.writer.write(n).then((()=>{r&&bi((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends ai{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=Ei&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(zr),r=[];for(let e=0;e<n.length;e++){const i=Kr(n[e],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach(((e,o)=>{Vr(e,!1,(e=>{r[o]=e,++i===n&&t(r.join(zr))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=fi()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new yi(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},Ri=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ii=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Oi(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=Ri.exec(e||""),o={},a=14;for(;a--;)o[Ii[a]]=i[a]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,o.path),o.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,o.query),o}class Ai extends $r{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Oi(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Oi(t.host).host),ii(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,r=n.length;e<r;e++){let r=n[e].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Ci[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Ai.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;Ai.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Ai.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){n||(n=!0,l(),t.close(),t=null)}const o=e=>{const n=new Error("probe error: "+e);n.transport=t.name,i(),this.emitReserved("upgradeError",n)};function a(){o("transport closed")}function s(){o("socket closed")}function c(e){t&&e.name!==t.name&&i()}const l=()=>{t.removeListener("open",r),t.removeListener("error",o),t.removeListener("close",a),this.off("close",s),this.off("upgrading",c)};t.once("open",r),t.once("error",o),t.once("close",a),this.once("close",s),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",Ai.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"==typeof(t=r)?function(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){Ai.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}Ai.protocol=4;Ai.protocol;const Ni="function"==typeof ArrayBuffer,Li=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Pi=Object.prototype.toString,ki="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Pi.call(Blob),Di="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Pi.call(File);function xi(e){return Ni&&(e instanceof ArrayBuffer||Li(e))||ki&&e instanceof Blob||Di&&e instanceof File}function Mi(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Mi(e[t]))return!0;return!1}if(xi(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Mi(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Mi(e[t]))return!0;return!1}function Ui(e){const t=[],n=e.data,r=e;return r.data=Vi(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Vi(e,t){if(!e)return e;if(xi(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Vi(e[r],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Vi(e[r],t));return n}return e}function ji(e,t){return e.data=Bi(e.data,t),delete e.attachments,e}function Bi(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Bi(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Bi(e[n],t));return e}const Fi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Gi=5;var Hi;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Hi||(Hi={}));class Wi{constructor(e){this.replacer=e}encode(e){return e.type!==Hi.EVENT&&e.type!==Hi.ACK||!Mi(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Hi.EVENT?Hi.BINARY_EVENT:Hi.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Hi.BINARY_EVENT&&e.type!==Hi.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ui(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function Ki(e){return"[object Object]"===Object.prototype.toString.call(e)}class qi extends $r{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===Hi.BINARY_EVENT;n||t.type===Hi.BINARY_ACK?(t.type=n?Hi.EVENT:Hi.ACK,this.reconstructor=new Yi(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!xi(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===Hi[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Hi.BINARY_EVENT||n.type===Hi.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(r,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!qi.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case Hi.CONNECT:return Ki(t);case Hi.DISCONNECT:return void 0===t;case Hi.CONNECT_ERROR:return"string"==typeof t||Ki(t);case Hi.EVENT:case Hi.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Fi.indexOf(t[0]));case Hi.ACK:case Hi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Yi{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ji(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function zi(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ji=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Xi extends $r{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[zi(e,"open",this.onopen.bind(this)),zi(e,"packet",this.onpacket.bind(this)),zi(e,"error",this.onerror.bind(this)),zi(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Ji.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:Hi.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,r=t.pop();this._registerAckCallback(e,r),n.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),r);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((r,i)=>{t.push(((e,t)=>n?e?i(e):r(t):r(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...r)=>{if(n!==this._queue[0])return;return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...r)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Hi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Hi.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Hi.EVENT:case Hi.BINARY_EVENT:this.onevent(e);break;case Hi.ACK:case Hi.BINARY_ACK:this.onack(e);break;case Hi.DISCONNECT:this.ondisconnect();break;case Hi.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...r){n||(n=!0,t.packet({type:Hi.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Hi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Qi(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Qi.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Qi.prototype.reset=function(){this.attempts=0},Qi.prototype.setMin=function(e){this.ms=e},Qi.prototype.setMax=function(e){this.max=e},Qi.prototype.setJitter=function(e){this.jitter=e};class Zi extends $r{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,ii(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Qi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ai(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=zi(t,"open",(function(){n.onopen(),e&&e()})),i=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},o=zi(t,"error",i);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{r(),i(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(zi(e,"ping",this.onping.bind(this)),zi(e,"data",this.ondata.bind(this)),zi(e,"error",this.onerror.bind(this)),zi(e,"close",this.onclose.bind(this)),zi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){bi((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Xi(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const $i={};function eo(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=Oi(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,i=n.id,o=n.path,a=$i[i]&&o in $i[i].nsps;let s;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?s=new Zi(r,t):($i[i]||($i[i]=new Zi(r,t)),s=$i[i]),n.query&&!t.query&&(t.query=n.queryKey),s.socket(n.path,t)}function to(e){return to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},to(e)}function no(){no=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==to(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ro(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function io(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ro(o,r,i,a,s,"next",e)}function s(e){ro(o,r,i,a,s,"throw",e)}a(void 0)}))}}function oo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==to(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==to(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===to(o)?o:String(o)),r)}var i,o}Object.assign(eo,{Manager:Zi,Socket:Xi,io:eo,connect:eo}),re().setLogLevel(2);var ao=n(2615),so=n(710),co=n(2025),lo=n(2500),uo=n(5494),po=n(296),ho=n(8738),fo=n(4699),mo=n(9346),go=n(4925),vo=n(8073),_o=n(3618),Eo=n(5072),yo=n(7651),wo=n(8437),bo=n(1673),So=n(7458),To=n(8873),Co=n(9644),Ro=n(3585);const Io=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.agoraAppId=t.widget_creds.app_id,this.agoraChannelName=t.widget_creds.channel_name,this.agoraToken=t.widget_creds.token,this.agoraUID=t.widget_creds.uid,this.people_id=H("form_data").people_id,this.client_id=t.client_id,this.is_recording_on=t.is_recording_on,this.copy_url_id=t.title,this.user_display_name=t.user_display_name,this.message_type=n,this.client=re().createClient({mode:"rtc",codec:"vp8"}),this.localAudioTrack,this.localVideoTrack,this.localScreenTrack,this.remoteUsers={},this.localAudioTrackMuted=!1,this.localVideoTrackMuted=!0,this.isSharingEnabled=!1,this.videoInputDevices,this.audioInputDevices,this.files=[],this.isMessageOpen=!1,console.log("".concat(this.message_type," Initialised"));var i=eo(s.url.SOCKET_URL,{query:"meeting_id=".concat(this.copy_url_id,"&id=").concat(this.people_id,"&client_id=").concat(this.client_id,"&uid=").concat(H("form_data").unique_field_value)});i.on("connect",(function(e){console.log(e,"socket connected successfully"),r.socket=i})),i.on("message",function(){var e=io(no().mark((function e(t){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("meeting_recording_started"===t.message&&ot("record_started"),"meeting_recording_ended"===t.message&&ot("record_ended"),"widget_incoming_request_closed"!==t.message){e.next=5;break}return e.next=5,tt.call(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),i.on("chat_message",function(){var e=io(no().mark((function e(t){var n;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in t)"text"===n&&(r="user",i=t.text,Sr(r,i,!1)),"hold"===n&&Ar(t.hold);case 1:case"end":return e.stop()}var r,i}),e)})));return function(t){return e.apply(this,arguments)}}()),"function"==typeof window.startCoBrowsing&&window.startCoBrowsing(this.user_display_name,this.copy_url_id),this.init().then((function(){return r.renderElement()}))}var t,n,r,i,o;return t=e,n=[{key:"init",value:(o=io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.getElementById("saleassist-video-call-app").innerHTML=ao({user_display_name_first_letter:this.user_display_name[0].toUpperCase(),user_display_name:this.user_display_name,screenShare:so(),toggleCamera:co(),toggleAudio:uo(),flipCamera:po(),endCall:ho(),videoCallTileToggle:fo(),maximize:mo(),moreOption:go(),message:vo(),settings:_o(),videoInputDeivce:lo(),pipMode:Eo(),closeBtn:yo(),infoIcon:wo(),recordIcon:bo(),shareUrl:So(),uploadBtn:Co(),sendBtn:To(),threeDotsLoader:Ro()}),e.next=4,ye.call(this,re());case 4:return e.t0=console,e.next=7,this.videoInputDevices;case 7:return e.t1=e.sent,e.t0.log.call(e.t0,"video",e.t1),e.t2=console,e.next=12,this.audioInputDevices;case 12:e.t3=e.sent,e.t2.log.call(e.t2,"audio",e.t3);case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"renderElement",value:(i=io(no().mark((function e(){var t,n,r,i,o,a,s,c,l,d,u,p,h,f,m,g,v,_,E,y=this;return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("leaveButton"),n=document.getElementById("screenShare"),r=document.getElementById("flipCamera"),i=document.getElementById("toggleCamera"),o=document.getElementById("toggleAudio"),a=document.getElementById("videoCallMaximizeButton"),s=document.getElementById("moreButton"),c=document.getElementById("sa-settings"),l=document.getElementById("inputDeviceSettingsClose"),d=document.querySelector("#videoInputDeviceSetting select"),u=document.querySelector("#audioInputDeviceSetting select"),p=document.getElementById("sa-pip-mode"),h=document.getElementById("videoCallShareUrlCopyButton"),f=document.getElementById("sa-message"),m=document.getElementById("saleassistVideoChatMessageInput"),g=document.getElementById("saleassistVideoChatSendButton"),v=document.getElementById("saleassistVideoChatCloseButton"),_=document.querySelector("#saleassistVideoChatUploadButton #upload-file"),E=document.querySelector(".saleassist-video-call-chat-log"),"mediaDevices"in navigator&&"getDisplayMedia"in navigator.mediaDevices&&(n.style.display="block"),"audio_call"===this.message_type&&(i.style.display="none",document.getElementById("videoInputDeviceSetting").style.display="none"),this.is_recording_on&&ot("record_started"),e.next=24,xe.call(this,re());case 24:t.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tt.call(y);case 2:case"end":return e.stop()}}),e)})))),n.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt.call(y,re(),n);case 2:case"end":return e.stop()}}),e)})))),r.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.call(y,d);case 2:case"end":return e.stop()}}),e)})))),i.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rt.call(y,i,re());case 2:case"end":return e.stop()}}),e)})))),o.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Et.call(y,o);case 2:case"end":return e.stop()}}),e)})))),a.addEventListener("click",(function(){var e,t,n;e=a,t=document.querySelector(".sa-live-call-widget-expanded"),n=document.querySelectorAll(".video-call-wrapper"),t.classList.toggle("sa-live-call-widget-expanded-maximize"),n.forEach((function(e){return e.classList.toggle("video-call-wrapper-maximize")})),t.classList.contains("sa-live-call-widget-expanded-maximize")?e.innerHTML=it():e.innerHTML=rt()})),s.addEventListener("click",(function(){document.querySelector(".saleassist-video-call-more-options-control").classList.toggle("more-options-control-active")})),c.addEventListener("click",(function(){ue("open")})),l.addEventListener("click",(function(){ue("close")})),"video_call"===this.message_type&&d&&d.addEventListener("change",function(){var e=io(no().mark((function e(t){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.call(y,"video",t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u&&u.addEventListener("change",function(){var e=io(no().mark((function e(t){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.call(y,"audio",t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p.addEventListener("click",(function(){var e,t,n;e=document.querySelector("#videoCallVideoTiles video"),t=document.querySelector("#localVideoContainer video"),n=document.querySelector(".saleassist-video-call-more-options-control"),document.pictureInPictureElement?document.exitPictureInPicture():document.pictureInPictureEnabled&&(e?e.requestPictureInPicture():t.requestPictureInPicture()),n.classList.remove("more-options-control-active")})),h.addEventListener("click",io(no().mark((function e(){return no().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ot.call(y);case 2:case"end":return e.stop()}}),e)})))),f.addEventListener("click",(function(){y.isMessageOpen?wr("close"):wr("open"),y.isMessageOpen=!y.isMessageOpen})),v.addEventListener("click",(function(){wr("close"),y.isMessageOpen=!1})),g.addEventListener("click",(function(){br.call(y)})),m.addEventListener("keydown",(function(e){13===e.keyCode&&(e.preventDefault(),br.call(y))})),_.addEventListener("click",(function(e){e.target.value=null})),_.addEventListener("change",(function(e){Cr.call(y,e)})),E.addEventListener("DOMSubtreeModified",Rr);case 44:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],n&&oo(t.prototype,n),r&&oo(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();var Oo=n(8235),Ao={};Ao.styleTagTransform=C(),Ao.setAttributes=w(),Ao.insert=E().bind(null,"head"),Ao.domAPI=v(),Ao.insertStyleElement=S();m()(Oo.Z,Ao);Oo.Z&&Oo.Z.locals&&Oo.Z.locals;function No(e){return No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(e)}function Lo(){Lo=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==No(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Po(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function ko(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Po(o,r,i,a,s,"next",e)}function s(e){Po(o,r,i,a,s,"throw",e)}a(void 0)}))}}var Do=n(1223),xo=n(3903),Mo=n(3525),Uo=function(){var e=ko(Lo().mark((function e(t,n){var r,i,o,a;return Lo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H("form_data"),i=U(),o=[],!Qe("widget_call")){e.next=7;break}return t.innerHTML=Do(),a=new Io(Xe("widget_call").credential,n),e.abrupt("return",a);case 7:return e.next=9,Fo(i,r,n).then((function(e){Bo(i,e.id,o,t,n)})).catch((function(e){console.log(e)}));case 9:t.innerHTML=xo({call_timeout:Math.ceil(i.call_timeout/60).toFixed(0),messageType:n});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Vo=function(){var e=ko(Lo().mark((function e(t,n,r){var i,o,a,c;return Lo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=H("user_data"),o=H("form_data"),e.next=4,u.post(s.url.ACTIONS,"/meeting/join_channel/".concat(t,"/").concat(i.name||o.unique_field_value||o.people_id));case 4:if(!(a=e.sent)){e.next=10;break}return n.innerHTML=Do(),c=new Io(a,r),Je("widget_call",{credential:a,message_type:r},1),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),jo=function(){var e=ko(Lo().mark((function e(t,n,r,i){var o,a,c;return Lo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.get(s.url.ACTIONS,"/get_join_url/".concat(t,"/").concat(n));case 2:(o=e.sent)&&(a=new URL(o),c=a.pathname.split("/").filter(Boolean)[0],console.log("room_id",c),Vo(c,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Bo=function(e,t,n,r,i){var o=0,a=0,c=setInterval((function(){0==parseInt(o%e.message_interval)&&(Ho(e.wait_messages[a]),(a+=1)>=e.wait_messages.length&&(a=0)),(o+=1)%2==0&&function(e,t,n,r,i){fetch("".concat(s.url.SOURCE,"/").concat(e.id,"/conversation_status/").concat(t),{method:"GET",headers:{referrer:window.location.href}}).then((function(t){if(t.ok)return t.json();throw 428===t.status?(Go(n),console.log("call_timeout_message",e.call_timeout_message),console.log("call_was_missed",!0),console.log("status","timeout"),r.innerHTML=Mo({timeoutMessage:e.timeout_message,ctaText:e.offline_cta_text}),Qs(!0),new Error("Request timeout")):404===t.status?(console.log("Resource not found:",t.status),new Error("Resource not found")):(console.log("Error occurred:",t.status),new Error("Request failed"))})).then((function(e){""!==e.meeting_id&&(Go(n),new Audio("https://static.saleassist.ai/j/sounds/Store_Door_Chime.mp3").play(n),console.log("meeting_id",e.meeting_id),V({meeting_id:e.meeting_id}),jo(e.meeting_id,H("form_data").unique_field_value,r,i),console.log("status","connecting"))})).catch((function(e){console.log("Error occurred:",e)}))}(e,t,n,r,i)}),1e3);n.push(c),V({videoCallTimers:n})},Fo=function(){var e=ko(Lo().mark((function e(t,n,r){var i;return Lo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.post(s.url.SOURCE,"/".concat(t.id,"/conversation"),{meta:[],message_content:"",message_type:r,message_from:n.people_id,people_id:n.people_id,form_id:n.form_id,unique_field_value:n.unique_field_value,source_id:t.id,source_name:t.name,source_type:t.source_type,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href,session_id:H("session_data")});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Go=function(e){e.forEach((function(e){clearInterval(e)}))},Ho=function(e){var t,n=document.querySelector(".sa-live-call-widget-call-waiting-messages-container");t=/\.(jpg|jpeg|png|webp|avif|gif|svg)$/.test(e)?'<div style="height:250px; padding: 12px">\n      <img\n        class="sa-live-call-widget-image-waiting-message"\n        alt=""\n        src="'.concat(e,'"\n      />\n    </div>'):/\.(mp4|mov|wmv|avi|avchd|mkv|webm|swf)$/.test(e)?'<div style="height:250px padding: 12px;">\n      <video\n        class="sa-live-call-widget-image-waiting-message"\n        src="'.concat(e,'"\n        muted\n        autoplay\n        loop\n        playsinline\n        controls\n        style="height:250px"\n      />\n    </div>'):'<div style="color:#fff;padding:32px 15px">'.concat(e,"</div>"),n&&(n.innerHTML=t)};function Wo(e){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(e)}function Ko(){Ko=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Wo(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qo(Object(n),!0).forEach((function(t){zo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zo(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Wo(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Wo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Wo(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jo(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Xo(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Jo(o,r,i,a,s,"next",e)}function s(e){Jo(o,r,i,a,s,"throw",e)}a(void 0)}))}}var Qo=n(8922),Zo=n(289),$o=n(3585),ea=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Record Video Message",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"video_message";e.innerHTML=Zo({title:t});var r,i,o=document.querySelector(".sa-live-call-widget-video-message-start-stop-recording-btn"),a=document.querySelector(".sa-live-call-widget-video-message-preview-wrapper"),c=document.querySelector(".sa-live-call-widget-video-message-preview"),l=document.querySelector(".sa-live-call-widget-video-message-toggle-video-recording-btn"),d=document.querySelector(".sa-live-call-widget-video-message-toggle-screen-recording-btn"),p=document.querySelector(".sa-live-call-widget-video-message-controls-btn-wrapper"),h=document.querySelector(".sa-live-call-widget-video-message-toggle-recording-btn-wrapper");c.style.transform="rotateY(180deg)",h.style.display="none";var f=[],m=!1,g=!1,v=!1;function _(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(o.textContent="Stop Recording",o.style.background="#d9534f",o.style.color="#fff"):(o.textContent="Start Recording",o.style.background="#4285f4",o.style.color="#fff")}function E(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){r=e,c.srcObject=r,c.style.objectFit="cover",c.style.transform="rotateY(180deg)",h.style.display="flex"})).catch((function(e){console.error("Error accessing camera and microphone:",e)}))}function y(){i&&"inactive"!==i.state&&(i.stop(),i.addEventListener("stop",(function(){var t=new Blob(f,{type:"video/webm"}),r=document.createElement("video");r.controls=!0,r.src=URL.createObjectURL(t),r.classList.add("sa-live-call-widget-recorded-video-message"),r.addEventListener("loadedmetadata",(function(){r.play()})),r.style.objectFit=m?"contain":"conver",a.appendChild(r),c.style.display="none",h.style.display="none",function(){o.style.display="none";var t='<button\n        class="sa-live-call-widget-video-message-start-stop-recording-btn"\n        id="sa-live-call-widget-video-message-re-record-btn"\n        style="color: black, opacity: 0.5"\n      >\n        Re-record\n      </button>\n      <button\n        class="sa-live-call-widget-video-message-start-stop-recording-btn"\n        id="sa-live-call-widget-video-message-submit-recording-btn"\n      >\n        Submit\n      </button>';p.insertAdjacentHTML("beforeend",t);var r=document.getElementById("sa-live-call-widget-video-message-submit-recording-btn"),i=document.getElementById("sa-live-call-widget-video-message-re-record-btn");i.addEventListener("click",(function(){c.style.display="block",w(),b(),g=!0,o.style.display="block",_(!0),h.style.display="flex",i.remove(),r.remove(),document.querySelector(".sa-live-call-widget-recorded-video-message").remove()})),r.addEventListener("click",Xo(Ko().mark((function t(){var i,o,a,c,l;return Ko().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.innerHTML=$o({}),r.style.cursor="not-allowed",i=H("form_data"),o=new Blob(f,{type:"video/webm"}),(a=new FormData).append("files",o,"".concat(i.people_id,"/").concat((new Date).getTime(),".").concat(o.type.split("/")[1])),t.prev=6,t.next=9,fetch(s.url.SOURCE+"/".concat(U().id,"/storage"),{method:"POST",body:a,headers:{referrer:window.location.href}});case 9:if((c=t.sent).ok){t.next=12;break}throw new Error("Error uploading recorded video");case 12:return t.next=14,c.json();case 14:if(!(l=t.sent)){t.next=20;break}return t.next=18,u.post(s.url.SOURCE,"/".concat(U().id,"/conversation"),Yo(Yo({},i),{},{message_content:l[0].url,message_type:n,message_from:i.people_id,source_id:U().id,source_type:"live_call",source_name:U().name,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href}));case 18:t.sent&&(V({message:"Your message has been received.",widgetName:"thankyouMessage"}),e.innerHTML=Qo({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc());case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(6),console.error("Error uploading recorded video:",t.t0);case 25:case"end":return t.stop()}}),t,null,[[6,22]])}))))}()})))}function w(){f=[]}function b(){g?(w(),m?(c.style.display="block",navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){r=e,c.srcObject=r,c.style.objectFit="contain",c.style.transform="rotateY(0deg)",h.style.display="flex",v=!1})).catch((function(e){console.error("Error accessing screen and microphone:",e),m=!1,v=!0,document.querySelector(".sa-live-call-widget-video-message-video-recording-icon").style.color="#4bbf73",document.querySelector(".sa-live-call-widget-video-message-screen-recording-icon").style.color="#fff"}))):E()):(c.style.display="block",r?(f=[],(i=new MediaRecorder(r)).addEventListener("dataavailable",(function(e){e.data&&e.data.size>0&&f.push(e.data)})),i.start()):console.error("Video preview not started. Please start the video preview before recording."))}c.autoplay=!0,c.muted=!0,E(),l.addEventListener("click",(function(){m&&!v&&(_(!1),document.querySelector(".sa-live-call-widget-video-message-video-recording-icon").style.color="#4bbf73",document.querySelector(".sa-live-call-widget-video-message-screen-recording-icon").style.color="#fff",g=!0,m=!1,b(),g=!1)})),d.addEventListener("click",(function(){m||(_(!1),document.querySelector(".sa-live-call-widget-video-message-video-recording-icon").style.color="#fff",document.querySelector(".sa-live-call-widget-video-message-screen-recording-icon").style.color="#4bbf73",g=!0,m=!0,b(),g=!1)})),o.addEventListener("click",(function(){g?(y(),g=!1,_(!1)):(b(),g=!0,_(!0))}))};function ta(e){return ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(e)}function na(){na=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ta(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ia(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ra(Object(n),!0).forEach((function(t){oa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ra(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oa(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==ta(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ta(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ta(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aa(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function sa(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){aa(o,r,i,a,s,"next",e)}function s(e){aa(o,r,i,a,s,"throw",e)}a(void 0)}))}}var ca=n(8922),la=n(7685),da=n(3585),ua='<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 16 16"\n  height="24"\n  width="24"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path\n    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"\n  ></path>\n</svg>',pa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Record Voice Message",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"voice_message";e.innerHTML=la({title:t});var r,i=document.querySelector(".sa-live-call-widget-audio-message-start-stop-recording-btn"),o=document.querySelector(".sa-live-call-widget-audio-message-controls-btn-wrapper"),a=document.querySelector(".sa-live-call-widget-audio-message-waves"),c=document.querySelector(".sa-live-call-widget-audio-message-play-pause-btn"),l=[],d=!1,p=!1,h=new Audio,f=!1;function m(){"permissions"in navigator&&"getUserMedia"in navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){l=[],(r=new MediaRecorder(e)).addEventListener("dataavailable",(function(e){e.data&&e.data.size>0&&l.push(e.data)})),r.start(),a.style.display="block"})).catch((function(e){console.error("Microphone permission denied or error:",e),v(!1),p=!0})):(console.error("Permissions API not supported"),v(!1))}function g(){r&&"inactive"!==r.state&&(r.stop(),r.addEventListener("stop",(function(){var t=new Blob(l,{type:"audio/webm"});h=new Audio(URL.createObjectURL(t)),a.style.display="block",c.style.display="flex",function(){i.style.display="none";var t='<button\n        class="sa-live-call-widget-audio-message-start-stop-recording-btn"\n        id="sa-live-call-widget-audio-message-re-record-btn"\n        style="color: black, opacity: 0.5"\n      >\n        Re-record\n      </button>\n      <button\n        class="sa-live-call-widget-audio-message-start-stop-recording-btn"\n        id="sa-live-call-widget-audio-message-submit-recording-btn"\n      >\n        Submit\n      </button>';o.insertAdjacentHTML("beforeend",t);var r=document.getElementById("sa-live-call-widget-audio-message-submit-recording-btn"),p=document.getElementById("sa-live-call-widget-audio-message-re-record-btn");p.addEventListener("click",(function(){h.pause(),h.src="",f=!1,c.innerHTML="".concat(ua,"Play"),c.style.display="none",m(),d=!0,i.style.display="block",a.style.display="block",v(!0),p.remove(),r.remove()})),r.addEventListener("click",sa(na().mark((function t(){var i,o,a,c,d;return na().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.innerHTML=da({}),r.style.cursor="not-allowed",i=H("form_data"),o=new Blob(l,{type:"audio/webm"}),(a=new FormData).append("files",o,"".concat(i.people_id,"/").concat((new Date).getTime(),".").concat(o.type.split("/")[1])),t.prev=6,t.next=9,fetch(s.url.SOURCE+"/".concat(U().id,"/storage"),{method:"POST",body:a,headers:{referrer:window.location.href}});case 9:if((c=t.sent).ok){t.next=12;break}throw new Error("Error uploading recorded audio");case 12:return t.next=14,c.json();case 14:if(!(d=t.sent)){t.next=20;break}return t.next=18,u.post(s.url.SOURCE,"/".concat(U().id,"/conversation"),ia(ia({},i),{},{message_content:d[0].url,message_type:n,message_from:i.people_id,source_id:U().id,source_type:"live_call",source_name:U().name,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href}));case 18:t.sent&&(V({message:"Your message has been received.",widgetName:"thankyouMessage"}),e.innerHTML=ca({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc());case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(6),console.error("Error uploading recorded video:",t.t0);case 25:case"end":return t.stop()}}),t,null,[[6,22]])}))))}(),h.addEventListener("ended",(function(){f=!1,c.innerHTML="".concat(ua,"Play")}))})))}function v(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(i.textContent="Stop Recording",i.style.background=document.documentElement.style.getPropertyValue("--themeColor"),i.style.color=document.documentElement.style.getPropertyValue("--invertColor")):(i.textContent="Start Recording",i.style.background="#4285f4",i.style.color="#fff")}i.addEventListener("click",(function(){p||(d?(g(),d=!1,v(!1)):(m(),d=!0,v(!0)))})),c.addEventListener("click",(function(){f?(c.innerHTML="".concat(ua,"Play"),h.pause(),f=!1):(c.innerHTML="".concat('<svg\n  stroke="currentColor"\n  fill="currentColor"\n  stroke-width="0"\n  viewBox="0 0 24 24"\n  height="24"\n  width="24"\n  xmlns="http://www.w3.org/2000/svg"\n>\n  <path fill="none" d="M0 0h24v24H0z"></path>\n  <path\n    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"\n  ></path>\n</svg>',"Pause"),h.play(),f=!0)}))};function ha(e){return ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ha(e)}function fa(){fa=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ha(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ma(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){va(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function va(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==ha(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ha(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ha(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _a(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ea(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){_a(o,r,i,a,s,"next",e)}function s(e){_a(o,r,i,a,s,"throw",e)}a(void 0)}))}}var ya=n(8922),wa=n(8141),ba=n(3585),Sa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Text Message",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text_message",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.innerHTML=wa({title:t,placeholder:r?"Enter message here":"Please leave a message for us"});var i=document.querySelector(".sa-live-call-widget-audio-message-submit-btn"),o=document.querySelector(".sa-live-call-widget-audio-message-textarea");i.addEventListener("click",Ea(fa().mark((function t(){var a;return fa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.innerHTML=ba({}),i.style.cursor="not-allowed",a=H("form_data"),!r){t.next=11;break}return window.open("https://api.whatsapp.com/send?text=".concat(o.value,"&phone=").concat(U().whatsapp_number),"_blank","noopener"),V({message:"You have been redirected to WhatsApp on another tab."}),e.innerHTML=ya({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc(),t.abrupt("return");case 11:return t.prev=11,t.next=14,u.post(s.url.SOURCE,"/".concat(U().id,"/conversation"),ga(ga({},a),{},{message_content:o.value,message_type:n,message_from:a.people_id,source_id:U().id,source_name:U().name,source_type:"live_call",source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href}));case 14:t.sent&&(V({message:"Your message has been received.",widgetName:"thankyouMessage"}),e.innerHTML=ya({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc()),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),console.error("Error uploading recorded video:",t.t0);case 21:case"end":return t.stop()}}),t,null,[[11,18]])}))))};function Ta(e){return Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ta(e)}function Ca(){Ca=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Ta(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ra(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var Ia=n(2461),Oa=n(6189);function Aa(e){var t=new Date(e),n=t.getHours()>12?t.getHours()-12:t.getHours(),r=t.getHours()>=12?"PM":"AM",i=t.getMinutes().toString().padStart(2,"0");return"".concat(n,":").concat(i," ").concat(r)}function Na(){return La.apply(this,arguments)}function La(){var e;return e=Ca().mark((function e(){var t,n,r,i,o,a,c=arguments;return Ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=c.length>0&&void 0!==c[0]?c[0]:Date.now(),n=document.getElementById("saleassistAiChatMessageInput"),document.querySelector(".sa-ai-chat-document-preview-container"),r=n.value,i=j().form_data,o=U(),""!==r.trim()&&(Pa("You",r,!0,t),n.value="",a={method:"POST",headers:{"Content-Type":"application/json",referrer:window.location.href},body:JSON.stringify({chat_group_id:"",form_id:i.form_id,message_content:r,message_from:i.people_id,message_type:"chat_request",meta:[],people_id:i.people_id,session_id:i.session_id,source_id:o.id,source_name:o.name,source_referrer:window.location.href.includes("&saleassist_referrer=")?window.location.href.split("&saleassist_referrer=")[1]:window.location.href,source_type:o.source_type,unique_field_value:i.unique_field_value})},fetch(s.url.SOURCE+"/".concat(o.id,"/conversation"),a).then((function(e){if(e.ok)return e.json();throw new Error("Request failed with status: ".concat(e.status))})).then((function(e){console.log("success",e)})).catch((function(e){var t=document.querySelectorAll("#saleassistAiChatLog .message");t[t.length-1].innerHTML+='<span title="Message Not Sent" class="sa-message-not-sent-error">'.concat(Oa(),"</span>"),console.error("An error occurred:",e)})));case 7:case"end":return e.stop()}}),e)})),La=function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ra(o,r,i,a,s,"next",e)}function s(e){Ra(o,r,i,a,s,"throw",e)}a(void 0)}))},La.apply(this,arguments)}function Pa(e,t,n,r){var i,o=document.getElementById("saleassistAiChatLog"),a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),l=!1;n?a.classList.add("sent"):a.classList.add("received"),s.classList.add("message"),c.classList.add("message-meta-info"),s.innerHTML=(i=/(https?:\/\/[^\s]+)/g,t.replace(i,(function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"}))),o.lastChild&&(n&&"sent"===o.lastChild.className&&o.lastChild.outerText.includes(Aa(r))||!n&&"received"===o.lastChild.className&&o.lastChild.outerText.includes(Aa(r)))&&(l=!0),c.innerHTML=l?"":"".concat(n?"":"<span>".concat(Ia(),"</span>").concat(e," | ")," ").concat(Aa(r)),a.appendChild(c),a.appendChild(s),o.appendChild(a),o.scrollTop=o.scrollHeight}function ka(e,t){Pa(e,t,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now())}function Da(e){return Da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Da(e)}function xa(){xa=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Da(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ma(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ua(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ma(o,r,i,a,s,"next",e)}function s(e){Ma(o,r,i,a,s,"throw",e)}a(void 0)}))}}var Va=n(1587),ja=n(2461),Ba=n(9001),Fa=n(4516),Ga=n(3585),Ha=n(9644),Wa=n(8873),Ka=function(){var e=Ua(xa().mark((function e(t){var n,r,i,o,a,c,l;return xa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j().form_data,t.innerHTML=Va({chatBotIcon:ja,chatLike:Ba,chatDislike:Fa,threeDotsLoader:Ga,uploadBtn:Ha,sendBtn:Wa}),e.next=4,u.get(s.url.SOURCE,"/".concat(U().id,"/conversation/").concat(n.session_id));case 4:if((r=e.sent)&&r.length>0)for(i=r.length-1;i>=0;i--)"openai"===r[i].message_from?ka("ChatBot",r[i].message_content,r[i].updated_on):r[i].message_from!==n.people_id?ka(r[i].unique_field_value,r[i].message_content,r[i].updated_on):Pa("You",r[i].message_content,!0,r[i].updated_on);else ka("ChatBot","Hello! Welcome to live Assistance."),ka("ChatBot","How can I help you?");(o=eo(s.url.SOCKET_URL,{query:"id=".concat(n.people_id,"&client_id=").concat(U().client_id)})).on("connect",(function(e){console.log(e,"socket connected successfully")})),o.on("message",function(){var e=Ua(xa().mark((function e(t){return xa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Message from socket",t),"widget_incoming_request_picked"===t.message&&ka("ChatBot","You have been connected to our agent, please proceed with your concern."),"widget_incoming_request_closed"===t.message&&ka("ChatBot","Thank you, hope your concern got resolved."),t.message_content&&"AI_HANDOVER"===t.message_content&&(ka("ChatBot","Well, i am not too sure of this."),ka("ChatBot","Let me see if i can get my senior to chat with you. Please wait...")),t.message_content&&"AI_HANDOVER"!==t.message_content&&t.message_from!==n.people_id&&ka("openai"===t.message_from?"ChatBot":t.unique_field_value,t.message_content);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a=document.getElementById("saleassistAiChatMessageInput"),c=document.querySelector("#saleassistAiChatUploadButton #ai-chat-upload-file"),l=document.getElementById("saleassistAiChatSendButton"),a.addEventListener("keydown",(function(e){13===e.keyCode&&(e.preventDefault(),Na())})),l.addEventListener("click",(function(){Na()})),c.addEventListener("click",(function(e){e.target.value=null})),c.addEventListener("change",(function(e){}));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qa=n(8922);function Ya(e){return Ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ya(e)}function za(){za=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Ya(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ja(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Xa(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ja(o,r,i,a,s,"next",e)}function s(e){Ja(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Qa(e){return new Promise((function(t){var n=document.createElement("script");n.src=e,n.onload=function(){t(!0)},n.onerror=function(){t(!1)},document.body.appendChild(n)}))}function Za(e,t,n,r,i,o,a,s,c,l){return $a.apply(this,arguments)}function $a(){return $a=Xa(za().mark((function e(t,n,r,i,o,a,c,l,d,u){var p,h;return za().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qa("https://checkout.razorpay.com/v1/checkout.js");case 2:if(e.sent){e.next=6;break}return alert("Razorpay SDK failed to load. Are you online?"),e.abrupt("return");case 6:p={key:l,order_id:t,description:"Live call Payment",handler:function(e){gr({url:s.url.SOURCE,path:"/live_merchant_pay_confirmation/"+r+"/"+a,data:{plan_payment_id:e.razorpay_payment_id,people_id:o,mode:"live_payment",amount:n,status:"authenticated",provider:"razorpay"},onSuccess:function(e){d&&d(e)}})},modal:{ondismiss:function(){gr({url:s.url.SOURCE,path:"/live_merchant_pay_confirmation/"+r+"/"+a,data:{people_id:o,mode:"live_payment",amount:n,status:"denied",provider:"razorpay"},onFailure:function(e){u&&u(e)}})}},notes:{people_id:o,meeting_id:c,client_id:i}},(h=new window.Razorpay(p)).on("payment.failed",(function(e){gr({url:s.url.SOURCE,path:"/live_merchant_pay_confirmation/"+r+"/"+a,data:{people_id:o,mode:"live_payment",amount:n,status:"failed",provider:"razorpay"},onFailure:function(e){u&&u(e)}})})),h.open();case 10:case"end":return e.stop()}}),e)}))),$a.apply(this,arguments)}function es(e,t,n,r,i,o,a,s){return ts.apply(this,arguments)}function ts(){return ts=Xa(za().mark((function e(t,n,r,i,o,a,c,l){return za().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:gr({url:s.url.SOURCE,path:"/merchant_pay_order/"+t,data:{amount:a,currency:o,receipt:r,notes:{client_id:n,people_id:r}},onSuccess:function(){var e=Xa(za().mark((function e(o){return za().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Za(o.data.order_id,a,t,n,r,i,null,o.razorpay_api_key,c,l);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onFailure:function(e){l&&l(e)}});case 1:case"end":return e.stop()}}),e)}))),ts.apply(this,arguments)}function ns(e){return ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ns(e)}function rs(){rs=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==ns(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function is(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var os=n(8345),as=function(){var e,t=(e=rs().mark((function e(t){var n,r,i,o,a,c,l,d,p,h,f=arguments;return rs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:"",r=U(),i=H("form_data"),o=H("user_data")||{},i){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,u.get(s.url.SOURCE,"/get_initiate_call_payment_confirmation/".concat(r.id,"/").concat(null==i?void 0:i.people_id));case 9:e.sent?"video_call"===n?Uo(t,n):te(t,r.id):(p=o.advance_payment_type?null===(a=o.advance_payment_type)||void 0===a||null===(c=a[0])||void 0===c?void 0:c.split("-")[0]:r.advance_payment_currency,h=o.advance_payment_type?null===(l=o.advance_payment_type)||void 0===l||null===(d=l[0])||void 0===d?void 0:d.split("-")[1]:r.advance_payment_amount,t.innerHTML=os({paymentCurrency:p,paymentAmount:h}),document.getElementById("sa-live-call-widget-advance-payment-btn").addEventListener("click",(function(){es(r.id,r.client_id,i.people_id,i.form_id,p,h,(function(e){console.log("Payment success."),"video_call"===n?Uo(t,n):te(t,r.id)}),(function(e){console.error("Your payment could not be processed.")}))}))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[6,13]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){is(o,r,i,a,s,"next",e)}function s(e){is(o,r,i,a,s,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}(),ss=function(e,t,n){V({isWidgetOpened:!0});var r=U();t.includes("schedule_meeting")?(r.capture_advance_payment?as(e,"schedule_meeting"):te(e,n),V({widgetName:"scheduleMeeting"})):t.includes("video_call")?(r.capture_advance_payment?as(e,"video_call"):Uo(e,"video_call"),V({widgetName:"videoCall"})):t.includes("video_message")?(ea(e),V({widgetName:"videoMessage"})):t.includes("video_feedback")?(ea(e,"Record Video Feedback","video_feedback"),V({widgetName:"videoFeedback"})):t.includes("audio_call")?(Uo(e,"audio_call"),V({widgetName:"audioCall"})):t.includes("voice_message")?(pa(e),V({widgetName:"voiceMessage"})):t.includes("audio_feedback")?(pa(e,"Record Audio Feedback","audio_feedback"),V({widgetName:"audioFeedback"})):t.includes("text_message")?(Sa(e),V({widgetName:"textMessage"})):t.includes("text_feedback")?(Sa(e,"Text Feedback","text_feedback"),V({widgetName:"textFeedback"})):t.includes("whatsapp_message")?(Sa(e,"WhatsApp Message","",!0),V({widgetName:"whatsappMessage"})):t.includes("feedback_form")?(ze(),V({widgetName:"feedbackForm"})):t.includes("ai_chat")?(Ka(e),V({widgetName:"AiChat"})):t.includes("shoppable_video")?function(e){V({message:"",widgetName:"thankyouMessage"}),e.innerHTML=qa({defaultMessage:j().message,thankyouMessage:U().thankyou_message}),lc()}(e):t.includes("chat-first-approach")&&(Ka(e),V({widgetName:"AiChat"}))},cs=n(7289),ls=n(8666),ds=n(6254),us=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AIzaSyDRnJ-FGnxGDemTnGqkAOWAjw35bOlE-Yg";return new Promise((function(t,n){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(r){var i=r.coords.latitude,o=r.coords.longitude,a="https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(i,",").concat(o,"&key=").concat(e);fetch(a).then((function(e){if(!e.ok)throw new Error("Request failed");return e.json()})).then((function(e){if("OK"===e.status&&e.results.length>0){var r=e.results[0];t({address:r,latitude:i,longitude:o})}else n("No results found")})).catch((function(e){n(e.message)}))}),(function(e){n("Geolocation error: "+e.message)})):n("Geolocation is not supported by this browser")}))},ps=function(e,t){var n=function(e){var t="",n=[];if(void 0===e?t=(n=(e=window.location.search).substring(1).split("&"))[0]:void 0!==(t=e.split("?")[1])&&(n=t.split("&")),void 0!==t&&""!==t){for(var r={},i=0;i<n.length;i++){var o=n[i].split("=");if(void 0!==o[0]&&""!==o[0]){var a=o[1];void 0===a&&(a=""),r[o[0]]=a}}return r}return{}}(t);return void 0===n[e]?"":n[e]};function hs(e){return hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hs(e)}function fs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ms(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ms(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ms(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gs(){gs=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==hs(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function vs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(n),!0).forEach((function(t){Es(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Es(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==hs(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==hs(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===hs(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ys(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function ws(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ys(o,r,i,a,s,"next",e)}function s(e){ys(o,r,i,a,s,"throw",e)}a(void 0)}))}}var bs=n(9004),Ss=n(3585),Ts=function(e){for(var t in e)e[t]&&("string"!=typeof e[t]||e[t].trim())||"boolean"==typeof e[t]||delete e[t];return e},Cs=function(e,t){if(document.getElementById(e)){var n=U();V({isWidgetOpened:!0,widgetName:"leadCaptureForm"});var r=n.id,i="string"==typeof n.lead_form?JSON.parse(n.lead_form):[],o=i.filter((function(e){return e.required})),a=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper"),c=function(){ss(a,e,r)},l=function(){var e=ws(gs().mark((function e(){var t,n,i=arguments;return gs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i.length>0&&void 0!==i[0]&&i[0])){e.next=15;break}return null!==(t=h.mobile_number)&&void 0!==t&&t.trim().length&&(h.country_code=g),e.prev=3,e.next=6,u.post(s.url.SOURCE,"/".concat(r,"/capture"),{session_id:H("session_data"),user_data:_s(_s(_s({},Ts(h)),f),m)});case 6:(n=e.sent)&&(G("form_data",n),V({form_data:n}),c()),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("Something went wrong");case 13:e.next=16;break;case 15:c();case 16:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}();if(H("form_data"))l();else{var d,p,h={},f={},m={},g="+91";if(n.capture_lead_url_params&&n.lead_url_params.length>0&&(d=n.lead_url_params.split(new RegExp("[,; ]","g")).filter((function(e){var t;return(null==e||null===(t=e.trim())||void 0===t?void 0:t.length)>0})),Array.isArray(d)&&d.length>0&&d.forEach((function(e){var t=ps(e);t.length>0&&(f[e]=t)}))),n.capture_lead_cookies&&n.lead_cookies.length>0&&(p=n.lead_cookies.split(new RegExp("[,; ]","g")).filter((function(e){var t;return(null==e||null===(t=e.trim())||void 0===t?void 0:t.length)>0})),Array.isArray(p)&&p.length>0&&p.forEach((function(e){var t=Xe(e);t.length>0&&(m[e]=t)}))),["www.unbottle.com","unbottle.com"].includes(window.location.hostname)&&j().is_agent_online)return f.name="user-".concat(Math.random().toString(36).substring(2,15)),void l(!0);if(!n.capture_lead_form&&n.unique_field_name in f&&f[n.unique_field_name])l(!0);else{a.innerHTML=bs({poweredBy:!j().addons.remove_powered_by,conversationName:t||""});var v=document.getElementById("sa-live-call-widget-lead-capture-form");document.querySelector(".sa-live-call-widget-lead-capture-form-fields-container").insertAdjacentHTML("afterbegin",q(i));var _=document.querySelector(".sa-live-call-widget-selected-country-wrapper");if(_){var E=document.querySelector(".sa-live-call-widget-select-country-arrow"),y=document.querySelector(".sa-live-call-widget-country-list");_.addEventListener("click",(function(){y.classList.toggle("sa-live-call-widget-d-hidden"),E.classList.toggle("sa-live-call-widget-rotate-180")}));var w=document.querySelectorAll(".sa-live-call-widget-country"),b=document.querySelector(".sa-live-call-widget-selected-country");w.forEach((function(e){e.addEventListener("click",(function(){g=e.getAttribute("data-country-dial-code"),b.innerHTML=g,y.classList.add("sa-live-call-widget-d-hidden"),E.classList.remove("sa-live-call-widget-rotate-180")}))}))}(e.includes("audio_call")||e.includes("video_call")||e.includes("video_message"))&&function(){var e="undefined"!=typeof InstallTrigger||navigator.userAgent.includes("Firefox"),t=document.querySelector(".sa-live-call-widget-lead-capture-form-container"),n=document.querySelector(".sa-live-call-widget-lead-capture-form-submit-btn-wrapper");n.innerHTML=cs({});var r=document.getElementById("sa-live-call-widget-lead-capture-form-microphone-permission-btn"),i=".sa-live-call-widget-lead-capture-form-media-permission-denied-overlay",o=!1,a=function(){var e=document.querySelector(i);e?e.style.display="flex":(t.insertAdjacentHTML("beforeend",ds({})),e=document.querySelector(i)),o||(e.addEventListener("click",(function(){e.style.display="none"})),o=!0)};r.addEventListener("click",(function(){"permissions"in navigator&&"getUserMedia"in navigator.mediaDevices?e?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){n.innerHTML=ls({}),e.getTracks().forEach((function(e){e.stop()}))})).catch((function(e){console.log("Microphone or camera permission denied or error:",e),a()})):navigator.permissions.query({name:"microphone"}).then((function(e){"granted"===e.state?n.innerHTML=ls({}):"prompt"===e.state?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){n.innerHTML=ls({}),e.getTracks().forEach((function(e){e.stop()}))})).catch((function(e){console.log("Microphone or camera permission denied or error:",e)})):"denied"===e.state&&a()})).catch((function(e){console.log("Error checking microphone permission:",e)})):console.log("Permissions API not supported")}))}(),v.addEventListener("submit",function(){var e=ws(gs().mark((function e(t){var r,a,s,c,d,u,p,f,m,_,E,y,w,b,S,T,C,R,I,O;return gs().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),(r=document.querySelector(".sa-live-call-widget-required-field-error")).style.display="none",!n.capture_location){e.next=23;break}return e.prev=4,e.next=7,us();case 7:a=e.sent,s=a.address,c=a.latitude,d=a.longitude,h.widget_location_source="GPS("+c+", "+d+")",h.widget_address=s.formatted_address,h.widget_city=s.address_components[s.address_components.length-4].long_name,h.widget_state=s.address_components[s.address_components.length-3].long_name,h.widget_country=s.address_components[s.address_components.length-2].long_name,h.widget_latitude=c,h.widget_longitude=d,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(4),console.error("Geocoding failed:",e.t0);case 23:(u=document.querySelector(".sa-live-call-widget-lead-capture-form-submit-btn")).innerHTML=Ss({}),u.style.cursor="not-allowed",p=v.querySelectorAll(".sa-live-call-widget-lead-capture-form-field"),f=v.querySelectorAll(".sa-live-call-widget-lead-capture-form-field-radio"),m=v.querySelectorAll(".sa-live-call-widget-lead-capture-form-field-checkbox"),p.forEach((function(e){if("select"===e.tagName.toLocaleLowerCase()){var t=Array.from(e.querySelectorAll("option:checked"),(function(e){return e.value}));h[e.name]=t}else h[e.name]=e.value})),_=function(e){var t=[];e.forEach((function(e){e.checked&&t.push(e.value)})),h[e[0].getAttribute("name")]=t},f.length&&_(f),m.length&&_(m),E=!1,y=fs(o),e.prev=35,y.s();case 37:if((w=y.n()).done){e.next=45;break}if(b=w.value,!((S=b.name)in h)||!1!==h[S]&&null!==h[S]&&void 0!==h[S]&&("string"!=typeof h[S]||""!==h[S].trim())){e.next=43;break}return E=!0,e.abrupt("break",45);case 43:e.next=37;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(35),y.e(e.t1);case 50:return e.prev=50,y.f(),e.finish(50);case 53:T=h.mobile_number,10,C=i.find((function(e){return"mobile_number"===e.name}))||{},R=C.maxlength,I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r.innerHTML=e,r.style.display="block",u.innerHTML="Submit",u.style.cursor="pointer"},T&&(T.length<10||T.length>R)?(O=T.length>R?"Mobile number exceeds ".concat(R," digit."):"Please Enter ".concat(10," digit Mobile Number."),I(O)):E?I("Required fields can't be empty."):(T&&(h.mobile_number="".concat(g).concat(h.mobile_number)),G("user_data",h),l(!0));case 58:case"end":return e.stop()}}),e,null,[[4,20],[35,47,50,53]])})));return function(t){return e.apply(this,arguments)}}())}}}};function Rs(e){return Rs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rs(e)}function Is(){Is=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Rs(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Os(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}var As=function(){var e,t=(e=Is().mark((function e(t,n){var r,i,o,a,c,l,d,p,h;return Is().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=j().widgetFormFactor,o=j().widgetName,a=U(),c=null===(r=H("form_data"))||void 0===r?void 0:r.people_id,l=H("session_data"),d="",p="",p="boolean"==typeof t?j().isWidgetOpened?"video_message"===a.button_type||"video_icon"===a.button_type?s.clicked_on.video_icon:a.button_type:s.clicked_on.close_window:t,l||(l=W(),G("session_data",l)),d="button"===i?"button":"embed"===i?"embedded_widget":window.location.href.includes("".concat(s.url.SOURCE,"/jump/"))?"jump":window.location.href.includes("".concat(s.url.SOURCE,"/registration/"))?"registration":"widget",h={clicked_on:p,source_form:d,app_panel:n||o,session_id:l,people_id:c||""},e.prev=11,e.next=14,u.post(s.url.SOURCE,"/register_click/".concat(a.id),h);case 14:e.sent,V({widgetName:null}),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),console.error("Unable to register click on ".concat(n||o));case 21:case"end":return e.stop()}}),e,null,[[11,18]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Os(o,r,i,a,s,"next",e)}function s(e){Os(o,r,i,a,s,"throw",e)}a(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),Ns=n(3378),Ls=n(1717),Ps=n(5366),ks=n(6315),Ds=n(5761),xs=n(3209),Ms=n(8095),Us=n(8310),Vs=n(8617),js=n(5801),Bs=n(9022),Fs=n(6113),Gs=n(5622),Hs=n(8001),Ws=null,Ks=null,qs=!1,Ys=!1,zs=function(e){if(e){var t=ps("cta");t&&"video_call"===t&&e.id.includes(t)&&e.click()}},Js=function(){if(Ys||arguments.length>0&&void 0!==arguments[0]&&arguments[0])return clearTimeout(Ks),void clearTimeout(Ws);var e=U(),t=e.button_position,n=e.trigger_loop,r=e.trigger_delay,i=e.trigger_hold,o=e.trigger_interval,a=e.trigger_messages;if(e.allow_trigger_messages&&0!==(null==a?void 0:a.filter((function(e){return e.trim().length>0})).length)){var s=j().is_agent_online?e.live_conversation_types.filter((function(e){return e.length>0})):e.offline_conversation_types.filter((function(e){return e.length>0})),c=document.getElementById("sa-live-call-widget-trigger-message-container"),l=document.querySelector(".sa-live-call-widget-trigger-message-cta-wrapper-".concat(t)),d=document.querySelector(".sa-live-call-widget-trigger-message");c.style.display="none";var u=t.includes("bottom"),p=0;setTimeout((function(){f()}),1e3*r)}else{var h=document.querySelector("#sa-live-call-widget-trigger-message-container");h&&(h.style.display="none")}function f(){Object.assign(c.style,{display:u?"block":"flex",flexDirection:"column-reverse",gap:s.length>0?"10px":""}),d.innerHTML="".concat(e.trigger_messages[p]);var t=c.clientHeight;(c.style["".concat(u?"top":"bottom")]="-".concat(t+20,"px"),qs)||(l.insertAdjacentHTML("beforeend",'<div class="sa-live-call-widget-close-trigger-message-btn">\n          <svg\n            stroke="currentColor"\n            fill="currentColor"\n            stroke-width="0"\n            viewBox="0 0 24 24"\n            height="14"\n            width="14"\n            xmlns="http://www.w3.org/2000/svg"\n            class="sa-live-call-widget-close-trigger-message-btn-icon"\n          >\n            <path\n              fill="none"\n              stroke="currentColor"\n              stroke-width="3"\n              d="M3,3 L21,21 M3,21 L21,3"\n            ></path>\n          </svg>\n        </div>'),qs=!0,document.querySelector(".sa-live-call-widget-close-trigger-message-btn").addEventListener("click",(function(){c.innerHTML="",Ys=!0,clearTimeout(Ks),clearTimeout(Ws)})));(p+=1)>=a.length&&(p=0),n&&(Ws=setTimeout((function(){c.style.display="none",Ks=setTimeout((function(){f()}),1e3*o)}),1e3*i))}},Xs=function(){var e,t=U(),n=t.button_position,r=j().is_agent_online?t.live_conversation_types:t.offline_conversation_types,i=document.querySelector(".sa-live-call-widget-trigger-message-cta-wrapper-".concat(n));"shoppable_video"!==t.button_type&&(null===(e=r.filter((function(e){return e.length>0})))||void 0===e||e.forEach((function(e,t){var n,r,o,a='\n          <div\n            id="sa-live-call-widget-'.concat(e,'-btn"\n            class="sa-btn-cta-icon-box"\n          >\n            ').concat((n=e,r=0===t?"var(--invertColor)":null,o=r||"#646a73","video_call"==n?"<svg\n        stroke=".concat(o,'\n        fill="none"\n        stroke-width="1.5"\n        viewBox="0 0 24 24"\n        aria-hidden="true"\n        height="20"\n        width="20"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          stroke-linecap="round"\n          d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n        ></path>\n      </svg>'):"audio_call"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="2 2 16 16"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M6.98706 2.06589L6.27036 2.28192C4.96684 2.67484 4.00944 3.78801 3.81598 5.13565C3.519 7.20438 4.18323 9.62242 5.78368 12.3945C7.38077 15.1607 9.13867 16.9433 11.0739 17.7231C12.3435 18.2346 13.7948 17.9592 14.7886 17.018L15.3314 16.5039C16.0589 15.815 16.1643 14.694 15.5781 13.8815L14.2215 12.0014C13.8458 11.4807 13.1805 11.2569 12.5665 11.4446L10.5158 12.0716L10.4628 12.082C10.2366 12.115 9.7154 11.6259 9.06527 10.4999C8.38512 9.32181 8.24417 8.63298 8.43194 8.45541L9.47529 7.48248C10.2572 6.75332 10.4882 5.60728 10.0499 4.63213L9.38841 3.16075C8.97652 2.24451 7.94888 1.77597 6.98706 2.06589ZM8.47634 3.57077L9.13779 5.04215C9.40063 5.62682 9.26212 6.31395 8.7933 6.75113L7.74739 7.72645C7.0783 8.35918 7.29992 9.44218 8.19924 10.9999C9.04545 12.4655 9.81744 13.1898 10.6469 13.0642L10.7713 13.0376L12.8589 12.4009C13.0635 12.3383 13.2853 12.413 13.4105 12.5865L14.7671 14.4666C15.0603 14.8729 15.0076 15.4334 14.6438 15.7778L14.101 16.2919C13.3911 16.9642 12.3545 17.1609 11.4476 16.7955C9.74957 16.1113 8.14475 14.484 6.64971 11.8945C5.15161 9.29969 4.54531 7.09254 4.80583 5.27775C4.94402 4.31515 5.62787 3.52003 6.55896 3.23937L7.27566 3.02334C7.75657 2.87838 8.27039 3.11265 8.47634 3.57077Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"whatsapp_message"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="2 2.9 15.5 14.85"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          fill-rule="evenodd"\n          clip-rule="evenodd"\n          d="M15.3358 4.69419C14.6428 3.99659 13.8182 3.44345 12.9099 3.06681C12.0015 2.69018 11.0275 2.49752 10.0442 2.50002C5.92083 2.50002 2.56417 5.85586 2.5625 9.98086C2.5625 11.2992 2.90667 12.5859 3.56083 13.7209L2.5 17.5967L6.46583 16.5559C7.56283 17.153 8.79183 17.4661 10.0408 17.4667H10.0442C14.1667 17.4667 17.5233 14.1109 17.525 9.98586C17.5278 9.00293 17.3358 8.02918 16.9601 7.12091C16.5843 6.21263 16.0323 5.38783 15.3358 4.69419ZM10.0442 16.2042H10.0417C8.92793 16.2043 7.83469 15.9047 6.87667 15.3367L6.65 15.2017L4.29667 15.8192L4.92417 13.525L4.77667 13.29C4.15399 12.2987 3.82436 11.1515 3.82583 9.98086C3.8275 6.55252 6.61667 3.76336 10.0467 3.76336C10.8635 3.76154 11.6727 3.92176 12.4272 4.23473C13.1818 4.54771 13.8667 5.00723 14.4425 5.58669C15.0213 6.16339 15.4802 6.8491 15.7924 7.60419C16.1047 8.35927 16.2641 9.16876 16.2617 9.98586C16.26 13.4142 13.4708 16.2042 10.0442 16.2042ZM13.455 11.5467C13.2675 11.4525 12.3492 11.0009 12.1775 10.9384C12.0067 10.8759 11.8825 10.845 11.7575 11.0317C11.6325 11.2184 11.2742 11.6392 11.165 11.7642C11.0558 11.8892 10.9467 11.9042 10.76 11.8109C10.5733 11.7175 9.97083 11.52 9.25667 10.8834C8.70083 10.3875 8.32583 9.77586 8.21667 9.58836C8.1075 9.40086 8.205 9.30002 8.29917 9.20669C8.38333 9.12336 8.48583 8.98836 8.57917 8.87919C8.6725 8.77002 8.70333 8.69252 8.76583 8.56752C8.82833 8.44252 8.7975 8.33336 8.75 8.24002C8.70333 8.14586 8.32917 7.22586 8.17333 6.85169C8.0225 6.48919 7.86833 6.53752 7.75333 6.53252C7.63423 6.52765 7.51503 6.52543 7.39583 6.52586C7.30105 6.52827 7.20778 6.55025 7.12188 6.5904C7.03599 6.63055 6.95931 6.68801 6.89667 6.75919C6.725 6.94669 6.2425 7.39836 6.2425 8.31836C6.2425 9.23836 6.9125 10.1275 7.00583 10.2525C7.09917 10.3775 8.32417 12.265 10.1992 13.075C10.6458 13.2675 10.9942 13.3825 11.265 13.4692C11.7125 13.6117 12.12 13.5909 12.4425 13.5434C12.8017 13.49 13.5483 13.0917 13.7042 12.655C13.86 12.2184 13.86 11.8442 13.8133 11.7659C13.7667 11.6875 13.6408 11.64 13.455 11.5467Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"text_message"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="2 2 16 16"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M10 2C14.4183 2 18 5.58172 18 10C18 14.4183 14.4183 18 10 18C8.72679 18 7.49591 17.7018 6.38669 17.1393L6.266 17.075L2.62109 17.9851C2.31127 18.0625 2.02622 17.8369 2.00131 17.5438L2.00114 17.4624L2.01493 17.3787L2.925 13.735L2.86169 13.6153C2.4066 12.7186 2.12433 11.7422 2.03275 10.7283L2.00738 10.3463L2 10C2 5.58172 5.58172 2 10 2ZM10 3C6.13401 3 3 6.13401 3 10C3 11.217 3.31054 12.3878 3.89352 13.4249C3.94046 13.5084 3.9621 13.603 3.95692 13.6973L3.94274 13.7912L3.187 16.812L6.21104 16.0583C6.27294 16.0429 6.33662 16.0396 6.39873 16.0479L6.4903 16.0691L6.57701 16.1075C7.61362 16.6898 8.7837 17 10 17C13.866 17 17 13.866 17 10C17 6.13401 13.866 3 10 3ZM10.5 11C10.7761 11 11 11.2239 11 11.5C11 11.7455 10.8231 11.9496 10.5899 11.9919L10.5 12H7.5C7.22386 12 7 11.7761 7 11.5C7 11.2545 7.17688 11.0504 7.41012 11.0081L7.5 11H10.5ZM12.5 8C12.7761 8 13 8.22386 13 8.5C13 8.74546 12.8231 8.94961 12.5899 8.99194L12.5 9H7.5C7.22386 9 7 8.77614 7 8.5C7 8.25454 7.17688 8.05039 7.41012 8.00806L7.5 8H12.5Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"video_message"==n?"<svg\n        stroke=".concat(o,'\n        fill="none"\n        stroke-width="1.5"\n        viewBox="0 0 24 24"\n        aria-hidden="true"\n        height="20"\n        width="20"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          stroke-linecap="round"\n          d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n        ></path>\n      </svg>'):"voice_message"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="2 2 16 16"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M10 13C11.6569 13 13 11.6568 13 9.99998V5C13 3.34315 11.6569 2 10 2C8.34315 2 7 3.34315 7 5V9.99998C7 11.6568 8.34315 13 10 13ZM10 12C8.89543 12 8 11.1046 8 9.99998V5C8 3.89543 8.89543 3 10 3C11.1046 3 12 3.89543 12 5V9.99998C12 11.1046 11.1046 12 10 12ZM5 9.49998C5.27614 9.49998 5.5 9.72384 5.5 9.99998C5.5 12.4853 7.51472 14.5 10 14.5C12.4853 14.5 14.5 12.4853 14.5 9.99998C14.5 9.72384 14.7239 9.49998 15 9.49998C15.2761 9.49998 15.5 9.72384 15.5 9.99998C15.5 12.869 13.3033 15.2249 10.5 15.4776V17.5C10.5 17.7761 10.2761 18 10 18C9.72386 18 9.5 17.7761 9.5 17.5V15.4776C6.69675 15.2249 4.5 12.869 4.5 9.99998C4.5 9.72384 4.72386 9.49998 5 9.49998Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"text_feedback"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="3 3 16 16"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M5 3C3.89543 3 3 3.89543 3 5V15C3 16.1046 3.89543 17 5 17H9.22047L9.43163 16.1553C9.44469 16.1031 9.45904 16.0513 9.47466 16H5C4.44772 16 4 15.5523 4 15V5C4 4.44772 4.44772 4 5 4H15C15.5523 4 16 4.44772 16 5V9.23163C16.3194 9.09477 16.6586 9.01856 17 9.00299V5C17 3.89543 16.1046 3 15 3H5ZM9.5 14H10.9427L11.9427 13H9.5C9.22386 13 9 13.2239 9 13.5C9 13.7761 9.22386 14 9.5 14ZM7.5 7.25C7.5 7.66421 7.16421 8 6.75 8C6.33579 8 6 7.66421 6 7.25C6 6.83579 6.33579 6.5 6.75 6.5C7.16421 6.5 7.5 6.83579 7.5 7.25ZM6.75 11C7.16421 11 7.5 10.6642 7.5 10.25C7.5 9.83579 7.16421 9.5 6.75 9.5C6.33579 9.5 6 9.83579 6 10.25C6 10.6642 6.33579 11 6.75 11ZM6.75 14C7.16421 14 7.5 13.6642 7.5 13.25C7.5 12.8358 7.16421 12.5 6.75 12.5C6.33579 12.5 6 12.8358 6 13.25C6 13.6642 6.33579 14 6.75 14ZM9.5 7C9.22386 7 9 7.22386 9 7.5C9 7.77614 9.22386 8 9.5 8H13.5C13.7761 8 14 7.77614 14 7.5C14 7.22386 13.7761 7 13.5 7H9.5ZM9.5 10C9.22386 10 9 10.2239 9 10.5C9 10.7761 9.22386 11 9.5 11H13.5C13.7761 11 14 10.7761 14 10.5C14 10.2239 13.7761 10 13.5 10H9.5ZM10.9798 15.3772L15.8092 10.5478C16.5395 9.81741 17.7237 9.81741 18.454 10.5478C19.1843 11.2781 19.1843 12.4622 18.454 13.1926L13.6246 18.022C13.343 18.3036 12.9902 18.5033 12.6039 18.5999L11.106 18.9744C10.4546 19.1372 9.86451 18.5472 10.0274 17.8958L10.4018 16.3979C10.4984 16.0116 10.6982 15.6588 10.9798 15.3772Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"video_feedback"==n?"<svg\n        stroke=".concat(o,'\n        fill="none"\n        stroke-width="1.5"\n        viewBox="0 0 24 24"\n        aria-hidden="true"\n        height="20"\n        width="20"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          stroke-linecap="round"\n          d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"\n        ></path>\n      </svg>'):"audio_feedback"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="0 0 122.88 113.8"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          fill='.concat(o,'\n          d="M0,67.6c-.06-5.83,2.16-11,7.37-12.69l.13-.22a2.91,2.91,0,0,1,.6-.8,3.1,3.1,0,0,1,1.05-.5l.29-.11C34.7,44,46.09,30.07,52.64,20.61c0,9.29,2.33,21.4,6.43,33.12,4.21,12,10.29,23.71,17.71,31.76h0c-7.73-2.2-17.43-5-33.21-2.85a15.17,15.17,0,0,0-1.12,5.06,3.9,3.9,0,0,0,1,3l.24.22c1,.91,1.49,1.36,1.71,2.17a9.17,9.17,0,0,1-.13,3.22l-.09.67c-.37,2.93,1.05,3.53,2.46,4.13s2.51,1.08,3.08,2.69a.68.68,0,0,1,0,.4c-.58,3-2.5,4.64-4.43,6.29-.47.41-.95.82-1.36,1.21l-.06,0c-3.92,3.14-6.57,2.3-8.58-.22-1.58-2-2.68-5-3.7-7.81l-.44-1.22a122.88,122.88,0,0,1-4-15.09l-.34-1.5c-.87.24-1.78.51-2.73.79h0c-1.2.35-2.4.73-3.59,1.11l-.38.14a1.21,1.21,0,0,1-1.33,0C13.47,90,8.2,87,4.68,82a25,25,0,0,1-3.41-6.9A25.74,25.74,0,0,1,0,67.6ZM87.81,16.16a3,3,0,0,1-4.23-.6l-.07-.09a3.05,3.05,0,0,1,.63-4.19C89,7.69,93.84,4.07,98.7.56A3.09,3.09,0,0,1,100.92,0a3.06,3.06,0,0,1,2,1.21l0,.05a3,3,0,0,1,.52,2.23,3,3,0,0,1-1.21,2L87.81,16.16Zm15.79,57.7h0a3,3,0,0,1-2.11-.93,3,3,0,0,1-.85-2.14v-.07a3,3,0,0,1,3.07-3c5.37,0,10.83.2,16.2.3a3.07,3.07,0,0,1,3,3.1,3.09,3.09,0,0,1-.93,2.15,3,3,0,0,1-2.16.86l-16.19-.31Zm.47-15.71a3,3,0,0,1-3.25-2.78V55.3a3.07,3.07,0,0,1,2.77-3.23c5-.4,10.09-.83,15.1-1.15a3.06,3.06,0,0,1,3.24,2.81h0a3,3,0,0,1-.73,2.21A3.08,3.08,0,0,1,119.12,57c-4.85.48-10.18.88-15.05,1.14Zm-2.16-14.59a3.06,3.06,0,0,1-3.78-2.11v0a3,3,0,0,1,.27-2.3,3.1,3.1,0,0,1,1.83-1.46c5.21-1.37,10.4-3.05,15.61-4.45a3,3,0,0,1,2.3.27,3.08,3.08,0,0,1,1.45,1.8v0a3.07,3.07,0,0,1-2.1,3.78l-15.59,4.45Zm-6.3-14.32a3.05,3.05,0,0,1-4.09-1.37,3,3,0,0,1-.17-2.33,3.09,3.09,0,0,1,1.53-1.77l15-7.49a3,3,0,0,1,4.09,1.37,3,3,0,0,1,.16,2.33,3.07,3.07,0,0,1-1.53,1.76l-15,7.5ZM58.75,12c.13-.15.27-.29.4-.42a4.46,4.46,0,0,1,1.48-1.11h0a3.58,3.58,0,0,1,2-.08c2.25.36,4.66,2,7.11,4.51,6,6.19,12.32,18,16.82,30.41s7.2,25.36,5.85,33.77c-.51,3.13-1.57,5.66-3.31,7.33l-.09.07a5.64,5.64,0,0,1-2.47,1,2.43,2.43,0,0,0-.25-.2C80.3,83,75,75.9,70.54,67.55c1.14.22,2.6-.63,4-2.08,7-7.38,3.56-20.28-5.17-23.27C65.81,41,62.27,41,60.87,41.69l-.15.08C57.52,29.42,56.61,18,58.75,12Z"\n        />\n      </svg>'):"ai_chat"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="0 0 459.579 459.579"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M429.579,14.7H139.935c-16.569,0-30,13.431-30,30v80.993h30V44.7h289.644v183.393h-48.495v30h48.495c16.568,0,30-13.431,30-30V44.7C459.579,28.132,446.148,14.7,429.579,14.7z"\n          fill='.concat(o,'\n        />\n        <path\n          d="M319.644,155.693H30c-16.565,0-30,13.427-30,30v183.393c0,16.569,13.431,30,30,30h92.333l29.531,35.11c11.99,14.255,33.945,14.234,45.917,0l29.531-35.11h92.333c9.32,0,17.647-4.25,23.149-10.917c0.306-0.37,0.603-0.748,0.891-1.133c3.743-5.005,5.96-11.219,5.96-17.95V185.693C349.644,169.126,336.214,155.693,319.644,155.693z M319.644,369.086h-106.3l-38.522,45.799L136.3,369.086H30V185.693h289.644V369.086z"\n          fill=').concat(o,'\n        />\n        <path\n          d="M80.011,257.792h189.621c8.284,0,15-6.716,15-15s-6.716-15-15-15H80.011c-8.284,0-15,6.716-15,15S71.727,257.792,80.011,257.792z"\n          fill=').concat(o,'\n        />\n        <path\n          d="M80.011,325.573h77.621c8.284,0,15-6.716,15-15s-6.716-15-15-15H80.011c-8.284,0-15,6.716-15,15S71.727,325.573,80.011,325.573z"\n          fill=').concat(o,"\n        />\n      </svg>"):"schedule_meeting"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="3 3 14 14"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M7 11C7.55228 11 8 10.5523 8 10C8 9.44771 7.55228 9 7 9C6.44772 9 6 9.44771 6 10C6 10.5523 6.44772 11 7 11ZM8 13C8 13.5523 7.55228 14 7 14C6.44772 14 6 13.5523 6 13C6 12.4477 6.44772 12 7 12C7.55228 12 8 12.4477 8 13ZM10 11C10.5523 11 11 10.5523 11 10C11 9.44771 10.5523 9 10 9C9.44771 9 9 9.44771 9 10C9 10.5523 9.44771 11 10 11ZM11 13C11 13.5523 10.5523 14 10 14C9.44771 14 9 13.5523 9 13C9 12.4477 9.44771 12 10 12C10.5523 12 11 12.4477 11 13ZM13 11C13.5523 11 14 10.5523 14 10C14 9.44771 13.5523 9 13 9C12.4477 9 12 9.44771 12 10C12 10.5523 12.4477 11 13 11ZM17 5.5C17 4.11929 15.8807 3 14.5 3H5.5C4.11929 3 3 4.11929 3 5.5V14.5C3 15.8807 4.11929 17 5.5 17H14.5C15.8807 17 17 15.8807 17 14.5V5.5ZM4 7H16V14.5C16 15.3284 15.3284 16 14.5 16H5.5C4.67157 16 4 15.3284 4 14.5V7ZM5.5 4H14.5C15.3284 4 16 4.67157 16 5.5V6H4V5.5C4 4.67157 4.67157 4 5.5 4Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"feedback_form"==n?'<svg\n        width="20"\n        height="20"\n        viewBox="3 3 14 14"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7H13.5C13.7761 7 14 6.77614 14 6.5C14 6.22386 13.7761 6 13.5 6H6.5ZM6 9.5C6 9.22386 6.22386 9 6.5 9H10.5C10.7761 9 11 9.22386 11 9.5C11 9.77614 10.7761 10 10.5 10H6.5C6.22386 10 6 9.77614 6 9.5ZM6.5 12C6.22386 12 6 12.2239 6 12.5C6 12.7761 6.22386 13 6.5 13H13.5C13.7761 13 14 12.7761 14 12.5C14 12.2239 13.7761 12 13.5 12H6.5ZM17 5.5C17 4.11929 15.8807 3 14.5 3H5.5C4.11929 3 3 4.11929 3 5.5V14.5C3 15.8807 4.11929 17 5.5 17H14.5C15.8807 17 17 15.8807 17 14.5V5.5ZM5.5 4H14.5C15.3284 4 16 4.67157 16 5.5V14.5C16 15.3284 15.3284 16 14.5 16H5.5C4.67157 16 4 15.3284 4 14.5V5.5C4 4.67157 4.67157 4 5.5 4Z"\n          fill='.concat(o,"\n        />\n      </svg>"):"shop"==n?'<svg\n        xmlns="http://www.w3.org/2000/svg"\n        width="20"\n        height="20"\n        viewBox="0 0 18.865 21.2"\n      >\n        <g\n          id="Group_9986"\n          data-name="Group 9986"\n          transform="translate(-8908.899 86.1)"\n        >\n          <path\n            id="Vector-1"\n            d="M9,10V5A4,4,0,1,0,1,5v5"\n            transform="translate(8913.33 -86.5)"\n            fill="none"\n            stroke={themeColor}\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            stroke-width="1.2"\n          />\n          <path\n            id="Vector"\n            d="M1.979,2.84A2,2,0,0,1,3.973,1H16.031a2,2,0,0,1,1.994,1.84l.8,10A2,2,0,0,1,16.835,15H3.169a2,2,0,0,1-1.993-2.16l.8-10Z"\n            transform="translate(8908.33 -80.5)"\n            fill="none"\n            stroke={themeColor}\n            stroke-linecap="round"\n            stroke-linejoin="round"\n            stroke-width="1.2"\n          />\n        </g>\n      </svg>':'<svg\n        width="12"\n        height="10"\n        viewBox="0 0 18 14"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M17.7303 6.52416L8.491 0.0766853C8.42008 0.027528 8.3296 0 8.23422 0H6.06989C5.88892 0 5.80577 0.180899 5.94272 0.275281L14.5071 6.25281H0.195645C0.0880404 6.25281 0 6.3236 0 6.41011V7.58989C0 7.6764 0.0880404 7.74719 0.195645 7.74719H14.5046L5.94028 13.7247C5.80333 13.8211 5.88648 14 6.06745 14H8.30514C8.35161 14 8.39807 13.9862 8.43231 13.9607L17.7303 7.47584C17.815 7.41665 17.8829 7.34354 17.9294 7.26145C17.9759 7.17936 18 7.09021 18 7C18 6.90979 17.9759 6.82064 17.9294 6.73855C17.8829 6.65646 17.815 6.58335 17.7303 6.52416Z"\n          fill='.concat(o,"\n        />\n      </svg>")),'\n            <p\n              class="sa-btn-cta-icon-text"\n              style="color: ').concat(0===t?"var(--invertColor)":null,'"\n            >\n              ').concat(F("ai_chat"===e?"Chat":e),"\n            </p>\n          </div>\n        ");i.insertAdjacentHTML("beforeend",a)})));document.querySelectorAll(".sa-btn-cta-icon-box").forEach((function(e){e.addEventListener("click",(function(){V({isWidgetOpened:!0,widgetName:"liveCallButton"}),As("".concat(null==r?void 0:r.find((function(t){return e.id.includes(t)})),"_button")),function(e,t){var n=U(),r=document.getElementById("saleassist-widget-".concat(n.id)),i=document.querySelector(".sa-live-call-widget-btn-container"),o=document.querySelector(".sa-live-call-widget-expanded");if(i.style.display="none",o)o.style.display="block",Cs(e,t),V({isWidgetOpened:!0});else{r.insertAdjacentHTML("beforeend",Hs({logo:n.watermark})),document.querySelector(".sa-live-call-widget-expanded-inner-wrapper").innerHTML="";var a=document.querySelector(".sa-live-call-widget-close-expanded-widget-btn");o=document.querySelector(".sa-live-call-widget-expanded"),a.addEventListener("click",(function(){o.style.display="none",i.style.display="block"})),Cs(e,t),V({isWidgetOpened:!0})}}(e.id,F(null==r?void 0:r.find((function(t){return e.id.includes(t)}))))})),zs(e)})),Js()},Qs=function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=U(),r=t||!j().is_agent_online?U().offline_conversation_types:U().live_conversation_types,i=r.filter((function(e){return e.length>0})).length<2,o=document.querySelector(".sa-live-call-widget-expanded-cta-btn-wrapper-2");i&&o.classList.add("sa-live-call-widget-one-cta");var a={video_call:"Video Call",audio_call:"Audio Call",whatsapp_message:"WhatsApp",text_message:"Message",video_message:"Message",voice_message:"Message",text_feedback:"Feedback",video_feedback:"Feedback",audio_feedback:"Feedback",ai_chat:"Chat",schedule_meeting:"Schedule",feedback_form:"Feedback Form"},s=function(e){return i?function(e){if(e.includes("whatsapp"))return"WhatsApp";if(e.includes("schedule_meeting"))return F("schedule_call");var t=e.split("_"),n=[];return t.forEach((function(e){["button","ai"].includes(e)||n.push(e)})),F(n.join("_"))}(e):a[e]};null===(e=r.filter((function(e){return e.length>0})))||void 0===e||e.forEach((function(e){var t;switch(e){case"video_call":t=Ns({title:s(e)});break;case"audio_call":t=Ls({title:s(e)});break;case"schedule_meeting":t=Ps({title:s(e)});break;case"ai_chat":t=ks({title:s(e)});break;case"video_message":t=Ds({title:s(e)});break;case"voice_message":t=xs({title:s(e)});break;case"text_message":t=Ms({title:s(e)});break;case"whatsapp_message":t=Us({title:s(e)});break;case"video_feedback":t=Vs({title:s(e)});break;case"audio_feedback":t=js({title:s(e)});break;case"text_feedback":t=Bs({title:s(e)});break;case"feedback_form":t=Fs({title:s(e)});break;case"shoppable_video":t=Gs({title:n.shoppable_video_button_message})}o.insertAdjacentHTML("beforeend",t)})),document.querySelectorAll(".sa-btn-cta-icon-box-expanded").forEach((function(e){e.addEventListener("click",(function(){var t;if(e.id.includes("shoppable_video")&&(null===(t=n.shoppable_video_button_url)||void 0===t?void 0:t.trim().length)>0)return window.open(n.shoppable_video_button_url,"_top"),void As("".concat(null==r?void 0:r.find((function(t){return e.id.includes(t)})),"_button"));V({isWidgetOpened:!0,widgetName:"mainPanel"}),As("".concat(null==r?void 0:r.find((function(t){return e.id.includes(t)})),"_button")),Cs(e.id,F(null==r?void 0:r.find((function(t){return e.id.includes(t)}))))})),zs(e)}));var c=document.getElementById("sa-live-call-widget-chat-first-approach-btn");c&&c.addEventListener("click",(function(){V({isWidgetOpened:!0,widgetName:"mainPanel"}),As("ai_chat_button"),Cs("sa-live-call-widget-chat-first-approach-btn","Connect Over Chat")}))},Zs=n(9103),$s=n(8001),ec=n(9923),tc=!1,nc=!1,rc=function(e){if(!j().isWelcomeImage){var t=document.getElementById("sa-live-call-widget-hls-video"),n=document.querySelector(".sa-live-call-widget-mute-unmute-video-btn"),r=n.querySelector(".sa-live-call-widget-mute-icon"),i=n.querySelector(".sa-live-call-widget-unmute-icon");n.addEventListener("click",(function(){t.muted?(t.muted=!1,r.style.display="block",i.style.display="none"):(t.muted=!0,i.style.display="block",r.style.display="none")})),window.location.href.includes("/jump/")&&(r.style.display=e?"none":"block",i.style.display=e?"block":"none")}},ic=function(e){if(!j().isWelcomeImage){var t=document.querySelector(".sa-live-call-widget-expanded"),n=document.getElementById("sa-live-call-widget-hls-video"),r=document.querySelector(".sa-live-call-widget-play-video-btn"),i=document.querySelector(".sa-live-call-widget-pause-video-btn");t.addEventListener("mouseenter",(function(e){n.paused||i.classList.remove("sa-live-call-widget-d-hidden")})),t.addEventListener("mouseleave",(function(e){n.paused||i.classList.add("sa-live-call-widget-d-hidden")}));i.addEventListener("click",(function(){n&&(n.pause(),r.classList.remove("sa-live-call-widget-d-hidden"),i.classList.add("sa-live-call-widget-d-hidden"))})),r.addEventListener("click",(function(){n&&(n.play(),r.classList.add("sa-live-call-widget-d-hidden"),i.classList.remove("sa-live-call-widget-d-hidden"))})),e&&r.click()}},oc=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=U(),n="shoppable_video"===t.button_type||"video_icon"===t.button_type&&t.allow_popup_video;if(!j().isWelcomeImage&&n&&!tc){var r=document.querySelector(".sa-live-call-widget-btn-container");if(e){r.classList.remove("sa-live-call-widget-btn-container-pop-up-video");var i=r.querySelector(".sa-live-call-widget-close-pop-up-video-btn");null==i||i.remove()}else{r.classList.add("sa-live-call-widget-btn-container-pop-up-video"),r.insertAdjacentHTML("beforeend",'<div class="sa-live-call-widget-close-pop-up-video-btn">\n          <svg\n            stroke="currentColor"\n            fill="none"\n            stroke-width="0"\n            viewBox="0 0 24 24"\n            height="16"\n            width="16"\n            xmlns="http://www.w3.org/2000/svg"\n          >\n            <path\n              d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z"\n              fill="currentColor"\n            ></path>\n          </svg>\n        </div>');var o=r.querySelector(".sa-live-call-widget-close-pop-up-video-btn");o.addEventListener("click",(function(){r.classList.remove("sa-live-call-widget-btn-container-pop-up-video"),tc=!0,o.remove()}))}}},ac=function(){var e,t=null===(e=j().intentsData)||void 0===e?void 0:e.intents;if(t&&0!==(null==t?void 0:t.length)){var n=document.querySelector(".sa-live-call-widget-intent-container"),r="";t.forEach((function(e,t){r+='\n      <div class="sa-live-call-widget-intent-box">\n        <span class="sa-live-call-widget-intent-number"\n          >'.concat(String.fromCharCode(65+t),"</span\n        >\n        <span>").concat(e.name,"</span>\n      </div>\n    ")})),n.insertAdjacentHTML("beforeend",r);var i=document.querySelectorAll(".sa-live-call-widget-intent-box"),o=document.getElementById("sa-live-call-widget-hls-video"),a=document.querySelector(".sa-live-call-widget-intent-title");i.forEach((function(e,n){e.addEventListener("click",(function(){0===n?(o.src=U().source_welcome_video_url,a.innerHTML="",a.style.display="none"):(o.src=t.at(n-1).media.url,a.innerHTML=t.at(n-1).name,a.style.display="block",setTimeout((function(){a.style.display="none"}),11e3)),e.style.display="none",i.forEach((function(e,t){n!==t&&(e.style.display="flex")}))}))}))}},sc=function(e,t){var n,r=j().intentsData;return!(0===e.length||(null==r||null===(n=r.intents)||void 0===n?void 0:n.length)>0&&e.length<2)&&t},cc=function(){var e,t,n=U(),r=n.source_welcome_video_url,i=j().is_agent_online,o=j().form_factor,a=j().parentElementId,s="button"===o||!1,c="embed"===o||!1,l=i?n.live_conversation_types.filter((function(e){return e.length>0})):n.offline_conversation_types.filter((function(e){return e.length>0})),d=document.getElementById("saleassist-widget-".concat(n.id));d.innerHTML=Zs({allow_trigger_messages:n.allow_trigger_messages,button_position:n.button_position,trigger_messages:n.trigger_messages,button_type:n.button_type,isIconButton:"icon"===n.button_type,isWelcomeImage:j().isWelcomeImage,source_welcome_video_url:n.source_welcome_video_url,source_image_url:n.source_image_url,buttonPositionOldClassName:(t=n.button_position,"bottom_right"===t?"safemeet-btn-bottom-right ":"bottom_left"===t?"safemeet-btn-bottom-left ":"top_left"===t?"safemeet-btn-top-left ":"safemeet-btn-top-right ")});var u,p=document.querySelector(".sa-live-call-widget-btn-container"),h=document.querySelector(".sa-live-call-widget-btn");if("bottom_right"===(u=U().button_position)?document.documentElement.style.setProperty("--saLiveWidgetBtnPosition","auto 10px 10px auto"):"bottom_left"===u?document.documentElement.style.setProperty("--saLiveWidgetBtnPosition","auto auto 10px 10px"):"top_left"===u?document.documentElement.style.setProperty("--saLiveWidgetBtnPosition","10px auto auto 10px"):document.documentElement.style.setProperty("--saLiveWidgetBtnPosition","10px 10px auto auto"),oc(),n.allow_trigger_messages&&0!==(null===(e=n.trigger_messages)||void 0===e?void 0:e.filter((function(e){return e.trim().length>0})).length))Xs();else{var f=document.querySelector("#sa-live-call-widget-trigger-message-container");f&&(f.style.display="none")}var m=document.querySelector(".sa-live-call-widget-expanded"),g=i?n.live_cta_text:n.offline_cta_text;if(h.addEventListener("click",(function(){if(V({isWidgetOpened:!0,widgetName:"liveCallButton"}),As(!0),p.style.display="none",Js(!0),oc(!0),m)m.style.display="block",B(r,!0);else{var e,t;d.insertAdjacentHTML("beforeend",$s({logo:n.watermark,chatFirstApproach:n.chat_first_approach,ctaText:sc(l,g),isWelcomeImage:j().isWelcomeImage,sourceWelcomeVideo:n.source_welcome_video_url,intents:(null===(e=j().intentsData)||void 0===e||null===(t=e.intents)||void 0===t?void 0:t.length)>0&&j().intentsData.intents,verticalContainerClass:l.length<2?"sa-live-call-widget-intent-vertical-container":"",poweredBy:!j().addons.remove_powered_by,isMuted:window.location.href.includes("/jump/")?"muted":""})),rc(!0),ic(),Qs(),ac();var o=document.querySelector(".sa-live-call-widget-close-expanded-widget-btn");m=document.querySelector(".sa-live-call-widget-expanded"),o.addEventListener("click",(function(){var e,t,r=j().videoCallTimers;Array.isArray(r)&&Go(r),V({isWidgetOpened:!1,widgetName:j().widgetName||"mainPanel"}),As(!0),m.style.display=c?"block":"none",p.style.display=s||c?"none":"block",document.querySelector(".sa-live-call-widget-expanded-inner-wrapper").innerHTML=ec({chatFirstApproach:n.chat_first_approach,ctaText:sc(l,g),isWelcomeImage:j().isWelcomeImage,sourceWelcomeVideo:n.source_welcome_video_url,intents:(null===(e=j().intentsData)||void 0===e||null===(t=e.intents)||void 0===t?void 0:t.length)>0&&j().intentsData.intents,verticalContainerClass:l.length<2?"sa-live-call-widget-intent-vertical-container":""}),rc(),ic(window.location.href.includes("/jump/")),Qs(),oc(!1),Js(!1),ac()}))}if(n.skip_welcome_screen){var a=document.getElementById("sa-live-call-widget-video_call-btn"),u=document.getElementById("sa-live-call-widget-schedule_meeting-btn"),h=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper");i&&a&&(h.innerHTML="",a.click(),nc=!0),!i&&u&&(h.innerHTML="",u.click(),nc=!0)}})),Qe("widget_call")){h.click();var v=document.getElementById("sa-live-call-widget-video_call-btn"),_=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper");i&&v&&(_.innerHTML="",v.click(),nc=!0)}if(s){var E=document.getElementById("saleassist-button-".concat(n.id));if(E)p.style.display="none",E.addEventListener("click",(function(){h.click();var e=document.getElementById("sa-live-call-widget-video_call-btn"),t=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper");["www.irth.in","irth.in"].includes(window.location.hostname)&&i&&e&&(t.innerHTML="",e.click(),nc=!0)}));else{h.click();var y=document.getElementById("sa-live-call-widget-video_call-btn"),w=document.querySelector(".sa-live-call-widget-expanded-inner-wrapper");["www.irth.in","irth.in"].includes(window.location.hostname)&&i&&y&&(w.innerHTML="",y.click(),nc=!0)}}if(c){var b=document.getElementById("".concat(a));b.classList.add("sa-live-call-widget-embed-page"),p.style.display="none",h.click(),m.style.position="relative",m.style.inset="unset",b.appendChild(d)}},lc=function(){var e=document.querySelector(".sa-live-call-widget-go-back-btn");nc?e.style.cursor="not-allowed":e.addEventListener("click",(function(){var e,t,n=U(),r=j().is_agent_online,i=r?n.live_conversation_types.filter((function(e){return e.length>0})):n.offline_conversation_types.filter((function(e){return e.length>0})),o=r?n.live_cta_text:n.offline_cta_text;document.querySelector(".sa-live-call-widget-expanded-inner-wrapper").innerHTML=ec({chatFirstApproach:n.chat_first_approach,ctaText:sc(i,o),isWelcomeImage:j().isWelcomeImage,sourceWelcomeVideo:n.source_welcome_video_url,intents:(null===(e=j().intentsData)||void 0===e||null===(t=e.intents)||void 0===t?void 0:t.length)>0&&j().intentsData.intents,verticalContainerClass:i.length<2?"sa-live-call-widget-intent-vertical-container":""}),rc(),ic(),B(),Qs(),oc(!1),Js(!1),ac()}))},dc=function(e,t,n,r){if(e){var i=e.includes("#")?e:s.colors[e];0===i.indexOf("#")&&(i=i.slice(1));var o=parseInt(i.slice(0,2),16),a=parseInt(i.slice(2,4),16),c=parseInt(i.slice(4,6),16);return i=t&&o>220&&a>220&&c>220?"#373737":"#"+i,n?(0===i.indexOf("#")&&(i=i.slice(1)),"rgba("+parseInt(i.slice(0,2),16)+", "+parseInt(i.slice(2,4),16)+", "+parseInt(i.slice(4,6),16)+(null!==r?", "+r:", 1")+")"):i}return s.colors.saleassist};function uc(e,t){return t=t||2,(new Array(t).join("0")+e).slice(-t)}var pc=function(e){document.documentElement.style.setProperty("--themeColor",dc(e,!0),"important"),document.documentElement.style.setProperty("--themeColorWithOpacity",dc(e,!0)+"60","important"),document.documentElement.style.setProperty("--invertColor",function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.colors.saleassist,i=arguments.length>1?arguments[1]:void 0,o=r.includes("#")?r:s.colors[r];if(0===(null===(e=o)||void 0===e?void 0:e.indexOf("#"))&&(o=o.slice(1)),3===(null===(t=o)||void 0===t?void 0:t.length)&&(o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]),6!==(null===(n=o)||void 0===n?void 0:n.length))throw new Error("Invalid HEX color.");var a=parseInt(o.slice(0,2),16),c=parseInt(o.slice(2,4),16),l=parseInt(o.slice(4,6),16);return i?.299*a+.587*c+.114*l>186?"#000000":"#FFFFFF":(a=(255-a).toString(16),c=(255-c).toString(16),l=(255-l).toString(16),"#"+uc(a)+uc(c)+uc(l))}(e,!0),"important")};function hc(e){return hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hc(e)}function fc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fc(Object(n),!0).forEach((function(t){gc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gc(e,t,n){return(t=wc(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vc(){vc=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==hc(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function _c(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Ec(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){_c(o,r,i,a,s,"next",e)}function s(e){_c(o,r,i,a,s,"throw",e)}a(void 0)}))}}function yc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,wc(r.key),r)}}function wc(e){var t=function(e,t){if("object"!==hc(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==hc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===hc(t)?t:String(t)}const bc=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.id?(this.widgetID=t.id,this.form_factor=t.form_factor,this.parentElementId=t.parentElementId,this.init()):console.warn("SaleAssist: Please pass an id to initialize the SDK")}var t,n,r,i,o,a,c,l,d;return t=e,n=[{key:"getOnlineStatus",value:(d=Ec(vc().mark((function e(){var t;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.get(s.url.SOURCE,"/".concat(this.widgetID).concat(H("form_data")?"/"+H("form_data").form_id:"","/can_queue"));case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return d.apply(this,arguments)})},{key:"getAddOns",value:(l=Ec(vc().mark((function e(){var t;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.get(s.url.SOURCE,"/addons/".concat(this.widgetID));case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"getSourceData",value:(c=Ec(vc().mark((function e(){var t,n;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.get(s.url.SOURCE,"/"+this.widgetID);case 2:if(!(t=e.sent)){e.next=15;break}return e.prev=4,n="",n="video_icon"===t.button_type||"video_message"===t.button_type?"video_icon":t.button_type,V({impressionType:n,isWelcomeImage:/\.(jpg|jpeg|png|webp|avif|gif|svg)$/.test(t.source_welcome_video_url)}),e.next=10,u.post(s.url.SOURCE,"/register_impression/".concat(n,"/").concat(t.id));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),console.error(e.t0);case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(){return c.apply(this,arguments)})},{key:"getIntents",value:(a=Ec(vc().mark((function e(){var t;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.get(s.url.SOURCE,"/".concat(this.widgetID,"/video-workflows"));case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return a.apply(this,arguments)})},{key:"getProducts",value:(o=Ec(vc().mark((function e(){var t;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.get(s.url.SOURCE,"/fetch_products/".concat(this.widgetID));case 3:return t=e.sent,console.log(t),e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return o.apply(this,arguments)})},{key:"init",value:(i=Ec(vc().mark((function e(){var t;return vc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.createElement("div")).id="saleassist-widget-".concat(this.widgetID),t.classList.add("saleassist"),document.body.appendChild(t),H("session_data")||G("session_data",W()),e.next=7,this.getSourceData();case 7:return this.sourceData=e.sent,M(mc(mc({},this.sourceData),{},{offline_conversation_types:"shoppable_video"===this.sourceData.button_type?["shoppable_video"]:this.sourceData.offline_conversation_types,live_conversation_types:"shoppable_video"===this.sourceData.button_type?["shoppable_video"]:this.sourceData.live_conversation_types})),e.t0=V,e.next=12,this.getOnlineStatus();case 12:return e.t1=e.sent,e.next=15,this.getAddOns();case 15:return e.t2=e.sent,e.next=18,this.getIntents();case 18:return e.t3=e.sent,e.next=21,this.getProducts();case 21:e.t4=e.sent,e.t5=this.form_factor,e.t6=this.parentElementId,e.t7=H("form_data"),e.t8=window.location.href.includes("embed=true")?"embed":void 0,e.t9={is_agent_online:e.t1,addons:e.t2,intentsData:e.t3,products:e.t4,form_factor:e.t5,parentElementId:e.t6,form_data:e.t7,widgetFormFactor:e.t8},(0,e.t0)(e.t9),pc(this.sourceData.theme),document.documentElement.style.setProperty("--saLiveCallWidgetDefaultContainerPaddingTop",this.sourceData.watermark&&this.sourceData.watermark.length>0?"51px":"15px","important"),cc();case 31:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],n&&yc(t.prototype,n),r&&yc(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();var Sc=n(7484),Tc=n.n(Sc);function Cc(e){return Cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cc(e)}function Rc(){Rc=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new C(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function p(){}function h(){}function f(){}var m={};c(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(R([])));v&&v!==t&&n.call(v,o)&&(m=v);var _=f.prototype=p.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==Cc(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,r(_,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=c(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),c(_,s,"Generator"),c(_,o,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function Ic(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function Oc(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ic(o,r,i,a,s,"next",e)}function s(e){Ic(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Ac(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==Cc(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Cc(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===Cc(o)?o:String(o)),r)}var i,o}const Nc=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.event_name=t.event_name,this.data=t.data,this.init()}var t,n,r,i,o;return t=e,n=[{key:"saveEvent",value:(o=Oc(Rc().mark((function e(t){var n,r;return Rc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,u.get(s.url.EVENT,"?".concat(t));case 4:r=e.sent,n=r,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(e){return o.apply(this,arguments)})},{key:"init",value:(i=Oc(Rc().mark((function e(){var t,n,r;return Rc().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=H("session_data"),!(j().form_data&&j().form_data.people_id&&t)){e.next=6;break}return n={people_id:j().form_data.people_id,client_id:U().client_id,source_id:U().id,session_id:t,event:this.event_name,data:JSON.stringify(this.data),z:Tc()().valueOf()},r=Object.keys(n).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(n[e]))})).join("&"),e.next=6,this.saveEvent(r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],n&&Ac(t.prototype,n),r&&Ac(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();"undefined"!=typeof window&&(window.saleassist=window.saleassist||{},window.saleassist.mountWidget=function(e){var t=e.id,n=e.form_factor,r=e.parentElementId;return new bc({id:t,form_factor:n,parentElementId:r})},window.EmbeddableWidget=window.saleassist||{},window.EmbeddableWidget.mount=function(e){var t=e.source_key,n=e.form_factor;return new bc({id:t,form_factor:n})},window.saleassist.track=function(e,t){return new Nc({event_name:e,data:t})})})(),r})()));